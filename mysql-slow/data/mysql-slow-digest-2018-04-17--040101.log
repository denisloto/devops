
# A software update is available:
#   * The current version for Percona::Toolkit is 3.0.5


# 3.2s user time, 30ms system time, 33.41M rss, 242.62M vsz
# Current date: Tue Apr 17 04:01:08 2018
# Hostname: aliyun-hz-hd1-E-bgp-4
# Files: /data/script/mysql-slow-digest/mysql-slow--2018-04-17--040101.log
# Overall: 7.50k total, 201 unique, 0.09 QPS, 0.54x concurrency __________
# Time range: 2018-04-16 04:01:49 to 2018-04-17 04:00:37
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time         46906s      2s    168s      6s     26s     10s      3s
# Lock time            62s     9us     20s     8ms   332us   390ms    98us
# Rows sent        149.18M       0  24.33M  20.38k  918.49 517.29k    1.96
# Rows examine      71.82G       0 202.51M   9.81M  92.12M  25.54M   1.95M
# Rows affecte     835.98k       0  95.74k  114.20       0   2.83k       0
# Query size         7.53M      25  47.23k   1.03k   3.52k   1.44k  463.90

# Profile
# Rank Query ID           Response time   Calls R/Call  V/M   Item
# ==== ================== =============== ===== ======= ===== ============
#    1 0x7CB8293C8D8EFAA6 7626.5810 16.3%   264 28.8886  1.64 SELECT lvb_lesson_video lvb_order_lesson lvb_lesson lvb_lesson_ext
#    2 0x4EC8A0DB8530E4CC 7229.5446 15.4%   244 29.6293  1.62 SELECT lvb_lesson_video lvb_order_lesson lvb_lesson lvb_lesson_ext
#    3 0x597AE1A5E18B09B5 5908.7045 12.6%  1677  3.5234  0.09 SELECT erp_lesson_book_files mis_user_info erp_lesson_docs
#    4 0x0F3305545EA49428 5623.9709 12.0%  1570  3.5821  1.81 SELECT erp_lesson_book_files mis_user_info erp_lesson_docs
#    5 0xC8F5044C7E2EADE7 3231.8684  6.9%    84 38.4746 47.23 SELECT erp_lessons erp_conf_course_subjects wx_service_msg
#    6 0x802478FD2EC71668 1896.9088  4.0%   145 13.0821  0.82 INSERT SELECT client_sea erp_clients erp_client_follow erp_follow_status callcenter_outer_log
#    7 0x874AC800CFB0B05C 1829.9165  3.9%   720  2.5416  0.08 SELECT app_notification
#    8 0x5FDDE1EC4813C54F 1285.5697  2.7%    81 15.8712  6.74 SELECT erp_lesson_application erp_lessons erp_conf_course_subjects erp_conf_student_grades wx_service_msg
#    9 0x0924E63A71759FDC  902.9689  1.9%   116  7.7842  0.19 INSERT SELECT client_sea erp_clients erp_client_follow erp_follow_status callcenter_outer_log
#   10 0x5188E74C090BF609  748.7284  1.6%   235  3.1861  0.41 SELECT lvb_lesson_video lvb_order_lesson lvb_order lvb_order_lesson lvb_order lvb_order_lesson lvb_lesson_series lvb_series_lesson_ref lvb_lesson lvb_lesson_ext
#   11 0x9802F83F3C5469D4  654.5005  1.4%   242  2.7045  0.09 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects mis_work_order
#   12 0xC275A476B01092D4  485.7873  1.0%    16 30.3617  1.67 SELECT lvb_lesson_video lvb_order_lesson lvb_lesson lvb_lesson_ext
#   13 0xAF7087AE5BCF7A6F  386.7892  0.8%   138  2.8028  0.09 SELECT erp_lessons erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects mis_user_info lesson_comment erp_client_cr
#   14 0xD9CFEA53507AC560  351.9728  0.8%   103  3.4172  0.06 SELECT mis_user_info erp_clients mis_user_info erp_lessons t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   15 0xED7DE5AA05230157  303.8681  0.6%   116  2.6196  0.13 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_contract mis_work_order
#   16 0xF83D3854B6294F5F  299.0659  0.6%   115  2.6006  0.10 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_contract mis_work_order
#   17 0x984170966838BF4D  295.4087  0.6%    51  5.7923  1.53 SELECT mis_user_info erp_clients mis_user_info erp_lessons t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   18 0x4A078E636F95F53C  291.1589  0.6%   107  2.7211  0.13 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_contract mis_work_order
#   19 0xD824344EA5B63403  268.6609  0.6%   105  2.5587  0.09 SELECT UNION erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_contract_orders erp_contract erp_lessons erp_contract_orders erp_lessons erp_lesson_plan erp_contract_orders teach_lesson_plan mis_work_order
#   20 0x531669EDCDB6CD4C  262.7558  0.6%     3 87.5853  3.23 SELECT erp_clients mis_user_info t_user_info user_device erp_lessons erp_conf_student_grades wechat_user_info erp_client_family
#   21 0x0AAEBB16BF6FA2DC  255.6047  0.5%    10 25.5605  1.22 SELECT lvb_lesson_video lvb_order_lesson lvb_lesson lvb_lesson_ext
#   22 0x807CEFFF6917F85F  247.9380  0.5%    97  2.5561  0.06 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects mis_work_order
#   24 0x08FE275627AABB49  237.9976  0.5%   104  2.2884  0.02 SELECT erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_lessons mis_work_order erp_student_teach_special
#   25 0x26476FF6C3C0CA5D  200.2649  0.4%    74  2.7063  0.08 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_contract mis_work_order
#   26 0x21B83224C5BD6EDA  185.3643  0.4%    33  5.6171  0.14 SELECT erp_clients mis_user_info erp_client_family t_user_info
#   27 0xB66AF273D4CC2576  178.3718  0.4%    58  3.0754  0.34 SELECT erp_lessons mis_user_info erp_clients
#   29 0xF5FEACC32429CC03  166.3917  0.4%    48  3.4665  1.11 SELECT server_trail_and_voice erp_lesson_docs mis_user_info erp_clients mis_user_info erp_lessons t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   34 0x8DF7748590F106FA  122.3904  0.3%    51  2.3998  0.08 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects mis_work_order
#   35 0x7A6044C4585A6A8C  110.9485  0.2%    34  3.2632  0.21 SELECT lvb_lesson_video lvb_order_lesson lvb_order lvb_order_lesson lvb_order lvb_order_lesson lvb_series_lesson_ref lvb_lesson_series lvb_lesson lvb_lesson_ext lvb_series_lesson_ref
#   36 0xBC6AD8511E5DCBAA  109.3691  0.2%    35  3.1248  0.12 SELECT server_trail_and_voice erp_lesson_docs mis_user_info erp_clients mis_user_info erp_lessons t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   37 0x24A7383D45436873  109.0876  0.2%    15  7.2725  0.52 SELECT mis_user_info erp_clients mis_user_info erp_lessons t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   41 0x223BB93DB6B60FD2   96.9179  0.2%    39  2.4851  0.04 SELECT erp_clients erp_client_channel erp_client_event user_test erp_channel erp_channel_cate
#   45 0x60E69C3EBFFC9431   89.5974  0.2%    36  2.4888  0.03 SELECT server_trail_and_voice erp_lesson_docs mis_teacher_info erp_lessons t_user_info erp_clients erp_conf_course_subjects erp_conf_student_grades www_config
#   48 0xF928383DFAECA667   82.5320  0.2%    29  2.8459  0.18 SELECT lvb_lesson_video lvb_order_lesson lvb_order lvb_order_lesson lvb_order lvb_order_lesson lvb_lesson_series lvb_series_lesson_ref lvb_lesson lvb_lesson_ext
#   50 0x50E7215F3276D4D0   82.3375  0.2%    17  4.8434  0.59 SELECT lvb_lesson_video lvb_order_lesson lvb_lesson lvb_lesson_ext
#   53 0xED82BEFCE140F1FC   70.6795  0.2%    21  3.3657  0.05 SELECT server_trail_and_voice erp_lesson_docs erp_lessons erp_clients t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   54 0xF5446E0AC6AB1913   69.8936  0.1%    24  2.9122  0.11 SELECT lvb_order_lesson lvb_lesson_video lvb_order_lesson lvb_lesson lvb_lesson_ext lvb_order_lesson lvb_order
#   56 0xA605B4FF51F45E6F   65.3204  0.1%    21  3.1105  0.08 SELECT erp_lessons erp_clients t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   57 0x53E68A2F4F0BCA83   62.2471  0.1%    23  2.7064  0.18 SELECT erp_clients erp_client_follow erp_follow_status
#   60 0x533B6E4A3847D8FE   60.7001  0.1%    21  2.8905  0.07 SELECT erp_channel_cate erp_channel erp_channel_cate erp_client_channel erp_clients erp_client_event user_test
#   61 0x4E36042C05849EC9   60.6373  0.1%    23  2.6364  0.12 SELECT lvb_lesson_video lvb_order_lesson lvb_lesson_series lvb_series_lesson_ref lvb_lesson lvb_lesson_ext
#   62 0x9954249D2259D880   60.4891  0.1%    11  5.4990  0.43 SELECT mis_user_info erp_clients mis_user_info erp_lessons t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   63 0x4B83C48FBD8F9C61   58.6692  0.1%    22  2.6668  0.03 SELECT erp_contract erp_contract_orders erp_lessons user_test erp_contract erp_contract_orders erp_lessons
#   71 0x4E33A4D16C9051F7   47.2779  0.1%    16  2.9549  0.28 SELECT erp_contract_orders erp_order_flow user_test erp_contract_orders erp_order_flow
#   72 0x1937B21D3A757C2D   44.9478  0.1%    15  2.9965  0.05 SELECT erp_channel_cate erp_channel erp_channel_cate erp_client_channel erp_clients erp_client_event user_test
#   74 0x8FC934C0FB674018   41.5720  0.1%    13  3.1978  0.05 SELECT erp_channel_cate erp_channel erp_channel_cate erp_client_channel erp_clients erp_client_event user_test
#   76 0x5B97519418BA5B13   39.6088  0.1%    11  3.6008  0.14 SELECT server_trail_and_voice erp_lesson_docs mis_user_info erp_clients mis_user_info erp_lessons t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   78 0x7096D48A29F00CFF   39.0312  0.1%    18  2.1684  0.01 SELECT mis_teacher_info erp_lessons t_user_info erp_clients erp_conf_course_subjects erp_conf_student_grades www_config
#   83 0xE8A1BEA6695823B2   32.3657  0.1%    11  2.9423  0.08 SELECT erp_channel_cate erp_channel erp_channel_cate erp_client_channel erp_clients erp_client_event user_test
#   84 0x0821DDBC5A0330A5   31.9254  0.1%    14  2.2804  0.03 SELECT server_trail_and_voice erp_lesson_docs mis_teacher_info erp_lessons t_user_info erp_clients erp_conf_course_subjects erp_conf_student_grades www_config
#   85 0x4EF2377A4B6CC5CD   30.5025  0.1%    12  2.5419  0.05 SELECT UNION erp_teacher_schedule mis_teacher_info erp_conf_lesson_schedule_? mis_calendar_week mis_teacher_info erp_timetable erp_conf_timetable
#   86 0x8EA77ECFE25B7D83   30.2013  0.1%    11  2.7456  0.22 SELECT erp_client_follow erp_clients
#   89 0x7146E02EEE59AD24   27.8033  0.1%    10  2.7803  0.19 SELECT erp_contract_orders erp_contract erp_clients mis_user_info erp_lessons erp_learn_report user_test
#   91 0x6A1708C026B47568   26.9988  0.1%    11  2.4544  0.07 SELECT erp_clients erp_client_channel erp_client_event user_test erp_channel erp_channel_cate
#   93 0x9A4B12447FDDD372   26.6841  0.1%    11  2.4258  0.01 SELECT erp_contract_orders erp_order_flow user_test
#   95 0x9F41075C48CFAA92   25.1161  0.1%    11  2.2833  0.01 SELECT erp_lessons erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects mis_user_info lesson_comment erp_client_cr
#   97 0xC4EDC64AF48E3254   22.3569  0.0%    11  2.0324  0.00 SELECT erp_contract_orders erp_order_flow erp_lessons
#   98 0x7FAC2E0A44CA4FAE   22.3268  0.0%    10  2.2327  0.01 SELECT erp_channel erp_clients user_test erp_lesson_application erp_lessons erp_clients erp_channel user_test erp_contract erp_clients erp_channel user_test
# MISC 0xMISC             3749.0097  8.0%   333 11.2583   0.0 <143 ITEMS>

# Query 1: 0.00 QPS, 0.11x concurrency, ID 0x7CB8293C8D8EFAA6 at byte 8354100
# This item is included in the report because it matches --limit.
# Scores: V/M = 1.64
# Time range: 2018-04-16 06:06:07 to 2018-04-17 01:23:07
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          3     264
# Exec time     16   7627s     21s     45s     29s     40s      7s     26s
# Lock time      0    13ms    37us    83us    49us    60us     6us    47us
# Rows sent      0 242.57k     935     944  940.88  918.49       0  918.49
# Rows examine  33  23.87G  91.83M  93.02M  92.59M  92.12M 609.60k  92.12M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     3 297.00k   1.12k   1.12k   1.12k   1.12k       0   1.12k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,lessonName,playBegin,playEnd,orginalPrice,currentPrice,entryLimit,img1,img2,
        if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
        WHERE l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
        (SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount
        FROM
        lvb_lesson l left join lvb_lesson_ext le on l.lessonId = le.lessonFid
        where
        (
          
             
              
                1=1
             
          
        )
        and
        (
          
             
              
                1=1
             
          
        )
        and
        (
          
             
             
             
              
                1=1
             
          
        )
        and
        (
          
             
             
              
                1=1
             
          
        )
        and l.applyFids  like concat('%',concat(1,'%'))
        and now() >= l.validBegin
        and now()  <=  l.validEnd
        group by l.lessonId\G

# Query 2: 0.00 QPS, 0.10x concurrency, ID 0x4EC8A0DB8530E4CC at byte 8348715
# This item is included in the report because it matches --limit.
# Scores: V/M = 1.62
# Time range: 2018-04-16 05:46:14 to 2018-04-17 02:48:18
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          3     244
# Exec time     15   7230s     21s     45s     30s     42s      7s     27s
# Lock time      0    62ms    33us    11ms   255us   366us   709us   236us
# Rows sent      0 224.37k     935     944  941.61  918.49    0.00  918.49
# Rows examine  30  22.08G  91.83M  92.98M  92.67M  92.12M 588.56k  92.12M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size    11 899.51k   3.69k   3.69k   3.69k   3.69k       0   3.69k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,lessonName,playBegin,playEnd,orginalPrice,currentPrice,entryLimit,img1,img2,
        if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
        WHERE l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
        (SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount
        FROM
        lvb_lesson l left join lvb_lesson_ext le on l.lessonId = le.lessonFid
        where
        (
          
              
                subjectIds like concat (concat('%','1'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','2'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','3'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','4'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','5'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','6'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','7'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','8'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','9'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','13'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','16'),'%')
             
             
          
        )
        and
        (
          
              
                termIds like concat (concat('%','130'),'%')
             
             
         
             or 
                termIds like concat (concat('%','140'),'%')
             
             
         
             or 
                termIds like concat (concat('%','150'),'%')
             
             
         
             or 
                termIds like concat (concat('%','160'),'%')
             
             
         
             or 
                termIds like concat (concat('%','170'),'%')
             
             
         
             or 
                termIds like concat (concat('%','210'),'%')
             
             
         
             or 
                termIds like concat (concat('%','220'),'%')
             
             
         
             or 
                termIds like concat (concat('%','230'),'%')
             
             
         
             or 
                termIds like concat (concat('%','240'),'%')
             
             
         
             or 
                termIds like concat (concat('%','310'),'%')
             
             
         
             or 
                termIds like concat (concat('%','320'),'%')
             
             
         
             or 
                termIds like concat (concat('%','330'),'%')
             
             
         
             or 
                termIds like concat (concat('%','410'),'%')
             
             
          
        )
        and
        (
          
             
             
             
              
                1=1
             
          
        )
        and
        (
          
             
             
              
                1=1
             
          
        )
        and l.applyFids  like concat('%',concat(1,'%'))
        and now() >= l.validBegin
        and now()  <=  l.validEnd
        group by l.lessonId\G

# Query 3: 0.02 QPS, 0.09x concurrency, ID 0x597AE1A5E18B09B5 at byte 2699853
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.09
# Time range: 2018-04-16 05:55:46 to 2018-04-17 01:09:29
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         22    1677
# Exec time     12   5909s      3s      6s      4s      4s   561ms      3s
# Lock time      0   140ms    19us     1ms    83us   144us    69us    84us
# Rows sent      0  18.38k       0      44   11.22   19.46    7.23    9.83
# Rows examine   4   3.28G   2.00M   2.01M   2.00M   1.95M       0   1.95M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size    10 786.05k     476     491  479.97  487.09    5.17  463.90
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        erpuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_book_files'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_book_files`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT b.*,mui.userRealName operatorName,
			
			t1.importCnt
			FROM
						erp_lesson_book_files b
			LEFT JOIN mis_user_info mui on mui.userId = b.operator	
			LEFT JOIN (
				SELECT t.fileId,COUNT(DISTINCT t.lessonId) importCnt
						FROM erp_lesson_docs t
						WHERE t.parentId = 0 AND t.fileId != 0
						GROUP BY t.fileId 
			) t1 ON t1.fileId=b.fileId
		 WHERE catalogCode like '%vxbmmq/%' and parentId = 0 
		order by fileStatus desc,
		 
		createTime desc limit 0,20\G

# Query 4: 0.02 QPS, 0.08x concurrency, ID 0x0F3305545EA49428 at byte 170443
# This item is included in the report because it matches --limit.
# Scores: V/M = 1.81
# Time range: 2018-04-16 05:55:01 to 2018-04-17 01:09:27
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         20    1570
# Exec time     11   5624s      3s    100s      4s      4s      3s      3s
# Lock time      0   160ms    19us    21ms   101us   144us   551us    84us
# Rows sent      0   1.53k       0       1    1.00    0.99    0.03    0.99
# Rows examine   4   3.07G   4.85k   2.01M   2.00M   1.95M  50.30k   1.95M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     6 502.76k     324     338  327.91  329.68       7  329.68
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        erpuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+  #
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_book_files'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_book_files`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT count(*) FROM erp_lesson_book_files b LEFT JOIN mis_user_info mui ON mui.userId = b.operator LEFT JOIN (SELECT t.fileId, COUNT(DISTINCT t.lessonId) importCnt FROM erp_lesson_docs t WHERE t.parentId = 0 AND t.fileId != 0 GROUP BY t.fileId) t1 ON t1.fileId = b.fileId WHERE catalogCode LIKE '%szxeoe/%' AND parentId = 0\G

# Query 5: 0.00 QPS, 0.04x concurrency, ID 0xC8F5044C7E2EADE7 at byte 9636625
# This item is included in the report because it matches --limit.
# Scores: V/M = 47.23
# Time range: 2018-04-16 04:02:07 to 2018-04-17 03:02:50
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1      84
# Exec time      6   3232s      2s    168s     38s    118s     43s     16s
# Lock time      0     4ms    24us   123us    47us    66us    15us    44us
# Rows sent      0  11.60k       5     611  141.37  592.07  177.42   49.17
# Rows examine   7   5.13G   2.42M 202.51M  62.56M 182.38M  71.39M  25.91M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  57.99k     704     707  706.89  685.39    0.00  685.39
# String:
# Databases    yimi
# Hosts        10.81.244.3 (20/23%), 10.31.53.111 (16/19%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ###########################
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'wx_service_msg'\G
#    SHOW CREATE TABLE `yimi`.`wx_service_msg`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
			lesson_temp.startTime,
			lesson_temp.endTime,
			lesson_temp.lessonId,
			lesson_temp.teacherId,
			lesson_temp.studentId,
			eccs.subjectName
		from
			(select els.startTime,
					els.endTime,
					els.subjectId,
					els.teacherId,
					els.studentId,
					els.lessonId
			from erp_lessons els
			where els.lessonType=10 and els.lessonStatus=0 and els.startTime   >=   NOW()
			and els.startTime   <=   '2018-04-18 03:00:02.048000') as lesson_temp
		left join erp_conf_course_subjects eccs on eccs.subjectId=lesson_temp.subjectId
		left join wx_service_msg wsm on wsm.bizFid=lesson_temp.lessonId and wsm.bizType='LESSON'
		and wsm.bizTimeType='1D' and wsm.userType='STU'
		where wsm.tId is null\G

# Query 6: 0.00 QPS, 0.02x concurrency, ID 0x802478FD2EC71668 at byte 459302
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.82
# Time range: 2018-04-16 04:10:15 to 2018-04-17 04:00:12
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     145
# Exec time      4   1897s      8s     30s     13s     19s      3s     13s
# Lock time      0    30ms   138us   307us   209us   260us    35us   204us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   1   1.02G   3.91M   8.69M   7.18M   8.43M   1.95M   8.03M
# Rows affecte  16 141.60k    1000    1000    1000    1000       0    1000
# Query size     2 212.12k   1.46k   1.46k   1.46k   1.46k       0   1.46k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  #################
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'client_sea'\G
#    SHOW CREATE TABLE `yimi`.`client_sea`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_follow'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_follow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_follow_status'\G
#    SHOW CREATE TABLE `yimi`.`erp_follow_status`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'callcenter_outer_log'\G
#    SHOW CREATE TABLE `yimi`.`callcenter_outer_log`\G
insert IGNORE client_sea(clientFid, clientSea, flag, clientType, viewTime, latestFollowTime)
        SELECT ec.clientId,ec.clientSea,ec.flag,ec.clientType ,ec.viewTime,ifnull(ecf.createdOn,now()) from erp_clients ec
        left join(
             
                    select max(id) id,clientFid,count(0) followNum,max(createdOn) createdOn from erp_client_follow
                        where followStatusFid in(select statusId from erp_follow_status where type like '%,CC,%') GROUP BY clientFid
             
        ) ecf
        on ecf.clientFid=ec.clientId
         WHERE ec.clientSea='P' and ec.clientType = 'C' and ec.viewTime<=now() and ec.flag is not null
            and not exists(select 1 from callcenter_outer_log where ec.clientId=callcenter_outer_log.clientFid and createdOn>date_add(now(),INTERVAL -120 MINUTE))
            and ec.phoneNo REGEXP '^[0]?[1][3456789][0-9]{9}$'
            and not exists(select 1 from callcenter_outer_log where ec.clientId=callcenter_outer_log.clientFid and createdOn>date_add(now(),INTERVAL -120 MINUTE))
            
             and date(ec.createdOnTime) >='2016-01-01'
             and date(ec.createdOnTime) <='2018-03-20'
            
            
            and ec.secondChannelFid not in(21006,27001,27006,21002,21001,39003,27008,27005,27004,21005,39001,39004,39002,21004,39010,39009,21003,39012,39005,39006/*... omitted 10 items ...*/) 
        ORDER BY ec.topTimes>0 desc,ec.viewTime asc
        LIMIT 1000\G

# Query 7: 0.01 QPS, 0.02x concurrency, ID 0x874AC800CFB0B05C at byte 872985
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.08
# Time range: 2018-04-16 04:02:03 to 2018-04-17 04:00:04
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          9     720
# Exec time      3   1830s      2s      4s      3s      3s   456ms      2s
# Lock time      0    23ms     9us   117us    31us    76us    19us    23us
# Rows sent      0  66.96k       0     729   95.23  463.90  156.95   17.65
# Rows examine   1   1.19G   1.69M   1.69M   1.69M   1.69M   1.43k   1.61M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 201.80k     287     287     287     287       0     287
# String:
# Databases    yimi
# Hosts        10.81.244.3 (142/19%), 10.80.58.47 (128/17%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'app_notification'\G
#    SHOW CREATE TABLE `yimi`.`app_notification`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT nId, bizType,userFid,relateId,displayType,title,msg,sound,goActivity,appSysInfo,appVersion,appDeviceInfo,isSend,sendTimes,thirdMsgId,isRead,status,createdOn,lastUpdatedOn,umengAppKey,appSource,userName
		FROM  app_notification
		WHERE isSend=0	AND sendTimes < 5 and NOW()<deadline\G

# Query 8: 0.00 QPS, 0.02x concurrency, ID 0x5FDDE1EC4813C54F at byte 1620971
# This item is included in the report because it matches --limit.
# Scores: V/M = 6.74
# Time range: 2018-04-16 05:00:34 to 2018-04-17 04:00:33
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1      81
# Exec time      2   1286s      2s     35s     16s     32s     10s     17s
# Lock time      0     5ms    24us   139us    64us   103us    21us    60us
# Rows sent      0   5.25k       8     121   66.35  112.70   40.22   82.29
# Rows examine   2   1.75G   2.42M  38.43M  22.17M  36.45M  13.67M  28.08M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  64.38k     811     814  813.85  793.42       0  793.42
# String:
# Databases    yimi
# Hosts        10.31.53.111 (18/22%), 10.81.244.11 (15/18%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ###################################################
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_application'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_application`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'wx_service_msg'\G
#    SHOW CREATE TABLE `yimi`.`wx_service_msg`\G
# EXPLAIN /*!50100 PARTITIONS*/
select msg_temp.startTime,
		msg_temp.teacherId,
		msg_temp.studentId,
		msg_temp.endTime,
		msg_temp.applicationId,
		eccs.subjectName,
		ecsg.gradeName
		from 
			(select ela.applicationId,
			ela.subjectFid,
			els.startTime,
			els.endTime,
			els.teacherId,
			els.studentId,
			els.gradeId 
			from erp_lesson_application ela
			join erp_lessons els on ela.lessonId=els.lessonId
			where els.startTime   >=   NOW() and els.startTime   <=   '2018-04-17 12:00:01.814000') as msg_temp
		left join erp_conf_course_subjects eccs on eccs.subjectId=msg_temp.subjectFid
		left join erp_conf_student_grades ecsg on ecsg.gradeId=msg_temp.gradeId
		left join wx_service_msg wsm on wsm.bizFid=msg_temp.applicationId and wsm.bizType='APPLICATION' 
		and wsm.bizTimeType='1D' and wsm.userType='TEA'
		where wsm.tId is null\G

# Query 9: 0.00 QPS, 0.01x concurrency, ID 0x0924E63A71759FDC at byte 6813940
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.19
# Time range: 2018-04-16 05:00:20 to 2018-04-17 04:00:19
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     116
# Exec time      1    903s      7s     12s      8s     10s      1s      7s
# Lock time      0    19ms   106us     1ms   163us   214us   109us   144us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0 419.22M   3.60M   3.63M   3.61M   3.50M    0.04   3.50M
# Rows affecte   0     864       1     180    7.45   19.46   22.77    2.90
# Query size     1 104.11k     919     919     919     919       0     919
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+  ######
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'client_sea'\G
#    SHOW CREATE TABLE `yimi`.`client_sea`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_follow'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_follow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_follow_status'\G
#    SHOW CREATE TABLE `yimi`.`erp_follow_status`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'callcenter_outer_log'\G
#    SHOW CREATE TABLE `yimi`.`callcenter_outer_log`\G
insert IGNORE client_sea(clientFid, clientSea, flag, clientType, viewTime, latestFollowTime)
        SELECT ec.clientId,ec.clientSea,ec.flag,ec.clientType ,ec.viewTime,ifnull(ecf.createdOn,now()) from erp_clients ec
        left join(select max(createdOn) createdOn,clientFid,count(0) followNum from erp_client_follow
            where followStatusFid in(select statusId from erp_follow_status where  type like '%,CC,%') GROUP BY clientFid
        )
         ecf
        on ecf.clientFid=ec.clientId
        where
            ec.clientSea='P' and ec.clientType in ('R','N') and ec.viewTime <= now() and ec.flag is not null
            and ec.phoneNo REGEXP '^[0]?[1][3456789][0-9]{9}$'
            and not exists(select 1 from callcenter_outer_log where ec.clientId=callcenter_outer_log.clientFid and createdOn>date_add(now(),INTERVAL -120 MINUTE))
        ORDER BY ec.topTimes>0 desc,ec.viewTime asc
        LIMIT 1000\G

# Query 10: 0.00 QPS, 0.01x concurrency, ID 0x5188E74C090BF609 at byte 3115320
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.41
# Time range: 2018-04-16 06:29:23 to 2018-04-17 02:48:32
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          3     235
# Exec time      1    749s      2s      8s      3s      6s      1s      3s
# Lock time      0    22ms    64us   136us    94us   119us    14us    89us
# Rows sent      0   6.61k      13      50   28.80   49.17    9.64   23.65
# Rows examine   0  34.12M 120.38k 186.73k 148.68k 182.98k  17.45k 136.54k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     3 294.44k   1.25k   1.25k   1.25k   1.25k       0   1.25k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_series'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_series`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_series_lesson_ref'\G
#    SHOW CREATE TABLE `yimi`.`lvb_series_lesson_ref`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
		l.lessonId,lessonName,playBegin,playEnd,l.orginalPrice,l.currentPrice,entryLimit,img1,img2,r.refNum,
		if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
		WHERE  l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
		(SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount,
		 
			(SELECT IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=133986 AND o.orderType='L' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,
			IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=133986 AND o.orderType='S' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,0))) isPaid,
		 
		(SELECT if(count(1) =(l.entryLimit-l.entryBase),1,0) FROM lvb_order_lesson ol  WHERE ol.lessonId = l.lessonId) as isFull
		FROM
		lvb_lesson_series ls
		INNER join lvb_series_lesson_ref r on ls.seriesId=r.seriesFid
		INNER join lvb_lesson l  on r.lessonFid=l.lessonId
		left join lvb_lesson_ext le on l.lessonId=le.lessonFid
		where
		ls.seriesId = '133'
		and l.applyFids  like concat('%,',concat(1,',%'))
		and now() >= l.validBegin
		and now()  <=  l.validEnd
		group by l.lessonId\G

# Query 11: 0.00 QPS, 0.01x concurrency, ID 0x9802F83F3C5469D4 at byte 9523452
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.09
# Time range: 2018-04-16 04:10:08 to 2018-04-17 04:00:06
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          3     242
# Exec time      1    655s      2s      5s      3s      4s   502ms      3s
# Lock time      0    51ms   141us   383us   212us   260us    36us   204us
# Rows sent      0      22       0       2    0.09    0.99    0.36       0
# Rows examine   0 511.05M   2.11M   2.12M   2.11M   2.05M       0   2.05M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     4 314.79k   1.30k   1.30k   1.30k   1.30k       0   1.30k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) > DATE(now())
		) t on l.clientId = t.clientId and l.startTime = t.startTime
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 10
		and co.contractProp = 1
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid)\G

# Query 12: 0.00 QPS, 0.01x concurrency, ID 0xC275A476B01092D4 at byte 243528
# This item is included in the report because it matches --limit.
# Scores: V/M = 1.67
# Time range: 2018-04-16 06:31:02 to 23:17:08
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      16
# Exec time      1    486s     21s     43s     30s     42s      7s     27s
# Lock time      0     3ms    34us   303us   168us   236us    84us   204us
# Rows sent      0  14.70k     935     943  940.50  918.49       0  918.49
# Rows examine   2   1.45G  91.85M  92.98M  92.56M  92.12M 575.30k  92.12M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  48.08k   3.00k   3.00k   3.00k   3.00k       0   3.00k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,lessonName,playBegin,playEnd,orginalPrice,currentPrice,entryLimit,img1,img2,
        if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
        WHERE l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
        (SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount
        FROM
        lvb_lesson l left join lvb_lesson_ext le on l.lessonId = le.lessonFid
        where
        (
          
              
                subjectIds like concat (concat('%','1'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','2'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','3'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','7'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','8'),'%')
             
             
          
        )
        and
        (
          
              
                termIds like concat (concat('%','130'),'%')
             
             
         
             or 
                termIds like concat (concat('%','140'),'%')
             
             
         
             or 
                termIds like concat (concat('%','150'),'%')
             
             
         
             or 
                termIds like concat (concat('%','160'),'%')
             
             
         
             or 
                termIds like concat (concat('%','170'),'%')
             
             
         
             or 
                termIds like concat (concat('%','210'),'%')
             
             
         
             or 
                termIds like concat (concat('%','220'),'%')
             
             
         
             or 
                termIds like concat (concat('%','230'),'%')
             
             
         
             or 
                termIds like concat (concat('%','240'),'%')
             
             
         
             or 
                termIds like concat (concat('%','310'),'%')
             
             
         
             or 
                termIds like concat (concat('%','320'),'%')
             
             
         
             or 
                termIds like concat (concat('%','330'),'%')
             
             
         
             or 
                termIds like concat (concat('%','410'),'%')
             
             
          
        )
        and
        (
          
             
             
             
              
                1=1
             
          
        )
        and
        (
          
             
             
              
                1=1
             
          
        )
        and l.applyFids  like concat('%',concat(1,'%'))
        and now() >= l.validBegin
        and now()  <=  l.validEnd
        group by l.lessonId\G

# Query 13: 0.00 QPS, 0.01x concurrency, ID 0xAF7087AE5BCF7A6F at byte 3780909
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.09
# Time range: 2018-04-16 09:17:44 to 23:07:04
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     138
# Exec time      0    387s      2s      4s      3s      4s   497ms      3s
# Lock time      0    23ms    40us   363us   169us   260us    67us   176us
# Rows sent      0   2.17k       0      82   16.10   54.21   15.64   12.54
# Rows examine   0 133.80M 635.76k   1.01M 992.85k 961.27k  39.61k 961.27k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 225.30k   1.39k   7.48k   1.63k   1.46k   1.11k   1.39k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        erpuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lesson_comment'\G
#    SHOW CREATE TABLE `yimi`.`lesson_comment`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_cr'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_cr`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
				l.*,
				
				IFNULL(c.clientName,t.nickName) studentName,
				mui.userRealName teacherName,
				g.gradeName gradeName,
				s.subjectName subjectName,
				o1.userRealName ccName,
				u1.userRealName chargeName,
				u1.userMobile chargePhone,
				stulc.param1 stuParam1,
				stulc.param2 stuParam2,
				stulc.param3 stuParam3,
				stulc.param4 stuParam4,
				tealc.param1 teaParam1,
				tealc.param2 teaParam2,
				tealc.param3 teaParam3,
				c.eduSystem
		FROM erp_lessons l
		LEFT JOIN erp_clients c ON l.clientId=c.clientId
		LEFT JOIN t_user_info t ON l.studentId=t.id
		LEFT JOIN mis_user_info mui ON mui.userId = l.teacherId
		LEFT JOIN erp_conf_student_grades g ON l.gradeId=g.gradeId
		LEFT JOIN erp_conf_course_subjects s ON l.subjectId=s.subjectId
		LEFT JOIN mis_user_info o1 ON o1.userId = c.consultantId
		LEFT JOIN mis_user_info u1 ON u1.userId=c.chargeFid
		LEFT JOIN lesson_comment stulc ON stulc.lessonFid=l.lessonId and stulc.commentBy='STU'
		LEFT JOIN lesson_comment tealc ON tealc.lessonFid=l.lessonId and tealc.commentBy='TEA'
		 WHERE  (c.clientName like '%李盈欣%' OR t.nickName like '%李盈欣%')
			
			
			
			
			
			
			
				and (c.consultantId in (				
				 900000981
	           )
				or EXISTS (select distinct 1 from erp_client_cr t1
				where t1.clientFid=l.clientId and t1.endTime is null
				and t1.crFid in (				
				 900000981
	           ))) 
		order by startTime desc limit 0,100\G

# Query 14: 0.00 QPS, 0.01x concurrency, ID 0xD9CFEA53507AC560 at byte 7963941
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.06
# Time range: 2018-04-16 07:47:05 to 21:42:41
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     103
# Exec time      0    352s      2s      4s      3s      4s   462ms      3s
# Lock time      0    16ms    44us   279us   157us   247us    70us   167us
# Rows sent      0     103       1       1       1       1       0       1
# Rows examine   0 200.67M   1.95M   1.95M   1.95M   1.86M   2.52k   1.86M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 203.59k   1.98k   1.98k   1.98k   1.98k       0   1.98k
# String:
# Databases    yimi
# Hosts        10.81.244.11 (24/23%), 10.31.53.111 (20/19%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        COUNT(1)
        FROM mis_user_info u
        LEFT JOIN erp_clients ec ON u.userId = ec.chargeFid
        LEFT JOIN mis_user_info u1 ON u1.userId = ec.consultantId
        LEFT JOIN mis_user_info u2 ON u2.userId = ec.cooperateConsultantId
        INNER JOIN erp_lessons l ON ec.studentId = l.studentId
        INNER JOIN t_user_info tui on tui.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
         INNER JOIN www_config pre on pre.configId=1
         INNER JOIN www_config aft on aft.configId=2
        WHERE
        l.lessonStatus = 1 and
        ((u.userOrgFid IN
         (  
            3030100
         ) 
         
            and ec.chargeFid = 900001255
         
        )
        OR (CASE WHEN ec.consultantId!= ec.chargeFid THEN
        u1.userOrgFid IN
         (  
            3030100
         ) 
         
            and ec.consultantId = 900001255
         
        END)
        OR (u2.userOrgFid IN
         (  
            3030100
         ) 
         
            AND ec.cooperateConsultantId = 900001255
         
        ))
         
         
        	and l.subjectId in
	         (  
	            0
	         , 
	            1
	         , 
	            2
	         , 
	            3
	         , 
	            4
	         , 
	            5
	         , 
	            6
	         , 
	            7
	         , 
	            8
	         , 
	            9
	         , 
	            13
	         , 
	            16
	         ) 
         
         
        	and l.gradeId in
	         (  
	            130
	         , 
	            140
	         , 
	            150
	         , 
	            160
	         , 
	            170
	         , 
	            210
	         , 
	            220
	         , 
	            230
	         , 
	            240
	         , 
	            310
	         , 
	            320
	         , 
	            330
	         , 
	            410
	         )\G

# Query 15: 0.00 QPS, 0.00x concurrency, ID 0xED7DE5AA05230157 at byte 6799356
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.13
# Time range: 2018-04-16 04:10:17 to 2018-04-17 04:00:13
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     116
# Exec time      0    304s      2s      6s      3s      3s   592ms      2s
# Lock time      0    27ms   173us   320us   235us   301us    35us   224us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0 256.27M   2.20M   2.21M   2.21M   2.15M       0   2.15M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 172.19k   1.48k   1.48k   1.48k   1.48k       0   1.48k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName,1 workFlag
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) =  DATE_SUB(now(),INTERVAL 30 DAY)
		) t on l.startTime = t.startTime and l.clientId = t.clientId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 12
		and co.gradeFid not in (160,230,330)
		and co.contractProp = 1
		and exists(select 1 from erp_contract ec where ec.clientFid = c.clientId and ec.contractStatus=3)
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid and workFlag = 1)\G

# Query 16: 0.00 QPS, 0.00x concurrency, ID 0xF83D3854B6294F5F at byte 3505952
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.10
# Time range: 2018-04-16 04:10:22 to 2018-04-17 04:00:16
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     115
# Exec time      0    299s      2s      4s      3s      3s   506ms      2s
# Lock time      0    28ms   164us     1ms   239us   301us    82us   214us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0 254.47M   2.21M   2.22M   2.21M   2.15M       0   2.15M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 170.25k   1.48k   1.48k   1.48k   1.48k       0   1.48k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName,1 workFlag
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) =  DATE_SUB(now(),INTERVAL 30 DAY)
		) t on l.startTime = t.startTime and l.clientId = t.clientId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 14
		and co.gradeFid in (160,230,330)
		and co.contractProp = 1
		and exists(select 1 from erp_contract ec where ec.clientFid = c.clientId and ec.contractStatus=3)
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid and workFlag = 1)\G

# Query 17: 0.00 QPS, 0.03x concurrency, ID 0x984170966838BF4D at byte 6264051
# This item is included in the report because it matches --limit.
# Scores: V/M = 1.53
# Time range: 2018-04-16 18:25:20 to 21:17:08
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      51
# Exec time      0    295s      2s     11s      6s     10s      3s      5s
# Lock time      0     6ms    52us   231us   109us   185us    35us    98us
# Rows sent      0      51       1       1       1       1       0       1
# Rows examine   0  41.63M 834.36k 868.76k 835.83k 830.38k       0 830.38k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  60.56k   1.19k   1.19k   1.19k   1.19k       0   1.19k
# String:
# Databases    yimi
# Hosts        10.31.53.111 (10/19%), 10.81.244.3 (10/19%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+  ##########
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        COUNT(1)
        FROM mis_user_info u
        LEFT JOIN erp_clients ec ON u.userId = ec.chargeFid
        LEFT JOIN mis_user_info u1 ON u1.userId = ec.consultantId
        LEFT JOIN mis_user_info u2 ON u2.userId = ec.cooperateConsultantId
        INNER JOIN erp_lessons l ON ec.studentId = l.studentId
        INNER JOIN t_user_info tui on tui.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
        INNER JOIN www_config pre on pre.configId=1
        INNER JOIN www_config aft on aft.configId=2
        WHERE
        ((u.userOrgFid IN
         (  
            3020100
         ) 
         
            and ec.chargeFid = 900001367
         
        )
        OR (CASE WHEN ec.consultantId!= ec.chargeFid THEN
        u1.userOrgFid IN
         (  
            3020100
         ) 
         
            and ec.consultantId = 900001367
         
        END)
        OR (u2.userOrgFid IN
         (  
            3020100
         ) 
         
            AND ec.cooperateConsultantId = 900001367
         
        ))
         
         
         
            AND l.startTime >= '2018-04-16'\G

# Query 18: 0.00 QPS, 0.00x concurrency, ID 0x4A078E636F95F53C at byte 3785329
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.13
# Time range: 2018-04-16 04:10:24 to 2018-04-17 04:00:19
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     107
# Exec time      0    291s      2s      5s      3s      4s   597ms      3s
# Lock time      0    28ms   192us   406us   261us   332us    46us   236us
# Rows sent      0     215       0     209    2.01       0   19.47       0
# Rows examine   0 105.26M 978.50k 1014.42k 1007.31k 1009.33k  17.57k 1009.33k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 171.99k   1.61k   1.61k   1.61k   1.61k       0   1.61k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName,round((datediff(now(),l.startTime)-30)/7,0)+1 workFlag
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) < DATE_SUB(now(),INTERVAL 30 DAY)
		) t on l.startTime = t.startTime and l.clientId = t.clientId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 15
		and co.gradeFid in (160,230,330)
		and co.contractProp = 1
		and exists(select 1 from erp_contract ec where ec.clientFid = c.clientId and ec.contractStatus=3)
		and (datediff(now(),l.startTime)-30)%7=0
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid and workFlag = round((datediff(now(),l.startTime)-30)/7,0)+1)\G

# Query 19: 0.00 QPS, 0.00x concurrency, ID 0xD824344EA5B63403 at byte 8757
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.09
# Time range: 2018-04-16 04:10:05 to 2018-04-17 04:00:03
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     105
# Exec time      0    269s      2s      6s      3s      3s   468ms      3s
# Lock time      0   159ms   292us    51ms     2ms   541us     7ms   467us
# Rows sent      0     103       0      16    0.98    3.89    2.43       0
# Rows examine   0  38.27M  62.49k 900.34k 373.27k 871.90k 391.37k  62.55k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     4 324.95k   3.09k   3.09k   3.09k   3.09k       0   3.09k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_plan'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_plan`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'teach_lesson_plan'\G
#    SHOW CREATE TABLE `yimi`.`teach_lesson_plan`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo contractNo,o.contractId orderFid,0 lessonFid,
		o.subjectId subjectFid,s.subjectName,o.teacherId teacherFid,i.userRealName teacherName,o.gradeId gradeFid,g.gradeName,round(temp.completeCount/5,0) workFlag
		from erp_contract_orders o
		join erp_contract co on co.contractId = o.contractFid
		join erp_clients c on o.clientId = c.clientId
		join t_user_info t on o.studentId = t.id
		join mis_user_info i on o.teacherId = i.userId
		join erp_conf_student_grades g on o.gradeId = g.gradeId
		join erp_conf_course_subjects s on o.subjectId = s.subjectId
		join (
		SELECT o.contractFid,o.teacherId,o.subjectId,o.clientId,sum(tmp.lessonCount) lessonCount,sum(tmp.lessonNum) completeCount
		from erp_contract_orders o
		JOIN erp_contract ec on o.contractFid = ec.contractId
		JOIN (
		SELECT contractId,sum(courseHours) lessonCount,count(contractId) lessonNum FROM erp_lessons
		WHERE lessonStatus = 1
		AND contractId>0
		GROUP BY contractId
		) tmp on o.contractId = tmp.contractId
		GROUP BY o.teacherId,o.subjectId,o.clientId
		HAVING sum(tmp.lessonNum)%5 = 0
		AND sum(tmp.lessonNum)>0
		
		)temp on o.clientId = temp.clientId and o.teacherId = temp.teacherId and o.subjectId = temp.subjectId
		JOIN (
		select tm.clientId,tm.teacherId,tm.subjectId,sum(renainLessonCount) renainLessonCount
		from (
		select o.contractId,o.clientId,o.teacherId,o.subjectId,(o.realLessonCount - ifnull(sum(l.courseHours),0)) renainLessonCount
		from erp_contract_orders o left JOIN erp_lessons l on o.contractId = l.contractId
		where l.lessonStatus in (1,3,4)
		GROUP BY o.contractId
		) tm GROUP BY tm.clientId,tm.teacherId,tm.subjectId
		) tmp on o.subjectId = tmp.subjectId and o.teacherId = tmp.teacherId and o.clientId = tmp.clientId 
		left join (
		select teacherId,subjectId,clientId,sum(planCount) planCount from (
		select o.teacherId,o.subjectId,o.clientId,round(count(p.planId)/5,0) planCount
		from erp_lesson_plan p
		JOIN erp_contract_orders o on p.contractId = o.contractId
		where o.teacherId>0
		GROUP BY o.teacherId,o.subjectId,o.clientId
		UNION ALL
		SELECT teacherFid teacherId,subjectFid subjectId,clientFid clientId,count(id) planCount
		FROM teach_lesson_plan
		GROUP BY teacherFid,subjectFid,clientFid
		) tmp
		GROUP BY teacherId,subjectId,clientId
		) tm on o.subjectId = tm.subjectId and o.teacherId = tm.teacherId and o.clientId = tm.clientId 
		,mis_work_order_config w
		where
		w.configId = 9
		and not exists(select 1 from mis_work_order o1 where o1.configFid = w.configId
		AND o1.clientFid = o.clientId
		AND o1.subjectFid = o.subjectId
		AND o1.teacherFid = o.teacherId
		and workFlag = round(temp.completeCount/5,0))
		and o.contractFid != o.contractId
		and o.contractId>0
		and tmp.renainLessonCount >0 
		and round(temp.completeCount/5,0) > (ifnull(planCount,0)-1) 
		GROUP BY o.clientId,o.subjectId,o.teacherId\G

# Query 20: 0.00 QPS, 0.01x concurrency, ID 0x531669EDCDB6CD4C at byte 4473896
# This item is included in the report because it matches --limit.
# Scores: V/M = 3.23
# Time range: 2018-04-16 10:25:01 to 18:09:01
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0       3
# Exec time      0    263s     65s    104s     88s    102s     17s     93s
# Lock time      0   781us   228us   309us   260us   301us    33us   236us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0  57.83k  12.47k  23.42k  19.28k  22.45k   4.74k  21.38k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0   9.57k   3.19k   3.19k   3.19k   3.19k       0   3.19k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_device'\G
#    SHOW CREATE TABLE `yimi`.`user_device`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'wechat_user_info'\G
#    SHOW CREATE TABLE `yimi`.`wechat_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_family'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_family`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT t1.*,erp_client_family.id as
        familyId,erp_client_family.familyName,erp_client_family.familyTitle,erp_client_family.familyPhoneNo,
         
            erp_client_family.familyPhoneNo as familyPhoneNoShow,
         
         
        erp_client_family.familyIm FROM(
        SELECT erp_clients.clientId,
        erp_clients.phoneNo,

         
            erp_clients.phoneNo as phoneNoShow,
         
         
        erp_clients.consultantId,
        erp_clients.chargeFid,
        if(erp_clients.cooperateConsultantId = 0,info1.userRealName,concat(info1.userRealName,'-',info3.userRealName))
        ccName,
        
        info2.userRealName crName,
        erp_clients.province,
        erp_clients.city,
        erp_clients.district,
        CONCAT(ifnull(erp_clients.sysProvince,''),' ',
        ifnull(erp_clients.sysCity,'')) AS sysAddress,
        CONCAT(ifnull(erp_clients.province,''),' ',
        ifnull(erp_clients.city,''),' ',
        ifnull(erp_clients.district,'')) AS address,
        erp_clients.clientName,
        erp_clients.clientSex,
        t_user_info.userName,
        erp_clients.clientIm,
        DATE_FORMAT(erp_clients.createdOnTime,'%Y-%m-%d %T') createdOnTime,
        erp_clients.currentGradeId,
        erp_conf_student_grades.gradeName,
        erp_clients.interestSubject,
        erp_clients.followTimes,
        erp_clients.clientStatus,
        erp_clients.clientSea,
        erp_clients.clientType,
        erp_clients.flag,
        erp_clients.clientMemo,
        user_device.appVersion,
        user_device.sysInfo,
        user_device.deviceInfo,
        COUNT(erp_lessons.lessonId) hasTry,
        COUNT(erp_lessons_2.lessonId) hasShow,
        case erp_clients.clientFrom
        when 'F' then '填单页'
        when 'B' then '后台新增'
        when 'I' then '邀请'
        when 'E' then 'Excel导入'
        when 'U' then '注册'
        WHEN 'X' THEN '未知'
        else '' end clientFromDesc,
        erp_clients.createdBy,
        erp_clients.createdByFid,
        wechat_user_info.isBind,
        wechat_user_info.openId,
        erp_clients.eduSystem
        FROM erp_clients
        LEFT JOIN mis_user_info info1 ON info1.userId=erp_clients.consultantId
        LEFT JOIN mis_user_info info2 ON info2.userId=erp_clients.chargeFid
        LEFT JOIN mis_user_info info3 ON info3.userId=erp_clients.cooperateConsultantId
        LEFT JOIN t_user_info ON t_user_info.id=erp_clients.studentId
        LEFT JOIN user_device ON user_device.userFid=erp_clients.studentId
        LEFT JOIN erp_lessons ON erp_lessons.clientId=erp_clients.clientId AND erp_lessons.lessonType in(1,0) AND
        erp_lessons.subjectId!=0 AND erp_lessons.lessonStatus=1
        LEFT JOIN erp_lessons erp_lessons_2 ON erp_lessons_2.clientId=erp_clients.clientId AND erp_lessons_2.subjectId=0
        AND erp_lessons_2.lessonStatus=1
        LEFT JOIN erp_conf_student_grades ON erp_conf_student_grades.gradeId = erp_clients.currentGradeId
        LEFT JOIN wechat_user_info on wechat_user_info.userId = erp_clients.studentId and wechat_user_info.userId>0
        WHERE erp_clients.clientId=10033
        ) t1 LEFT JOIN erp_client_family ON erp_client_family.clientFid=t1.clientId order by erp_client_family.id desc\G

# Query 21: 0.00 QPS, 0.00x concurrency, ID 0x0AAEBB16BF6FA2DC at byte 7596969
# This item is included in the report because it matches --outliers.
# Scores: V/M = 1.22
# Time range: 2018-04-16 06:33:56 to 22:31:33
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      10
# Exec time      0    256s     20s     37s     26s     32s      6s     24s
# Lock time      0     2ms    35us   351us   168us   247us   107us   224us
# Rows sent      0   8.71k     860     921  891.80  874.75   22.86  874.75
# Rows examine   1 877.48M  84.65M  90.62M  87.75M  87.73M   2.05M  87.73M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  35.74k   3.57k   3.57k   3.57k   3.57k       0   3.57k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,lessonName,playBegin,playEnd,orginalPrice,currentPrice,entryLimit,img1,img2,
        if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
        WHERE l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
        (SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount
        FROM
        lvb_lesson l left join lvb_lesson_ext le on l.lessonId = le.lessonFid
        where
        (
          
              
                subjectIds like concat (concat('%','1'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','2'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','3'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','4'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','5'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','6'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','7'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','8'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','9'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','13'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','16'),'%')
             
             
          
        )
        and
        (
          
              
                termIds like concat (concat('%','130'),'%')
             
             
         
             or 
                termIds like concat (concat('%','160'),'%')
             
             
         
             or 
                termIds like concat (concat('%','170'),'%')
             
             
         
             or 
                termIds like concat (concat('%','210'),'%')
             
             
         
             or 
                termIds like concat (concat('%','220'),'%')
             
             
         
             or 
                termIds like concat (concat('%','230'),'%')
             
             
         
             or 
                termIds like concat (concat('%','240'),'%')
             
             
         
             or 
                termIds like concat (concat('%','310'),'%')
             
             
         
             or 
                termIds like concat (concat('%','320'),'%')
             
             
         
             or 
                termIds like concat (concat('%','330'),'%')
             
             
         
             or 
                termIds like concat (concat('%','410'),'%')
             
             
         
             or 
                termIds like concat (concat('%','140'),'%')
             
             
          
        )
        and
        (
          
             
             
             
              
                1=1
             
          
        )
        and
        (
          
             
             
              
                1=1
             
          
        )
        and l.applyFids  like concat('%',concat(1,'%'))
        and now() >= l.validBegin
        and now()  <=  l.validEnd
        group by l.lessonId\G

# Query 22: 0.00 QPS, 0.00x concurrency, ID 0x807CEFFF6917F85F at byte 3496447
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.06
# Time range: 2018-04-16 04:10:13 to 2018-04-17 03:00:16
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1      97
# Exec time      0    248s      2s      5s      3s      3s   399ms      3s
# Lock time      0    25ms   169us   380us   255us   301us    42us   247us
# Rows sent      0      38       0       8    0.39    2.90    1.22       0
# Rows examine   0  70.28M 694.15k 857.49k 741.93k 830.38k  43.16k 717.31k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 149.33k   1.54k   1.54k   1.54k   1.53k    0.00   1.53k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,
		t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,
		i.userRealName teacherName,l.gradeId gradeFid,g.gradeName,round(timestampdiff(DAY,t.startTime,now())/7,0) workFlag
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) >  DATE_SUB(now(),INTERVAL 30 DAY)
		) t on l.startTime = t.startTime and l.clientId = t.clientId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		JOIN erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 11
		and timestampdiff(DAY,t.startTime,now())%7 = 0
		and timestampdiff(DAY,t.startTime,now()) > 0
		and co.contractProp = 1
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid and workFlag = round(timestampdiff(DAY,t.startTime,now())/7,0))\G

# Query 24: 0.00 QPS, 0.00x concurrency, ID 0x08FE275627AABB49 at byte 3489765
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.02
# Time range: 2018-04-16 04:10:09 to 2018-04-17 04:00:09
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     104
# Exec time      0    238s      2s      3s      2s      3s   238ms      2s
# Lock time      0    30ms   181us     2ms   284us   316us   160us   273us
# Rows sent      0       8       0       2    0.08       0    0.35       0
# Rows examine   0  77.80M 765.04k 767.61k 765.99k 753.18k       0 753.18k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 167.78k   1.61k   1.61k   1.61k   1.61k       0   1.61k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_student_teach_special'\G
#    SHOW CREATE TABLE `yimi`.`erp_student_teach_special`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo contractNo,o.contractId orderFid,temp.lessonId lessonFid,
		o.subjectId subjectFid,s.subjectName,o.teacherId teacherFid,i.userRealName teacherName,o.gradeId gradeFid,g.gradeName
		from erp_contract_orders o
		join erp_contract co on co.contractId = o.contractFid
		join erp_clients c on o.clientId = c.clientId
		join t_user_info t on o.studentId = t.id
		join mis_user_info i on o.teacherId = i.userId
		join erp_conf_student_grades g on o.gradeId = g.gradeId
		join erp_conf_course_subjects s on o.subjectId = s.subjectId
		join (
		select
		contractId,l.lessonId
		from erp_lessons l,
		(
		select
		clientId,subjectId,teacherid,max(startTime) startTime
		from erp_lessons
		where lessonStatus=1
		AND startTime > date_sub(now(),INTERVAL 30 DAY)
		and lessonType=10
		GROUP BY subjectId,clientId,teacherId
		HAVING timestampdiff(day,max(startTime),now())= 28
		) ll
		where l.clientId=ll.clientId
		and l.subjectId=ll.subjectId
		and l.teacherId=ll.teacherId
		and l.startTime=ll.startTime
		) temp on o.contractId = temp.contractId
		,mis_work_order_config w
		where
		w.configId = 20
		and o.orderStatus = 2
		and not exists(select 1 from mis_work_order wo where wo.configFid = w.configId and wo.lessonFid = temp.lessonId)
		and not exists(select 1 from erp_student_teach_special s where c.clientId = s.clientFid)\G

# Query 25: 0.00 QPS, 0.00x concurrency, ID 0x26476FF6C3C0CA5D at byte 6810273
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.08
# Time range: 2018-04-16 04:10:19 to 2018-04-17 03:00:21
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      74
# Exec time      0    200s      2s      5s      3s      3s   451ms      3s
# Lock time      0    21ms   197us   384us   279us   348us    47us   273us
# Rows sent      0      27       0      10    0.36    1.96    1.39       0
# Rows examine   0  60.77M 831.22k 843.01k 840.91k 830.38k       0 830.38k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 119.53k   1.62k   1.62k   1.62k   1.62k       0   1.62k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName,round((datediff(now(),l.startTime)-30)/14,0)+1 workFlag
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) <  DATE_SUB(now(),INTERVAL 30 DAY)
		) t on l.startTime = t.startTime and l.clientId = t.clientId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 13
		and co.gradeFid not in (160,230,330)
		and co.contractProp = 1
		and exists(select 1 from erp_contract ec where ec.clientFid = c.clientId and ec.contractStatus=3)
		and (datediff(now(),l.startTime)-30)%14=0
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid and workFlag = round((datediff(now(),l.startTime)-30)/14,0)+1)\G

# Query 26: 0.00 QPS, 0.00x concurrency, ID 0x21B83224C5BD6EDA at byte 1222348
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.14
# Time range: 2018-04-16 10:41:52 to 21:45:48
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      33
# Exec time      0    185s      4s      7s      6s      7s   880ms      5s
# Lock time      0     4ms    60us   162us   114us   144us    24us   108us
# Rows sent      0      28       0       1    0.85    0.99    0.36    0.99
# Rows examine   0  28.41M 880.21k 883.07k 881.48k 871.90k       0 871.90k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  18.53k     575     575     575     575       0     575
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_family'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_family`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
# EXPLAIN /*!50100 PARTITIONS*/
select distinct ec.clientId, ec.clientName, ec.phoneNo, ec.studentId, ec.consultantId, ec.chargeFid, u1.userRealName ccName, u2.userRealName crName
		from erp_clients ec
		left join mis_user_info u1 on ec.consultantId = u1.userId
		left join mis_user_info u2 on ec.chargeFid = u2.userId
		left join erp_client_family f on ec.clientId = f.clientFid
		left join t_user_info t on ec.studentId = t.id and (t.accountType = 0 or t.accountType = 1)
		 WHERE (ec.phoneNo = '13655703439' or ec.clientName = '13655703439' or familyPhoneNo = '13655703439' or t.mobileNo = '13655703439')\G

# Query 27: 0.00 QPS, 0.00x concurrency, ID 0xB66AF273D4CC2576 at byte 5658970
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.34
# Time range: 2018-04-16 09:13:43 to 21:01:49
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      58
# Exec time      0    178s      2s      6s      3s      5s      1s      3s
# Lock time      0     8ms    78us   227us   132us   176us    26us   125us
# Rows sent      0     241       0      10    4.16    9.83    4.50    0.99
# Rows examine   0  48.93M 863.12k 864.58k 863.95k 830.38k       0 830.38k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  32.82k     574     583  579.38  563.87       0  563.87
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
# EXPLAIN /*!50100 PARTITIONS*/
select l.lessonId,if(contractId>0,'订单课','试听课')
		lessonType,concat(DATE_FORMAT(l.startTime, '%Y-%m-%d %k:%i'),'-',DATE_FORMAT(l.endTime, '%k:%i')) lessonTime
		,tu.userRealName teacherName,c.clientName studentName, l.lessonStatus
		from erp_lessons l
		join mis_user_info tu on tu.userId=l.teacherId
		join erp_clients c on c.clientId=l.clientId
		where
		tu.userId=l.teacherId
		and c.clientId=l.clientId
		and date(l.startTime) <= date(now())
		and (l.lessonId='胡钟匀' or c.clientName='胡钟匀' or tu.userRealName='胡钟匀')
		order by l.startTime desc limit 10\G

# Query 29: 0.00 QPS, 0.00x concurrency, ID 0xF5FEACC32429CC03 at byte 5027357
# This item is included in the report because it matches --outliers.
# Scores: V/M = 1.11
# Time range: 2018-04-16 07:47:03 to 21:32:04
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      48
# Exec time      0    166s      2s      8s      3s      7s      2s      2s
# Lock time      0    15ms    45us   443us   309us   424us   138us   366us
# Rows sent      0     380       0      10    7.92    9.83    3.75    9.83
# Rows examine   0  44.32M 353.84k   2.62M 945.43k   2.62M 999.34k 362.29k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 156.38k   3.26k   3.26k   3.26k   3.26k       0   3.26k
# String:
# Databases    yimi
# Hosts        10.28.143.117 (13/27%), 10.81.244.11 (10/20%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'server_trail_and_voice'\G
#    SHOW CREATE TABLE `yimi`.`server_trail_and_voice`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,
        l.teacherId,
        l.lessonType,
        l.courseHours,
        date_format(l.startTime,'%Y-%m-%d %H:%i') AS startTime,
        date_format(l.endTime,'%Y-%m-%d %H:%i') AS endTime,
        (case ec.clientName when '' then tui.realName else ec.clientName end) studentName,
        s.subjectName,
        g.gradeName,
        l.lessonStatus,
         timestampdiff(second,now(),l.startTime) remaining,
         timestampdiff(second,l.startTime,l.endTime) lessonSecondCount,
         cast(pre.configValue as signed)*60 beforeSecond,
         cast(aft.configValue as signed)*60 afterSecond,
        if(exists(select 1 from server_trail_and_voice where status=1 and lessonID=l.lessonId),1,0) hasRecord,
        if(exists(select 1 from erp_lesson_docs where parentId=0 and docType=1 and lessonId=l.lessonId),1,0) hasDoc,
        "" AS title,
        "" AS keywords,
        case l.studentAppraiseType when 0 then '未评价' when 1 then '好评' when 2 then '中评' when 3 then '差评' end
        studentAppraiseType,
        studentAppraises
        FROM mis_user_info u
        LEFT JOIN erp_clients ec ON u.userId = ec.chargeFid
        LEFT JOIN mis_user_info u1 ON u1.userId = ec.consultantId
        LEFT JOIN mis_user_info u2 ON u2.userId = ec.cooperateConsultantId
        INNER JOIN erp_lessons l ON ec.studentId = l.studentId
        INNER JOIN t_user_info tui on tui.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
         INNER JOIN www_config pre on pre.configId=1
         INNER JOIN www_config aft on aft.configId=2
        WHERE
       	l.lessonStatus = 1 and
        ((u.userOrgFid IN
         (  
            3030100
         ) 
         
            and ec.chargeFid = 900001520
         
        )
        OR (CASE WHEN ec.consultantId!= ec.chargeFid THEN
        u1.userOrgFid IN
         (  
            3030100
         ) 
         
            and ec.consultantId = 900001520
         
        END)
        OR (u2.userOrgFid IN
         (  
            3030100
         ) 
         
            AND ec.cooperateConsultantId = 900001520
         
        ))
         
         
        	and l.subjectId in
	         (  
	            0
	         , 
	            1
	         , 
	            2
	         , 
	            3
	         , 
	            4
	         , 
	            5
	         , 
	            6
	         , 
	            7
	         , 
	            8
	         , 
	            9
	         , 
	            13
	         , 
	            16
	         ) 
         
         
        	and l.gradeId in
	         (  
	            130
	         , 
	            140
	         , 
	            150
	         , 
	            160
	         , 
	            170
	         , 
	            210
	         , 
	            220
	         , 
	            230
	         , 
	            240
	         , 
	            310
	         , 
	            320
	         , 
	            330
	         , 
	            410
	         ) 
         
         
         
         
		 
         
         
        ORDER BY l.lessonStatus,
        CASE WHEN l.lessonStatus in(0) THEN
        l.startTime END,
        CASE WHEN l.lessonStatus in(1) THEN
        l.startTime END desc
        limit 0, 10\G

# Query 34: 0.00 QPS, 0.00x concurrency, ID 0x8DF7748590F106FA at byte 7234
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.08
# Time range: 2018-04-16 04:10:04 to 2018-04-17 03:00:02
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      51
# Exec time      0    122s      2s      5s      2s      3s   448ms      2s
# Lock time      0    91ms   113us    45ms     2ms   273us     8ms   176us
# Rows sent      0      10       0       1    0.20    0.99    0.39       0
# Rows examine   0  47.69M 952.62k 962.68k 957.51k 961.27k   5.03k 915.49k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  63.50k   1.25k   1.25k   1.25k   1.25k       0   1.25k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName
		FROM erp_lessons l
		join (
		select clientId,min(lessonId) lessonId from erp_lessons WHERE lessonType = 10 GROUP BY clientId
		) t on l.lessonId = t.lessonId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 7
		and l.createTime > DATE(now())
		and co.contractProp = 1
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid)\G

# Query 35: 0.00 QPS, 0.00x concurrency, ID 0x7A6044C4585A6A8C at byte 8460570
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.21
# Time range: 2018-04-16 08:24:20 to 2018-04-17 01:30:06
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      34
# Exec time      0    111s      2s      5s      3s      5s   833ms      3s
# Lock time      0     4ms    86us   147us   107us   125us    14us   108us
# Rows sent      0     996      14      44   29.29   38.53    7.76   26.08
# Rows examine   0   5.07M 123.98k 201.11k 152.81k 165.97k  17.40k 143.37k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  45.55k   1.34k   1.34k   1.34k   1.33k       0   1.33k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_series_lesson_ref'\G
#    SHOW CREATE TABLE `yimi`.`lvb_series_lesson_ref`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_series'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_series`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
	    ls.seriesId,seriesName,l.lessonId,lessonName,playBegin,playEnd,l.orginalPrice,l.currentPrice,entryLimit,img1,img2,
	    if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
	    WHERE  l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
		(SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount,
		 
			(SELECT IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=191901 AND o.orderType='L' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,
			IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=191901 AND o.orderType='S' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,0))) isPaid,
		 
		(SELECT if(count(1) = (l.entryLimit-l.entryBase),1,0) FROM lvb_order_lesson ol  WHERE ol.lessonId = l.lessonId) as isFull
	FROM
	lvb_series_lesson_ref r
	INNER JOIN lvb_lesson_series ls on r.seriesFid=ls.seriesId
	INNER join lvb_lesson l  on r.lessonFid=l.lessonId
		left join lvb_lesson_ext le on l.lessonId=le.lessonFid
	where
	    r.seriesFid IN (SELECT seriesFid FROM  lvb_series_lesson_ref where lessonFid = '3301')
		and l.applyFids  like concat('%,',concat(2,',%'))
		and now() >= l.validBegin
		and now()  <=  l.validEnd
		GROUP BY l.lessonId\G

# Query 36: 0.01 QPS, 0.02x concurrency, ID 0xBC6AD8511E5DCBAA at byte 6252059
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.12
# Time range: 2018-04-16 18:25:22 to 20:21:25
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      35
# Exec time      0    109s      2s      4s      3s      4s   625ms      3s
# Lock time      0    11ms    53us   405us   302us   384us   115us   348us
# Rows sent      0     256       3      10    7.31    9.83    3.17    9.83
# Rows examine   0  12.96M 162.83k 613.81k 379.30k 562.03k 201.86k 485.50k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1  85.07k   2.43k   2.43k   2.43k   2.43k       0   2.43k
# String:
# Databases    yimi
# Hosts        10.80.58.47 (9/25%), 10.28.143.117 (8/22%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'server_trail_and_voice'\G
#    SHOW CREATE TABLE `yimi`.`server_trail_and_voice`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,
        l.teacherId,
        l.lessonType,
        l.courseHours,
        date_format(l.startTime,'%Y-%m-%d %H:%i') AS startTime,
        date_format(l.endTime,'%Y-%m-%d %H:%i') AS endTime,
        (case ec.clientName when '' then tui.realName else ec.clientName end) studentName,
        s.subjectName,
        g.gradeName,
        l.lessonStatus,
        timestampdiff(second,now(),l.startTime) remaining,
        timestampdiff(second,l.startTime,l.endTime) lessonSecondCount,
        cast(pre.configValue as signed)*60 beforeSecond,
        cast(aft.configValue as signed)*60 afterSecond,
        if(exists(select 1 from server_trail_and_voice where status=1 and lessonID=l.lessonId),1,0) hasRecord,
        if(exists(select 1 from erp_lesson_docs where parentId=0 and docType=1 and lessonId=l.lessonId),1,0) hasDoc,
        "" AS title,
        "" AS keywords,
        case l.studentAppraiseType when 0 then '未评价' when 1 then '好评' when 2 then '中评' when 3 then '差评' end
        studentAppraiseType,
        studentAppraises
        FROM mis_user_info u
        LEFT JOIN erp_clients ec ON u.userId = ec.chargeFid
        LEFT JOIN mis_user_info u1 ON u1.userId = ec.consultantId
        LEFT JOIN mis_user_info u2 ON u2.userId = ec.cooperateConsultantId
        INNER JOIN erp_lessons l ON ec.studentId = l.studentId
        INNER JOIN t_user_info tui on tui.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
        INNER JOIN www_config pre on pre.configId=1
        INNER JOIN www_config aft on aft.configId=2
        WHERE
        ((u.userOrgFid IN
         (  
            3020100
         ) 
         
            and ec.chargeFid = 900001367
         
        )
        OR (CASE WHEN ec.consultantId!= ec.chargeFid THEN
        u1.userOrgFid IN
         (  
            3020100
         ) 
         
            and ec.consultantId = 900001367
         
        END)
        OR (u2.userOrgFid IN
         (  
            3020100
         ) 
         
            AND ec.cooperateConsultantId = 900001367
         
        ))
         
         
         
            AND l.startTime >= '2018-04-16'
         
         
         
        ORDER BY l.lessonStatus,
        CASE WHEN l.lessonStatus in(0) THEN
        l.startTime END,
        CASE WHEN l.lessonStatus in(1) THEN
        l.startTime END desc
        limit 0, 10\G

# Query 37: 1 QPS, 7.27x concurrency, ID 0x24A7383D45436873 at byte 4068755
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.52
# Time range: 2018-04-16 16:52:16 to 16:52:31
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      15
# Exec time      0    109s      3s      9s      7s      9s      2s      8s
# Lock time      0     3ms   104us   241us   209us   236us    32us   204us
# Rows sent      0      15       1       1       1       1       0       1
# Rows examine   0  10.18M 695.29k 695.29k 695.29k 695.29k       0 695.29k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  20.49k   1.37k   1.37k   1.37k   1.37k       0   1.37k
# String:
# Databases    yimi
# Hosts        10.31.53.111 (5/33%), 10.80.237.213 (3/20%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        COUNT(1)
        FROM mis_user_info u
        LEFT JOIN erp_clients ec ON u.userId = ec.chargeFid
        LEFT JOIN mis_user_info u1 ON u1.userId = ec.consultantId
        LEFT JOIN mis_user_info u2 ON u2.userId = ec.cooperateConsultantId
        INNER JOIN erp_lessons l ON ec.studentId = l.studentId
        INNER JOIN t_user_info tui on tui.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
        INNER JOIN www_config pre on pre.configId=1
        INNER JOIN www_config aft on aft.configId=2
        WHERE
        ((u.userOrgFid IN
         (  
            6040100
         ) 
         
            and ec.chargeFid = 900001273
         
        )
        OR (CASE WHEN ec.consultantId!= ec.chargeFid THEN
        u1.userOrgFid IN
         (  
            6040100
         ) 
         
            and ec.consultantId = 900001273
         
        END)
        OR (u2.userOrgFid IN
         (  
            6040100
         ) 
         
            AND ec.cooperateConsultantId = 900001273
         
        ))
         
            and (l.clientId='黄佑琪'
            or ec.clientName='黄佑琪'
            or l.lessonId='黄佑琪'
            or tui.realname='黄佑琪'
            )
         
         
         
            AND l.startTime >= '2018-04-15'\G

# Query 41: 0.00 QPS, 0.00x concurrency, ID 0x223BB93DB6B60FD2 at byte 859937
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.04
# Time range: 2018-04-16 09:23:08 to 19:37:09
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      39
# Exec time      0     97s      2s      3s      2s      3s   312ms      3s
# Lock time      0    15ms   180us     5ms   375us   301us   730us   247us
# Rows sent      0   8.22k       0     380  215.92  363.48  142.59  284.79
# Rows examine   0  61.62M   1.27M   1.72M   1.58M   1.69M 144.12k   1.61M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  63.50k   1.63k   1.63k   1.63k   1.61k       0   1.61k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_channel`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_event'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_event`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel_cate'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel_cate`\G
# EXPLAIN /*!50100 PARTITIONS*/
select 
				if(ec.sysCity='' or ec.sysCity IS NULL,'未知城市',ec.sysCity) cityName,
				count(ec.clientId) leadsCount,
				sum(ece.isDeadNumber) deadNumberCount,
				count(reservation.clientFid) reservationCount,
				count(attend.clientFid) attendCount,
				count(sign.clientFid) signCount,
				sum(ifnull(sign.firstContractAmount,0)) signAmount
			from erp_clients ec
			join (
				SELECT erp_client_channel.* FROM erp_client_channel 
				JOIN (select max(id) id,clientFid from erp_client_channel 
							where isSettle = 1 group by clientFid) t 
				ON t.clientFid=erp_client_channel.clientFid AND erp_client_channel.id=t.id
			) ecc on ec.clientId = ecc.clientFid
			join erp_client_event ece on ec.clientId = ece.clientFid
			left join erp_client_event reservation
				on ece.clientFid = reservation.clientFid 
				and reservation.applicationFid>0 
				 
			left join erp_client_event attend
				on ece.clientFid = attend.clientFid
				and attend.attendLessonFid>0 
				 
			left join erp_client_event sign
				on ece.clientFid = sign.clientFid
				and sign.firstContractFid>0
				 
			where date(ece.createTime) between '2018-02-26' and '2018-04-01'
				
				and not exists (
					select 1 from user_test ut where ec.studentId = ut.userId and ut.accType = 'STU'
				)
				 
				 
				and exists(
					select 1 from
						erp_channel c
						join erp_channel c1 on c.pid = c1.id
						join erp_channel_cate ecc on ecc.cateId = c.cateFid
						where c.id = ecc.secondChannelFid
						and ecc.levelId = 5
						 
						 
						  and ecc.cate3Fid=9  
						 
						 
						 
				)
			
			group by if(ec.sysCity='' or ec.sysCity IS NULL,'未知城市',ec.sysCity)\G

# Query 45: 0.00 QPS, 0.00x concurrency, ID 0x60E69C3EBFFC9431 at byte 3032978
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.03
# Time range: 2018-04-16 10:51:18 to 22:22:03
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      36
# Exec time      0     90s      2s      3s      2s      3s   262ms      2s
# Lock time      0    10ms    43us   476us   283us   366us    95us   308us
# Rows sent      0      53       1      10    1.47    0.99    1.92    0.99
# Rows examine   0  23.16M 441.80k 683.50k 658.85k 683.15k  37.47k 650.62k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  74.04k   2.06k   2.06k   2.06k   2.06k       0   2.06k
# String:
# Databases    yimi
# Hosts        10.81.244.3 (10/27%), 10.81.244.11 (7/19%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'server_trail_and_voice'\G
#    SHOW CREATE TABLE `yimi`.`server_trail_and_voice`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_teacher_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_teacher_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,
        l.teacherId,
        l.lessonType,
        l.courseHours,
        DATE_FORMAT(l.startTime,'%Y-%m-%d %H:%i') AS startTime,
        DATE_FORMAT(l.endTime,'%Y-%m-%d %H:%i') AS endTime,
        (CASE ec.clientName WHEN '' THEN tui.realName ELSE ec.clientName END) studentName,
        s.subjectName,
        g.gradeName,
        l.lessonStatus,
        TIMESTAMPDIFF(SECOND,NOW(),l.startTime) remaining,
        TIMESTAMPDIFF(SECOND,l.startTime,l.endTime) lessonSecondCount,
        CAST(pre.configValue AS SIGNED)*60 beforeSecond,
        CAST(aft.configValue AS SIGNED)*60 afterSecond,
        IF(EXISTS(SELECT 1 FROM server_trail_and_voice WHERE STATUS=1 AND lessonID=l.lessonId),1,0) hasRecord,
        IF(EXISTS(SELECT 1 FROM erp_lesson_docs WHERE parentId=0 AND docType=1 AND lessonId=l.lessonId),1,0) hasDoc,
        "" AS title,
        "" AS keywords,
        CASE l.studentAppraiseType WHEN 0 THEN '未评价' WHEN 1 THEN '好评' WHEN 2 THEN '中评' WHEN 3 THEN '差评' END
        studentAppraiseType,
        studentAppraises

        FROM mis_teacher_info u
        INNER JOIN erp_lessons l ON u.subjectIds LIKE CONCAT('%,',l.subjectId,',%')
        INNER JOIN t_user_info tui ON tui.id = l.studentId
        LEFT JOIN erp_clients ec ON ec.studentId = l.studentId
        LEFT JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
        INNER JOIN www_config pre ON pre.configId=1
        INNER JOIN www_config aft ON aft.configId=2
        WHERE u.userFid = 800121389
         
            AND (l.clientId='910290'
            OR ec.clientName='910290'
            OR l.lessonId='910290'
            OR tui.realname='910290'
            )
         
         
         
         
         
            AND ((l.startTime > DATE(NOW()) AND l.lessonStatus=0) OR l.lessonStatus=1)
         
        ORDER BY l.lessonStatus,
        CASE WHEN l.lessonStatus IN(0) THEN
        l.startTime END,
        CASE WHEN l.lessonStatus IN(1) THEN
        l.startTime END DESC
        LIMIT 0, 10\G

# Query 48: 0.00 QPS, 0.00x concurrency, ID 0xF928383DFAECA667 at byte 5502321
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.18
# Time range: 2018-04-16 10:07:33 to 22:31:59
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      29
# Exec time      0     83s      2s      5s      3s      4s   706ms      3s
# Lock time      0     3ms    42us   123us    98us   119us    19us    93us
# Rows sent      0     771      14      41   26.59   33.28    5.24   24.84
# Rows examine   0   4.10M 122.16k 170.18k 144.77k 150.54k  10.15k 136.54k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  35.54k   1.23k   1.23k   1.23k   1.23k       0   1.23k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_series'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_series`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_series_lesson_ref'\G
#    SHOW CREATE TABLE `yimi`.`lvb_series_lesson_ref`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
		l.lessonId,lessonName,playBegin,playEnd,l.orginalPrice,l.currentPrice,entryLimit,img1,img2,r.refNum,
		if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
		WHERE  l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
		(SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount,
		 
			(SELECT IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=191195 AND o.orderType='L' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,
			IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=191195 AND o.orderType='S' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,0))) isPaid,
		 
		(SELECT if(count(1) =(l.entryLimit-l.entryBase),1,0) FROM lvb_order_lesson ol  WHERE ol.lessonId = l.lessonId) as isFull
		FROM
		lvb_lesson_series ls
		INNER join lvb_series_lesson_ref r on ls.seriesId=r.seriesFid
		INNER join lvb_lesson l  on r.lessonFid=l.lessonId
		left join lvb_lesson_ext le on l.lessonId=le.lessonFid
		where
		ls.seriesId = '121'
		and l.applyFids  like concat('%,',concat(1,',%'))
		and now() >= l.validBegin
		group by l.lessonId\G

# Query 50: 0.00 QPS, 0.00x concurrency, ID 0x50E7215F3276D4D0 at byte 3616188
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.59
# Time range: 2018-04-16 11:48:13 to 23:43:09
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      17
# Exec time      0     82s      3s      9s      5s      8s      2s      4s
# Lock time      0     2ms    31us   193us    89us   176us    52us    58us
# Rows sent      0   2.71k     102     217  163.53  212.52   45.41  136.99
# Rows examine   0 273.51M  10.03M  21.38M  16.09M  21.31M   4.68M  13.74M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  19.79k   1.16k   1.16k   1.16k   1.16k       0   1.16k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,lessonName,playBegin,playEnd,orginalPrice,currentPrice,entryLimit,img1,img2,
        if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
        WHERE l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
        (SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount
        FROM
        lvb_lesson l left join lvb_lesson_ext le on l.lessonId = le.lessonFid
        where
        (
          
             
              
                1=1
             
          
        )
        and
        (
          
              
                termIds like concat (concat('%','220'),'%')
             
             
          
        )
        and
        (
          
             
             
             
              
                1=1
             
          
        )
        and
        (
          
             
             
              
                1=1
             
          
        )
        and l.applyFids  like concat('%',concat(1,'%'))
        and now() >= l.validBegin
        and now()  <=  l.validEnd
        group by l.lessonId\G

# Query 53: 0.00 QPS, 0.00x concurrency, ID 0xED82BEFCE140F1FC at byte 2525214
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.05
# Time range: 2018-04-16 13:40:19 to 18:30:10
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      21
# Exec time      0     71s      3s      4s      3s      4s   420ms      3s
# Lock time      0     6ms   104us   332us   263us   316us    53us   273us
# Rows sent      0      21       1       1       1       1       0       1
# Rows examine   0  35.37M   1.68M   1.69M   1.68M   1.61M   1.29k   1.61M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  41.41k   1.97k   1.97k   1.97k   1.97k       0   1.97k
# String:
# Databases    yimi
# Hosts        10.80.58.47 (7/33%), 10.81.244.11 (4/19%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'server_trail_and_voice'\G
#    SHOW CREATE TABLE `yimi`.`server_trail_and_voice`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,
        l.teacherId,
        l.lessonType,
        l.courseHours,
        date_format(l.startTime,'%Y-%m-%d %H:%i') AS startTime,
        date_format(l.endTime,'%Y-%m-%d %H:%i') AS endTime,
        (case c.clientName when '' then u.realName else c.clientName end) studentName,
        s.subjectName,
        g.gradeName,
        l.lessonStatus,
        timestampdiff(second,now(),l.startTime) remaining,
        timestampdiff(second,l.startTime,l.endTime) lessonSecondCount,
        cast(pre.configValue as signed)*60 beforeSecond,
        cast(aft.configValue as signed)*60 afterSecond,
        if(exists(select 1
        from server_trail_and_voice where status=1 and lessonID=l.lessonId),1,0)
        hasRecord,
        if(exists(select 1 from
        erp_lesson_docs where parentId=0 and docType=1 and
        lessonId=l.lessonId),1,0) hasDoc,
        "" AS title,
        "" AS keywords,
        case l.studentAppraiseType when 0 then '未评价' when 1 then '好评' when 2 then '中评' when 3 then '差评' end
        studentAppraiseType,studentAppraises
        FROM
        erp_lessons l
        LEFT JOIN erp_clients c ON c.studentId = l.studentId
        INNER JOIN t_user_info u on u.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON s.subjectId = l.subjectId
        INNER JOIN erp_conf_student_grades g ON g.gradeId = l.gradeId
        INNER JOIN www_config pre on pre.configId=1
        INNER JOIN www_config aft on aft.configId=2
        WHERE l.lessonStatus in(0,1)
         
            and (l.clientId='924260'
            or c.clientName='924260'
            or l.lessonId='924260'
            or u.realname='924260'
            )
         
         
         
         
         
            AND ((l.startTime > date(now()) and l.lessonStatus=0) or l.lessonStatus=1)
         
        ORDER BY l.lessonStatus,CASE WHEN l.lessonStatus in(0) THEN
        l.startTime END,CASE WHEN l.lessonStatus in(1) THEN
        l.startTime END desc
        limit 0, 10\G

# Query 54: 0.00 QPS, 0.00x concurrency, ID 0xF5446E0AC6AB1913 at byte 8191049
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.11
# Time range: 2018-04-16 15:36:04 to 22:43:56
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      24
# Exec time      0     70s      2s      4s      3s      4s   567ms      3s
# Lock time      0     2ms    61us    86us    73us    84us     7us    73us
# Rows sent      0    1015      24      63   42.29   59.77    9.61   36.69
# Rows examine   0 197.44M   4.69M  12.22M   8.23M  11.87M   1.87M   7.29M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  21.47k     916     916     916     916       0     916
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
				l.lessonId,le.lessonFid,l.lessonName,l.playBegin,l.playEnd,l.orginalPrice,l.currentPrice,l.entryLimit,le.img1,le.img2,o.paidOn,
				 (SELECT if(count(1) = (l.entryLimit-l.entryBase),1,0) FROM lvb_order_lesson ol  WHERE ol.lessonId = l.lessonId) as isFull,
			if(now() <= l.playBegin ,0,if(l.streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
			WHERE l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
				(SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase  as paycount
			FROM
			lvb_lesson l
			    LEFT JOIN lvb_lesson_ext le on l.lessonId = le.lessonFid
				INNER JOIN lvb_order_lesson s on s.lessonId=l.lessonId
				INNER JOIN lvb_order o on o.orderid = s.orderFid
			WHERE
				o.studentFid = 191552 and o.isPaid=1
				and l.applyFids  like concat('%,',concat(1,',%'))
				and now() >= l.validBegin
            group by l.lessonId\G

# Query 56: 0.00 QPS, 0.00x concurrency, ID 0xA605B4FF51F45E6F at byte 2950849
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.08
# Time range: 2018-04-16 13:40:21 to 18:30:14
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      21
# Exec time      0     65s      2s      4s      3s      4s   498ms      3s
# Lock time      0     3ms    80us   180us   136us   159us    23us   131us
# Rows sent      0      21       1       1       1       1       0       1
# Rows examine   0  35.37M   1.68M   1.69M   1.68M   1.61M   1.33k   1.61M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  15.69k     765     765     765     765       0     765
# String:
# Databases    yimi
# Hosts        10.80.58.47 (7/33%), 10.81.244.11 (4/19%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        COUNT(1)
        FROM
        erp_lessons l
        LEFT JOIN erp_clients c ON c.studentId = l.studentId
        INNER JOIN t_user_info u on u.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON s.subjectId = l.subjectId
        INNER JOIN erp_conf_student_grades g ON g.gradeId = l.gradeId
        INNER JOIN www_config pre on pre.configId=1
        INNER JOIN www_config aft on aft.configId=2
        WHERE l.lessonStatus in(0,1)
         
            and (l.clientId='924260'
            or c.clientName='924260'
            or l.lessonId='924260'
            or u.realname='924260'
            )
         
         
         
         
         
            AND ((l.startTime > date(now()) and l.lessonStatus=0) or l.lessonStatus=1)\G

# Query 57: 0.00 QPS, 0.00x concurrency, ID 0x53E68A2F4F0BCA83 at byte 2695521
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.18
# Time range: 2018-04-16 09:00:02 to 23:30:02
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      23
# Exec time      0     62s      2s      6s      3s      3s   700ms      3s
# Lock time      0   111ms    96us    50ms     5ms     7ms    14ms   152us
# Rows sent      0      23       1       1       1       1       0       1
# Rows examine   0   8.57M 380.24k 382.01k 381.41k 380.41k  902.50 380.41k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  16.08k     716     716     716     716       0     716
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_follow'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_follow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_follow_status'\G
#    SHOW CREATE TABLE `yimi`.`erp_follow_status`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
			   ifnull(sum(if(ec.flag in('A1','A2'),1,0)),0) AClientNum,
			   ifnull(sum(if(ec.flag='B',1,0)),0) BClientNum,
			   count(0) totalNum, date_format(now(),'%H:%i') now,
				ifnull( sum(if(ec.flag in('A1','A2') and ecf.clientFid is null,1,0)),0) AClientNoFollowNum,
				ifnull(sum(if(ec.flag = 'B' and ecf.clientFid is null,1,0)),0) BClientNoFollowNum,
			   ifnull(sum(if(ecf.clientFid is null,1,0)),0) clientNoFollowNum from erp_clients ec
			left join (
						  SELECT clientFid
							  FROM erp_client_follow ecf
								where ecf.clientFid not in(select statusId from erp_follow_status where type=',SYS,')
							  GROUP BY clientFid
					  ) ecf on ecf.clientFid=ec.clientId
		where ec.clientSea='T'\G

# Query 60: 0.00 QPS, 0.01x concurrency, ID 0x533B6E4A3847D8FE at byte 5151237
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.07
# Time range: 2018-04-16 16:18:55 to 18:28:45
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      21
# Exec time      0     61s      2s      4s      3s      4s   465ms      3s
# Lock time      0     8ms   299us   641us   397us   467us    87us   348us
# Rows sent      0   6.25k       6     375  304.71  363.48  140.47  363.48
# Rows examine   0  39.75M   1.88M   1.96M   1.89M   1.86M  20.27k   1.86M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1  88.53k   4.22k   4.22k   4.22k   4.22k       0   4.22k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel_cate'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel_cate`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_channel`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_event'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_event`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
			 temp1.cate1,
			 temp1.cate2,
			 temp1.cate3,
			 temp1.cate4,
			 temp1.cate5,
			 temp1.cate1Fid,
			 temp1.cate2Fid,
			 temp1.cate3Fid,
			 temp1.cate4Fid,
			 temp1.cate5Fid,
			 temp1.levelId,
			  
			 		0 secondChannelId,
					null secondChannel,
					0 firstChannelId,
					null firstChannel,
			 	 
			 temp2.propBFid,
			 sum(temp2.leadsCount) leadsCount,
			 sum(temp2.deadNumberCount) deadNumberCount,
			 sum(temp2.reservationCount) reservationCount,
			 sum(temp2.attendCount) attendCount,
			 sum(temp2.signCount) signCount,
			 sum(temp2.signAmount) signAmount,
			 sum(temp2.leadsToReservation) leadsToReservationAvg,
			 sum(temp2.reservationToAttend) reservationToAttendAvg,
			 sum(temp2.attendToSign) attendToSignAvg,
			 sum(temp2.leadsToSign) leadsToSignAvg
			 from 
			(
				select
					 
					 
				 	 
				 	 
				 	 
				 		5 levelId,
				 		cate1Fid,
				 		cate1,
					 	cate2Fid,
					 	cate2,
					 	cate3Fid,
					 	cate3,
					 	cate4Fid,
					 	cate4,
					 	cateId cate5Fid,
					 	cateName cate5,
				 	 
				 	cateId
				from erp_channel_cate t
				where levelId = 5
				 
				 
				 
				 and cate4Fid = 20 
				 
			)temp1
			left join (
				select  
					c.cateFid,
					c.id secondChannelId,
					c.name secondChannel,
					c.propBFid,
					c1.id firstChannelId,
					c1.name firstChannel,
					ifnull(leadsCount,0) leadsCount,
					ifnull(deadNumberCount,0) deadNumberCount,
					ifnull(reservationCount,0) reservationCount,
					ifnull(attendCount,0) attendCount,
					ifnull(signCount,0) signCount,
					ifnull(signAmount,0) signAmount,
					ifnull(leadsToReservation,0) leadsToReservation,
					ifnull(reservationToAttend,0) reservationToAttend,
					ifnull(attendToSign,0) attendToSign,
					ifnull(leadsToSign,0) leadsToSign
				from 
				erp_channel c
				join erp_channel c1 on c.pid = c1.id
				join erp_channel_cate ecc on ecc.cateId = c.cateFid
				join (
					select 
						ecc.secondChannelFid,
						ecc.secondChannel,
						ecc.firstChannelFid,
						ecc.firstChannel,
						count(ec.clientId) leadsCount,
						sum(ce.isDeadNumber) deadNumberCount,
						count(reservation.clientFid) reservationCount,
						count(attend.clientFid) attendCount,
						count(sign.clientFid) signCount,
						sum(ifnull(sign.firstContractAmount,0)) signAmount,
						sum(ifnull(dateDiff(reservation.applicationTime,reservation.createTime),0)) leadsToReservation,
						sum(ifnull(dateDiff(attend.attendTime ,attend.applicationTime),0)) reservationToAttend,
						sum(ifnull(dateDiff(sign.firstContractPayTime ,sign.attendTime),0)) attendToSign,
						sum(ifnull(dateDiff(sign.firstContractPayTime ,sign.createTime),0)) leadsToSign
					 from 
						 
						(
							SELECT 
								erp_client_channel.* 
							FROM 
								erp_client_channel 
							JOIN
								(SELECT 
									clientFid,MAX(id) id 
								FROM 
									erp_client_channel
								where 
									isSettle = 1
								group by clientFid) temp
							ON 
								temp.clientFid=erp_client_channel.clientFid AND erp_client_channel.id=temp.id						
						) ecc
						join erp_clients ec on ecc.clientFid = ec.clientId
						join erp_client_event ce on ce.clientFid = ec.clientId
						left join erp_client_event reservation 
							on ce.clientFid = reservation.clientFid 
							and reservation.applicationFid>0 
							 
								and reservation.applicationTime < DATE_ADD(date(reservation.createTime),INTERVAL 91+1 DAY)
							 
						left join erp_client_event attend
							on ce.clientFid = attend.clientFid
							and attend.attendLessonFid>0 
							 
								and attend.attendTime < DATE_ADD(date(attend.createTime),INTERVAL 91+1 DAY)
							 
						left join erp_client_event sign
							on ce.clientFid = sign.clientFid
							and sign.firstContractFid>0
							 
								and sign.firstContractPayTime < DATE_ADD(date(sign.createTime),INTERVAL 91+1 DAY)
							 
					where date(ce.createTime) between '2018-04-02' and '2018-04-08' 
							
							and not exists (
								select 1 from user_test ut where ec.studentId = ut.userId and ut.accType = 'STU'
							)
							 
					group by ecc.secondChannelFid
				) temp on c.id = temp.secondChannelFid
				  
			)temp2 on temp1.cateId = temp2.cateFid
			 
			
			 
			 
			 
			 
			 group by temp1.cate5Fid  order by temp1.cate5Fid asc\G

# Query 61: 0.00 QPS, 0.00x concurrency, ID 0x4E36042C05849EC9 at byte 5166387
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.12
# Time range: 2018-04-16 06:57:56 to 23:31:18
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      23
# Exec time      0     61s      2s      4s      3s      4s   565ms      2s
# Lock time      0     2ms    61us    96us    71us    76us     8us    69us
# Rows sent      0    1011      27      50   43.96   46.83    6.88   44.60
# Rows examine   0 195.44M   5.21M   9.66M   8.50M   9.30M   1.35M   8.86M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  19.74k     879     879     879     879       0     879
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_series'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_series`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_series_lesson_ref'\G
#    SHOW CREATE TABLE `yimi`.`lvb_series_lesson_ref`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
		l.lessonId,lessonName,playBegin,playEnd,l.orginalPrice,l.currentPrice,entryLimit,img1,img2,r.refNum,
		if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
		WHERE  l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
		(SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount,
		 
		(SELECT if(count(1) =(l.entryLimit-l.entryBase),1,0) FROM lvb_order_lesson ol  WHERE ol.lessonId = l.lessonId) as isFull
		FROM
		lvb_lesson_series ls
		INNER join lvb_series_lesson_ref r on ls.seriesId=r.seriesFid
		INNER join lvb_lesson l  on r.lessonFid=l.lessonId
		left join lvb_lesson_ext le on l.lessonId=le.lessonFid
		where
		ls.seriesId = '143'
		and l.applyFids  like concat('%,',concat(1,',%'))
		and now() >= l.validBegin
		and now()  <=  l.validEnd
		group by l.lessonId\G

# Query 62: 0.00 QPS, 0.00x concurrency, ID 0x9954249D2259D880 at byte 3191979
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.43
# Time range: 2018-04-16 09:44:10 to 16:02:22
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      11
# Exec time      0     60s      3s      8s      5s      7s      2s      5s
# Lock time      0     3ms    52us   339us   273us   316us    85us   301us
# Rows sent      0      11       1       1       1       1       0       1
# Rows examine   0  21.79M   1.98M   1.98M   1.98M   1.95M       0   1.95M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  61.47k   1.91k   6.41k   5.59k   6.31k   1.72k   6.31k
# String:
# Databases    yimi
# Hosts        10.28.143.117 (5/45%), 10.80.58.47 (4/36%)... 1 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        COUNT(1)
        FROM mis_user_info u
        LEFT JOIN erp_clients ec ON u.userId = ec.chargeFid
        LEFT JOIN mis_user_info u1 ON u1.userId = ec.consultantId
        LEFT JOIN mis_user_info u2 ON u2.userId = ec.cooperateConsultantId
        INNER JOIN erp_lessons l ON ec.studentId = l.studentId
        INNER JOIN t_user_info tui on tui.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
         INNER JOIN www_config pre on pre.configId=1
         INNER JOIN www_config aft on aft.configId=2
        WHERE
        l.lessonStatus = 1 and
        ((u.userOrgFid IN
         (  
            6070100
         , 
            6060100
         , 
            6050100
         , 
            6040100
         , 
            6030100
         , 
            6020100
         , 
            6010100
         , 
            6070000
         , 
            6060000
         , 
            6050000
         , 
            6040000
         , 
            6030000
         , 
            6020000
         , 
            6010000
         , 
            3130000
         , 
            3120000
         , 
            3110000
         , 
            3100000
         , 
            3080000
         , 
            3070000
         /*... omitted 30 items ...*/) 
         
        )
        OR (CASE WHEN ec.consultantId!= ec.chargeFid THEN
        u1.userOrgFid IN
         (  
            6070100
         , 
            6060100
         , 
            6050100
         , 
            6040100
         , 
            6030100
         , 
            6020100
         , 
            6010100
         , 
            6070000
         , 
            6060000
         , 
            6050000
         , 
            6040000
         , 
            6030000
         , 
            6020000
         , 
            6010000
         , 
            3130000
         , 
            3120000
         , 
            3110000
         , 
            3100000
         , 
            3080000
         , 
            3070000
         /*... omitted 30 items ...*/) 
         
        END)
        OR (u2.userOrgFid IN
         (  
            6070100
         , 
            6060100
         , 
            6050100
         , 
            6040100
         , 
            6030100
         , 
            6020100
         , 
            6010100
         , 
            6070000
         , 
            6060000
         , 
            6050000
         , 
            6040000
         , 
            6030000
         , 
            6020000
         , 
            6010000
         , 
            3130000
         , 
            3120000
         , 
            3110000
         , 
            3100000
         , 
            3080000
         , 
            3070000
         /*... omitted 30 items ...*/) 
         
        ))
         
         
        	and l.subjectId in
	         (  
	            0
	         , 
	            1
	         , 
	            2
	         , 
	            3
	         , 
	            4
	         , 
	            5
	         , 
	            6
	         , 
	            7
	         , 
	            8
	         , 
	            9
	         , 
	            13
	         , 
	            16
	         ) 
         
         
        	and l.gradeId in
	         (  
	            130
	         , 
	            140
	         , 
	            150
	         , 
	            160
	         , 
	            170
	         , 
	            210
	         , 
	            220
	         , 
	            230
	         , 
	            240
	         , 
	            310
	         , 
	            320
	         , 
	            330
	         , 
	            410
	         )\G

# Query 63: 0.00 QPS, 0.00x concurrency, ID 0x4B83C48FBD8F9C61 at byte 480938
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.03
# Time range: 2018-04-16 08:10:13 to 17:23:27
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      22
# Exec time      0     59s      2s      3s      3s      3s   298ms      3s
# Lock time      0     4ms   149us   277us   197us   224us    30us   194us
# Rows sent      0      22       1       1       1       1       0       1
# Rows examine   0  22.84M   1.03M   1.04M   1.04M   1.03M   3.30k   1.03M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  27.89k   1.27k   1.27k   1.27k   1.27k       0   1.27k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
        count(distinct
        clientFid) finishClientCount from erp_contract co
        inner join
        (select
        o.contractFid,max(startTime)
        startTime,sum(courseHours) courseHours
        from erp_contract_orders o
        ,(select contractId,max(startTime)
        startTime,sum(courseHours)
        courseHours from
        erp_lessons
        where
        lessonStatus in(1,3,4) group by contractId) l
        where o.contractId=l.contractId
        group by o.contractFid) oo
        on
        co.contractId=oo.contractFid and co.contractFlag='N'
        where
        date(startTime) between '2018-04-09' and
        '2018-04-15'
        and co.totalLessonCount=courseHours
        and studentFid not in(select userId
        from user_test where accType='STU')
        and co.clientFid not in(select clientId from erp_contract coo,erp_contract_orders
        o
        left join (select contractId,sum(courseHours) courseHours
        from erp_lessons
        where contractId>0 and lessonStatus in(1,3,4) and startTime < date_add('2018-04-15',interval
        1 day) group by contractId) l on o.contractId=l.contractId
        where
        o.contractFid=coo.contractId
        and coo.payTime < '2018-04-09'
        and ifnull(l.courseHours,0)!=realLessonCount)\G

# Query 71: 0.00 QPS, 0.00x concurrency, ID 0x4E33A4D16C9051F7 at byte 490782
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.28
# Time range: 2018-04-16 08:10:20 to 17:23:32
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      16
# Exec time      0     47s      2s      6s      3s      5s   902ms      3s
# Lock time      0     3ms   124us   214us   173us   204us    25us   176us
# Rows sent      0      16       1       1       1       1       0       1
# Rows examine   0  19.71M   1.22M   1.23M   1.23M   1.20M       0   1.20M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  17.30k   1.08k   1.08k   1.08k   1.08k       0   1.08k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_order_flow'\G
#    SHOW CREATE TABLE `yimi`.`erp_order_flow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
select count(distinct clientId) pauseStudentCount from
        erp_contract_orders o,(
        select
        ff.orderFid,orderStatusFid from
        erp_order_flow ff ,(select orderFid,
        max(createdOn) createdOn from
        erp_order_flow
        where createdOn < date_add('2018-04-15',interval
        1 day) and orderStatusFid>0 group by orderFid) fff where ff.createdOn=fff.createdOn and
        ff.orderFid=fff.orderFid) f
        where o.contractId=f.orderFid and
        f.orderStatusFid in(6)
        and studentId
        not
        in(select userId from user_test)
        and clientId not
        in(select clientId
        from
        erp_contract_orders o,(
        select
        ff.orderFid,orderStatusFid from
        erp_order_flow ff ,(select orderFid,
        max(createdOn) createdOn from
        erp_order_flow
        where createdOn < date_add('2018-04-15',interval
        1 day) and orderStatusFid>0 group by orderFid) fff where ff.createdOn=fff.createdOn and
        ff.orderFid=fff.orderFid) f
        where o.contractId=f.orderFid and
        f.orderStatusFid in(1,2))\G

# Query 72: 0.00 QPS, 0.00x concurrency, ID 0x1937B21D3A757C2D at byte 6635622
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.05
# Time range: 2018-04-16 08:50:45 to 20:12:34
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      15
# Exec time      0     45s      2s      4s      3s      3s   400ms      3s
# Lock time      0     6ms   302us     1ms   417us   445us   170us   384us
# Rows sent      0      15       1       1       1       1       0       1
# Rows examine   0  27.98M   1.21M   1.91M   1.87M   1.86M 168.72k   1.86M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  58.45k   3.90k   3.90k   3.90k   3.90k       0   3.90k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel_cate'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel_cate`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_channel`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_event'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_event`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
			 temp1.cate1,
			 temp1.cate2,
			 temp1.cate3,
			 temp1.cate4,
			 temp1.cate5,
			 temp1.cate1Fid,
			 temp1.cate2Fid,
			 temp1.cate3Fid,
			 temp1.cate4Fid,
			 temp1.cate5Fid,
			 temp1.levelId,
			  
			 		0 secondChannelId,
					null secondChannel,
					0 firstChannelId,
					null firstChannel,
			 	 
			 temp2.propBFid,
			 sum(temp2.leadsCount) leadsCount,
			 sum(temp2.deadNumberCount) deadNumberCount,
			 sum(temp2.reservationCount) reservationCount,
			 sum(temp2.attendCount) attendCount,
			 sum(temp2.signCount) signCount,
			 sum(temp2.signAmount) signAmount,
			 sum(temp2.leadsToReservation) leadsToReservationAvg,
			 sum(temp2.reservationToAttend) reservationToAttendAvg,
			 sum(temp2.attendToSign) attendToSignAvg,
			 sum(temp2.leadsToSign) leadsToSignAvg
			 from 
			(
				select
					 
						1 levelId,
				 		cate1Fid,
				 		cate1,
					 	0 cate2Fid,
					 	NULL cate2,
					 	0 cate3Fid,
					 	NULL cate3,
					 	0 cate4Fid,
					 	NULL cate4,
					 	0 cate5Fid,
					 	NULL cate5,
				 	 
					 
				 	 
				 	 
				 	 
				 	cateId
				from erp_channel_cate t
				where levelId = 5
				 
				 
				 
				 
				 
			)temp1
			left join (
				select  
					c.cateFid,
					c.id secondChannelId,
					c.name secondChannel,
					c.propBFid,
					c1.id firstChannelId,
					c1.name firstChannel,
					ifnull(leadsCount,0) leadsCount,
					ifnull(deadNumberCount,0) deadNumberCount,
					ifnull(reservationCount,0) reservationCount,
					ifnull(attendCount,0) attendCount,
					ifnull(signCount,0) signCount,
					ifnull(signAmount,0) signAmount,
					ifnull(leadsToReservation,0) leadsToReservation,
					ifnull(reservationToAttend,0) reservationToAttend,
					ifnull(attendToSign,0) attendToSign,
					ifnull(leadsToSign,0) leadsToSign
				from 
				erp_channel c
				join erp_channel c1 on c.pid = c1.id
				join erp_channel_cate ecc on ecc.cateId = c.cateFid
				join (
					select 
						ecc.secondChannelFid,
						ecc.secondChannel,
						ecc.firstChannelFid,
						ecc.firstChannel,
						count(ec.clientId) leadsCount,
						sum(ce.isDeadNumber) deadNumberCount,
						count(reservation.clientFid) reservationCount,
						count(attend.clientFid) attendCount,
						count(sign.clientFid) signCount,
						sum(ifnull(sign.firstContractAmount,0)) signAmount,
						sum(ifnull(dateDiff(reservation.applicationTime,reservation.createTime),0)) leadsToReservation,
						sum(ifnull(dateDiff(attend.attendTime ,attend.applicationTime),0)) reservationToAttend,
						sum(ifnull(dateDiff(sign.firstContractPayTime ,sign.attendTime),0)) attendToSign,
						sum(ifnull(dateDiff(sign.firstContractPayTime ,sign.createTime),0)) leadsToSign
					 from 
						 
						(
							SELECT 
								erp_client_channel.* 
							FROM 
								erp_client_channel 
							JOIN
								(SELECT 
									clientFid,MAX(id) id 
								FROM 
									erp_client_channel
								where 
									isSettle = 1
								group by clientFid) temp
							ON 
								temp.clientFid=erp_client_channel.clientFid AND erp_client_channel.id=temp.id						
						) ecc
						join erp_clients ec on ecc.clientFid = ec.clientId
						join erp_client_event ce on ce.clientFid = ec.clientId
						left join erp_client_event reservation 
							on ce.clientFid = reservation.clientFid 
							and reservation.applicationFid>0 
							 
						left join erp_client_event attend
							on ce.clientFid = attend.clientFid
							and attend.attendLessonFid>0 
							 
						left join erp_client_event sign
							on ce.clientFid = sign.clientFid
							and sign.firstContractFid>0
							 
					where date(ce.createTime) between '2018-04-02' and '2018-04-29' 
							
							and not exists (
								select 1 from user_test ut where ec.studentId = ut.userId and ut.accType = 'STU'
							)
							 
					group by ecc.secondChannelFid
				) temp on c.id = temp.secondChannelFid
				  
			)temp2 on temp1.cateId = temp2.cateFid
			 
			
			 group by temp1.cate1Fid  order by temp1.cate1Fid asc\G

# Query 74: 0.00 QPS, 0.00x concurrency, ID 0x8FC934C0FB674018 at byte 5723041
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.05
# Time range: 2018-04-16 17:49:15 to 20:12:47
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      13
# Exec time      0     42s      2s      4s      3s      4s   409ms      3s
# Lock time      0     5ms   300us   480us   407us   467us    66us   434us
# Rows sent      0     296       3      41   22.77   23.65    7.44   21.45
# Rows examine   0  24.48M   1.88M   1.90M   1.88M   1.86M    0.02   1.86M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  51.35k   3.95k   3.95k   3.95k   3.95k       0   3.95k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel_cate'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel_cate`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_channel`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_event'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_event`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
			 temp1.cate1,
			 temp1.cate2,
			 temp1.cate3,
			 temp1.cate4,
			 temp1.cate5,
			 temp1.cate1Fid,
			 temp1.cate2Fid,
			 temp1.cate3Fid,
			 temp1.cate4Fid,
			 temp1.cate5Fid,
			 temp1.levelId,
			  
			 		temp2.secondChannelId,
					temp2.secondChannel,
					temp2.firstChannelId,
					temp2.firstChannel,
			 	 
			 temp2.propBFid,
			 sum(temp2.leadsCount) leadsCount,
			 sum(temp2.deadNumberCount) deadNumberCount,
			 sum(temp2.reservationCount) reservationCount,
			 sum(temp2.attendCount) attendCount,
			 sum(temp2.signCount) signCount,
			 sum(temp2.signAmount) signAmount,
			 sum(temp2.leadsToReservation) leadsToReservationAvg,
			 sum(temp2.reservationToAttend) reservationToAttendAvg,
			 sum(temp2.attendToSign) attendToSignAvg,
			 sum(temp2.leadsToSign) leadsToSignAvg
			 from 
			(
				select
					 
					 
				 	 
				 	 
				 	 
				 		5 levelId,
				 		cate1Fid,
				 		cate1,
					 	cate2Fid,
					 	cate2,
					 	cate3Fid,
					 	cate3,
					 	cate4Fid,
					 	cate4,
					 	cateId cate5Fid,
					 	cateName cate5,
				 	 
				 	cateId
				from erp_channel_cate t
				where levelId = 5
				 
				 
				 
				 
				 and cateId = 417 
			)temp1
			left join (
				select  
					c.cateFid,
					c.id secondChannelId,
					c.name secondChannel,
					c.propBFid,
					c1.id firstChannelId,
					c1.name firstChannel,
					ifnull(leadsCount,0) leadsCount,
					ifnull(deadNumberCount,0) deadNumberCount,
					ifnull(reservationCount,0) reservationCount,
					ifnull(attendCount,0) attendCount,
					ifnull(signCount,0) signCount,
					ifnull(signAmount,0) signAmount,
					ifnull(leadsToReservation,0) leadsToReservation,
					ifnull(reservationToAttend,0) reservationToAttend,
					ifnull(attendToSign,0) attendToSign,
					ifnull(leadsToSign,0) leadsToSign
				from 
				erp_channel c
				join erp_channel c1 on c.pid = c1.id
				join erp_channel_cate ecc on ecc.cateId = c.cateFid
				join (
					select 
						ecc.secondChannelFid,
						ecc.secondChannel,
						ecc.firstChannelFid,
						ecc.firstChannel,
						count(ec.clientId) leadsCount,
						sum(ce.isDeadNumber) deadNumberCount,
						count(reservation.clientFid) reservationCount,
						count(attend.clientFid) attendCount,
						count(sign.clientFid) signCount,
						sum(ifnull(sign.firstContractAmount,0)) signAmount,
						sum(ifnull(dateDiff(reservation.applicationTime,reservation.createTime),0)) leadsToReservation,
						sum(ifnull(dateDiff(attend.attendTime ,attend.applicationTime),0)) reservationToAttend,
						sum(ifnull(dateDiff(sign.firstContractPayTime ,sign.attendTime),0)) attendToSign,
						sum(ifnull(dateDiff(sign.firstContractPayTime ,sign.createTime),0)) leadsToSign
					 from 
						 
						(
							SELECT 
								erp_client_channel.* 
							FROM 
								erp_client_channel 
							JOIN
								(SELECT 
									clientFid,MAX(id) id 
								FROM 
									erp_client_channel
								where 
									isSettle = 1
								group by clientFid) temp
							ON 
								temp.clientFid=erp_client_channel.clientFid AND erp_client_channel.id=temp.id						
						) ecc
						join erp_clients ec on ecc.clientFid = ec.clientId
						join erp_client_event ce on ce.clientFid = ec.clientId
						left join erp_client_event reservation 
							on ce.clientFid = reservation.clientFid 
							and reservation.applicationFid>0 
							 
						left join erp_client_event attend
							on ce.clientFid = attend.clientFid
							and attend.attendLessonFid>0 
							 
						left join erp_client_event sign
							on ce.clientFid = sign.clientFid
							and sign.firstContractFid>0
							 
					where date(ce.createTime) between '2018-04-02' and '2018-04-08' 
							
							and not exists (
								select 1 from user_test ut where ec.studentId = ut.userId and ut.accType = 'STU'
							)
							 
					group by ecc.secondChannelFid
				) temp on c.id = temp.secondChannelFid
				  
			)temp2 on temp1.cateId = temp2.cateFid
			 
			
			 
			 
			 
			 
			 
			 group by temp2.secondChannelId  order by temp2.secondChannelId asc\G

# Query 76: 1 QPS, 3.60x concurrency, ID 0x5B97519418BA5B13 at byte 4044708
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.14
# Time range: 2018-04-16 16:52:16 to 16:52:27
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      11
# Exec time      0     40s      2s      4s      4s      4s   717ms      4s
# Lock time      0     4ms   269us   417us   377us   403us    37us   384us
# Rows sent      0     110      10      10      10      10       0      10
# Rows examine   0   4.79M 445.56k 445.56k 445.56k 445.56k       0 445.56k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  28.71k   2.61k   2.61k   2.61k   2.61k       0   2.61k
# String:
# Databases    yimi
# Hosts        10.31.53.111 (3/27%), 10.80.237.213 (3/27%)... 3 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'server_trail_and_voice'\G
#    SHOW CREATE TABLE `yimi`.`server_trail_and_voice`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,
        l.teacherId,
        l.lessonType,
        l.courseHours,
        date_format(l.startTime,'%Y-%m-%d %H:%i') AS startTime,
        date_format(l.endTime,'%Y-%m-%d %H:%i') AS endTime,
        (case ec.clientName when '' then tui.realName else ec.clientName end) studentName,
        s.subjectName,
        g.gradeName,
        l.lessonStatus,
        timestampdiff(second,now(),l.startTime) remaining,
        timestampdiff(second,l.startTime,l.endTime) lessonSecondCount,
        cast(pre.configValue as signed)*60 beforeSecond,
        cast(aft.configValue as signed)*60 afterSecond,
        if(exists(select 1 from server_trail_and_voice where status=1 and lessonID=l.lessonId),1,0) hasRecord,
        if(exists(select 1 from erp_lesson_docs where parentId=0 and docType=1 and lessonId=l.lessonId),1,0) hasDoc,
        "" AS title,
        "" AS keywords,
        case l.studentAppraiseType when 0 then '未评价' when 1 then '好评' when 2 then '中评' when 3 then '差评' end
        studentAppraiseType,
        studentAppraises
        FROM mis_user_info u
        LEFT JOIN erp_clients ec ON u.userId = ec.chargeFid
        LEFT JOIN mis_user_info u1 ON u1.userId = ec.consultantId
        LEFT JOIN mis_user_info u2 ON u2.userId = ec.cooperateConsultantId
        INNER JOIN erp_lessons l ON ec.studentId = l.studentId
        INNER JOIN t_user_info tui on tui.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
        INNER JOIN www_config pre on pre.configId=1
        INNER JOIN www_config aft on aft.configId=2
        WHERE
        ((u.userOrgFid IN
         (  
            6040100
         ) 
         
            and ec.chargeFid = 900001273
         
        )
        OR (CASE WHEN ec.consultantId!= ec.chargeFid THEN
        u1.userOrgFid IN
         (  
            6040100
         ) 
         
            and ec.consultantId = 900001273
         
        END)
        OR (u2.userOrgFid IN
         (  
            6040100
         ) 
         
            AND ec.cooperateConsultantId = 900001273
         
        ))
         
            and (l.clientId='黄佑琪'
            or ec.clientName='黄佑琪'
            or l.lessonId='黄佑琪'
            or tui.realname='黄佑琪'
            )
         
         
         
            AND l.startTime >= '2018-04-15'
         
         
         
        ORDER BY l.lessonStatus,
        CASE WHEN l.lessonStatus in(0) THEN
        l.startTime END,
        CASE WHEN l.lessonStatus in(1) THEN
        l.startTime END desc
        limit 10, 10\G

# Query 78: 0.00 QPS, 0.00x concurrency, ID 0x7096D48A29F00CFF at byte 5361465
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.01
# Time range: 2018-04-16 14:27:06 to 18:49:31
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      18
# Exec time      0     39s      2s      2s      2s      2s   104ms      2s
# Lock time      0     3ms    43us   353us   171us   204us    62us   176us
# Rows sent      0      18       1       1       1       1       0       1
# Rows examine   0  11.20M 635.38k 643.13k 637.34k 619.64k       0 619.64k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  14.98k     852     852     852     852       0     852
# String:
# Databases    yimi
# Hosts        10.81.244.3 (6/33%), 10.28.143.117 (4/22%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_teacher_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_teacher_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        COUNT(1)
        FROM mis_teacher_info u
        INNER JOIN erp_lessons l ON u.subjectIds LIKE CONCAT('%,',l.subjectId,',%')
        INNER JOIN t_user_info tui ON tui.id = l.studentId
        LEFT JOIN erp_clients ec ON ec.studentId = l.studentId
        LEFT JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
        INNER JOIN www_config pre ON pre.configId=1
        INNER JOIN www_config aft ON aft.configId=2
        WHERE u.userFid = 800121389
         
            AND (l.clientId='935444'
            OR ec.clientName='935444'
            OR l.lessonId='935444'
            OR tui.realname='935444'
            )
         
         
         
         
         
            AND ((l.startTime > DATE(NOW()) AND l.lessonStatus=0) OR l.lessonStatus=1)\G

# Query 83: 0.00 QPS, 0.00x concurrency, ID 0xE8A1BEA6695823B2 at byte 6077058
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.08
# Time range: 2018-04-16 16:22:24 to 19:45:58
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      11
# Exec time      0     32s      2s      4s      3s      4s   498ms      3s
# Lock time      0     5ms   320us   732us   418us   445us   108us   403us
# Rows sent      0   2.23k       7     375  207.73  363.48  177.51  363.48
# Rows examine   0  21.04M   1.88M   1.96M   1.91M   1.95M  36.70k   1.86M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  43.15k   3.92k   3.92k   3.92k   3.92k       0   3.92k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel_cate'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel_cate`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_channel`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_event'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_event`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
			 temp1.cate1,
			 temp1.cate2,
			 temp1.cate3,
			 temp1.cate4,
			 temp1.cate5,
			 temp1.cate1Fid,
			 temp1.cate2Fid,
			 temp1.cate3Fid,
			 temp1.cate4Fid,
			 temp1.cate5Fid,
			 temp1.levelId,
			  
			 		0 secondChannelId,
					null secondChannel,
					0 firstChannelId,
					null firstChannel,
			 	 
			 temp2.propBFid,
			 sum(temp2.leadsCount) leadsCount,
			 sum(temp2.deadNumberCount) deadNumberCount,
			 sum(temp2.reservationCount) reservationCount,
			 sum(temp2.attendCount) attendCount,
			 sum(temp2.signCount) signCount,
			 sum(temp2.signAmount) signAmount,
			 sum(temp2.leadsToReservation) leadsToReservationAvg,
			 sum(temp2.reservationToAttend) reservationToAttendAvg,
			 sum(temp2.attendToSign) attendToSignAvg,
			 sum(temp2.leadsToSign) leadsToSignAvg
			 from 
			(
				select
					 
					 
				 	 
				 	 
				 	 
				 		5 levelId,
				 		cate1Fid,
				 		cate1,
					 	cate2Fid,
					 	cate2,
					 	cate3Fid,
					 	cate3,
					 	cate4Fid,
					 	cate4,
					 	cateId cate5Fid,
					 	cateName cate5,
				 	 
				 	cateId
				from erp_channel_cate t
				where levelId = 5
				 
				 
				 
				 and cate4Fid = 33 
				 
			)temp1
			left join (
				select  
					c.cateFid,
					c.id secondChannelId,
					c.name secondChannel,
					c.propBFid,
					c1.id firstChannelId,
					c1.name firstChannel,
					ifnull(leadsCount,0) leadsCount,
					ifnull(deadNumberCount,0) deadNumberCount,
					ifnull(reservationCount,0) reservationCount,
					ifnull(attendCount,0) attendCount,
					ifnull(signCount,0) signCount,
					ifnull(signAmount,0) signAmount,
					ifnull(leadsToReservation,0) leadsToReservation,
					ifnull(reservationToAttend,0) reservationToAttend,
					ifnull(attendToSign,0) attendToSign,
					ifnull(leadsToSign,0) leadsToSign
				from 
				erp_channel c
				join erp_channel c1 on c.pid = c1.id
				join erp_channel_cate ecc on ecc.cateId = c.cateFid
				join (
					select 
						ecc.secondChannelFid,
						ecc.secondChannel,
						ecc.firstChannelFid,
						ecc.firstChannel,
						count(ec.clientId) leadsCount,
						sum(ce.isDeadNumber) deadNumberCount,
						count(reservation.clientFid) reservationCount,
						count(attend.clientFid) attendCount,
						count(sign.clientFid) signCount,
						sum(ifnull(sign.firstContractAmount,0)) signAmount,
						sum(ifnull(dateDiff(reservation.applicationTime,reservation.createTime),0)) leadsToReservation,
						sum(ifnull(dateDiff(attend.attendTime ,attend.applicationTime),0)) reservationToAttend,
						sum(ifnull(dateDiff(sign.firstContractPayTime ,sign.attendTime),0)) attendToSign,
						sum(ifnull(dateDiff(sign.firstContractPayTime ,sign.createTime),0)) leadsToSign
					 from 
						 
						(
							SELECT 
								erp_client_channel.* 
							FROM 
								erp_client_channel 
							JOIN
								(SELECT 
									clientFid,MAX(id) id 
								FROM 
									erp_client_channel
								where 
									isSettle = 1
								group by clientFid) temp
							ON 
								temp.clientFid=erp_client_channel.clientFid AND erp_client_channel.id=temp.id						
						) ecc
						join erp_clients ec on ecc.clientFid = ec.clientId
						join erp_client_event ce on ce.clientFid = ec.clientId
						left join erp_client_event reservation 
							on ce.clientFid = reservation.clientFid 
							and reservation.applicationFid>0 
							 
						left join erp_client_event attend
							on ce.clientFid = attend.clientFid
							and attend.attendLessonFid>0 
							 
						left join erp_client_event sign
							on ce.clientFid = sign.clientFid
							and sign.firstContractFid>0
							 
					where date(ce.createTime) between '2018-02-26' and '2018-04-01' 
							
							and not exists (
								select 1 from user_test ut where ec.studentId = ut.userId and ut.accType = 'STU'
							)
							 
					group by ecc.secondChannelFid
				) temp on c.id = temp.secondChannelFid
				  
			)temp2 on temp1.cateId = temp2.cateFid
			 
			
			 
			 
			 
			 
			 group by temp1.cate5Fid  order by temp1.cate5Fid asc\G

# Query 84: 0.00 QPS, 0.00x concurrency, ID 0x0821DDBC5A0330A5 at byte 3777582
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.03
# Time range: 2018-04-16 09:50:05 to 16:33:05
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      14
# Exec time      0     32s      2s      3s      2s      3s   282ms      2s
# Lock time      0     3ms    48us   366us   200us   348us   122us   224us
# Rows sent      0     140      10      10      10      10       0      10
# Rows examine   0   5.75M 419.90k 420.71k 420.34k 419.40k       0 419.40k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  26.46k   1.89k   1.89k   1.89k   1.86k    0.00   1.86k
# String:
# Databases    yimi
# Hosts        10.81.244.3 (6/42%), 10.80.58.47 (3/21%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'server_trail_and_voice'\G
#    SHOW CREATE TABLE `yimi`.`server_trail_and_voice`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_teacher_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_teacher_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,
        l.teacherId,
        l.lessonType,
        l.courseHours,
        DATE_FORMAT(l.startTime,'%Y-%m-%d %H:%i') AS startTime,
        DATE_FORMAT(l.endTime,'%Y-%m-%d %H:%i') AS endTime,
        (CASE ec.clientName WHEN '' THEN tui.realName ELSE ec.clientName END) studentName,
        s.subjectName,
        g.gradeName,
        l.lessonStatus,
        TIMESTAMPDIFF(SECOND,NOW(),l.startTime) remaining,
        TIMESTAMPDIFF(SECOND,l.startTime,l.endTime) lessonSecondCount,
        CAST(pre.configValue AS SIGNED)*60 beforeSecond,
        CAST(aft.configValue AS SIGNED)*60 afterSecond,
        IF(EXISTS(SELECT 1 FROM server_trail_and_voice WHERE STATUS=1 AND lessonID=l.lessonId),1,0) hasRecord,
        IF(EXISTS(SELECT 1 FROM erp_lesson_docs WHERE parentId=0 AND docType=1 AND lessonId=l.lessonId),1,0) hasDoc,
        "" AS title,
        "" AS keywords,
        CASE l.studentAppraiseType WHEN 0 THEN '未评价' WHEN 1 THEN '好评' WHEN 2 THEN '中评' WHEN 3 THEN '差评' END
        studentAppraiseType,
        studentAppraises

        FROM mis_teacher_info u
        INNER JOIN erp_lessons l ON u.subjectIds LIKE CONCAT('%,',l.subjectId,',%')
        INNER JOIN t_user_info tui ON tui.id = l.studentId
        LEFT JOIN erp_clients ec ON ec.studentId = l.studentId
        LEFT JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
        INNER JOIN www_config pre ON pre.configId=1
        INNER JOIN www_config aft ON aft.configId=2
        WHERE u.userFid = 800121391
         
         
         
         
         
            AND ((l.startTime > DATE(NOW()) AND l.lessonStatus=0) OR l.lessonStatus=1)
         
        ORDER BY l.lessonStatus,
        CASE WHEN l.lessonStatus IN(0) THEN
        l.startTime END,
        CASE WHEN l.lessonStatus IN(1) THEN
        l.startTime END DESC
        LIMIT 0, 10\G

# Query 85: 0.00 QPS, 0.00x concurrency, ID 0x4EF2377A4B6CC5CD at byte 1263923
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.05
# Time range: 2018-04-16 10:07:20 to 21:37:52
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      12
# Exec time      0     31s      2s      3s      3s      3s   361ms      3s
# Lock time      0     4ms   254us   442us   314us   403us    60us   287us
# Rows sent      0   1.80k     154     154     154     154       0     154
# Rows examine   0  29.51M   2.45M   2.46M   2.46M   2.37M       0   2.37M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  28.80k   2.40k   2.40k   2.40k   2.40k       0   2.40k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_teacher_schedule'\G
#    SHOW CREATE TABLE `yimi`.`erp_teacher_schedule`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_teacher_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_teacher_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_lesson_schedule_201609'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_lesson_schedule_201609`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_calendar_week'\G
#    SHOW CREATE TABLE `yimi`.`mis_calendar_week`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_timetable'\G
#    SHOW CREATE TABLE `yimi`.`erp_timetable`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_timetable'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_timetable`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT temp.lessonDate,temp.scheduleId,GROUP_CONCAT(teacherIds) teacherIds FROM
		(

			SELECT lessonDate,scheduleId,CONCAT(',',(GROUP_CONCAT(DISTINCT teacherId)),',') teacherIds FROM erp_teacher_schedule
			WHERE lessonId > 0
			 
				AND lessonDate BETWEEN '2018-04-16' and DATE_ADD('2018-04-16',INTERVAL 6 DAY)
			 
			 
			GROUP BY lessonDate,scheduleId
			 
				UNION
				SELECT lessonDate,scheduleId,(SELECT CONCAT(',',GROUP_CONCAT(mti1.userFid),',') FROM mis_teacher_info mti1 WHERE mti1.teacherType=1 and mti1.isTeach = 1 AND NOT
				FIND_IN_SET(mti1.userFid,IFNULL(teacherIds,''))) teacherIds
					from(
					select  b.scheduleId,b.date lessonDate,temp.teacherIds from (
				    select a.scheduleId,t.date from erp_conf_lesson_schedule_201609 a,(
				      select w.date from mis_calendar_week w where w.date between (select subdate('2018-04-16',if(date_format('2018-04-16','%w')=0,7,date_format('2018-04-16','%w'))-1)) and date_add((select subdate('2018-04-16',if(date_format('2018-04-16','%w')=0,7,date_format('2018-04-16','%w'))-1)),INTERVAL 6 DAY)
				    ) t
				  ) b
				  left join (
				  select et.scheduleId scheduleId,date_format(date_add((select subdate('2018-04-16',if(date_format('2018-04-16','%w')=0,7,date_format('2018-04-16','%w'))-1)),INTERVAL (IF(et.dayOfWeek=1,6,et.dayOfWeek-2)) DAY),'%Y-%m-%d') lessonDate ,
				         CONCAT(',',GROUP_CONCAT(mti.userFid),',') teacherIds
				  from
				    mis_teacher_info mti,erp_timetable et
				  where
				    (
				      exists(select 1 from erp_conf_timetable tmpect
				      where tmpect.relatedFid=mti.timetableFid and  et.timetableFid=tmpect.timetableId
				            and (select subdate('2018-04-16',if(date_format('2018-04-16','%w')=0,7,date_format('2018-04-16','%w'))-1)) between tmpect.beginDate and tmpect.endDate)
				      or (
				        not exists(select 1 from erp_conf_timetable tmpect where tmpect.relatedFid=mti.timetableFid and (select subdate('2018-04-16',if(date_format('2018-04-16','%w')=0,7,date_format('2018-04-16','%w'))-1)) between tmpect.beginDate and tmpect.endDate)
				        and et.timetableFid=mti.timetableFid
				      )
				    )
				    AND mti.teacherType=1 and mti.isTeach = 1
					 
				  GROUP BY lessonDate,scheduleId
				)temp on b.scheduleId = temp.scheduleId and b.date = temp.lessonDate
					
					) t
			 
			 
		) temp
		where lessonDate BETWEEN '2018-04-16' and DATE_ADD('2018-04-16',INTERVAL 6 DAY)
		GROUP BY lessonDate,scheduleId\G

# Query 86: 0.01 QPS, 0.02x concurrency, ID 0x8EA77ECFE25B7D83 at byte 7050085
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.22
# Time range: 2018-04-16 20:09:36 to 20:31:05
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      11
# Exec time      0     30s      2s      4s      3s      4s   785ms      2s
# Lock time      0     4ms   103us   797us   347us   725us   268us   167us
# Rows sent      0      38       0       7    3.45    6.98    3.22    4.96
# Rows examine   0  48.96M   4.27M   4.78M   4.45M   4.70M 215.09k   4.26M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 194.64k     834  47.23k  17.69k  46.68k  22.06k  833.10
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_follow'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_follow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT count(1) followNumber,date(f.nextDate) nextDate
		FROM erp_client_follow f
		  JOIN
		  (SELECT
			 clientFid,
			 MAX(id) AS MaxId
		   FROM
			 erp_client_follow
		 
		   GROUP BY clientFid) groupedf
			ON f.id = groupedf.MaxId
		  JOIN erp_clients client ON client.clientId = f.clientFid
		 
		 
         
         
			AND
			 
					(
                    client.consultantId IN
                     
                             (  
                                10014
                             , 
                                101446
                             , 
                                101611
                             , 
                                107157
                             , 
                                107946
                             , 
                                108633
                             , 
                                110244
                             , 
                                114520
                             , 
                                115245
                             , 
                                115246
                             , 
                                115877
                             , 
                                117466
                             , 
                                118233
                             , 
                                119323
                             , 
                                121338
                             , 
                                121340
                             , 
                                121377
                             , 
                                121446
                             , 
                                900000059
                             , 
                                900000066
                             /*... omitted 302 items ...*/) 
                         
					OR
                    client.chargeFid IN
                     
                             (  
                                10014
                             , 
                                101446
                             , 
                                101611
                             , 
                                107157
                             , 
                                107946
                             , 
                                108633
                             , 
                                110244
                             , 
                                114520
                             , 
                                115245
                             , 
                                115246
                             , 
                                115877
                             , 
                                117466
                             , 
                                118233
                             , 
                                119323
                             , 
                                121338
                             , 
                                121340
                             , 
                                121377
                             , 
                                121446
                             , 
                                900000059
                             , 
                                900000066
                             /*... omitted 302 items ...*/) 
                         
					)
				 
		 
		WHERE date(f.nextDate) BETWEEN date_sub(curdate(),INTERVAL WEEKDAY(curdate()) -7*0 DAY)
		AND date_add(date_sub(curdate(),INTERVAL WEEKDAY(curdate()) -7*0 DAY),INTERVAL 6 DAY)
		GROUP BY date(f.nextDate)\G

# Query 89: 0.00 QPS, 0.00x concurrency, ID 0x7146E02EEE59AD24 at byte 5114615
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.19
# Time range: 2018-04-16 14:53:57 to 18:25:32
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      10
# Exec time      0     28s      2s      5s      3s      3s   729ms      3s
# Lock time      0     2ms   184us   240us   208us   224us    17us   204us
# Rows sent      0      10       1       1       1       1       0       1
# Rows examine   0   4.68M 471.56k 545.88k 479.20k 462.39k  21.87k 462.39k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  16.18k   1.10k   5.83k   1.62k   1.53k   1.38k   1.09k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_learn_report'\G
#    SHOW CREATE TABLE `yimi`.`erp_learn_report`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
			count(1)
		FROM erp_contract_orders o
		JOIN erp_contract c ON
		o.`contractFid` = c.`contractId`
		LEFT JOIN erp_clients ec ON
		ec.`clientId` = o.`clientId`
		LEFT JOIN mis_user_info u ON u.`userId` =
		ec.`chargeFid`
		LEFT JOIN mis_user_info tu2 ON tu2.userId =
		ec.consultantId
		left join (
                  SELECT DATE_FORMAT(max(l.startTime), '%Y-%m-%d %H:%i') startTime,IFNULL(sum(courseHours),0) courseHours,
                    l.contractId
                 FROM erp_lessons l
                 WHERE l.lessonStatus in (1,3,4) AND l.contractId>0
                 GROUP BY l.contractId
              ) maxel on maxel.contractId=o.contractId
        LEFT JOIN (
            SELECT DISTINCT r.orderFid
            FROM erp_learn_report r
         )elr on elr.orderFid=o.contractId
		 WHERE o.orderStatus>0
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			and 2=2
				
				
					and ec.chargeFid in (
						
							900001435
						
					)
				
			
			
			
			
			
			
				and not exists (select 1 from user_test ut where ut.userId = ec.studentId and ut.accType = 'STU')\G

# Query 91: 0.00 QPS, 0.00x concurrency, ID 0x6A1708C026B47568 at byte 2776286
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.07
# Time range: 2018-04-16 09:27:49 to 18:28:09
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      11
# Exec time      0     27s      2s      3s      2s      3s   411ms      2s
# Lock time      0     3ms   200us   285us   260us   273us    23us   260us
# Rows sent      0   4.05k     368     388  376.64  381.65    8.74  363.48
# Rows examine   0  17.58M   1.25M   1.72M   1.60M   1.61M 121.92k   1.53M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  17.68k   1.61k   1.61k   1.61k   1.61k       0   1.61k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_channel`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_event'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_event`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel_cate'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel_cate`\G
# EXPLAIN /*!50100 PARTITIONS*/
select 
				if(ec.sysCity='' or ec.sysCity IS NULL,'未知城市',ec.sysCity) cityName,
				count(ec.clientId) leadsCount,
				sum(ece.isDeadNumber) deadNumberCount,
				count(reservation.clientFid) reservationCount,
				count(attend.clientFid) attendCount,
				count(sign.clientFid) signCount,
				sum(ifnull(sign.firstContractAmount,0)) signAmount
			from erp_clients ec
			join (
				SELECT erp_client_channel.* FROM erp_client_channel 
				JOIN (select max(id) id,clientFid from erp_client_channel 
							where isSettle = 1 group by clientFid) t 
				ON t.clientFid=erp_client_channel.clientFid AND erp_client_channel.id=t.id
			) ecc on ec.clientId = ecc.clientFid
			join erp_client_event ece on ec.clientId = ece.clientFid
			left join erp_client_event reservation
				on ece.clientFid = reservation.clientFid 
				and reservation.applicationFid>0 
				 
			left join erp_client_event attend
				on ece.clientFid = attend.clientFid
				and attend.attendLessonFid>0 
				 
			left join erp_client_event sign
				on ece.clientFid = sign.clientFid
				and sign.firstContractFid>0
				 
			where date(ece.createTime) between '2018-04-02' and '2018-04-29'
				
				and not exists (
					select 1 from user_test ut where ec.studentId = ut.userId and ut.accType = 'STU'
				)
				 
				 
				and exists(
					select 1 from
						erp_channel c
						join erp_channel c1 on c.pid = c1.id
						join erp_channel_cate ecc on ecc.cateId = c.cateFid
						where c.id = ecc.secondChannelFid
						and ecc.levelId = 5
						 
						 
						 
						 
						 
						 
				)
			
			group by if(ec.sysCity='' or ec.sysCity IS NULL,'未知城市',ec.sysCity)\G

# Query 93: 0.00 QPS, 0.00x concurrency, ID 0x9A4B12447FDDD372 at byte 4443686
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.01
# Time range: 2018-04-16 08:10:23 to 17:23:34
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      11
# Exec time      0     27s      2s      3s      2s      3s   171ms      2s
# Lock time      0     2ms   107us   174us   141us   167us    20us   141us
# Rows sent      0      11       1       1       1       1       0       1
# Rows examine   0  11.49M   1.04M   1.05M   1.04M   1.03M       0   1.03M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0   7.59k     707     707     707     707       0     707
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_order_flow'\G
#    SHOW CREATE TABLE `yimi`.`erp_order_flow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
select count(distinct subjectId,studentId) pendingSubjectOrderCount
        from
        erp_contract_orders o,(
        select
        ff.orderFid,ff.orderStatusFid,ff.createdOn from erp_order_flow
        ff,(select orderFid,max(createdOn) createdOn from erp_order_flow
        where
        createdOn < date_add('2018-04-29',interval
        1 day) and orderStatusFid>0 group by orderFid)
        fff where ff.orderFid=fff.orderFid and
        ff.createdOn=fff.createdOn and ff.orderFid=fff.orderFid) f
        where
        o.contractId=f.orderFid
        and
        orderStatusFid in(1,2,6)
        and studentId
        not
        in(select
        userId from
        user_test where accType='STU')\G

# Query 95: 0.00 QPS, 0.00x concurrency, ID 0x9F41075C48CFAA92 at byte 3401646
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.01
# Time range: 2018-04-16 11:13:29 to 22:25:43
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      11
# Exec time      0     25s      2s      3s      2s      2s   156ms      2s
# Lock time      0     2ms    60us   260us   162us   224us    64us   189us
# Rows sent      0     272       6      57   24.73   38.53   13.81   26.08
# Rows examine   0   7.38M 619.83k 703.97k 687.11k 683.15k  24.50k 683.15k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  16.05k   1.45k   1.52k   1.46k   1.39k   20.48   1.39k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        erpuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lesson_comment'\G
#    SHOW CREATE TABLE `yimi`.`lesson_comment`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_cr'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_cr`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
				l.*,
				
				IFNULL(c.clientName,t.nickName) studentName,
				mui.userRealName teacherName,
				g.gradeName gradeName,
				s.subjectName subjectName,
				o1.userRealName ccName,
				u1.userRealName chargeName,
				u1.userMobile chargePhone,
				stulc.param1 stuParam1,
				stulc.param2 stuParam2,
				stulc.param3 stuParam3,
				stulc.param4 stuParam4,
				tealc.param1 teaParam1,
				tealc.param2 teaParam2,
				tealc.param3 teaParam3,
				c.eduSystem
		FROM erp_lessons l
		LEFT JOIN erp_clients c ON l.clientId=c.clientId
		LEFT JOIN t_user_info t ON l.studentId=t.id
		LEFT JOIN mis_user_info mui ON mui.userId = l.teacherId
		LEFT JOIN erp_conf_student_grades g ON l.gradeId=g.gradeId
		LEFT JOIN erp_conf_course_subjects s ON l.subjectId=s.subjectId
		LEFT JOIN mis_user_info o1 ON o1.userId = c.consultantId
		LEFT JOIN mis_user_info u1 ON u1.userId=c.chargeFid
		LEFT JOIN lesson_comment stulc ON stulc.lessonFid=l.lessonId and stulc.commentBy='STU'
		LEFT JOIN lesson_comment tealc ON tealc.lessonFid=l.lessonId and tealc.commentBy='TEA'
		 WHERE  l.subjectId = 2
			
			
			
			
			
			
			
				
				and (c.clientName like '%王博越%' OR t.nickName like '%王博越%')
			
			
			
			
			
			
			
				and (c.consultantId in (				
				 900001078
	           )
				or EXISTS (select distinct 1 from erp_client_cr t1
				where t1.clientFid=l.clientId and t1.endTime is null
				and t1.crFid in (				
				 900001078
	           ))) 
		order by startTime desc limit 0,50\G

# Query 97: 0.52 QPS, 1.06x concurrency, ID 0xC4EDC64AF48E3254 at byte 9656807
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.00
# Time range: 2018-04-17 03:03:56 to 03:04:17
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      11
# Exec time      0     22s      2s      2s      2s      2s       0      2s
# Lock time      0     2ms   145us   190us   170us   176us    11us   167us
# Rows sent      0      11       1       1       1       1       0       1
# Rows examine   0  10.64M 990.08k 990.26k 990.15k 961.27k    0.01 961.27k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0   8.01k     746     746     746     746       0     746
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_order_flow'\G
#    SHOW CREATE TABLE `yimi`.`erp_order_flow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
# EXPLAIN /*!50100 PARTITIONS*/
select count(0) from erp_contract_orders tmpeco
        join (
        select eof.orderFid,eof.orderStatusFid from erp_order_flow eof
        join (select max(flowId) flowId from erp_order_flow where orderStatusFid>0 and createdOn  <  '2018-04-16 10:56:48' GROUP BY orderFid) tmp on tmp.flowId=eof.flowId
        ) tmpeof on tmpeco.contractId=tmpeof.orderFid
        LEFT JOIN (select contractId,sum(courseHours) overHours from erp_lessons where lessonStatus in(1,3,4) and contractId>0 GROUP BY contractId) tmpel on tmpel.contractId=tmpeco.contractId
        where tmpeof.orderStatusFid in(1,2,6) and (orderStatusFid=1 or tmpel.overHours!=tmpeco.realLessonCount)
         
         
        and tmpeco.contractId!=12026 and tmpeco.clientId=264245\G

# Query 98: 0.00 QPS, 0.00x concurrency, ID 0x7FAC2E0A44CA4FAE at byte 4689155
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.01
# Time range: 2018-04-16 09:28:43 to 18:17:06
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      10
# Exec time      0     22s      2s      2s      2s      2s   150ms      2s
# Lock time      0     3ms   230us   402us   325us   366us    46us   332us
# Rows sent      0   8.02k     821     822  821.60  793.42       0  793.42
# Rows examine   0   5.48M 559.31k 561.43k 560.67k 535.27k       0 535.27k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  26.72k   2.67k   2.67k   2.67k   2.67k       0   2.67k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_application'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_application`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
# EXPLAIN /*!50100 PARTITIONS*/
select cha.id,cha.pid,cha.name,ifnull(leads.leadsNum,0)
		leadsNum,ifnull(free.freeLessonNum,0) freeLessonNum,
		ifnull(con.newContractNum,0) newContractNum,ifnull(con.paidNum,0)
		paidNum
		from erp_channel cha
		left join (select ech_leads.pid,ech_leads.id,ech_leads.name,count(0) leadsNum from
		erp_channel ech_leads
		join
         
                erp_clients
             
        ec_leads ON ech_leads.id =
         
                ec_leads.originalSecondChannelFid
             
        WHERE 1 = 1
         
            AND ech_leads.pid = 16000
         
         
        AND date(ec_leads.createdOnTime) between '2018-04-01' and '2018-04-16'
        AND NOT exists(SELECT 1 FROM user_test ut_leads
        WHERE ut_leads.userId = ec_leads.studentId AND ut_leads.accType = 'STU'
        )
        GROUP BY
         ech_leads.id 
		) leads
		 on leads.id=cha.id 
		left join
        (
        SELECT ech_free.pid, ech_free.id ,count(DISTINCT ec_free.clientId) freeLessonNum
        FROM erp_lesson_application ela
        JOIN erp_lessons lesson ON lesson.lessonId = ela.lessonId
        AND lesson.lessonStatus in(1,3,4)
        AND date(lesson.startTime) between '2018-04-01' and '2018-04-16'
        JOIN
         
                erp_clients
             
        ec_free ON ec_free.clientId = ela.clientFid
        JOIN erp_channel ech_free ON ech_free.id =
         
                ec_free.originalSecondChannelFid
                AND ela.tryType=0 AND ela.tryProperty=0
             
         
         
            AND ech_free.pid = 16000
         
        WHERE NOT exists(SELECT 1 FROM user_test ut_free WHERE ut_free.userId = ec_free.studentId AND ut_free.accType = 'STU')
        GROUP BY
         ech_free.id 
        ) free 
		on
		 free.id=cha.id 
		left join
        (
        SELECT
        ech_con.pid,
        ech_con.id,
        count(DISTINCT contract.clientFid) newContractNum,
        sum(contract.paidPrice)            paidNum
        FROM erp_contract contract
        JOIN
         
                erp_clients
             
        ec_con ON ec_con.clientId = contract.clientFid
        JOIN erp_channel ech_con ON ech_con.id =
         
                ec_con.originalSecondChannelFid
             
        WHERE contract.contractFlag = 'N' AND date(contract.payTime) between '2018-04-01' AND '2018-04-16'
        AND contract.contractProp = 1 AND contract.isPaid = 1
         
         
            AND ech_con.pid = 16000
         
        AND NOT exists(SELECT 1
        FROM user_test ut_con
        WHERE ut_con.userId = ec_con.studentId AND ut_con.accType = 'STU')
        GROUP BY
         ech_con.id 
        ) con
		on
		 con.id=cha.id 
		where cha.pid=16000
		 
		order by cha.id desc\G
