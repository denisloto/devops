
# 4.2s user time, 30ms system time, 31.33M rss, 225.23M vsz
# Current date: Mon Apr 16 04:01:06 2018
# Hostname: aliyun-hz-hd1-E-bgp-4
# Files: /data/script/mysql-slow-digest/mysql-slow--2018-04-16--040101.log
# Overall: 13.08k total, 194 unique, 0.15 QPS, 0.87x concurrency _________
# Time range: 2018-04-15 04:01:15 to 2018-04-16 04:00:37
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time         75183s      2s    315s      6s     24s      9s      3s
# Lock time           181s     9us     59s    14ms   316us   862ms   103us
# Rows sent        147.53M       0  23.96M  11.55k  918.49 389.12k    1.96
# Rows examine     103.30G       0 579.64M   8.09M  87.73M  22.82M   1.95M
# Rows affecte       1.10M       0  95.17k   88.02       0   2.56k       0
# Query size        10.42M      24  10.40k  835.21   2.62k  843.68  463.90

# Profile
# Rank Query ID           Response time    Calls R/Call   V/M   Item
# ==== ================== ================ ===== ======== ===== ==========
#    1 0x597AE1A5E18B09B5 14023.5233 18.7%  3962   3.5395  0.12 SELECT erp_lesson_book_files mis_user_info erp_lesson_docs
#    2 0x0F3305545EA49428 13986.6309 18.6%  3854   3.6291  2.11 SELECT erp_lesson_book_files mis_user_info erp_lesson_docs
#    3 0x7CB8293C8D8EFAA6 12008.6725 16.0%   419  28.6603  1.35 SELECT lvb_lesson_video lvb_order_lesson lvb_lesson lvb_lesson_ext
#    4 0x4EC8A0DB8530E4CC  9327.1283 12.4%   314  29.7042  1.57 SELECT lvb_lesson_video lvb_order_lesson lvb_lesson lvb_lesson_ext
#    5 0xC8F5044C7E2EADE7  3731.3878  5.0%    78  47.8383 52.16 SELECT erp_lessons erp_conf_course_subjects wx_service_msg
#    6 0x5FDDE1EC4813C54F  2651.4618  3.5%    94  28.2070 29.00 SELECT erp_lesson_application erp_lessons erp_conf_course_subjects erp_conf_student_grades wx_service_msg
#    7 0x802478FD2EC71668  1990.9908  2.6%   150  13.2733  0.71 INSERT SELECT client_sea erp_clients erp_client_follow erp_follow_status callcenter_outer_log
#    8 0x874AC800CFB0B05C  1876.9879  2.5%   720   2.6069  0.08 SELECT app_notification
#    9 0x5188E74C090BF609  1444.4355  1.9%   435   3.3205  0.49 SELECT lvb_lesson_video lvb_order_lesson lvb_order lvb_order_lesson lvb_order lvb_order_lesson lvb_lesson_series lvb_series_lesson_ref lvb_lesson lvb_lesson_ext
#   10 0x984170966838BF4D  1348.3315  1.8%   142   9.4953  3.16 SELECT mis_user_info erp_clients mis_user_info erp_lessons t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   11 0x24A7383D45436873   898.1709  1.2%    62  14.4866  0.63 SELECT mis_user_info erp_clients mis_user_info erp_lessons t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   12 0x0924E63A71759FDC   855.5591  1.1%   103   8.3064  0.39 INSERT SELECT client_sea erp_clients erp_client_follow erp_follow_status callcenter_outer_log
#   13 0xC275A476B01092D4   844.3230  1.1%    28  30.1544  1.84 SELECT lvb_lesson_video lvb_order_lesson lvb_lesson lvb_lesson_ext
#   14 0x9802F83F3C5469D4   744.3052  1.0%   252   2.9536  0.98 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects mis_work_order
#   15 0xBC6AD8511E5DCBAA   575.6865  0.8%   121   4.7577  1.11 SELECT server_trail_and_voice erp_lesson_docs mis_user_info erp_clients mis_user_info erp_lessons t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   16 0xAF7087AE5BCF7A6F   448.1977  0.6%   151   2.9682  0.10 SELECT erp_lessons erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects mis_user_info lesson_comment erp_client_cr
#   17 0x228B947AC62652E4   417.8576  0.6%     3 139.2859  4.09 CALL sp_statistics_insert_finish_order_teacher(date(date_add(now
#   18 0x5B97519418BA5B13   384.0787  0.5%    60   6.4013  0.48 SELECT server_trail_and_voice erp_lesson_docs mis_user_info erp_clients mis_user_info erp_lessons t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   19 0x807CEFFF6917F85F   345.4405  0.5%   137   2.5215  0.05 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects mis_work_order
#   20 0xED7DE5AA05230157   307.6093  0.4%   117   2.6291  0.09 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_contract mis_work_order
#   21 0x7A6044C4585A6A8C   304.7278  0.4%   106   2.8748  0.18 SELECT lvb_lesson_video lvb_order_lesson lvb_order lvb_order_lesson lvb_order lvb_order_lesson lvb_series_lesson_ref lvb_lesson_series lvb_lesson lvb_lesson_ext lvb_series_lesson_ref
#   22 0xA94D3D74D07035C4   297.4865  0.4%   145   2.0516  0.00 SELECT erp_contract_orders erp_order_flow erp_lessons
#   23 0xF83D3854B6294F5F   295.6999  0.4%   106   2.7896  0.17 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_contract mis_work_order
#   24 0x08FE275627AABB49   287.9468  0.4%   112   2.5710  1.34 SELECT erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_lessons mis_work_order erp_student_teach_special
#   25 0xD824344EA5B63403   279.3522  0.4%   106   2.6354  0.07 SELECT UNION erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_contract_orders erp_contract erp_lessons erp_contract_orders erp_lessons erp_lesson_plan erp_contract_orders teach_lesson_plan mis_work_order
#   26 0x4A078E636F95F53C   278.3244  0.4%    98   2.8400  0.22 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_contract mis_work_order
#   27 0xC4EDC64AF48E3254   252.9318  0.3%   124   2.0398  0.00 SELECT erp_contract_orders erp_order_flow erp_lessons
#   28 0x26476FF6C3C0CA5D   229.6617  0.3%    85   2.7019  0.17 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_contract mis_work_order
#   29 0x21B83224C5BD6EDA   207.7707  0.3%    36   5.7714  0.11 SELECT erp_clients mis_user_info erp_client_family t_user_info
#   30 0xD9CFEA53507AC560   198.3210  0.3%    59   3.3614  0.15 SELECT mis_user_info erp_clients mis_user_info erp_lessons t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   32 0x8DF7748590F106FA   168.1371  0.2%    70   2.4020  0.08 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects mis_work_order
#   33 0xF5FEACC32429CC03   167.7782  0.2%    34   4.9347  2.96 SELECT server_trail_and_voice erp_lesson_docs mis_user_info erp_clients mis_user_info erp_lessons t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   34 0x2C9AB886E8ACE1D9   162.3873  0.2%    49   3.3140  0.19 SELECT UNION erp_lesson_application erp_conf_student_grades erp_conf_course_subjects mis_user_info server_trail_and_voice erp_lesson_docs erp_teacher_schedule erp_lessons erp_clients lvb_lesson_video lvb_lesson erp_teacher_schedule
#   35 0x2F1A313814D4967F   158.6150  0.2%    75   2.1149  0.01 SELECT erp_contract_orders erp_order_flow erp_lessons
#   37 0xEC2DF1FE33870420   122.0298  0.2%    33   3.6979  0.09 SELECT UNION erp_teacher_schedule mis_teacher_info erp_conf_lesson_schedule_? mis_calendar_week mis_teacher_info erp_timetable erp_conf_timetable mis_teacher_info erp_conf_lesson_schedule_? mis_calendar_week mis_teacher_info erp_timetable erp_conf_timetable
#   38 0x4E36042C05849EC9   107.5364  0.1%    39   2.7573  0.17 SELECT lvb_lesson_video lvb_order_lesson lvb_lesson_series lvb_series_lesson_ref lvb_lesson lvb_lesson_ext
#   39 0x14919AA85204C7C9    99.3996  0.1%    35   2.8400  0.02 SELECT erp_contract_orders erp_clients mis_teacher_info erp_order_flow erp_lessons user_test
#   43 0xED82BEFCE140F1FC    89.1491  0.1%    27   3.3018  0.09 SELECT server_trail_and_voice erp_lesson_docs erp_lessons erp_clients t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   45 0x53E68A2F4F0BCA83    85.0250  0.1%    30   2.8342  0.27 SELECT erp_clients erp_client_follow erp_follow_status
#   46 0xF928383DFAECA667    84.8537  0.1%    28   3.0305  0.38 SELECT lvb_lesson_video lvb_order_lesson lvb_order lvb_order_lesson lvb_order lvb_order_lesson lvb_lesson_series lvb_series_lesson_ref lvb_lesson lvb_lesson_ext
#   47 0xA605B4FF51F45E6F    82.3554  0.1%    27   3.0502  0.06 SELECT erp_lessons erp_clients t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   48 0xB66AF273D4CC2576    81.3769  0.1%    30   2.7126  0.22 SELECT erp_lessons mis_user_info erp_clients
#   49 0x50E7215F3276D4D0    72.7273  0.1%    16   4.5455  0.46 SELECT lvb_lesson_video lvb_order_lesson lvb_lesson lvb_lesson_ext
#   51 0xF5446E0AC6AB1913    71.4194  0.1%    26   2.7469  0.19 SELECT lvb_order_lesson lvb_lesson_video lvb_order_lesson lvb_lesson lvb_lesson_ext lvb_order_lesson lvb_order
#   54 0x4B83C48FBD8F9C61    55.7554  0.1%    21   2.6550  0.10 SELECT erp_contract erp_contract_orders erp_lessons user_test erp_contract erp_contract_orders erp_lessons
#   59 0x4E33A4D16C9051F7    45.1247  0.1%    18   2.5069  0.19 SELECT erp_contract_orders erp_order_flow user_test erp_contract_orders erp_order_flow
#   63 0x398D07B3BB5A793E    38.0993  0.1%    16   2.3812  0.05 DELETE SELECT erp_teacher_schedule erp_lessons
#   70 0x7146E02EEE59AD24    29.2799  0.0%    10   2.9280  0.67 SELECT erp_contract_orders erp_contract erp_clients mis_user_info erp_lessons erp_learn_report user_test
#   71 0xD8D08DA009DE195E    29.2598  0.0%    10   2.9260  0.92 SELECT mis_work_order erp_contract_orders erp_contract erp_clients mis_user_info erp_order_status erp_lessons erp_learn_report user_test
#   82 0x6BC7D5D7388C71CF    22.4565  0.0%    10   2.2457  0.01 UPDATE SELECT client_data_pool erp_channel
# MISC 0xMISC              2566.9801  3.4%   300   8.5566   0.0 <144 ITEMS>

# Query 1: 0.05 QPS, 0.19x concurrency, ID 0x597AE1A5E18B09B5 at byte 11355277
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.12
# Time range: 2018-04-15 04:58:29 to 2018-04-16 01:09:01
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         30    3962
# Exec time     18  14024s      3s     10s      4s      5s   646ms      3s
# Lock time      0   431ms    19us    36ms   108us   152us   550us    98us
# Rows sent      0  44.64k       0      50   11.54   19.46    7.16   10.84
# Rows examine   7   7.72G   1.99M   2.00M   2.00M   1.95M       0   1.95M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size    17   1.82M     476     491  480.70  487.09    5.88  463.90
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        erpuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+  #
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_book_files'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_book_files`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT b.*,mui.userRealName operatorName,
			
			t1.importCnt
			FROM
						erp_lesson_book_files b
			LEFT JOIN mis_user_info mui on mui.userId = b.operator	
			LEFT JOIN (
				SELECT t.fileId,COUNT(DISTINCT t.lessonId) importCnt
						FROM erp_lesson_docs t
						WHERE t.parentId = 0 AND t.fileId != 0
						GROUP BY t.fileId 
			) t1 ON t1.fileId=b.fileId
		 WHERE catalogCode like '%tdwaoj/%' and parentId = 0 
		order by fileStatus desc,
		 
		createTime desc limit 0,20\G

# Query 2: 0.05 QPS, 0.19x concurrency, ID 0x0F3305545EA49428 at byte 86758
# This item is included in the report because it matches --limit.
# Scores: V/M = 2.11
# Time range: 2018-04-15 04:58:25 to 2018-04-16 01:08:59
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         29    3854
# Exec time     18  13987s      3s    115s      4s      5s      3s      3s
# Lock time      0   497ms    18us    50ms   128us   152us     1ms    98us
# Rows sent      0   3.76k       1       1       1       1       0       1
# Rows examine   7   7.51G   1.99M   2.00M   2.00M   1.95M       0   1.95M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size    11   1.21M     324     338  328.62  329.68       7  329.68
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        erpuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+  #
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_book_files'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_book_files`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT count(*) FROM erp_lesson_book_files b LEFT JOIN mis_user_info mui ON mui.userId = b.operator LEFT JOIN (SELECT t.fileId, COUNT(DISTINCT t.lessonId) importCnt FROM erp_lesson_docs t WHERE t.parentId = 0 AND t.fileId != 0 GROUP BY t.fileId) t1 ON t1.fileId = b.fileId WHERE catalogCode LIKE '%lrwhgc/siaijv/%' AND parentId = 0\G

# Query 3: 0.01 QPS, 0.16x concurrency, ID 0x7CB8293C8D8EFAA6 at byte 12354124
# This item is included in the report because it matches --limit.
# Scores: V/M = 1.35
# Time range: 2018-04-15 05:50:26 to 2018-04-16 02:11:38
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          3     419
# Exec time     15  12009s     20s     44s     29s     40s      6s     26s
# Lock time      0    20ms    36us    74us    48us    60us     6us    47us
# Rows sent      0 382.58k     935     935     935     935       0     935
# Rows examine  36  37.45G  91.14M  91.83M  91.53M  87.73M       0  87.73M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     4 471.38k   1.12k   1.12k   1.12k   1.12k       0   1.12k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,lessonName,playBegin,playEnd,orginalPrice,currentPrice,entryLimit,img1,img2,
        if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
        WHERE l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
        (SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount
        FROM
        lvb_lesson l left join lvb_lesson_ext le on l.lessonId = le.lessonFid
        where
        (
          
             
              
                1=1
             
          
        )
        and
        (
          
             
              
                1=1
             
          
        )
        and
        (
          
             
             
             
              
                1=1
             
          
        )
        and
        (
          
             
             
              
                1=1
             
          
        )
        and l.applyFids  like concat('%',concat(1,'%'))
        and now() >= l.validBegin
        and now()  <=  l.validEnd
        group by l.lessonId\G

# Query 4: 0.00 QPS, 0.12x concurrency, ID 0x4EC8A0DB8530E4CC at byte 8252583
# This item is included in the report because it matches --limit.
# Scores: V/M = 1.57
# Time range: 2018-04-15 04:58:13 to 2018-04-16 02:10:51
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2     314
# Exec time     12   9327s     20s     46s     30s     40s      7s     27s
# Lock time      0    71ms    33us   457us   225us   366us   115us   247us
# Rows sent      0 286.71k     935     935     935     935       0     935
# Rows examine  27  28.04G  91.14M  91.83M  91.45M  87.73M       0  87.73M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size    10   1.13M   3.69k   3.69k   3.69k   3.69k       0   3.69k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,lessonName,playBegin,playEnd,orginalPrice,currentPrice,entryLimit,img1,img2,
        if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
        WHERE l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
        (SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount
        FROM
        lvb_lesson l left join lvb_lesson_ext le on l.lessonId = le.lessonFid
        where
        (
          
              
                subjectIds like concat (concat('%','1'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','2'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','3'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','4'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','5'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','6'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','7'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','8'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','9'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','13'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','16'),'%')
             
             
          
        )
        and
        (
          
              
                termIds like concat (concat('%','130'),'%')
             
             
         
             or 
                termIds like concat (concat('%','140'),'%')
             
             
         
             or 
                termIds like concat (concat('%','150'),'%')
             
             
         
             or 
                termIds like concat (concat('%','160'),'%')
             
             
         
             or 
                termIds like concat (concat('%','170'),'%')
             
             
         
             or 
                termIds like concat (concat('%','210'),'%')
             
             
         
             or 
                termIds like concat (concat('%','220'),'%')
             
             
         
             or 
                termIds like concat (concat('%','230'),'%')
             
             
         
             or 
                termIds like concat (concat('%','240'),'%')
             
             
         
             or 
                termIds like concat (concat('%','310'),'%')
             
             
         
             or 
                termIds like concat (concat('%','320'),'%')
             
             
         
             or 
                termIds like concat (concat('%','330'),'%')
             
             
         
             or 
                termIds like concat (concat('%','410'),'%')
             
             
          
        )
        and
        (
          
             
             
             
              
                1=1
             
          
        )
        and
        (
          
             
             
              
                1=1
             
          
        )
        and l.applyFids  like concat('%',concat(1,'%'))
        and now() >= l.validBegin
        and now()  <=  l.validEnd
        group by l.lessonId\G

# Query 5: 0.00 QPS, 0.05x concurrency, ID 0xC8F5044C7E2EADE7 at byte 4756
# This item is included in the report because it matches --limit.
# Scores: V/M = 52.16
# Time range: 2018-04-15 04:05:16 to 2018-04-16 03:01:42
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      78
# Exec time      4   3731s      4s    315s     48s    118s     50s     38s
# Lock time      0     5ms    20us   180us    58us   131us    35us    44us
# Rows sent      0  12.45k      11   1.06k  163.38  400.73  176.09  107.34
# Rows examine   5   6.01G   4.83M 579.64M  78.89M 221.69M  88.05M  59.38M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  53.82k     704     707  706.50  685.39       0  685.39
# String:
# Databases    yimi
# Hosts        10.28.143.117 (21/26%), 10.81.244.11 (14/17%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ###################
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'wx_service_msg'\G
#    SHOW CREATE TABLE `yimi`.`wx_service_msg`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
			lesson_temp.startTime,
			lesson_temp.endTime,
			lesson_temp.lessonId,
			lesson_temp.teacherId,
			lesson_temp.studentId,
			eccs.subjectName
		from
			(select els.startTime,
					els.endTime,
					els.subjectId,
					els.teacherId,
					els.studentId,
					els.lessonId
			from erp_lessons els
			where els.lessonType=10 and els.lessonStatus=0 and els.startTime   >=   NOW()
			and els.startTime   <=   '2018-04-16 04:00:01.249000') as lesson_temp
		left join erp_conf_course_subjects eccs on eccs.subjectId=lesson_temp.subjectId
		left join wx_service_msg wsm on wsm.bizFid=lesson_temp.lessonId and wsm.bizType='LESSON'
		and wsm.bizTimeType='1D' and wsm.userType='STU'
		where wsm.tId is null\G

# Query 6: 0.00 QPS, 0.03x concurrency, ID 0x5FDDE1EC4813C54F at byte 1833183
# This item is included in the report because it matches --limit.
# Scores: V/M = 29.00
# Time range: 2018-04-15 04:01:15 to 2018-04-16 04:00:35
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      94
# Exec time      3   2651s      2s    113s     28s     84s     29s     12s
# Lock time      0   107ms    23us    50ms     1ms   159us     7ms    63us
# Rows sent      0  12.24k       5     473  133.31  400.73  138.95   54.21
# Rows examine   3   4.04G   2.41M 146.20M  43.98M 142.90M  46.31M  18.41M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  74.65k     810     814  813.24  793.42       0  793.42
# String:
# Databases    yimi
# Hosts        10.81.244.3 (23/24%), 10.31.53.111 (19/20%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  #################################################
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_application'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_application`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'wx_service_msg'\G
#    SHOW CREATE TABLE `yimi`.`wx_service_msg`\G
# EXPLAIN /*!50100 PARTITIONS*/
select msg_temp.startTime,
		msg_temp.teacherId,
		msg_temp.studentId,
		msg_temp.endTime,
		msg_temp.applicationId,
		eccs.subjectName,
		ecsg.gradeName
		from 
			(select ela.applicationId,
			ela.subjectFid,
			els.startTime,
			els.endTime,
			els.teacherId,
			els.studentId,
			els.gradeId 
			from erp_lesson_application ela
			join erp_lessons els on ela.lessonId=els.lessonId
			where els.startTime   >=   NOW() and els.startTime   <=   '2018-04-16 09:00:01.135000') as msg_temp
		left join erp_conf_course_subjects eccs on eccs.subjectId=msg_temp.subjectFid
		left join erp_conf_student_grades ecsg on ecsg.gradeId=msg_temp.gradeId
		left join wx_service_msg wsm on wsm.bizFid=msg_temp.applicationId and wsm.bizType='APPLICATION' 
		and wsm.bizTimeType='1D' and wsm.userType='TEA'
		where wsm.tId is null\G

# Query 7: 0.00 QPS, 0.02x concurrency, ID 0x802478FD2EC71668 at byte 3049681
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.71
# Time range: 2018-04-15 04:10:14 to 2018-04-16 04:00:10
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     150
# Exec time      2   1991s      8s     27s     13s     18s      3s     13s
# Lock time      0    33ms   142us   560us   217us   260us    43us   214us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0   1.01G   3.88M   7.86M   6.88M   7.65M   1.46M   7.29M
# Rows affecte  13 146.48k    1000    1000    1000    1000       0    1000
# Query size     2 219.43k   1.46k   1.46k   1.46k   1.46k       0   1.46k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ###########
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'client_sea'\G
#    SHOW CREATE TABLE `yimi`.`client_sea`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_follow'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_follow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_follow_status'\G
#    SHOW CREATE TABLE `yimi`.`erp_follow_status`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'callcenter_outer_log'\G
#    SHOW CREATE TABLE `yimi`.`callcenter_outer_log`\G
insert IGNORE client_sea(clientFid, clientSea, flag, clientType, viewTime, latestFollowTime)
        SELECT ec.clientId,ec.clientSea,ec.flag,ec.clientType ,ec.viewTime,ifnull(ecf.createdOn,now()) from erp_clients ec
        left join(
             
                    select max(id) id,clientFid,count(0) followNum,max(createdOn) createdOn from erp_client_follow
                        where followStatusFid in(select statusId from erp_follow_status where type like '%,CC,%') GROUP BY clientFid
             
        ) ecf
        on ecf.clientFid=ec.clientId
         WHERE ec.clientSea='P' and ec.clientType = 'C' and ec.viewTime<=now() and ec.flag is not null
            and not exists(select 1 from callcenter_outer_log where ec.clientId=callcenter_outer_log.clientFid and createdOn>date_add(now(),INTERVAL -120 MINUTE))
            and ec.phoneNo REGEXP '^[0]?[1][3456789][0-9]{9}$'
            and not exists(select 1 from callcenter_outer_log where ec.clientId=callcenter_outer_log.clientFid and createdOn>date_add(now(),INTERVAL -120 MINUTE))
            
             and date(ec.createdOnTime) >='2016-01-01'
             and date(ec.createdOnTime) <='2018-03-20'
            
            
            and ec.secondChannelFid not in(21006,27001,27006,21002,21001,39003,27008,27005,27004,21005,39001,39004,39002,21004,39010,39009,21003,39012,39005,39006/*... omitted 10 items ...*/) 
        ORDER BY ec.topTimes>0 desc,ec.viewTime asc
        LIMIT 1000\G

# Query 8: 0.01 QPS, 0.02x concurrency, ID 0x874AC800CFB0B05C at byte 8007843
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.08
# Time range: 2018-04-15 04:02:05 to 2018-04-16 04:00:05
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          5     720
# Exec time      2   1877s      2s      4s      3s      3s   448ms      2s
# Lock time      0    75ms     9us    19ms   104us    89us   806us    35us
# Rows sent      0 203.26k       0    1008  289.08  652.75  246.25  271.23
# Rows examine   1   1.18G   1.67M   1.69M   1.68M   1.61M       0   1.61M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 201.80k     287     287     287     287       0     287
# String:
# Databases    yimi
# Hosts        10.81.244.11 (150/20%), 10.28.143.117 (124/17%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'app_notification'\G
#    SHOW CREATE TABLE `yimi`.`app_notification`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT nId, bizType,userFid,relateId,displayType,title,msg,sound,goActivity,appSysInfo,appVersion,appDeviceInfo,isSend,sendTimes,thirdMsgId,isRead,status,createdOn,lastUpdatedOn,umengAppKey,appSource,userName
		FROM  app_notification
		WHERE isSend=0	AND sendTimes < 5 and NOW()<deadline\G

# Query 9: 0.01 QPS, 0.02x concurrency, ID 0x5188E74C090BF609 at byte 10810422
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.49
# Time range: 2018-04-15 05:33:39 to 2018-04-16 00:05:05
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          3     435
# Exec time      1   1444s      2s      8s      3s      6s      1s      3s
# Lock time      0    41ms    64us   162us    95us   113us    13us    93us
# Rows sent      0  12.19k       8      50   28.69   46.83    9.82   26.08
# Rows examine   0  62.78M 110.73k 186.09k 147.79k 182.98k  17.87k 143.37k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     5 545.02k   1.25k   1.25k   1.25k   1.25k       0   1.25k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_series'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_series`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_series_lesson_ref'\G
#    SHOW CREATE TABLE `yimi`.`lvb_series_lesson_ref`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
		l.lessonId,lessonName,playBegin,playEnd,l.orginalPrice,l.currentPrice,entryLimit,img1,img2,r.refNum,
		if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
		WHERE  l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
		(SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount,
		 
			(SELECT IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=158399 AND o.orderType='L' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,
			IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=158399 AND o.orderType='S' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,0))) isPaid,
		 
		(SELECT if(count(1) =(l.entryLimit-l.entryBase),1,0) FROM lvb_order_lesson ol  WHERE ol.lessonId = l.lessonId) as isFull
		FROM
		lvb_lesson_series ls
		INNER join lvb_series_lesson_ref r on ls.seriesId=r.seriesFid
		INNER join lvb_lesson l  on r.lessonFid=l.lessonId
		left join lvb_lesson_ext le on l.lessonId=le.lessonFid
		where
		ls.seriesId = '133'
		and l.applyFids  like concat('%,',concat(1,',%'))
		and now() >= l.validBegin
		and now()  <=  l.validEnd
		group by l.lessonId\G

# Query 10: 0.00 QPS, 0.04x concurrency, ID 0x984170966838BF4D at byte 3073701
# This item is included in the report because it matches --limit.
# Scores: V/M = 3.16
# Time range: 2018-04-15 09:50:38 to 20:24:18
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     142
# Exec time      1   1348s      2s     20s      9s     19s      5s      7s
# Lock time      0    34ms    72us    11ms   242us   236us   833us   185us
# Rows sent      0     142       1       1       1       1       0       1
# Rows examine   0 116.07M 834.50k 851.22k 837.02k 830.38k       0 830.38k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 168.62k   1.19k   1.19k   1.19k   1.19k       0   1.19k
# String:
# Databases    yimi
# Hosts        10.28.143.117 (27/19%), 10.81.244.3 (27/19%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+  #################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        COUNT(1)
        FROM mis_user_info u
        LEFT JOIN erp_clients ec ON u.userId = ec.chargeFid
        LEFT JOIN mis_user_info u1 ON u1.userId = ec.consultantId
        LEFT JOIN mis_user_info u2 ON u2.userId = ec.cooperateConsultantId
        INNER JOIN erp_lessons l ON ec.studentId = l.studentId
        INNER JOIN t_user_info tui on tui.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
        INNER JOIN www_config pre on pre.configId=1
        INNER JOIN www_config aft on aft.configId=2
        WHERE
        ((u.userOrgFid IN
         (  
            3020100
         ) 
         
            and ec.chargeFid = 900001478
         
        )
        OR (CASE WHEN ec.consultantId!= ec.chargeFid THEN
        u1.userOrgFid IN
         (  
            3020100
         ) 
         
            and ec.consultantId = 900001478
         
        END)
        OR (u2.userOrgFid IN
         (  
            3020100
         ) 
         
            AND ec.cooperateConsultantId = 900001478
         
        ))
         
         
         
            AND l.startTime >= '2018-04-15'\G

# Query 11: 1.07 QPS, 15.49x concurrency, ID 0x24A7383D45436873 at byte 8141064
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.63
# Time range: 2018-04-15 16:03:58 to 16:04:56
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      62
# Exec time      1    898s      2s     19s     14s     18s      3s     15s
# Lock time      0    14ms   101us   298us   218us   247us    33us   214us
# Rows sent      0      62       1       1       1       1       0       1
# Rows examine   0  42.24M 697.58k 697.58k 697.58k 683.15k       0 683.15k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  84.71k   1.37k   1.37k   1.37k   1.37k       0   1.37k
# String:
# Databases    yimi
# Hosts        10.28.143.117 (15/24%), 10.80.58.47 (12/19%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  #####
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        COUNT(1)
        FROM mis_user_info u
        LEFT JOIN erp_clients ec ON u.userId = ec.chargeFid
        LEFT JOIN mis_user_info u1 ON u1.userId = ec.consultantId
        LEFT JOIN mis_user_info u2 ON u2.userId = ec.cooperateConsultantId
        INNER JOIN erp_lessons l ON ec.studentId = l.studentId
        INNER JOIN t_user_info tui on tui.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
        INNER JOIN www_config pre on pre.configId=1
        INNER JOIN www_config aft on aft.configId=2
        WHERE
        ((u.userOrgFid IN
         (  
            3120100
         ) 
         
            and ec.chargeFid = 900001428
         
        )
        OR (CASE WHEN ec.consultantId!= ec.chargeFid THEN
        u1.userOrgFid IN
         (  
            3120100
         ) 
         
            and ec.consultantId = 900001428
         
        END)
        OR (u2.userOrgFid IN
         (  
            3120100
         ) 
         
            AND ec.cooperateConsultantId = 900001428
         
        ))
         
            and (l.clientId='张振宇'
            or ec.clientName='张振宇'
            or l.lessonId='张振宇'
            or tui.realname='张振宇'
            )
         
         
         
            AND l.startTime >= '2018-04-14'\G

# Query 12: 0.00 QPS, 0.01x concurrency, ID 0x0924E63A71759FDC at byte 2572758
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.39
# Time range: 2018-04-15 04:10:20 to 23:50:18
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0     103
# Exec time      1    856s      6s     16s      8s     11s      2s      7s
# Lock time      0    16ms   113us   228us   155us   194us    23us   152us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0 369.27M   3.57M   3.60M   3.59M   3.50M       0   3.50M
# Rows affecte   0     837       1      39    8.13   24.84    8.09    5.75
# Query size     0  92.44k     919     919     919     919       0     919
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+  ##############
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'client_sea'\G
#    SHOW CREATE TABLE `yimi`.`client_sea`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_follow'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_follow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_follow_status'\G
#    SHOW CREATE TABLE `yimi`.`erp_follow_status`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'callcenter_outer_log'\G
#    SHOW CREATE TABLE `yimi`.`callcenter_outer_log`\G
insert IGNORE client_sea(clientFid, clientSea, flag, clientType, viewTime, latestFollowTime)
        SELECT ec.clientId,ec.clientSea,ec.flag,ec.clientType ,ec.viewTime,ifnull(ecf.createdOn,now()) from erp_clients ec
        left join(select max(createdOn) createdOn,clientFid,count(0) followNum from erp_client_follow
            where followStatusFid in(select statusId from erp_follow_status where  type like '%,CC,%') GROUP BY clientFid
        )
         ecf
        on ecf.clientFid=ec.clientId
        where
            ec.clientSea='P' and ec.clientType in ('R','N') and ec.viewTime <= now() and ec.flag is not null
            and ec.phoneNo REGEXP '^[0]?[1][3456789][0-9]{9}$'
            and not exists(select 1 from callcenter_outer_log where ec.clientId=callcenter_outer_log.clientFid and createdOn>date_add(now(),INTERVAL -120 MINUTE))
        ORDER BY ec.topTimes>0 desc,ec.viewTime asc
        LIMIT 1000\G

# Query 13: 0.00 QPS, 0.01x concurrency, ID 0xC275A476B01092D4 at byte 1203512
# This item is included in the report because it matches --limit.
# Scores: V/M = 1.84
# Time range: 2018-04-15 06:03:03 to 23:29:48
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      28
# Exec time      1    844s     22s     43s     30s     40s      7s     26s
# Lock time      0     6ms    32us   330us   206us   301us   102us   247us
# Rows sent      0  25.57k     935     935     935     935       0     935
# Rows examine   2   2.50G  91.16M  91.82M  91.47M  87.73M       0  87.73M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  84.14k   3.00k   3.00k   3.00k   3.00k       0   3.00k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,lessonName,playBegin,playEnd,orginalPrice,currentPrice,entryLimit,img1,img2,
        if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
        WHERE l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
        (SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount
        FROM
        lvb_lesson l left join lvb_lesson_ext le on l.lessonId = le.lessonFid
        where
        (
          
              
                subjectIds like concat (concat('%','1'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','2'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','3'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','7'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','8'),'%')
             
             
          
        )
        and
        (
          
              
                termIds like concat (concat('%','130'),'%')
             
             
         
             or 
                termIds like concat (concat('%','140'),'%')
             
             
         
             or 
                termIds like concat (concat('%','150'),'%')
             
             
         
             or 
                termIds like concat (concat('%','160'),'%')
             
             
         
             or 
                termIds like concat (concat('%','170'),'%')
             
             
         
             or 
                termIds like concat (concat('%','210'),'%')
             
             
         
             or 
                termIds like concat (concat('%','220'),'%')
             
             
         
             or 
                termIds like concat (concat('%','230'),'%')
             
             
         
             or 
                termIds like concat (concat('%','240'),'%')
             
             
         
             or 
                termIds like concat (concat('%','310'),'%')
             
             
         
             or 
                termIds like concat (concat('%','320'),'%')
             
             
         
             or 
                termIds like concat (concat('%','330'),'%')
             
             
         
             or 
                termIds like concat (concat('%','410'),'%')
             
             
          
        )
        and
        (
          
             
             
             
              
                1=1
             
          
        )
        and
        (
          
             
             
              
                1=1
             
          
        )
        and l.applyFids  like concat('%',concat(1,'%'))
        and now() >= l.validBegin
        and now()  <=  l.validEnd
        group by l.lessonId\G

# Query 14: 0.00 QPS, 0.01x concurrency, ID 0x9802F83F3C5469D4 at byte 3066798
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.98
# Time range: 2018-04-15 04:10:06 to 2018-04-16 04:00:07
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     252
# Exec time      0    744s      2s     27s      3s      4s      2s      3s
# Lock time      0    56ms   150us   383us   222us   273us    38us   214us
# Rows sent      0      55       0       7    0.22    0.99    0.76       0
# Rows examine   0 530.25M   2.10M   2.11M   2.10M   2.05M       0   2.05M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     3 327.80k   1.30k   1.30k   1.30k   1.30k       0   1.30k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+  #
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) > DATE(now())
		) t on l.clientId = t.clientId and l.startTime = t.startTime
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 10
		and co.contractProp = 1
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid)\G

# Query 15: 0.00 QPS, 0.01x concurrency, ID 0xBC6AD8511E5DCBAA at byte 3040679
# This item is included in the report because it matches --limit.
# Scores: V/M = 1.11
# Time range: 2018-04-15 09:50:27 to 21:30:14
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0     121
# Exec time      0    576s      2s     11s      5s     10s      2s      4s
# Lock time      0    44ms   289us   446us   364us   403us    31us   348us
# Rows sent      0     485       0      10    4.01    9.83    2.53    3.89
# Rows examine   0  64.93M  80.20k 597.19k 549.53k 590.13k 131.76k 590.13k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 294.11k   2.43k   2.43k   2.43k   2.43k       0   2.43k
# String:
# Databases    yimi
# Hosts        10.31.53.111 (26/21%), 10.81.244.3 (25/20%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+  ######
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'server_trail_and_voice'\G
#    SHOW CREATE TABLE `yimi`.`server_trail_and_voice`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,
        l.teacherId,
        l.lessonType,
        l.courseHours,
        date_format(l.startTime,'%Y-%m-%d %H:%i') AS startTime,
        date_format(l.endTime,'%Y-%m-%d %H:%i') AS endTime,
        (case ec.clientName when '' then tui.realName else ec.clientName end) studentName,
        s.subjectName,
        g.gradeName,
        l.lessonStatus,
        timestampdiff(second,now(),l.startTime) remaining,
        timestampdiff(second,l.startTime,l.endTime) lessonSecondCount,
        cast(pre.configValue as signed)*60 beforeSecond,
        cast(aft.configValue as signed)*60 afterSecond,
        if(exists(select 1 from server_trail_and_voice where status=1 and lessonID=l.lessonId),1,0) hasRecord,
        if(exists(select 1 from erp_lesson_docs where parentId=0 and docType=1 and lessonId=l.lessonId),1,0) hasDoc,
        "" AS title,
        "" AS keywords,
        case l.studentAppraiseType when 0 then '未评价' when 1 then '好评' when 2 then '中评' when 3 then '差评' end
        studentAppraiseType,
        studentAppraises
        FROM mis_user_info u
        LEFT JOIN erp_clients ec ON u.userId = ec.chargeFid
        LEFT JOIN mis_user_info u1 ON u1.userId = ec.consultantId
        LEFT JOIN mis_user_info u2 ON u2.userId = ec.cooperateConsultantId
        INNER JOIN erp_lessons l ON ec.studentId = l.studentId
        INNER JOIN t_user_info tui on tui.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
        INNER JOIN www_config pre on pre.configId=1
        INNER JOIN www_config aft on aft.configId=2
        WHERE
        ((u.userOrgFid IN
         (  
            3020100
         ) 
         
            and ec.chargeFid = 900001478
         
        )
        OR (CASE WHEN ec.consultantId!= ec.chargeFid THEN
        u1.userOrgFid IN
         (  
            3020100
         ) 
         
            and ec.consultantId = 900001478
         
        END)
        OR (u2.userOrgFid IN
         (  
            3020100
         ) 
         
            AND ec.cooperateConsultantId = 900001478
         
        ))
         
         
         
            AND l.startTime >= '2018-04-15'
         
         
         
        ORDER BY l.lessonStatus,
        CASE WHEN l.lessonStatus in(0) THEN
        l.startTime END,
        CASE WHEN l.lessonStatus in(1) THEN
        l.startTime END desc
        limit 0, 10\G

# Query 16: 0.00 QPS, 0.01x concurrency, ID 0xAF7087AE5BCF7A6F at byte 3905417
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.10
# Time range: 2018-04-15 10:05:13 to 23:10:07
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     151
# Exec time      0    448s      2s      5s      3s      4s   544ms      3s
# Lock time      0    30ms    42us   458us   196us   273us    63us   194us
# Rows sent      0   2.85k       0     100   19.33   56.92   18.73   13.83
# Rows examine   0 146.87M 472.76k   1.33M 995.97k 1009.33k  74.21k 961.27k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 240.35k   1.39k   7.09k   1.59k   2.16k  696.44   1.39k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        erpuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lesson_comment'\G
#    SHOW CREATE TABLE `yimi`.`lesson_comment`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_cr'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_cr`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
				l.*,
				
				IFNULL(c.clientName,t.nickName) studentName,
				mui.userRealName teacherName,
				g.gradeName gradeName,
				s.subjectName subjectName,
				o1.userRealName ccName,
				u1.userRealName chargeName,
				u1.userMobile chargePhone,
				stulc.param1 stuParam1,
				stulc.param2 stuParam2,
				stulc.param3 stuParam3,
				stulc.param4 stuParam4,
				tealc.param1 teaParam1,
				tealc.param2 teaParam2,
				tealc.param3 teaParam3,
				c.eduSystem
		FROM erp_lessons l
		LEFT JOIN erp_clients c ON l.clientId=c.clientId
		LEFT JOIN t_user_info t ON l.studentId=t.id
		LEFT JOIN mis_user_info mui ON mui.userId = l.teacherId
		LEFT JOIN erp_conf_student_grades g ON l.gradeId=g.gradeId
		LEFT JOIN erp_conf_course_subjects s ON l.subjectId=s.subjectId
		LEFT JOIN mis_user_info o1 ON o1.userId = c.consultantId
		LEFT JOIN mis_user_info u1 ON u1.userId=c.chargeFid
		LEFT JOIN lesson_comment stulc ON stulc.lessonFid=l.lessonId and stulc.commentBy='STU'
		LEFT JOIN lesson_comment tealc ON tealc.lessonFid=l.lessonId and tealc.commentBy='TEA'
		 WHERE  (c.clientName like '%鲍美霖%' OR t.nickName like '%鲍美霖%')
			
			
			
			
			
			
			
				and (c.consultantId in (				
				 107157
	           ,				
				 110244
	           ,				
				 115245
	           ,				
				 115877
	           ,				
				 117466
	           ,				
				 118233
	           ,				
				 121446
	           ,				
				 900000059
	           ,				
				 900000151
	           ,				
				 900000326
	           ,				
				 900000378
	           ,				
				 900000380
	           ,				
				 900000414
	           ,				
				 900000458
	           ,				
				 900000460
	           ,				
				 900000475
	           ,				
				 900000482
	           ,				
				 900000561
	           ,				
				 900000581
	           ,				
				 900000582
	           /*... omitted 70 items ...*/)
				or EXISTS (select distinct 1 from erp_client_cr t1
				where t1.clientFid=l.clientId and t1.endTime is null
				and t1.crFid in (				
				 107157
	           ,				
				 110244
	           ,				
				 115245
	           ,				
				 115877
	           ,				
				 117466
	           ,				
				 118233
	           ,				
				 121446
	           ,				
				 900000059
	           ,				
				 900000151
	           ,				
				 900000326
	           ,				
				 900000378
	           ,				
				 900000380
	           ,				
				 900000414
	           ,				
				 900000458
	           ,				
				 900000460
	           ,				
				 900000475
	           ,				
				 900000482
	           ,				
				 900000561
	           ,				
				 900000581
	           ,				
				 900000582
	           /*... omitted 70 items ...*/))) 
		order by startTime desc limit 0,20\G

# Query 17: 0.02 QPS, 3.37x concurrency, ID 0x228B947AC62652E4 at byte 13450561
# This item is included in the report because it matches --limit.
# Scores: V/M = 4.09
# Time range: 2018-04-16 03:03:26 to 03:05:30
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0       3
# Exec time      0    418s    103s    165s    139s    159s     24s    144s
# Lock time     97    176s     59s     59s     59s     59s       0     59s
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0   3.65M       0   3.65M   1.22M   3.50M   1.65M       0
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0     255      85      85      85      85       0      85
# String:
# Databases    yimi
# Hosts        10.8.0.%
# Users        root
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s
#  10s+  ################################################################
call sp_statistics_insert_finish_order_teacher(date(date_add(now(),interval -3 day)))\G

# Query 18: 0.01 QPS, 0.07x concurrency, ID 0x5B97519418BA5B13 at byte 8178155
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.48
# Time range: 2018-04-15 14:30:02 to 16:04:52
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      60
# Exec time      0    384s      2s      9s      6s      8s      2s      7s
# Lock time      0    22ms   290us   730us   370us   403us    53us   348us
# Rows sent      0     179       2       3    2.98    2.90    0.12    2.90
# Rows examine   0  27.02M 460.25k 461.15k 461.13k 440.37k       0 440.37k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 156.56k   2.61k   2.61k   2.61k   2.61k       0   2.61k
# String:
# Databases    yimi
# Hosts        10.28.143.117 (13/21%), 10.80.58.47 (12/20%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'server_trail_and_voice'\G
#    SHOW CREATE TABLE `yimi`.`server_trail_and_voice`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,
        l.teacherId,
        l.lessonType,
        l.courseHours,
        date_format(l.startTime,'%Y-%m-%d %H:%i') AS startTime,
        date_format(l.endTime,'%Y-%m-%d %H:%i') AS endTime,
        (case ec.clientName when '' then tui.realName else ec.clientName end) studentName,
        s.subjectName,
        g.gradeName,
        l.lessonStatus,
        timestampdiff(second,now(),l.startTime) remaining,
        timestampdiff(second,l.startTime,l.endTime) lessonSecondCount,
        cast(pre.configValue as signed)*60 beforeSecond,
        cast(aft.configValue as signed)*60 afterSecond,
        if(exists(select 1 from server_trail_and_voice where status=1 and lessonID=l.lessonId),1,0) hasRecord,
        if(exists(select 1 from erp_lesson_docs where parentId=0 and docType=1 and lessonId=l.lessonId),1,0) hasDoc,
        "" AS title,
        "" AS keywords,
        case l.studentAppraiseType when 0 then '未评价' when 1 then '好评' when 2 then '中评' when 3 then '差评' end
        studentAppraiseType,
        studentAppraises
        FROM mis_user_info u
        LEFT JOIN erp_clients ec ON u.userId = ec.chargeFid
        LEFT JOIN mis_user_info u1 ON u1.userId = ec.consultantId
        LEFT JOIN mis_user_info u2 ON u2.userId = ec.cooperateConsultantId
        INNER JOIN erp_lessons l ON ec.studentId = l.studentId
        INNER JOIN t_user_info tui on tui.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
        INNER JOIN www_config pre on pre.configId=1
        INNER JOIN www_config aft on aft.configId=2
        WHERE
        ((u.userOrgFid IN
         (  
            3120100
         ) 
         
            and ec.chargeFid = 900001428
         
        )
        OR (CASE WHEN ec.consultantId!= ec.chargeFid THEN
        u1.userOrgFid IN
         (  
            3120100
         ) 
         
            and ec.consultantId = 900001428
         
        END)
        OR (u2.userOrgFid IN
         (  
            3120100
         ) 
         
            AND ec.cooperateConsultantId = 900001428
         
        ))
         
            and (l.clientId='张振宇'
            or ec.clientName='张振宇'
            or l.lessonId='张振宇'
            or tui.realname='张振宇'
            )
         
         
         
            AND l.startTime >= '2018-04-14'
         
         
         
        ORDER BY l.lessonStatus,
        CASE WHEN l.lessonStatus in(0) THEN
        l.startTime END,
        CASE WHEN l.lessonStatus in(1) THEN
        l.startTime END desc
        limit 0, 10\G

# Query 19: 0.00 QPS, 0.00x concurrency, ID 0x807CEFFF6917F85F at byte 13394534
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.05
# Time range: 2018-04-15 04:10:11 to 2018-04-16 03:50:14
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     137
# Exec time      0    345s      2s      4s      3s      3s   355ms      3s
# Lock time      0    35ms   173us   370us   256us   316us    45us   260us
# Rows sent      0     174       0      23    1.27   11.95    4.17       0
# Rows examine   0 109.62M 752.54k 879.98k 819.32k 871.90k  56.32k 830.38k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 210.90k   1.54k   1.54k   1.54k   1.53k       0   1.53k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,
		t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,
		i.userRealName teacherName,l.gradeId gradeFid,g.gradeName,round(timestampdiff(DAY,t.startTime,now())/14,0) workFlag
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) >  DATE_SUB(now(),INTERVAL 30 DAY)
		) t on l.startTime = t.startTime and l.clientId = t.clientId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		JOIN erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 23
		and timestampdiff(DAY,t.startTime,now())%14 = 0
		and timestampdiff(DAY,t.startTime,now()) > 0
		and co.contractProp = 1
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid and workFlag = round(timestampdiff(DAY,t.startTime,now())/14,0))\G

# Query 20: 0.00 QPS, 0.00x concurrency, ID 0xED7DE5AA05230157 at byte 13078431
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.09
# Time range: 2018-04-15 04:10:15 to 2018-04-16 04:00:13
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0     117
# Exec time      0    308s      2s      4s      3s      3s   499ms      3s
# Lock time      0    27ms   177us   334us   234us   301us    39us   214us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0 257.74M   2.20M   2.21M   2.20M   2.15M       0   2.15M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 173.67k   1.48k   1.48k   1.48k   1.48k       0   1.48k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName,1 workFlag
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) =  DATE_SUB(now(),INTERVAL 30 DAY)
		) t on l.startTime = t.startTime and l.clientId = t.clientId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 12
		and co.gradeFid not in (160,230,330)
		and co.contractProp = 1
		and exists(select 1 from erp_contract ec where ec.clientFid = c.clientId and ec.contractStatus=3)
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid and workFlag = 1)\G

# Query 21: 0.00 QPS, 0.01x concurrency, ID 0x7A6044C4585A6A8C at byte 3528830
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.18
# Time range: 2018-04-15 06:57:33 to 23:10:48
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0     106
# Exec time      0    305s      2s      5s      3s      4s   711ms      3s
# Lock time      0    11ms    79us   333us   106us   119us    25us    98us
# Rows sent      0   2.81k      16      46   27.10   30.19    3.68   26.08
# Rows examine   0  23.02M 125.19k   7.83M 222.42k 150.54k 743.45k 143.37k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 142.01k   1.34k   1.34k   1.34k   1.33k       0   1.33k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_series_lesson_ref'\G
#    SHOW CREATE TABLE `yimi`.`lvb_series_lesson_ref`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_series'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_series`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
	    ls.seriesId,seriesName,l.lessonId,lessonName,playBegin,playEnd,l.orginalPrice,l.currentPrice,entryLimit,img1,img2,
	    if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
	    WHERE  l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
		(SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount,
		 
			(SELECT IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=149230 AND o.orderType='L' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,
			IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=149230 AND o.orderType='S' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,0))) isPaid,
		 
		(SELECT if(count(1) = (l.entryLimit-l.entryBase),1,0) FROM lvb_order_lesson ol  WHERE ol.lessonId = l.lessonId) as isFull
	FROM
	lvb_series_lesson_ref r
	INNER JOIN lvb_lesson_series ls on r.seriesFid=ls.seriesId
	INNER join lvb_lesson l  on r.lessonFid=l.lessonId
		left join lvb_lesson_ext le on l.lessonId=le.lessonFid
	where
	    r.seriesFid IN (SELECT seriesFid FROM  lvb_series_lesson_ref where lessonFid = '3311')
		and l.applyFids  like concat('%,',concat(1,',%'))
		and now() >= l.validBegin
		and now()  <=  l.validEnd
		GROUP BY l.lessonId\G

# Query 22: 0.26 QPS, 0.53x concurrency, ID 0xA94D3D74D07035C4 at byte 13559496
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.00
# Time range: 2018-04-16 03:06:53 to 03:16:12
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     145
# Exec time      0    297s      2s      2s      2s      2s    54ms      2s
# Lock time      0    24ms   105us   211us   162us   185us    26us   167us
# Rows sent      0     145       1       1       1       1       0       1
# Rows examine   0 139.83M 987.46k 987.71k 987.52k 961.27k       0 961.27k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 108.89k     768     770  769.01  755.64       0  755.64
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_order_flow'\G
#    SHOW CREATE TABLE `yimi`.`erp_order_flow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
# EXPLAIN /*!50100 PARTITIONS*/
select count(0) from erp_contract_orders tmpeco
        join (
        select eof.orderFid,eof.orderStatusFid from erp_order_flow eof
        join (select max(flowId) flowId from erp_order_flow where orderStatusFid>0 and createdOn  <  '2018-04-14 11:14:55' GROUP BY orderFid) tmp on tmp.flowId=eof.flowId
        ) tmpeof on tmpeco.contractId=tmpeof.orderFid
        LEFT JOIN (select contractId,sum(courseHours) overHours from erp_lessons where lessonStatus in(1,3,4) and contractId>0 GROUP BY contractId) tmpel on tmpel.contractId=tmpeco.contractId
        where tmpeof.orderStatusFid in(1,2,6) and (orderStatusFid=1 or tmpel.overHours!=tmpeco.realLessonCount)
         
         and tmpeco.subjectId=2 
        and tmpeco.contractId!=7851 and tmpeco.clientId=207705\G

# Query 23: 0.00 QPS, 0.00x concurrency, ID 0xF83D3854B6294F5F at byte 8367183
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.17
# Time range: 2018-04-15 04:10:20 to 2018-04-16 04:00:17
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0     106
# Exec time      0    296s      2s      5s      3s      4s   690ms      3s
# Lock time      0    25ms   167us   326us   235us   287us    42us   224us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0 233.89M   2.20M   2.21M   2.21M   2.15M       0   2.15M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 156.93k   1.48k   1.48k   1.48k   1.48k       0   1.48k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName,1 workFlag
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) =  DATE_SUB(now(),INTERVAL 30 DAY)
		) t on l.startTime = t.startTime and l.clientId = t.clientId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 14
		and co.gradeFid in (160,230,330)
		and co.contractProp = 1
		and exists(select 1 from erp_contract ec where ec.clientFid = c.clientId and ec.contractStatus=3)
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid and workFlag = 1)\G

# Query 24: 0.00 QPS, 0.00x concurrency, ID 0x08FE275627AABB49 at byte 3092013
# This item is included in the report because it matches --outliers.
# Scores: V/M = 1.34
# Time range: 2018-04-15 05:00:05 to 2018-04-16 04:00:08
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0     112
# Exec time      0    288s      2s     19s      3s      3s      2s      2s
# Lock time      0    29ms   183us   395us   260us   316us    42us   260us
# Rows sent      0      71       0      25    0.63    0.99    3.29       0
# Rows examine   0  83.47M 760.17k 765.72k 763.17k 753.18k       0 753.18k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 180.69k   1.61k   1.61k   1.61k   1.61k       0   1.61k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+  #
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_student_teach_special'\G
#    SHOW CREATE TABLE `yimi`.`erp_student_teach_special`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo contractNo,o.contractId orderFid,temp.lessonId lessonFid,
		o.subjectId subjectFid,s.subjectName,o.teacherId teacherFid,i.userRealName teacherName,o.gradeId gradeFid,g.gradeName
		from erp_contract_orders o
		join erp_contract co on co.contractId = o.contractFid
		join erp_clients c on o.clientId = c.clientId
		join t_user_info t on o.studentId = t.id
		join mis_user_info i on o.teacherId = i.userId
		join erp_conf_student_grades g on o.gradeId = g.gradeId
		join erp_conf_course_subjects s on o.subjectId = s.subjectId
		join (
		select
		contractId,l.lessonId
		from erp_lessons l,
		(
		select
		clientId,subjectId,teacherid,max(startTime) startTime
		from erp_lessons
		where lessonStatus=1
		AND startTime > date_sub(now(),INTERVAL 30 DAY)
		and lessonType=10
		GROUP BY subjectId,clientId,teacherId
		HAVING timestampdiff(day,max(startTime),now())= 28
		) ll
		where l.clientId=ll.clientId
		and l.subjectId=ll.subjectId
		and l.teacherId=ll.teacherId
		and l.startTime=ll.startTime
		) temp on o.contractId = temp.contractId
		,mis_work_order_config w
		where
		w.configId = 20
		and o.orderStatus = 2
		and not exists(select 1 from mis_work_order wo where wo.configFid = w.configId and wo.lessonFid = temp.lessonId)
		and not exists(select 1 from erp_student_teach_special s where c.clientId = s.clientFid)\G

# Query 25: 0.00 QPS, 0.00x concurrency, ID 0xD824344EA5B63403 at byte 6004996
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.07
# Time range: 2018-04-15 04:10:04 to 2018-04-16 04:00:03
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0     106
# Exec time      0    279s      2s      4s      3s      3s   423ms      3s
# Lock time      0    99ms   316us    51ms   934us   541us     5ms   467us
# Rows sent      0     277       0      32    2.61    9.83    5.70       0
# Rows examine   0  28.42M  62.08k 898.09k 274.58k 871.90k 353.64k  59.57k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     3 328.04k   3.09k   3.09k   3.09k   3.09k       0   3.09k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_plan'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_plan`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'teach_lesson_plan'\G
#    SHOW CREATE TABLE `yimi`.`teach_lesson_plan`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo contractNo,o.contractId orderFid,0 lessonFid,
		o.subjectId subjectFid,s.subjectName,o.teacherId teacherFid,i.userRealName teacherName,o.gradeId gradeFid,g.gradeName,round(temp.completeCount/5,0) workFlag
		from erp_contract_orders o
		join erp_contract co on co.contractId = o.contractFid
		join erp_clients c on o.clientId = c.clientId
		join t_user_info t on o.studentId = t.id
		join mis_user_info i on o.teacherId = i.userId
		join erp_conf_student_grades g on o.gradeId = g.gradeId
		join erp_conf_course_subjects s on o.subjectId = s.subjectId
		join (
		SELECT o.contractFid,o.teacherId,o.subjectId,o.clientId,sum(tmp.lessonCount) lessonCount,sum(tmp.lessonNum) completeCount
		from erp_contract_orders o
		JOIN erp_contract ec on o.contractFid = ec.contractId
		JOIN (
		SELECT contractId,sum(courseHours) lessonCount,count(contractId) lessonNum FROM erp_lessons
		WHERE lessonStatus = 1
		AND contractId>0
		GROUP BY contractId
		) tmp on o.contractId = tmp.contractId
		GROUP BY o.teacherId,o.subjectId,o.clientId
		HAVING sum(tmp.lessonNum)%5 = 0
		AND sum(tmp.lessonNum)>0
		
		)temp on o.clientId = temp.clientId and o.teacherId = temp.teacherId and o.subjectId = temp.subjectId
		JOIN (
		select tm.clientId,tm.teacherId,tm.subjectId,sum(renainLessonCount) renainLessonCount
		from (
		select o.contractId,o.clientId,o.teacherId,o.subjectId,(o.realLessonCount - ifnull(sum(l.courseHours),0)) renainLessonCount
		from erp_contract_orders o left JOIN erp_lessons l on o.contractId = l.contractId
		where l.lessonStatus in (1,3,4)
		GROUP BY o.contractId
		) tm GROUP BY tm.clientId,tm.teacherId,tm.subjectId
		) tmp on o.subjectId = tmp.subjectId and o.teacherId = tmp.teacherId and o.clientId = tmp.clientId 
		left join (
		select teacherId,subjectId,clientId,sum(planCount) planCount from (
		select o.teacherId,o.subjectId,o.clientId,round(count(p.planId)/5,0) planCount
		from erp_lesson_plan p
		JOIN erp_contract_orders o on p.contractId = o.contractId
		where o.teacherId>0
		GROUP BY o.teacherId,o.subjectId,o.clientId
		UNION ALL
		SELECT teacherFid teacherId,subjectFid subjectId,clientFid clientId,count(id) planCount
		FROM teach_lesson_plan
		GROUP BY teacherFid,subjectFid,clientFid
		) tmp
		GROUP BY teacherId,subjectId,clientId
		) tm on o.subjectId = tm.subjectId and o.teacherId = tm.teacherId and o.clientId = tm.clientId 
		,mis_work_order_config w
		where
		w.configId = 9
		and not exists(select 1 from mis_work_order o1 where o1.configFid = w.configId
		AND o1.clientFid = o.clientId
		AND o1.subjectFid = o.subjectId
		AND o1.teacherFid = o.teacherId
		and workFlag = round(temp.completeCount/5,0))
		and o.contractFid != o.contractId
		and o.contractId>0
		and tmp.renainLessonCount >0 
		and round(temp.completeCount/5,0) > (ifnull(planCount,0)-1) 
		GROUP BY o.clientId,o.subjectId,o.teacherId\G

# Query 26: 0.00 QPS, 0.00x concurrency, ID 0x4A078E636F95F53C at byte 2586587
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.22
# Time range: 2018-04-15 04:10:22 to 2018-04-16 04:00:19
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      98
# Exec time      0    278s      2s      8s      3s      4s   798ms      3s
# Lock time      0    26ms   193us   355us   268us   332us    45us   260us
# Rows sent      0     180       0     175    1.84       0   17.57       0
# Rows examine   0  86.57M 880.26k 1013.11k 904.60k 1009.33k  52.04k 871.90k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 157.53k   1.61k   1.61k   1.61k   1.61k       0   1.61k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName,round((datediff(now(),l.startTime)-30)/7,0)+1 workFlag
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) < DATE_SUB(now(),INTERVAL 30 DAY)
		) t on l.startTime = t.startTime and l.clientId = t.clientId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 15
		and co.gradeFid in (160,230,330)
		and co.contractProp = 1
		and exists(select 1 from erp_contract ec where ec.clientFid = c.clientId and ec.contractStatus=3)
		and (datediff(now(),l.startTime)-30)%7=0
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid and workFlag = round((datediff(now(),l.startTime)-30)/7,0)+1)\G

# Query 27: 0.28 QPS, 0.57x concurrency, ID 0xC4EDC64AF48E3254 at byte 13814369
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.00
# Time range: 2018-04-16 03:16:38 to 03:23:58
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0     124
# Exec time      0    253s      2s      2s      2s      2s    15ms      2s
# Lock time      0    20ms   104us   200us   162us   185us    22us   167us
# Rows sent      0     124       1       1       1       1       0       1
# Rows examine   0 119.60M 987.46k 988.25k 987.62k 961.27k       0 961.27k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  90.33k     745     746  745.99  719.66       0  719.66
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_order_flow'\G
#    SHOW CREATE TABLE `yimi`.`erp_order_flow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
# EXPLAIN /*!50100 PARTITIONS*/
select count(0) from erp_contract_orders tmpeco
        join (
        select eof.orderFid,eof.orderStatusFid from erp_order_flow eof
        join (select max(flowId) flowId from erp_order_flow where orderStatusFid>0 and createdOn  <  '2018-04-14 18:45:00' GROUP BY orderFid) tmp on tmp.flowId=eof.flowId
        ) tmpeof on tmpeco.contractId=tmpeof.orderFid
        LEFT JOIN (select contractId,sum(courseHours) overHours from erp_lessons where lessonStatus in(1,3,4) and contractId>0 GROUP BY contractId) tmpel on tmpel.contractId=tmpeco.contractId
        where tmpeof.orderStatusFid in(1,2,6) and (orderStatusFid=1 or tmpel.overHours!=tmpeco.realLessonCount)
         
         
        and tmpeco.contractId!=27711 and tmpeco.clientId=280834\G

# Query 28: 0.00 QPS, 0.00x concurrency, ID 0x26476FF6C3C0CA5D at byte 2559963
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.17
# Time range: 2018-04-15 04:10:17 to 2018-04-16 03:50:20
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      85
# Exec time      0    230s      2s      8s      3s      3s   675ms      3s
# Lock time      0    23ms   200us   352us   275us   332us    47us   273us
# Rows sent      0     310       0     297    3.65    0.99   30.70       0
# Rows examine   0  64.93M 770.87k 842.98k 782.27k 830.38k  26.88k 753.18k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 137.29k   1.62k   1.62k   1.62k   1.62k       0   1.62k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName,round((datediff(now(),l.startTime)-30)/14,0)+1 workFlag
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) <  DATE_SUB(now(),INTERVAL 30 DAY)
		) t on l.startTime = t.startTime and l.clientId = t.clientId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 13
		and co.gradeFid not in (160,230,330)
		and co.contractProp = 1
		and exists(select 1 from erp_contract ec where ec.clientFid = c.clientId and ec.contractStatus=3)
		and (datediff(now(),l.startTime)-30)%14=0
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid and workFlag = round((datediff(now(),l.startTime)-30)/14,0)+1)\G

# Query 29: 0.00 QPS, 0.01x concurrency, ID 0x21B83224C5BD6EDA at byte 10688439
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.11
# Time range: 2018-04-15 10:08:53 to 21:22:21
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      36
# Exec time      0    208s      5s      7s      6s      7s   779ms      6s
# Lock time      0     4ms    55us   177us   111us   144us    25us   113us
# Rows sent      0      30       0       2    0.83    0.99    0.44    0.99
# Rows examine   0  30.86M 875.74k 879.00k 877.83k 871.90k       0 871.90k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  20.21k     575     575     575     575       0     575
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_family'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_family`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
# EXPLAIN /*!50100 PARTITIONS*/
select distinct ec.clientId, ec.clientName, ec.phoneNo, ec.studentId, ec.consultantId, ec.chargeFid, u1.userRealName ccName, u2.userRealName crName
		from erp_clients ec
		left join mis_user_info u1 on ec.consultantId = u1.userId
		left join mis_user_info u2 on ec.chargeFid = u2.userId
		left join erp_client_family f on ec.clientId = f.clientFid
		left join t_user_info t on ec.studentId = t.id and (t.accountType = 0 or t.accountType = 1)
		 WHERE (ec.phoneNo = '18825139199' or ec.clientName = '18825139199' or familyPhoneNo = '18825139199' or t.mobileNo = '18825139199')\G

# Query 30: 0.00 QPS, 0.00x concurrency, ID 0xD9CFEA53507AC560 at byte 3101644
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.15
# Time range: 2018-04-15 09:50:40 to 21:17:44
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      59
# Exec time      0    198s      2s      7s      3s      4s   705ms      3s
# Lock time      0    11ms    46us   287us   179us   260us    62us   185us
# Rows sent      0      59       1       1       1       1       0       1
# Rows examine   0 114.46M   1.94M   1.95M   1.94M   1.86M       0   1.86M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 116.62k   1.98k   1.98k   1.98k   1.98k       0   1.98k
# String:
# Databases    yimi
# Hosts        10.28.143.117 (15/25%), 10.31.53.111 (11/18%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        COUNT(1)
        FROM mis_user_info u
        LEFT JOIN erp_clients ec ON u.userId = ec.chargeFid
        LEFT JOIN mis_user_info u1 ON u1.userId = ec.consultantId
        LEFT JOIN mis_user_info u2 ON u2.userId = ec.cooperateConsultantId
        INNER JOIN erp_lessons l ON ec.studentId = l.studentId
        INNER JOIN t_user_info tui on tui.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
         INNER JOIN www_config pre on pre.configId=1
         INNER JOIN www_config aft on aft.configId=2
        WHERE
        l.lessonStatus = 1 and
        ((u.userOrgFid IN
         (  
            3020100
         ) 
         
            and ec.chargeFid = 900001478
         
        )
        OR (CASE WHEN ec.consultantId!= ec.chargeFid THEN
        u1.userOrgFid IN
         (  
            3020100
         ) 
         
            and ec.consultantId = 900001478
         
        END)
        OR (u2.userOrgFid IN
         (  
            3020100
         ) 
         
            AND ec.cooperateConsultantId = 900001478
         
        ))
         
         
        	and l.subjectId in
	         (  
	            0
	         , 
	            1
	         , 
	            2
	         , 
	            3
	         , 
	            4
	         , 
	            5
	         , 
	            6
	         , 
	            7
	         , 
	            8
	         , 
	            9
	         , 
	            13
	         , 
	            16
	         ) 
         
         
        	and l.gradeId in
	         (  
	            130
	         , 
	            140
	         , 
	            150
	         , 
	            160
	         , 
	            170
	         , 
	            210
	         , 
	            220
	         , 
	            230
	         , 
	            240
	         , 
	            310
	         , 
	            320
	         , 
	            330
	         , 
	            410
	         )\G

# Query 32: 0.00 QPS, 0.00x concurrency, ID 0x8DF7748590F106FA at byte 1787402
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.08
# Time range: 2018-04-15 04:10:04 to 2018-04-16 03:50:02
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      70
# Exec time      0    168s      2s      4s      2s      3s   424ms      2s
# Lock time      0   264ms   116us    50ms     4ms    48ms    12ms   176us
# Rows sent      0      26       0       3    0.37    1.96    0.65       0
# Rows examine   0  65.21M 948.08k 959.65k 953.93k 915.49k       0 915.49k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  87.16k   1.25k   1.25k   1.25k   1.25k       0   1.25k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName
		FROM erp_lessons l
		join (
		select clientId,min(lessonId) lessonId from erp_lessons WHERE lessonType = 10 GROUP BY clientId
		) t on l.lessonId = t.lessonId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 7
		and l.createTime > DATE(now())
		and co.contractProp = 1
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid)\G

# Query 33: 0.00 QPS, 0.01x concurrency, ID 0xF5FEACC32429CC03 at byte 3075167
# This item is included in the report because it matches --outliers.
# Scores: V/M = 2.96
# Time range: 2018-04-15 09:50:35 to 18:33:07
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      34
# Exec time      0    168s      2s     20s      5s      8s      4s      4s
# Lock time      0    10ms    55us   422us   303us   403us   109us   332us
# Rows sent      0     214       0      10    6.29    9.83    4.47    9.83
# Rows examine   0  48.24M 348.28k   2.61M   1.42M   2.49M   1.03M   1.39M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 110.77k   3.26k   3.26k   3.26k   3.19k       0   3.19k
# String:
# Databases    yimi
# Hosts        10.28.143.117 (8/23%), 10.81.244.11 (8/23%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+  ####
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'server_trail_and_voice'\G
#    SHOW CREATE TABLE `yimi`.`server_trail_and_voice`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,
        l.teacherId,
        l.lessonType,
        l.courseHours,
        date_format(l.startTime,'%Y-%m-%d %H:%i') AS startTime,
        date_format(l.endTime,'%Y-%m-%d %H:%i') AS endTime,
        (case ec.clientName when '' then tui.realName else ec.clientName end) studentName,
        s.subjectName,
        g.gradeName,
        l.lessonStatus,
         timestampdiff(second,now(),l.startTime) remaining,
         timestampdiff(second,l.startTime,l.endTime) lessonSecondCount,
         cast(pre.configValue as signed)*60 beforeSecond,
         cast(aft.configValue as signed)*60 afterSecond,
        if(exists(select 1 from server_trail_and_voice where status=1 and lessonID=l.lessonId),1,0) hasRecord,
        if(exists(select 1 from erp_lesson_docs where parentId=0 and docType=1 and lessonId=l.lessonId),1,0) hasDoc,
        "" AS title,
        "" AS keywords,
        case l.studentAppraiseType when 0 then '未评价' when 1 then '好评' when 2 then '中评' when 3 then '差评' end
        studentAppraiseType,
        studentAppraises
        FROM mis_user_info u
        LEFT JOIN erp_clients ec ON u.userId = ec.chargeFid
        LEFT JOIN mis_user_info u1 ON u1.userId = ec.consultantId
        LEFT JOIN mis_user_info u2 ON u2.userId = ec.cooperateConsultantId
        INNER JOIN erp_lessons l ON ec.studentId = l.studentId
        INNER JOIN t_user_info tui on tui.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
         INNER JOIN www_config pre on pre.configId=1
         INNER JOIN www_config aft on aft.configId=2
        WHERE
       	l.lessonStatus = 1 and
        ((u.userOrgFid IN
         (  
            3020100
         ) 
         
            and ec.chargeFid = 900001478
         
        )
        OR (CASE WHEN ec.consultantId!= ec.chargeFid THEN
        u1.userOrgFid IN
         (  
            3020100
         ) 
         
            and ec.consultantId = 900001478
         
        END)
        OR (u2.userOrgFid IN
         (  
            3020100
         ) 
         
            AND ec.cooperateConsultantId = 900001478
         
        ))
         
         
        	and l.subjectId in
	         (  
	            0
	         , 
	            1
	         , 
	            2
	         , 
	            3
	         , 
	            4
	         , 
	            5
	         , 
	            6
	         , 
	            7
	         , 
	            8
	         , 
	            9
	         , 
	            13
	         , 
	            16
	         ) 
         
         
        	and l.gradeId in
	         (  
	            130
	         , 
	            140
	         , 
	            150
	         , 
	            160
	         , 
	            170
	         , 
	            210
	         , 
	            220
	         , 
	            230
	         , 
	            240
	         , 
	            310
	         , 
	            320
	         , 
	            330
	         , 
	            410
	         ) 
         
         
         
         
		 
         
         
        ORDER BY l.lessonStatus,
        CASE WHEN l.lessonStatus in(0) THEN
        l.startTime END,
        CASE WHEN l.lessonStatus in(1) THEN
        l.startTime END desc
        limit 0, 10\G

# Query 34: 0.00 QPS, 0.00x concurrency, ID 0x2C9AB886E8ACE1D9 at byte 7749411
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.19
# Time range: 2018-04-15 06:04:13 to 22:28:39
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      49
# Exec time      0    162s      2s      7s      3s      4s   788ms      3s
# Lock time      0    18ms    58us   707us   370us   445us   115us   384us
# Rows sent      0   3.77k      62     154   78.82  102.22   22.51   62.76
# Rows examine   0       0       0       0       0       0       0       0
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 136.95k   2.79k   2.79k   2.79k   2.79k       0   2.79k
# String:
# Databases    yimi
# Hosts        10.31.53.111 (12/24%), 10.81.244.3 (10/20%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_application'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_application`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'server_trail_and_voice'\G
#    SHOW CREATE TABLE `yimi`.`server_trail_and_voice`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_teacher_schedule'\G
#    SHOW CREATE TABLE `yimi`.`erp_teacher_schedule`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
# EXPLAIN /*!50100 PARTITIONS*/
(SELECT
		tsche.lessonId,
		tsche.teacherId,
		TIMESTAMPDIFF(DAY,'2018-04-09',tsche.lessonDate) as dateId,
		(tsche.scheduleId -1) as scheduleId,
		if((tsche.isFree = 0 ),'V',tsche.relateType) as relateType,
		(CASE lessons.lessonType
		WHEN  1 THEN  "A"
		WHEN  0  THEN  "A"
		WHEN  10  THEN  "O"
		WHEN  11  THEN  "O"
		ELSE tsche.relateType
		END
		) as lessonType,
		lessons.startTime,
		lessons.endTime,
		lessons.lessonStatus,
		lessons.courseHours,
		lessons.clientId AS clientNo,
		"" AS lessonName,
		if((lessons.lessonType = 0 || lessons.lessonType = 1),(SELECT applicationId FROM erp_lesson_application WHERE lessonId = tsche.lessonId),lessons.contractId) AS contractNo,
		(SELECT gradeName FROM erp_conf_student_grades  WHERE gradeId = lessons.gradeId)     AS grade,
		(SELECT subjectName FROM erp_conf_course_subjects WHERE subjectId = lessons.subjectId) AS subject,
		clients.clientName   AS name,
		(SELECT userRealName FROM mis_user_info WHERE userId = clients.chargeFid) as chargeName,
		(SELECT userMobile  FROM mis_user_info WHERE userId = clients.chargeFid) as chargeMobile,
		clients.clientName   AS parentRealName,
		clients.phoneNo   AS parentContactInfo,
		(select IF(COUNT(1)>0,1,0) from server_trail_and_voice WHERE  lessonId = tsche.lessonId) as hasRecord,
		(select IF(COUNT(1)>0,1,0) from erp_lesson_docs WHERE docType = 1 and lessonId = tsche.lessonId) as hasCourseware
		FROM erp_teacher_schedule tsche
		LEFT JOIN  erp_lessons lessons
		ON lessons.lessonId = tsche.lessonId
		LEFT JOIN erp_clients clients ON lessons.clientId = clients.clientId
		WHERE
		(tsche.relateType = 'V'  OR tsche.relateType = 'O' OR tsche.relateType = 'A')
		AND
		tsche.teacherId = 900000913
		AND
		tsche.lessonDate  BETWEEN '2018-04-09' AND '2018-04-15'
		ORDER BY
		tsche.lessonDate
		)
		UNION ALL
		(
		SELECT
		tsche.lessonId,
		tsche.teacherId,
		TIMESTAMPDIFF(DAY,'2018-04-09',tsche.lessonDate) as dateId,
		(tsche.scheduleId -1) as scheduleId,
		tsche.relateType,
		'L' as lessonType,
		lessons.playBegin as startTime,
		lessons.playEnd  as endTime,
		lessons.lessonName,
		if(now()  <=  lessons.playBegin ,0,if(lessons.streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v WHERE  tsche.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as lessonStatus,
		0     AS courseHours,
		""    AS clientNo,
		""    AS contractNo,
		lessons.termIds    AS grade,
		lessons.subjectIds    AS subject,
		""    AS name,
		""    AS chargeName,
		""    AS chargeMobile,
		""    AS parentRealName,
		""    AS parentContactInfo,
		0     AS hasRecord,
		0     AS hasCourseware
		FROM lvb_lesson lessons
		LEFT JOIN  erp_teacher_schedule tsche ON lessons.lessonId = tsche.lessonId
		WHERE
		tsche.relateType = 'L'
		AND
		tsche.teacherId = 900000913
		AND
		tsche.lessonDate  BETWEEN '2018-04-09' AND '2018-04-15'
		ORDER BY tsche.lessonDate
		)\G

# Query 35: 0.21 QPS, 0.45x concurrency, ID 0x2F1A313814D4967F at byte 13414559
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.01
# Time range: 2018-04-16 03:00:35 to 03:06:26
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      75
# Exec time      0    159s      2s      2s      2s      2s   104ms      2s
# Lock time      0    11ms    71us   192us   146us   185us    33us   159us
# Rows sent      0      75       1       1       1       1       0       1
# Rows examine   0  72.33M 987.47k 987.82k 987.52k 961.27k       0 961.27k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  58.54k     796     801  799.28  793.42       0  793.42
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_order_flow'\G
#    SHOW CREATE TABLE `yimi`.`erp_order_flow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
# EXPLAIN /*!50100 PARTITIONS*/
select count(0) from erp_contract_orders tmpeco
        join (
        select eof.orderFid,eof.orderStatusFid from erp_order_flow eof
        join (select max(flowId) flowId from erp_order_flow where orderStatusFid>0 and createdOn  <  '2018-04-09 11:48:02' GROUP BY orderFid) tmp on tmp.flowId=eof.flowId
        ) tmpeof on tmpeco.contractId=tmpeof.orderFid
        LEFT JOIN (select contractId,sum(courseHours) overHours from erp_lessons where lessonStatus in(1,3,4) and contractId>0 GROUP BY contractId) tmpel on tmpel.contractId=tmpeco.contractId
        where tmpeof.orderStatusFid in(1,2,6) and (orderStatusFid=1 or tmpel.overHours!=tmpeco.realLessonCount)
         and tmpeco.teacherId=900000967 
         and tmpeco.subjectId=3 
        and tmpeco.contractId!=21711 and tmpeco.clientId=406249\G

# Query 37: 0.00 QPS, 0.00x concurrency, ID 0xEC2DF1FE33870420 at byte 7307112
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.09
# Time range: 2018-04-15 07:19:22 to 23:40:17
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      33
# Exec time      0    122s      3s      5s      4s      5s   579ms      4s
# Lock time      0    18ms   363us   771us   536us   690us   113us   568us
# Rows sent      0   4.96k     154     154     154     154       0     154
# Rows examine   0 134.14M   4.06M   4.07M   4.06M   4.06M       0   4.06M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 142.44k   4.32k   4.32k   4.32k   4.32k       0   4.32k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_teacher_schedule'\G
#    SHOW CREATE TABLE `yimi`.`erp_teacher_schedule`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_teacher_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_teacher_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_lesson_schedule_201609'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_lesson_schedule_201609`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_calendar_week'\G
#    SHOW CREATE TABLE `yimi`.`mis_calendar_week`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_timetable'\G
#    SHOW CREATE TABLE `yimi`.`erp_timetable`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_timetable'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_timetable`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT temp.lessonDate,temp.scheduleId,GROUP_CONCAT(teacherIds) teacherIds FROM
		(

			SELECT lessonDate,scheduleId,CONCAT(',',(GROUP_CONCAT(DISTINCT teacherId)),',') teacherIds FROM erp_teacher_schedule
			WHERE lessonId > 0
			 
				AND lessonDate BETWEEN '2018-04-15' and DATE_ADD('2018-04-15',INTERVAL 6 DAY)
			 
			 
			GROUP BY lessonDate,scheduleId
			 
				UNION
				SELECT lessonDate,scheduleId,(SELECT CONCAT(',',GROUP_CONCAT(mti1.userFid),',') FROM mis_teacher_info mti1 WHERE mti1.teacherType=1 and mti1.isTeach = 1 AND NOT
				FIND_IN_SET(mti1.userFid,IFNULL(teacherIds,''))) teacherIds
					from(
					select  b.scheduleId,b.date lessonDate,temp.teacherIds from (
				    select a.scheduleId,t.date from erp_conf_lesson_schedule_201609 a,(
				      select w.date from mis_calendar_week w where w.date between (select subdate('2018-04-15',if(date_format('2018-04-15','%w')=0,7,date_format('2018-04-15','%w'))-1)) and date_add((select subdate('2018-04-15',if(date_format('2018-04-15','%w')=0,7,date_format('2018-04-15','%w'))-1)),INTERVAL 6 DAY)
				    ) t
				  ) b
				  left join (
				  select et.scheduleId scheduleId,date_format(date_add((select subdate('2018-04-15',if(date_format('2018-04-15','%w')=0,7,date_format('2018-04-15','%w'))-1)),INTERVAL (IF(et.dayOfWeek=1,6,et.dayOfWeek-2)) DAY),'%Y-%m-%d') lessonDate ,
				         CONCAT(',',GROUP_CONCAT(mti.userFid),',') teacherIds
				  from
				    mis_teacher_info mti,erp_timetable et
				  where
				    (
				      exists(select 1 from erp_conf_timetable tmpect
				      where tmpect.relatedFid=mti.timetableFid and  et.timetableFid=tmpect.timetableId
				            and (select subdate('2018-04-15',if(date_format('2018-04-15','%w')=0,7,date_format('2018-04-15','%w'))-1)) between tmpect.beginDate and tmpect.endDate)
				      or (
				        not exists(select 1 from erp_conf_timetable tmpect where tmpect.relatedFid=mti.timetableFid and (select subdate('2018-04-15',if(date_format('2018-04-15','%w')=0,7,date_format('2018-04-15','%w'))-1)) between tmpect.beginDate and tmpect.endDate)
				        and et.timetableFid=mti.timetableFid
				      )
				    )
				    AND mti.teacherType=1 and mti.isTeach = 1
					 
				  GROUP BY lessonDate,scheduleId
				)temp on b.scheduleId = temp.scheduleId and b.date = temp.lessonDate
					
					) t
			 
			 
				UNION
				SELECT lessonDate,scheduleId,(SELECT CONCAT(',',GROUP_CONCAT(mti1.userFid),',') FROM mis_teacher_info mti1 WHERE mti1.teacherType=1 and mti1.isTeach = 1 AND NOT
				FIND_IN_SET(mti1.userFid,IFNULL(teacherIds,''))) teacherIds
					from(
					select  b.scheduleId,b.date lessonDate,temp.teacherIds from (
				    select a.scheduleId,t.date from erp_conf_lesson_schedule_201609 a,(
				      select w.date from mis_calendar_week w where w.date between (select subdate('2018-04-16',if(date_format('2018-04-16','%w')=0,7,date_format('2018-04-16','%w'))-1)) and date_add((select subdate('2018-04-16',if(date_format('2018-04-16','%w')=0,7,date_format('2018-04-16','%w'))-1)),INTERVAL 6 DAY)
				    ) t
				  ) b
				  left join (
				  select et.scheduleId scheduleId,date_format(date_add((select subdate('2018-04-16',if(date_format('2018-04-16','%w')=0,7,date_format('2018-04-16','%w'))-1)),INTERVAL (IF(et.dayOfWeek=1,6,et.dayOfWeek-2)) DAY),'%Y-%m-%d') lessonDate ,
				         CONCAT(',',GROUP_CONCAT(mti.userFid),',') teacherIds
				  from
				    mis_teacher_info mti,erp_timetable et
				  where
				    (
				      exists(select 1 from erp_conf_timetable tmpect
				      where tmpect.relatedFid=mti.timetableFid and  et.timetableFid=tmpect.timetableId
				            and (select subdate('2018-04-16',if(date_format('2018-04-16','%w')=0,7,date_format('2018-04-16','%w'))-1)) between tmpect.beginDate and tmpect.endDate)
				      or (
				        not exists(select 1 from erp_conf_timetable tmpect where tmpect.relatedFid=mti.timetableFid and (select subdate('2018-04-16',if(date_format('2018-04-16','%w')=0,7,date_format('2018-04-16','%w'))-1)) between tmpect.beginDate and tmpect.endDate)
				        and et.timetableFid=mti.timetableFid
				      )
				    )
				    AND mti.teacherType=1 and mti.isTeach = 1
					 
				  GROUP BY lessonDate,scheduleId
				)temp on b.scheduleId = temp.scheduleId and b.date = temp.lessonDate

					) t
			 
		) temp
		where lessonDate BETWEEN '2018-04-15' and DATE_ADD('2018-04-15',INTERVAL 6 DAY)
		GROUP BY lessonDate,scheduleId\G

# Query 38: 0.00 QPS, 0.00x concurrency, ID 0x4E36042C05849EC9 at byte 3183516
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.17
# Time range: 2018-04-15 07:02:06 to 2018-04-16 01:00:18
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      39
# Exec time      0    108s      2s      4s      3s      4s   692ms      2s
# Lock time      0     3ms    59us    98us    77us    84us     7us    76us
# Rows sent      0   1.51k      24      50   39.77   49.17    9.76   42.48
# Rows examine   0 298.26M   4.60M   9.65M   7.65M   9.30M   1.92M   8.03M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  33.48k     879     879     879     879       0     879
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_series'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_series`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_series_lesson_ref'\G
#    SHOW CREATE TABLE `yimi`.`lvb_series_lesson_ref`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
		l.lessonId,lessonName,playBegin,playEnd,l.orginalPrice,l.currentPrice,entryLimit,img1,img2,r.refNum,
		if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
		WHERE  l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
		(SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount,
		 
		(SELECT if(count(1) =(l.entryLimit-l.entryBase),1,0) FROM lvb_order_lesson ol  WHERE ol.lessonId = l.lessonId) as isFull
		FROM
		lvb_lesson_series ls
		INNER join lvb_series_lesson_ref r on ls.seriesId=r.seriesFid
		INNER join lvb_lesson l  on r.lessonFid=l.lessonId
		left join lvb_lesson_ext le on l.lessonId=le.lessonFid
		where
		ls.seriesId = '137'
		and l.applyFids  like concat('%,',concat(1,',%'))
		and now() >= l.validBegin
		and now()  <=  l.validEnd
		group by l.lessonId\G

# Query 39: 0.03 QPS, 0.08x concurrency, ID 0x14919AA85204C7C9 at byte 13986548
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.02
# Time range: 2018-04-16 03:06:49 to 03:27:08
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      35
# Exec time      0     99s      2s      3s      3s      3s   212ms      3s
# Lock time      0    16ms   319us   512us   450us   490us    44us   445us
# Rows sent      0   1.78k       0     404   52.06  246.02  101.02    3.89
# Rows examine   0  31.87M 908.04k   1.07M 932.35k 961.27k  49.48k 871.90k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 234.17k   6.69k   6.69k   6.69k   6.63k       0   6.63k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_teacher_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_teacher_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_order_flow'\G
#    SHOW CREATE TABLE `yimi`.`erp_order_flow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
select eco.clientId clientFid,date('2018-04-16') beginDate,date('2018-04-22') endDate,'W' period,'STU_PAUSE' sItem,
        eco.studentId studentFid,ec.clientName studentName,
            eco.subjectId subjectFid,eco.subjectName,
        max(el.startTime) lastLessonTime from erp_contract_orders eco
        join erp_clients ec on ec.clientId=eco.clientId
        join mis_teacher_info mti on mti.userFid=eco.teacherId
        left join (
        select eof.orderFid,eof.orderStatusFid from erp_order_flow eof
        join (select max(flowId) flowId from erp_order_flow where orderStatusFid>0 and date(createdOn)  <=  '2018-04-22' GROUP BY orderFid) tmp on tmp.flowId=eof.flowId
        ) eof on eco.contractId=eof.orderFid
        left join (select contractId,max(startTime) startTime,sum(courseHours) overHours from erp_lessons where lessonStatus=1 and contractId>0 and startTime <= '2018-04-22' GROUP BY contractId) el
        on el.contractId=eco.contractId
        where
        eco.studentId not in(select userId from user_test where accType='STU') and mti.isMaturity=1 and mti.userFid in(103120,103150,103434,103948,104334,104915,105164,105260,105616,105653,105743,105757,105857,105874,106087,107654,107683,107963,108447,108453/*... omitted 548 items ...*/)
         
            and eco.subjectId=3
         
        and (eof.orderStatusFid=6 or (el.startTime is not null and el.overHours!=eco.realLessonCount and date_add(el.startTime,INTERVAL 28 DAY) <= '2018-04-22'))
        GROUP BY eco.clientId\G

# Query 43: 0.00 QPS, 0.00x concurrency, ID 0xED82BEFCE140F1FC at byte 5566908
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.09
# Time range: 2018-04-15 09:27:04 to 14:26:21
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      27
# Exec time      0     89s      2s      5s      3s      4s   547ms      3s
# Lock time      0     7ms    40us   367us   256us   348us    92us   287us
# Rows sent      0      27       1       1       1       1       0       1
# Rows examine   0  45.34M   1.68M   1.68M   1.68M   1.61M       0   1.61M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  53.24k   1.97k   1.97k   1.97k   1.97k       0   1.97k
# String:
# Databases    yimi
# Hosts        10.81.244.11 (9/33%), 10.28.143.117 (5/18%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'server_trail_and_voice'\G
#    SHOW CREATE TABLE `yimi`.`server_trail_and_voice`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,
        l.teacherId,
        l.lessonType,
        l.courseHours,
        date_format(l.startTime,'%Y-%m-%d %H:%i') AS startTime,
        date_format(l.endTime,'%Y-%m-%d %H:%i') AS endTime,
        (case c.clientName when '' then u.realName else c.clientName end) studentName,
        s.subjectName,
        g.gradeName,
        l.lessonStatus,
        timestampdiff(second,now(),l.startTime) remaining,
        timestampdiff(second,l.startTime,l.endTime) lessonSecondCount,
        cast(pre.configValue as signed)*60 beforeSecond,
        cast(aft.configValue as signed)*60 afterSecond,
        if(exists(select 1
        from server_trail_and_voice where status=1 and lessonID=l.lessonId),1,0)
        hasRecord,
        if(exists(select 1 from
        erp_lesson_docs where parentId=0 and docType=1 and
        lessonId=l.lessonId),1,0) hasDoc,
        "" AS title,
        "" AS keywords,
        case l.studentAppraiseType when 0 then '未评价' when 1 then '好评' when 2 then '中评' when 3 then '差评' end
        studentAppraiseType,studentAppraises
        FROM
        erp_lessons l
        LEFT JOIN erp_clients c ON c.studentId = l.studentId
        INNER JOIN t_user_info u on u.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON s.subjectId = l.subjectId
        INNER JOIN erp_conf_student_grades g ON g.gradeId = l.gradeId
        INNER JOIN www_config pre on pre.configId=1
        INNER JOIN www_config aft on aft.configId=2
        WHERE l.lessonStatus in(0,1)
         
            and (l.clientId='924260'
            or c.clientName='924260'
            or l.lessonId='924260'
            or u.realname='924260'
            )
         
         
         
         
         
            AND ((l.startTime > date(now()) and l.lessonStatus=0) or l.lessonStatus=1)
         
        ORDER BY l.lessonStatus,CASE WHEN l.lessonStatus in(0) THEN
        l.startTime END,CASE WHEN l.lessonStatus in(1) THEN
        l.startTime END desc
        limit 0, 10\G

# Query 45: 0.00 QPS, 0.00x concurrency, ID 0x53E68A2F4F0BCA83 at byte 6010409
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.27
# Time range: 2018-04-15 09:00:04 to 23:30:02
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      30
# Exec time      0     85s      2s      7s      3s      3s   870ms      3s
# Lock time      0   156ms    87us    50ms     5ms    48ms    14ms   144us
# Rows sent      0      30       1       1       1       1       0       1
# Rows examine   0  11.10M 376.83k 379.92k 378.80k 362.29k       0 362.29k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  20.98k     716     716     716     716       0     716
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_follow'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_follow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_follow_status'\G
#    SHOW CREATE TABLE `yimi`.`erp_follow_status`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
			   ifnull(sum(if(ec.flag in('A1','A2'),1,0)),0) AClientNum,
			   ifnull(sum(if(ec.flag='B',1,0)),0) BClientNum,
			   count(0) totalNum, date_format(now(),'%H:%i') now,
				ifnull( sum(if(ec.flag in('A1','A2') and ecf.clientFid is null,1,0)),0) AClientNoFollowNum,
				ifnull(sum(if(ec.flag = 'B' and ecf.clientFid is null,1,0)),0) BClientNoFollowNum,
			   ifnull(sum(if(ecf.clientFid is null,1,0)),0) clientNoFollowNum from erp_clients ec
			left join (
						  SELECT clientFid
							  FROM erp_client_follow ecf
								where ecf.clientFid not in(select statusId from erp_follow_status where type=',SYS,')
							  GROUP BY clientFid
					  ) ecf on ecf.clientFid=ec.clientId
		where ec.clientSea='T'\G

# Query 46: 0.00 QPS, 0.00x concurrency, ID 0xF928383DFAECA667 at byte 13022383
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.38
# Time range: 2018-04-15 06:02:16 to 2018-04-16 00:05:12
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      28
# Exec time      0     85s      2s      7s      3s      4s      1s      3s
# Lock time      0     5ms    36us   329us   177us   273us    80us   214us
# Rows sent      0     751      16      47   26.82   28.75    5.43   24.84
# Rows examine   0 115.18M 124.84k   8.77M   4.11M   8.43M   3.68M   5.99M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  34.32k   1.23k   1.23k   1.23k   1.23k       0   1.23k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_series'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_series`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_series_lesson_ref'\G
#    SHOW CREATE TABLE `yimi`.`lvb_series_lesson_ref`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
		l.lessonId,lessonName,playBegin,playEnd,l.orginalPrice,l.currentPrice,entryLimit,img1,img2,r.refNum,
		if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
		WHERE  l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
		(SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount,
		 
			(SELECT IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=149669 AND o.orderType='L' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,
			IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=149669 AND o.orderType='S' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,0))) isPaid,
		 
		(SELECT if(count(1) =(l.entryLimit-l.entryBase),1,0) FROM lvb_order_lesson ol  WHERE ol.lessonId = l.lessonId) as isFull
		FROM
		lvb_lesson_series ls
		INNER join lvb_series_lesson_ref r on ls.seriesId=r.seriesFid
		INNER join lvb_lesson l  on r.lessonFid=l.lessonId
		left join lvb_lesson_ext le on l.lessonId=le.lessonFid
		where
		ls.seriesId = '136'
		and l.applyFids  like concat('%,',concat(1,',%'))
		and now() >= l.validBegin
		group by l.lessonId\G

# Query 47: 0.00 QPS, 0.00x concurrency, ID 0xA605B4FF51F45E6F at byte 5871571
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.06
# Time range: 2018-04-15 09:27:07 to 14:26:25
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      27
# Exec time      0     82s      2s      4s      3s      4s   412ms      3s
# Lock time      0     4ms    32us   735us   162us   185us   120us   159us
# Rows sent      0      27       1       1       1       1       0       1
# Rows examine   0  45.34M   1.68M   1.68M   1.68M   1.61M       0   1.61M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  20.17k     765     765     765     765       0     765
# String:
# Databases    yimi
# Hosts        10.81.244.11 (9/33%), 10.28.143.117 (5/18%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        COUNT(1)
        FROM
        erp_lessons l
        LEFT JOIN erp_clients c ON c.studentId = l.studentId
        INNER JOIN t_user_info u on u.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON s.subjectId = l.subjectId
        INNER JOIN erp_conf_student_grades g ON g.gradeId = l.gradeId
        INNER JOIN www_config pre on pre.configId=1
        INNER JOIN www_config aft on aft.configId=2
        WHERE l.lessonStatus in(0,1)
         
            and (l.clientId='924260'
            or c.clientName='924260'
            or l.lessonId='924260'
            or u.realname='924260'
            )
         
         
         
         
         
            AND ((l.startTime > date(now()) and l.lessonStatus=0) or l.lessonStatus=1)\G

# Query 48: 0.00 QPS, 0.00x concurrency, ID 0xB66AF273D4CC2576 at byte 1789416
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.22
# Time range: 2018-04-15 09:00:04 to 20:46:05
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      30
# Exec time      0     81s      2s      5s      3s      4s   772ms      2s
# Lock time      0    41ms    86us    37ms     1ms   167us     6ms   125us
# Rows sent      0      73       1      10    2.43    9.83    2.94    0.99
# Rows examine   0  25.25M 861.11k 862.26k 861.73k 830.38k       0 830.38k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  16.83k     574     583  574.60  563.87       0  563.87
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
# EXPLAIN /*!50100 PARTITIONS*/
select l.lessonId,if(contractId>0,'订单课','试听课')
		lessonType,concat(DATE_FORMAT(l.startTime, '%Y-%m-%d %k:%i'),'-',DATE_FORMAT(l.endTime, '%k:%i')) lessonTime
		,tu.userRealName teacherName,c.clientName studentName, l.lessonStatus
		from erp_lessons l
		join mis_user_info tu on tu.userId=l.teacherId
		join erp_clients c on c.clientId=l.clientId
		where
		tu.userId=l.teacherId
		and c.clientId=l.clientId
		and date(l.startTime) <= date(now())
		and (l.lessonId='928049' or c.clientName='928049' or tu.userRealName='928049')
		order by l.startTime desc limit 10\G

# Query 49: 0.00 QPS, 0.00x concurrency, ID 0x50E7215F3276D4D0 at byte 2858675
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.46
# Time range: 2018-04-15 08:11:29 to 23:35:26
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      16
# Exec time      0     73s      2s      7s      5s      6s      1s      5s
# Lock time      0     2ms    30us   233us   118us   214us    70us   138us
# Rows sent      0   2.57k     102     243  164.31  234.30   47.12  136.99
# Rows examine   0 257.08M  10.01M  23.79M  16.07M  23.50M   4.87M  13.74M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  18.62k   1.16k   1.16k   1.16k   1.16k       0   1.16k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,lessonName,playBegin,playEnd,orginalPrice,currentPrice,entryLimit,img1,img2,
        if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
        WHERE l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
        (SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount
        FROM
        lvb_lesson l left join lvb_lesson_ext le on l.lessonId = le.lessonFid
        where
        (
          
             
              
                1=1
             
          
        )
        and
        (
          
              
                termIds like concat (concat('%','230'),'%')
             
             
          
        )
        and
        (
          
             
             
             
              
                1=1
             
          
        )
        and
        (
          
             
             
              
                1=1
             
          
        )
        and l.applyFids  like concat('%',concat(1,'%'))
        and now() >= l.validBegin
        and now()  <=  l.validEnd
        group by l.lessonId\G

# Query 51: 0.00 QPS, 0.00x concurrency, ID 0xF5446E0AC6AB1913 at byte 3374753
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.19
# Time range: 2018-04-15 07:17:29 to 21:20:11
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      26
# Exec time      0     71s      2s      5s      3s      4s   728ms      2s
# Lock time      0     2ms    58us    87us    69us    76us     7us    69us
# Rows sent      0   1.13k      24      69   44.35   65.89   14.54   40.45
# Rows examine   0 222.94M   4.68M  13.32M   8.57M  13.08M   2.95M   7.65M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  23.26k     916     916     916     916       0     916
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
				l.lessonId,le.lessonFid,l.lessonName,l.playBegin,l.playEnd,l.orginalPrice,l.currentPrice,l.entryLimit,le.img1,le.img2,o.paidOn,
				 (SELECT if(count(1) = (l.entryLimit-l.entryBase),1,0) FROM lvb_order_lesson ol  WHERE ol.lessonId = l.lessonId) as isFull,
			if(now() <= l.playBegin ,0,if(l.streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
			WHERE l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
				(SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase  as paycount
			FROM
			lvb_lesson l
			    LEFT JOIN lvb_lesson_ext le on l.lessonId = le.lessonFid
				INNER JOIN lvb_order_lesson s on s.lessonId=l.lessonId
				INNER JOIN lvb_order o on o.orderid = s.orderFid
			WHERE
				o.studentFid = 190566 and o.isPaid=1
				and l.applyFids  like concat('%,',concat(1,',%'))
				and now() >= l.validBegin
            group by l.lessonId\G

# Query 54: 0.00 QPS, 0.00x concurrency, ID 0x4B83C48FBD8F9C61 at byte 11436183
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.10
# Time range: 2018-04-15 09:42:47 to 21:40:49
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      21
# Exec time      0     56s      2s      4s      3s      3s   508ms      3s
# Lock time      0     4ms   153us   249us   196us   224us    26us   194us
# Rows sent      0      21       1       1       1       1       0       1
# Rows examine   0  21.77M   1.03M   1.04M   1.04M   1.03M   1.87k   1.03M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  26.62k   1.27k   1.27k   1.27k   1.27k       0   1.27k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
        count(distinct
        clientFid) finishClientCount from erp_contract co
        inner join
        (select
        o.contractFid,max(startTime)
        startTime,sum(courseHours) courseHours
        from erp_contract_orders o
        ,(select contractId,max(startTime)
        startTime,sum(courseHours)
        courseHours from
        erp_lessons
        where
        lessonStatus in(1,3,4) group by contractId) l
        where o.contractId=l.contractId
        group by o.contractFid) oo
        on
        co.contractId=oo.contractFid and co.contractFlag='N'
        where
        date(startTime) between '2018-04-02' and
        '2018-04-29'
        and co.totalLessonCount=courseHours
        and studentFid not in(select userId
        from user_test where accType='STU')
        and co.clientFid not in(select clientId from erp_contract coo,erp_contract_orders
        o
        left join (select contractId,sum(courseHours) courseHours
        from erp_lessons
        where contractId>0 and lessonStatus in(1,3,4) and startTime < date_add('2018-04-29',interval
        1 day) group by contractId) l on o.contractId=l.contractId
        where
        o.contractFid=coo.contractId
        and coo.payTime < '2018-04-02'
        and ifnull(l.courseHours,0)!=realLessonCount)\G

# Query 59: 0.00 QPS, 0.00x concurrency, ID 0x4E33A4D16C9051F7 at byte 2389095
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.19
# Time range: 2018-04-15 09:42:53 to 21:33:51
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      18
# Exec time      0     45s      2s      5s      3s      3s   685ms      2s
# Lock time      0     3ms   128us   227us   167us   204us    32us   176us
# Rows sent      0      18       1       1       1       1       0       1
# Rows examine   0  22.13M   1.22M   1.23M   1.23M   1.20M       0   1.20M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  19.46k   1.08k   1.08k   1.08k   1.08k       0   1.08k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_order_flow'\G
#    SHOW CREATE TABLE `yimi`.`erp_order_flow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
select count(distinct clientId) pauseStudentCount from
        erp_contract_orders o,(
        select
        ff.orderFid,orderStatusFid from
        erp_order_flow ff ,(select orderFid,
        max(createdOn) createdOn from
        erp_order_flow
        where createdOn < date_add('2018-04-15',interval
        1 day) and orderStatusFid>0 group by orderFid) fff where ff.createdOn=fff.createdOn and
        ff.orderFid=fff.orderFid) f
        where o.contractId=f.orderFid and
        f.orderStatusFid in(6)
        and studentId
        not
        in(select userId from user_test)
        and clientId not
        in(select clientId
        from
        erp_contract_orders o,(
        select
        ff.orderFid,orderStatusFid from
        erp_order_flow ff ,(select orderFid,
        max(createdOn) createdOn from
        erp_order_flow
        where createdOn < date_add('2018-04-15',interval
        1 day) and orderStatusFid>0 group by orderFid) fff where ff.createdOn=fff.createdOn and
        ff.orderFid=fff.orderFid) f
        where o.contractId=f.orderFid and
        f.orderStatusFid in(1,2))\G

# Query 63: 0.00 QPS, 0.00x concurrency, ID 0x398D07B3BB5A793E at byte 8872097
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.05
# Time range: 2018-04-15 11:01:56 to 22:54:26
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      16
# Exec time      0     38s      2s      3s      2s      3s   338ms      2s
# Lock time      0      1s    46us      1s    72ms    76us   265ms    54us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0  13.18M 842.50k 843.92k 843.20k 830.38k       0 830.38k
# Rows affecte   0      74       0      44    4.62   14.52   10.73       0
# Query size     0   2.42k     155     155     155     155       0     155
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_teacher_schedule'\G
#    SHOW CREATE TABLE `yimi`.`erp_teacher_schedule`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
delete from erp_teacher_schedule WHERE isFree = 1 AND lessonId IN (SELECT l.lessonId FROM erp_lessons l WHERE l.contractId = 15386 AND l.lessonStatus = 0 )\G
# Converted for EXPLAIN
# EXPLAIN /*!50100 PARTITIONS*/
select * from  erp_teacher_schedule WHERE isFree = 1 AND lessonId IN (SELECT l.lessonId FROM erp_lessons l WHERE l.contractId = 15386 AND l.lessonStatus = 0 )\G

# Query 70: 0.00 QPS, 0.00x concurrency, ID 0x7146E02EEE59AD24 at byte 8278838
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.67
# Time range: 2018-04-15 09:00:06 to 20:23:09
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      10
# Exec time      0     29s      2s      7s      3s      3s      1s      2s
# Lock time      0     2ms   140us   335us   206us   236us    54us   194us
# Rows sent      0      10       1       1       1       1       0       1
# Rows examine   0   4.67M 469.68k 545.15k 478.30k 462.39k  21.87k 462.39k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  15.57k   1.10k   5.68k   1.56k   1.09k   1.31k   1.09k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_learn_report'\G
#    SHOW CREATE TABLE `yimi`.`erp_learn_report`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
			count(1)
		FROM erp_contract_orders o
		JOIN erp_contract c ON
		o.`contractFid` = c.`contractId`
		LEFT JOIN erp_clients ec ON
		ec.`clientId` = o.`clientId`
		LEFT JOIN mis_user_info u ON u.`userId` =
		ec.`chargeFid`
		LEFT JOIN mis_user_info tu2 ON tu2.userId =
		ec.consultantId
		left join (
                  SELECT DATE_FORMAT(max(l.startTime), '%Y-%m-%d %H:%i') startTime,IFNULL(sum(courseHours),0) courseHours,
                    l.contractId
                 FROM erp_lessons l
                 WHERE l.lessonStatus in (1,3,4) AND l.contractId>0
                 GROUP BY l.contractId
              ) maxel on maxel.contractId=o.contractId
        LEFT JOIN (
            SELECT DISTINCT r.orderFid
            FROM erp_learn_report r
         )elr on elr.orderFid=o.contractId
		 WHERE o.orderStatus>0
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			and 2=2
				
				
					and ec.chargeFid in (
						
							900001430
						
					)
				
			
			
			
			
			
			
				and not exists (select 1 from user_test ut where ut.userId = ec.studentId and ut.accType = 'STU')\G

# Query 71: 0.00 QPS, 0.00x concurrency, ID 0xD8D08DA009DE195E at byte 8239297
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.92
# Time range: 2018-04-15 09:00:04 to 19:09:40
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      10
# Exec time      0     29s      2s      8s      3s      3s      2s      2s
# Lock time      0     4ms   262us   415us   350us   384us    40us   348us
# Rows sent      0      94       4      10    9.40    9.83    1.78    9.83
# Rows examine   0   4.60M 469.70k 474.51k 471.29k 462.39k       0 462.39k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  26.46k   2.65k   2.65k   2.65k   2.65k       0   2.65k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_order_status'\G
#    SHOW CREATE TABLE `yimi`.`erp_order_status`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_learn_report'\G
#    SHOW CREATE TABLE `yimi`.`erp_learn_report`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
         
            CASE WHEN (SELECT COUNT(*) FROM mis_work_order orders
                       WHERE orders.orderFid=o.contractId
                       AND orders.configType='WARN'
                       AND orders.status=1)>0
            THEN 1
            ELSE 0
            END  isOrderWarn,
         
         
		ec.consultantId,
		ec.cooperateConsultantId,
		ec.createdByFid,
		o.`contractId`,
		o.`clientId`,
		c.contractType,
		o.`orderProp`,
		o.`teachProp`,
		o.`orderStatus`,
		o.`realLessonCount`,
		o.`teacherId`,
		o.`teacherName`,
		o.`subjectId`,
		o.`gradeId`,
		o.`createTime`,
		c.`contractNo`,
		u.`userRealName` as chargeName,
		ec.`clientName` realName,
		ec.`clientName` parentRealName,
		ec.`chargeFid`,
		ec.`phoneNo` AS
		parentTel,
		ec.`phoneNo` AS studentTel,
		s.`statusDesc`,
		u.`userOrgFid`,
		u.`userId`,
		tu2.`userOrgFid` as ccUserOrgFid,
		tu2.`userId` as ccUserId,
		CASE
		WHEN
		o.`orderProp` = 1
		THEN '新'
		WHEN o.`orderProp` = 2
		THEN '续'
		WHEN o.`orderProp` = 3
		THEN '扩'
		WHEN o.`orderProp` = 4
		THEN '赠'
		ELSE ''
		END AS orderPropDesc,
		CASE
		WHEN
		o.`teachProp` = 1
		THEN '新签'
		WHEN o.`teachProp` = 2
		THEN '续科'
		WHEN o.`teachProp` = 3
		THEN '赠送'
		ELSE ''
		END AS
		teachPropDesc,
		maxel.startTime AS lessonStartTime,
        (o.`realLessonCount` - ifNUll(maxel.courseHours,0)) AS remainHours,
        IF(elr.orderFid is not null, 1, 0)              hasReport,
		ec.studentId
		FROM erp_contract_orders o
		JOIN erp_contract c ON
		o.`contractFid` = c.`contractId`
		LEFT JOIN erp_clients ec ON
		ec.`clientId` = o.`clientId`
		LEFT JOIN mis_user_info u ON u.`userId` =
		ec.`chargeFid`
		LEFT JOIN mis_user_info tu2 ON tu2.userId =
		ec.consultantId
		LEFT JOIN erp_order_status s ON s.`statusId` =
		o.`orderStatus`
		left join (
                  SELECT DATE_FORMAT(max(l.startTime), '%Y-%m-%d %H:%i') startTime,IFNULL(sum(courseHours),0) courseHours,
                    l.contractId
                 FROM erp_lessons l
                 WHERE l.lessonStatus in (1,3,4) AND l.contractId>0
                 GROUP BY l.contractId
              ) maxel on maxel.contractId=o.contractId
        LEFT JOIN (
            SELECT DISTINCT r.orderFid
                 FROM erp_learn_report r
         )elr on elr.orderFid=o.contractId
		 WHERE o.orderStatus>0
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			and 2=2
				
				
					and ec.chargeFid in (
						
							900001430
						
					)
				
			
			
			
			
			
			
				and not exists (select 1 from user_test ut where ut.userId = ec.studentId and ut.accType = 'STU') 
			 
					ORDER BY o.contractId DESC
				 
		LIMIT 0, 10\G

# Query 82: 0.00 QPS, 0.00x concurrency, ID 0x6BC7D5D7388C71CF at byte 5999404
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.01
# Time range: 2018-04-15 09:00:02 to 2018-04-16 03:00:01
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      10
# Exec time      0     22s      2s      3s      2s      2s   172ms      2s
# Lock time      0   685us    44us   110us    68us    93us    21us    60us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0   5.85M 597.69k 600.79k 599.35k 590.13k       0 590.13k
# Rows affecte  84 948.47k  94.51k  95.17k  94.85k  92.42k       0  92.42k
# Query size     0   1.71k     175     175     175     175       0     175
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'client_data_pool'\G
#    SHOW CREATE TABLE `yimi`.`client_data_pool`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel`\G
update client_data_pool set flag='A1'
        where type='N' and exists(select 1 from erp_channel where erp_channel.id=client_data_pool.secondChannel and erp_channel.flag='A')\G
# Converted for EXPLAIN
# EXPLAIN /*!50100 PARTITIONS*/
select  flag='A1' from client_data_pool where  type='N' and exists(select 1 from erp_channel where erp_channel.id=client_data_pool.secondChannel and erp_channel.flag='A')\G
