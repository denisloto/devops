
# 2.6s user time, 30ms system time, 29.94M rss, 223.99M vsz
# Current date: Wed Apr 18 04:01:04 2018
# Hostname: aliyun-hz-hd1-E-bgp-4
# Files: /data/script/mysql-slow-digest/mysql-slow--2018-04-18--040101.log
# Overall: 7.03k total, 166 unique, 0.08 QPS, 0.47x concurrency __________
# Time range: 2018-04-17 04:01:49 to 2018-04-18 04:00:37
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time         40316s      2s    129s      6s     23s     10s      3s
# Lock time            54s    10us     17s     8ms   301us   347ms   103us
# Rows sent        148.52M       0  24.40M  21.62k  918.49 536.23k    0.99
# Rows examine      58.84G       0 277.33M   8.57M  92.12M  24.26M   1.95M
# Rows affecte     359.52k       0  96.23k   52.35       0   1.58k       0
# Query size         6.11M      25  10.40k  910.51   2.89k  836.09  463.90

# Profile
# Rank Query ID           Response time   Calls R/Call  V/M   Item
# ==== ================== =============== ===== ======= ===== ============
#    1 0x7CB8293C8D8EFAA6 6359.2923 15.8%   228 27.8916  1.43 SELECT lvb_lesson_video lvb_order_lesson lvb_lesson lvb_lesson_ext
#    2 0x597AE1A5E18B09B5 5586.6701 13.9%  1651  3.3838  0.08 SELECT erp_lesson_book_files mis_user_info erp_lesson_docs
#    3 0x0F3305545EA49428 5531.7371 13.7%  1554  3.5597  3.58 SELECT erp_lesson_book_files mis_user_info erp_lesson_docs
#    4 0x4EC8A0DB8530E4CC 4116.7307 10.2%   143 28.7883  1.89 SELECT lvb_lesson_video lvb_order_lesson lvb_lesson lvb_lesson_ext
#    5 0xC8F5044C7E2EADE7 3703.7488  9.2%   106 34.9410 49.10 SELECT erp_lessons erp_conf_course_subjects wx_service_msg
#    6 0x802478FD2EC71668 1959.2692  4.9%   145 13.5122  0.72 INSERT SELECT client_sea erp_clients erp_client_follow erp_follow_status callcenter_outer_log
#    7 0x874AC800CFB0B05C 1796.4491  4.5%   720  2.4951  0.08 SELECT app_notification
#    8 0x5FDDE1EC4813C54F 1128.9882  2.8%    75 15.0532  4.98 SELECT erp_lesson_application erp_lessons erp_conf_course_subjects erp_conf_student_grades wx_service_msg
#    9 0x0924E63A71759FDC 1028.2213  2.6%   134  7.6733  0.18 INSERT SELECT client_sea erp_clients erp_client_follow erp_follow_status callcenter_outer_log
#   10 0x9802F83F3C5469D4  672.2205  1.7%   253  2.6570  0.10 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects mis_work_order
#   11 0x5188E74C090BF609  635.8550  1.6%   191  3.3291  0.44 SELECT lvb_lesson_video lvb_order_lesson lvb_order lvb_order_lesson lvb_order lvb_order_lesson lvb_lesson_series lvb_series_lesson_ref lvb_lesson lvb_lesson_ext
#   12 0xB1119848086E47DA  457.2262  1.1%     8 57.1533  1.30 SELECT user_ping_test t_user_info erp_clients mis_user_info
#   13 0xC275A476B01092D4  392.2715  1.0%    13 30.1747  1.85 SELECT lvb_lesson_video lvb_order_lesson lvb_lesson lvb_lesson_ext
#   14 0xED7DE5AA05230157  300.1754  0.7%   119  2.5225  0.11 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_contract mis_work_order
#   15 0xF83D3854B6294F5F  289.7862  0.7%   116  2.4982  0.10 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_contract mis_work_order
#   16 0x807CEFFF6917F85F  275.6955  0.7%   107  2.5766  0.04 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects mis_work_order
#   17 0x4B83C48FBD8F9C61  255.1458  0.6%   100  2.5515  0.05 SELECT erp_contract erp_contract_orders erp_lessons user_test erp_contract erp_contract_orders erp_lessons
#   18 0xD824344EA5B63403  252.6167  0.6%    99  2.5517  0.07 SELECT UNION erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_contract_orders erp_contract erp_lessons erp_contract_orders erp_lessons erp_lesson_plan erp_contract_orders teach_lesson_plan mis_work_order
#   19 0xD9CFEA53507AC560  247.6114  0.6%    81  3.0569  0.09 SELECT mis_user_info erp_clients mis_user_info erp_lessons t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   20 0x4A078E636F95F53C  240.4953  0.6%    94  2.5585  0.08 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_contract mis_work_order
#   21 0x08FE275627AABB49  215.9701  0.5%    96  2.2497  0.02 SELECT erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_lessons mis_work_order erp_student_teach_special
#   22 0x2C9AB886E8ACE1D9  202.1429  0.5%    50  4.0429  0.65 SELECT UNION erp_lesson_application erp_conf_student_grades erp_conf_course_subjects mis_user_info server_trail_and_voice erp_lesson_docs erp_teacher_schedule erp_lessons erp_clients lvb_lesson_video lvb_lesson erp_teacher_schedule
#   23 0x26476FF6C3C0CA5D  177.6271  0.4%    71  2.5018  0.07 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_contract mis_work_order
#   24 0xAF7087AE5BCF7A6F  171.4011  0.4%    64  2.6781  0.09 SELECT erp_lessons erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects mis_user_info lesson_comment erp_client_cr
#   26 0x4E33A4D16C9051F7  164.0698  0.4%    67  2.4488  0.04 SELECT erp_contract_orders erp_order_flow user_test erp_contract_orders erp_order_flow
#   32 0x8DF7748590F106FA  125.1161  0.3%    53  2.3607  0.07 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects mis_work_order
#   33 0x9A4B12447FDDD372  123.2461  0.3%    53  2.3254  0.02 SELECT erp_contract_orders erp_order_flow user_test
#   34 0x24A7383D45436873  110.3893  0.3%    15  7.3593  0.34 SELECT mis_user_info erp_clients mis_user_info erp_lessons t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   35 0x6FF7C208961C02F5  103.6982  0.3%    34  3.0499  0.13 SELECT erp_lessons erp_clients mis_user_info
#   36 0x50E7215F3276D4D0   99.1383  0.2%    21  4.7209  0.78 SELECT lvb_lesson_video lvb_order_lesson lvb_lesson lvb_lesson_ext
#   40 0x21B83224C5BD6EDA   81.1744  0.2%    14  5.7982  0.15 SELECT erp_clients mis_user_info erp_client_family t_user_info
#   41 0xF5446E0AC6AB1913   79.9439  0.2%    25  3.1978  0.53 SELECT lvb_order_lesson lvb_lesson_video lvb_order_lesson lvb_lesson lvb_lesson_ext lvb_order_lesson lvb_order
#   43 0x60E69C3EBFFC9431   78.9051  0.2%    34  2.3207  0.02 SELECT server_trail_and_voice erp_lesson_docs mis_teacher_info erp_lessons t_user_info erp_clients erp_conf_course_subjects erp_conf_student_grades www_config
#   46 0x2F1A313814D4967F   65.8801  0.2%    31  2.1252  0.00 SELECT erp_contract_orders erp_order_flow erp_lessons
#   47 0x53E68A2F4F0BCA83   62.0314  0.2%    26  2.3858  0.03 SELECT erp_clients erp_client_follow erp_follow_status
#   50 0xF5FEACC32429CC03   55.3324  0.1%    22  2.5151  0.48 SELECT server_trail_and_voice erp_lesson_docs mis_user_info erp_clients mis_user_info erp_lessons t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   51 0xC4EDC64AF48E3254   53.1803  0.1%    26  2.0454  0.00 SELECT erp_contract_orders erp_order_flow erp_lessons
#   55 0xA84D5981B9D05DD8   50.2387  0.1%    13  3.8645  0.19 SELECT free_lesson erp_channel
#   57 0x1937B21D3A757C2D   44.3492  0.1%    16  2.7718  0.11 SELECT erp_channel_cate erp_channel erp_channel_cate erp_client_channel erp_clients erp_client_event user_test
#   59 0x4E36042C05849EC9   38.5359  0.1%    17  2.2668  0.04 SELECT lvb_lesson_video lvb_order_lesson lvb_lesson_series lvb_series_lesson_ref lvb_lesson lvb_lesson_ext
#   60 0xF928383DFAECA667   38.3924  0.1%    14  2.7423  0.31 SELECT lvb_lesson_video lvb_order_lesson lvb_order lvb_order_lesson lvb_order lvb_order_lesson lvb_lesson_series lvb_series_lesson_ref lvb_lesson lvb_lesson_ext
#   61 0xB66AF273D4CC2576   37.8575  0.1%    17  2.2269  0.01 SELECT erp_lessons mis_user_info erp_clients
#   63 0x5B97519418BA5B13   36.0480  0.1%    10  3.6048  0.19 SELECT server_trail_and_voice erp_lesson_docs mis_user_info erp_clients mis_user_info erp_lessons t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   68 0x7A6044C4585A6A8C   28.2352  0.1%    11  2.5668  0.05 SELECT lvb_lesson_video lvb_order_lesson lvb_order lvb_order_lesson lvb_order lvb_order_lesson lvb_series_lesson_ref lvb_lesson_series lvb_lesson lvb_lesson_ext lvb_series_lesson_ref
#   72 0x7096D48A29F00CFF   25.4984  0.1%    12  2.1249  0.00 SELECT mis_teacher_info erp_lessons t_user_info erp_clients erp_conf_course_subjects erp_conf_student_grades www_config
#   75 0x38D31DE66BF3A521   22.1671  0.1%    10  2.2167  0.01 SELECT erp_lessons erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects mis_user_info lesson_comment erp_client_cr
# MISC 0xMISC             2795.3566  6.9%   274 10.2020   0.0 <120 ITEMS>

# Query 1: 0.00 QPS, 0.10x concurrency, ID 0x7CB8293C8D8EFAA6 at byte 5332576
# This item is included in the report because it matches --limit.
# Scores: V/M = 1.43
# Time range: 2018-04-17 06:38:04 to 2018-04-18 00:19:14
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          3     228
# Exec time     15   6359s     21s     44s     28s     39s      6s     25s
# Lock time      0    11ms    34us    68us    49us    60us     6us    47us
# Rows sent      0 210.18k     943     945  943.98  918.49       0  918.49
# Rows examine  35  20.77G  92.98M  93.52M  93.27M  92.12M       0  92.12M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     4 256.50k   1.12k   1.12k   1.12k   1.12k       0   1.12k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,lessonName,playBegin,playEnd,orginalPrice,currentPrice,entryLimit,img1,img2,
        if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
        WHERE l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
        (SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount
        FROM
        lvb_lesson l left join lvb_lesson_ext le on l.lessonId = le.lessonFid
        where
        (
          
             
              
                1=1
             
          
        )
        and
        (
          
             
              
                1=1
             
          
        )
        and
        (
          
             
             
             
              
                1=1
             
          
        )
        and
        (
          
             
             
              
                1=1
             
          
        )
        and l.applyFids  like concat('%',concat(1,'%'))
        and now() >= l.validBegin
        and now()  <=  l.validEnd
        group by l.lessonId\G

# Query 2: 0.02 QPS, 0.08x concurrency, ID 0x597AE1A5E18B09B5 at byte 395652
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.08
# Time range: 2018-04-17 07:59:38 to 2018-04-18 03:26:29
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         23    1651
# Exec time     13   5587s      3s      5s      3s      4s   529ms      3s
# Lock time      0   142ms    19us     2ms    86us   152us    61us    89us
# Rows sent      0  18.15k       0      37   11.26   19.46    7.19    9.83
# Rows examine   5   3.24G   2.01M   2.01M   2.01M   1.95M       0   1.95M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size    12 774.59k     476     491  480.42  487.09    6.38  463.90
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        erpuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_book_files'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_book_files`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT b.*,mui.userRealName operatorName,
			
			t1.importCnt
			FROM
						erp_lesson_book_files b
			LEFT JOIN mis_user_info mui on mui.userId = b.operator	
			LEFT JOIN (
				SELECT t.fileId,COUNT(DISTINCT t.lessonId) importCnt
						FROM erp_lesson_docs t
						WHERE t.parentId = 0 AND t.fileId != 0
						GROUP BY t.fileId 
			) t1 ON t1.fileId=b.fileId
		 WHERE catalogCode like '%pzvupd/xuelzz/%' and parentId = 0 
		order by fileStatus desc,
		 
		createTime desc limit 0,20\G

# Query 3: 0.02 QPS, 0.08x concurrency, ID 0x0F3305545EA49428 at byte 390674
# This item is included in the report because it matches --limit.
# Scores: V/M = 3.58
# Time range: 2018-04-17 07:59:01 to 2018-04-18 03:26:26
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         22    1554
# Exec time     13   5532s      3s    111s      4s      4s      4s      3s
# Lock time      0   135ms    18us   644us    86us   152us    46us    93us
# Rows sent      0   1.52k       0       1    1.00    0.99    0.03    0.99
# Rows examine   5   3.04G   3.22k   2.01M   2.01M   1.95M  50.60k   1.95M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     7 498.32k     324     338  328.36  329.68       7  329.68
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        erpuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+  #
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_book_files'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_book_files`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT count(*) FROM erp_lesson_book_files b LEFT JOIN mis_user_info mui ON mui.userId = b.operator LEFT JOIN (SELECT t.fileId, COUNT(DISTINCT t.lessonId) importCnt FROM erp_lesson_docs t WHERE t.parentId = 0 AND t.fileId != 0 GROUP BY t.fileId) t1 ON t1.fileId = b.fileId WHERE catalogCode LIKE '%pzvupd/fuyvwx/%' AND parentId = 0\G

# Query 4: 0.00 QPS, 0.06x concurrency, ID 0x4EC8A0DB8530E4CC at byte 5385525
# This item is included in the report because it matches --limit.
# Scores: V/M = 1.89
# Time range: 2018-04-17 06:47:48 to 2018-04-18 00:34:37
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2     143
# Exec time     10   4117s     21s     44s     29s     42s      7s     25s
# Lock time      0    28ms    33us   409us   192us   366us   122us   236us
# Rows sent      0 131.82k     943     945  943.94  918.49       0  918.49
# Rows examine  22  13.03G  92.98M  93.50M  93.28M  92.12M       0  92.12M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     8 527.17k   3.69k   3.69k   3.69k   3.69k       0   3.69k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,lessonName,playBegin,playEnd,orginalPrice,currentPrice,entryLimit,img1,img2,
        if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
        WHERE l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
        (SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount
        FROM
        lvb_lesson l left join lvb_lesson_ext le on l.lessonId = le.lessonFid
        where
        (
          
              
                subjectIds like concat (concat('%','1'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','2'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','3'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','4'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','5'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','6'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','7'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','8'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','9'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','13'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','16'),'%')
             
             
          
        )
        and
        (
          
              
                termIds like concat (concat('%','130'),'%')
             
             
         
             or 
                termIds like concat (concat('%','140'),'%')
             
             
         
             or 
                termIds like concat (concat('%','150'),'%')
             
             
         
             or 
                termIds like concat (concat('%','160'),'%')
             
             
         
             or 
                termIds like concat (concat('%','170'),'%')
             
             
         
             or 
                termIds like concat (concat('%','210'),'%')
             
             
         
             or 
                termIds like concat (concat('%','220'),'%')
             
             
         
             or 
                termIds like concat (concat('%','230'),'%')
             
             
         
             or 
                termIds like concat (concat('%','240'),'%')
             
             
         
             or 
                termIds like concat (concat('%','310'),'%')
             
             
         
             or 
                termIds like concat (concat('%','320'),'%')
             
             
         
             or 
                termIds like concat (concat('%','330'),'%')
             
             
         
             or 
                termIds like concat (concat('%','410'),'%')
             
             
          
        )
        and
        (
          
             
             
             
              
                1=1
             
          
        )
        and
        (
          
             
             
              
                1=1
             
          
        )
        and l.applyFids  like concat('%',concat(1,'%'))
        and now() >= l.validBegin
        and now()  <=  l.validEnd
        group by l.lessonId\G

# Query 5: 0.00 QPS, 0.04x concurrency, ID 0xC8F5044C7E2EADE7 at byte 7792917
# This item is included in the report because it matches --limit.
# Scores: V/M = 49.10
# Time range: 2018-04-17 04:02:00 to 2018-04-18 04:00:15
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     106
# Exec time      9   3704s      2s    122s     35s    118s     41s     17s
# Lock time      0     5ms    23us   136us    48us    66us    16us    44us
# Rows sent      0  12.13k       4     670  117.16  400.73  151.81   42.48
# Rows examine  10   6.33G   2.43M 242.98M  61.12M 211.13M  75.69M  24.67M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1  73.18k     704     707  706.92  685.39       0  685.39
# String:
# Databases    yimi
# Hosts        10.81.244.11 (28/26%), 10.81.244.3 (24/22%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ##################################
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'wx_service_msg'\G
#    SHOW CREATE TABLE `yimi`.`wx_service_msg`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
			lesson_temp.startTime,
			lesson_temp.endTime,
			lesson_temp.lessonId,
			lesson_temp.teacherId,
			lesson_temp.studentId,
			eccs.subjectName
		from
			(select els.startTime,
					els.endTime,
					els.subjectId,
					els.teacherId,
					els.studentId,
					els.lessonId
			from erp_lessons els
			where els.lessonType=10 and els.lessonStatus=0 and els.startTime   >=   NOW()
			and els.startTime   <=   '2018-04-19 02:00:01.812000') as lesson_temp
		left join erp_conf_course_subjects eccs on eccs.subjectId=lesson_temp.subjectId
		left join wx_service_msg wsm on wsm.bizFid=lesson_temp.lessonId and wsm.bizType='LESSON'
		and wsm.bizTimeType='1D' and wsm.userType='STU'
		where wsm.tId is null\G

# Query 6: 0.00 QPS, 0.02x concurrency, ID 0x802478FD2EC71668 at byte 367149
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.72
# Time range: 2018-04-17 04:10:14 to 2018-04-18 04:00:11
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2     145
# Exec time      4   1959s      9s     31s     14s     19s      3s     13s
# Lock time      0    30ms   148us   299us   209us   260us    34us   194us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   1   1.13G   3.93M  10.00M   7.97M   9.76M   2.36M   8.86M
# Rows affecte  39 141.60k    1000    1000    1000    1000       0    1000
# Query size     3 212.12k   1.46k   1.46k   1.46k   1.46k       0   1.46k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ##########
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'client_sea'\G
#    SHOW CREATE TABLE `yimi`.`client_sea`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_follow'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_follow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_follow_status'\G
#    SHOW CREATE TABLE `yimi`.`erp_follow_status`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'callcenter_outer_log'\G
#    SHOW CREATE TABLE `yimi`.`callcenter_outer_log`\G
insert IGNORE client_sea(clientFid, clientSea, flag, clientType, viewTime, latestFollowTime)
        SELECT ec.clientId,ec.clientSea,ec.flag,ec.clientType ,ec.viewTime,ifnull(ecf.createdOn,now()) from erp_clients ec
        left join(
             
                    select max(id) id,clientFid,count(0) followNum,max(createdOn) createdOn from erp_client_follow
                        where followStatusFid in(select statusId from erp_follow_status where type like '%,CC,%') GROUP BY clientFid
             
        ) ecf
        on ecf.clientFid=ec.clientId
         WHERE ec.clientSea='P' and ec.clientType = 'C' and ec.viewTime<=now() and ec.flag is not null
            and not exists(select 1 from callcenter_outer_log where ec.clientId=callcenter_outer_log.clientFid and createdOn>date_add(now(),INTERVAL -120 MINUTE))
            and ec.phoneNo REGEXP '^[0]?[1][3456789][0-9]{9}$'
            and not exists(select 1 from callcenter_outer_log where ec.clientId=callcenter_outer_log.clientFid and createdOn>date_add(now(),INTERVAL -120 MINUTE))
            
             and date(ec.createdOnTime) >='2016-01-01'
             and date(ec.createdOnTime) <='2018-03-20'
            
            
            and ec.secondChannelFid not in(27001,21006,27006,21001,21002,39003,27008,27005,27004,21005,39001,39004,39002,21004,39010,39009,21003,39012,39005,39006/*... omitted 10 items ...*/) 
        ORDER BY ec.topTimes>0 desc,ec.viewTime asc
        LIMIT 1000\G

# Query 7: 0.01 QPS, 0.02x concurrency, ID 0x874AC800CFB0B05C at byte 3008384
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.08
# Time range: 2018-04-17 04:02:04 to 2018-04-18 04:00:03
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         10     720
# Exec time      4   1796s      2s      4s      2s      3s   451ms      2s
# Lock time      0    20ms    10us   114us    27us    63us    14us    23us
# Rows sent      0  56.94k       1     658   80.97  400.73  143.75   11.95
# Rows examine   2   1.19G   1.69M   1.69M   1.69M   1.69M       0   1.69M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     3 201.80k     287     287     287     287       0     287
# String:
# Databases    yimi
# Hosts        10.31.53.111 (146/20%), 10.81.244.3 (137/19%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'app_notification'\G
#    SHOW CREATE TABLE `yimi`.`app_notification`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT nId, bizType,userFid,relateId,displayType,title,msg,sound,goActivity,appSysInfo,appVersion,appDeviceInfo,isSend,sendTimes,thirdMsgId,isRead,status,createdOn,lastUpdatedOn,umengAppKey,appSource,userName
		FROM  app_notification
		WHERE isSend=0	AND sendTimes < 5 and NOW()<deadline\G

# Query 8: 0.00 QPS, 0.01x concurrency, ID 0x5FDDE1EC4813C54F at byte 3455547
# This item is included in the report because it matches --limit.
# Scores: V/M = 4.98
# Time range: 2018-04-17 05:00:23 to 2018-04-18 04:00:24
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1      75
# Exec time      2   1129s      2s     33s     15s     29s      9s     18s
# Lock time      0     5ms    26us   192us    65us    93us    25us    60us
# Rows sent      0   4.84k       8     108   66.15  102.22   34.56   88.31
# Rows examine   2   1.70G   3.05M  36.20M  23.20M  34.72M  12.25M  31.49M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  59.61k     810     814  813.87  793.42       0  793.42
# String:
# Databases    yimi
# Hosts        10.80.58.47 (18/24%), 10.28.143.117 (14/18%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ######################################
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_application'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_application`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'wx_service_msg'\G
#    SHOW CREATE TABLE `yimi`.`wx_service_msg`\G
# EXPLAIN /*!50100 PARTITIONS*/
select msg_temp.startTime,
		msg_temp.teacherId,
		msg_temp.studentId,
		msg_temp.endTime,
		msg_temp.applicationId,
		eccs.subjectName,
		ecsg.gradeName
		from 
			(select ela.applicationId,
			ela.subjectFid,
			els.startTime,
			els.endTime,
			els.teacherId,
			els.studentId,
			els.gradeId 
			from erp_lesson_application ela
			join erp_lessons els on ela.lessonId=els.lessonId
			where els.startTime   >=   NOW() and els.startTime   <=   '2018-04-18 16:00:01.558000') as msg_temp
		left join erp_conf_course_subjects eccs on eccs.subjectId=msg_temp.subjectFid
		left join erp_conf_student_grades ecsg on ecsg.gradeId=msg_temp.gradeId
		left join wx_service_msg wsm on wsm.bizFid=msg_temp.applicationId and wsm.bizType='APPLICATION' 
		and wsm.bizTimeType='1D' and wsm.userType='TEA'
		where wsm.tId is null\G

# Query 9: 0.00 QPS, 0.01x concurrency, ID 0x0924E63A71759FDC at byte 6555404
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.18
# Time range: 2018-04-17 04:10:22 to 2018-04-18 04:00:20
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     134
# Exec time      2   1028s      7s     12s      8s     10s      1s      7s
# Lock time      0    22ms   119us     2ms   167us   194us   118us   152us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0 486.59M   3.63M   3.64M   3.63M   3.50M       0   3.50M
# Rows affecte   0     894       0      35    6.67   22.53    6.67    4.96
# Query size     1 120.26k     919     919     919     919       0     919
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+  #####
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'client_sea'\G
#    SHOW CREATE TABLE `yimi`.`client_sea`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_follow'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_follow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_follow_status'\G
#    SHOW CREATE TABLE `yimi`.`erp_follow_status`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'callcenter_outer_log'\G
#    SHOW CREATE TABLE `yimi`.`callcenter_outer_log`\G
insert IGNORE client_sea(clientFid, clientSea, flag, clientType, viewTime, latestFollowTime)
        SELECT ec.clientId,ec.clientSea,ec.flag,ec.clientType ,ec.viewTime,ifnull(ecf.createdOn,now()) from erp_clients ec
        left join(select max(createdOn) createdOn,clientFid,count(0) followNum from erp_client_follow
            where followStatusFid in(select statusId from erp_follow_status where  type like '%,CC,%') GROUP BY clientFid
        )
         ecf
        on ecf.clientFid=ec.clientId
        where
            ec.clientSea='P' and ec.clientType in ('R','N') and ec.viewTime <= now() and ec.flag is not null
            and ec.phoneNo REGEXP '^[0]?[1][3456789][0-9]{9}$'
            and not exists(select 1 from callcenter_outer_log where ec.clientId=callcenter_outer_log.clientFid and createdOn>date_add(now(),INTERVAL -120 MINUTE))
        ORDER BY ec.topTimes>0 desc,ec.viewTime asc
        LIMIT 1000\G

# Query 10: 0.00 QPS, 0.01x concurrency, ID 0x9802F83F3C5469D4 at byte 7887776
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.10
# Time range: 2018-04-17 04:10:08 to 2018-04-18 04:00:07
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          3     253
# Exec time      1    672s      2s      5s      3s      4s   516ms      3s
# Lock time      0    55ms   151us   319us   215us   273us    35us   204us
# Rows sent      0      22       0       3    0.09    0.99    0.41       0
# Rows examine   0 535.52M   2.11M   2.12M   2.12M   2.05M       0   2.05M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     5 329.10k   1.30k   1.30k   1.30k   1.30k       0   1.30k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) > DATE(now())
		) t on l.clientId = t.clientId and l.startTime = t.startTime
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 22
		and co.contractProp = 1
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid)\G

# Query 11: 0.00 QPS, 0.01x concurrency, ID 0x5188E74C090BF609 at byte 5400903
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.44
# Time range: 2018-04-17 07:10:24 to 2018-04-18 00:55:09
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2     191
# Exec time      1    636s      2s      8s      3s      6s      1s      3s
# Lock time      0    18ms    66us   137us    92us   113us    14us    89us
# Rows sent      0   5.78k      13      50   31.01   49.17   10.74   26.08
# Rows examine   0  28.57M 120.74k 187.39k 153.18k 182.98k  19.92k 143.37k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     3 239.31k   1.25k   1.25k   1.25k   1.25k       0   1.25k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_series'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_series`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_series_lesson_ref'\G
#    SHOW CREATE TABLE `yimi`.`lvb_series_lesson_ref`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
		l.lessonId,lessonName,playBegin,playEnd,l.orginalPrice,l.currentPrice,entryLimit,img1,img2,r.refNum,
		if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
		WHERE  l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
		(SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount,
		 
			(SELECT IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=192036 AND o.orderType='L' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,
			IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=192036 AND o.orderType='S' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,0))) isPaid,
		 
		(SELECT if(count(1) =(l.entryLimit-l.entryBase),1,0) FROM lvb_order_lesson ol  WHERE ol.lessonId = l.lessonId) as isFull
		FROM
		lvb_lesson_series ls
		INNER join lvb_series_lesson_ref r on ls.seriesId=r.seriesFid
		INNER join lvb_lesson l  on r.lessonFid=l.lessonId
		left join lvb_lesson_ext le on l.lessonId=le.lessonFid
		where
		ls.seriesId = '134'
		and l.applyFids  like concat('%,',concat(1,',%'))
		and now() >= l.validBegin
		and now()  <=  l.validEnd
		group by l.lessonId\G

# Query 12: 0.00 QPS, 0.02x concurrency, ID 0xB1119848086E47DA at byte 982470
# This item is included in the report because it matches --limit.
# Scores: V/M = 1.30
# Time range: 2018-04-17 09:49:37 to 15:21:14
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0       8
# Exec time      1    457s     49s     79s     57s     76s      9s     54s
# Lock time      0   560us    38us   200us    70us   194us    48us    56us
# Rows sent      0       8       1       1       1       1       0       1
# Rows examine   0 235.44M  29.41M  29.43M  29.43M  28.56M       0  28.56M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0   1.59k     203     203     203     203       0     203
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_ping_test'\G
#    SHOW CREATE TABLE `yimi`.`user_ping_test`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
# EXPLAIN /*!50100 PARTITIONS*/
select count(0)
			from user_ping_test upt
			LEFT JOIN t_user_info tui ON tui.id=upt.userFid
			LEFT JOIN erp_clients tec ON tui.id=tec.studentId
			LEFT JOIN mis_user_info mui ON mui.userId=upt.userFid\G

# Query 13: 0.00 QPS, 0.01x concurrency, ID 0xC275A476B01092D4 at byte 7545240
# This item is included in the report because it matches --limit.
# Scores: V/M = 1.85
# Time range: 2018-04-17 10:43:30 to 2018-04-18 00:20:15
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      13
# Exec time      0    392s     21s     42s     30s     40s      7s     31s
# Lock time      0     3ms   183us   353us   261us   287us    41us   260us
# Rows sent      0  11.98k     943     944  943.85  918.49       0  918.49
# Rows examine   2   1.19G  93.01M  93.46M  93.35M  92.12M    1.41  92.12M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  39.06k   3.00k   3.00k   3.00k   3.00k       0   3.00k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,lessonName,playBegin,playEnd,orginalPrice,currentPrice,entryLimit,img1,img2,
        if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
        WHERE l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
        (SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount
        FROM
        lvb_lesson l left join lvb_lesson_ext le on l.lessonId = le.lessonFid
        where
        (
          
              
                subjectIds like concat (concat('%','1'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','2'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','3'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','7'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','8'),'%')
             
             
          
        )
        and
        (
          
              
                termIds like concat (concat('%','130'),'%')
             
             
         
             or 
                termIds like concat (concat('%','140'),'%')
             
             
         
             or 
                termIds like concat (concat('%','150'),'%')
             
             
         
             or 
                termIds like concat (concat('%','160'),'%')
             
             
         
             or 
                termIds like concat (concat('%','170'),'%')
             
             
         
             or 
                termIds like concat (concat('%','210'),'%')
             
             
         
             or 
                termIds like concat (concat('%','220'),'%')
             
             
         
             or 
                termIds like concat (concat('%','230'),'%')
             
             
         
             or 
                termIds like concat (concat('%','240'),'%')
             
             
         
             or 
                termIds like concat (concat('%','310'),'%')
             
             
         
             or 
                termIds like concat (concat('%','320'),'%')
             
             
         
             or 
                termIds like concat (concat('%','330'),'%')
             
             
         
             or 
                termIds like concat (concat('%','410'),'%')
             
             
          
        )
        and
        (
          
             
             
             
              
                1=1
             
          
        )
        and
        (
          
             
             
              
                1=1
             
          
        )
        and l.applyFids  like concat('%',concat(1,'%'))
        and now() >= l.validBegin
        and now()  <=  l.validEnd
        group by l.lessonId\G

# Query 14: 0.00 QPS, 0.00x concurrency, ID 0xED7DE5AA05230157 at byte 2432730
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.11
# Time range: 2018-04-17 04:10:17 to 2018-04-18 04:00:15
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     119
# Exec time      0    300s      2s      5s      3s      3s   530ms      2s
# Lock time      0    28ms   177us   335us   232us   301us    38us   214us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0 263.19M   2.21M   2.21M   2.21M   2.15M    0.03   2.15M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 176.64k   1.48k   1.48k   1.48k   1.48k       0   1.48k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName,1 workFlag
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) =  DATE_SUB(now(),INTERVAL 30 DAY)
		) t on l.startTime = t.startTime and l.clientId = t.clientId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 12
		and co.gradeFid not in (160,230,330)
		and co.contractProp = 1
		and exists(select 1 from erp_contract ec where ec.clientFid = c.clientId and ec.contractStatus=3)
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid and workFlag = 1)\G

# Query 15: 0.00 QPS, 0.00x concurrency, ID 0xF83D3854B6294F5F at byte 1705412
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.10
# Time range: 2018-04-17 04:10:21 to 2018-04-18 04:00:19
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     116
# Exec time      0    290s      2s      4s      2s      3s   500ms      2s
# Lock time      0    27ms   172us   331us   233us   301us    38us   214us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0 256.98M   2.21M   2.22M   2.22M   2.15M       0   2.15M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 171.73k   1.48k   1.48k   1.48k   1.48k       0   1.48k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName,1 workFlag
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) =  DATE_SUB(now(),INTERVAL 30 DAY)
		) t on l.startTime = t.startTime and l.clientId = t.clientId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 14
		and co.gradeFid in (160,230,330)
		and co.contractProp = 1
		and exists(select 1 from erp_contract ec where ec.clientFid = c.clientId and ec.contractStatus=3)
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid and workFlag = 1)\G

# Query 16: 0.00 QPS, 0.00x concurrency, ID 0x807CEFFF6917F85F at byte 1497463
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.04
# Time range: 2018-04-17 04:10:13 to 2018-04-18 04:00:09
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     107
# Exec time      0    276s      2s      4s      3s      3s   314ms      3s
# Lock time      0    27ms   164us   342us   251us   316us    43us   247us
# Rows sent      0      29       0       8    0.27    1.96    0.96       0
# Rows examine   0  76.74M 701.39k 765.37k 734.41k 753.18k  29.75k 717.31k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 164.71k   1.54k   1.54k   1.54k   1.53k    0.00   1.53k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,
		t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,
		i.userRealName teacherName,l.gradeId gradeFid,g.gradeName,round(timestampdiff(DAY,t.startTime,now())/14,0) workFlag
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) >  DATE_SUB(now(),INTERVAL 30 DAY)
		) t on l.startTime = t.startTime and l.clientId = t.clientId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		JOIN erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 23
		and timestampdiff(DAY,t.startTime,now())%14 = 0
		and timestampdiff(DAY,t.startTime,now()) > 0
		and co.contractProp = 1
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid and workFlag = round(timestampdiff(DAY,t.startTime,now())/14,0))\G

# Query 17: 0.00 QPS, 0.01x concurrency, ID 0x4B83C48FBD8F9C61 at byte 5363814
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.05
# Time range: 2018-04-17 09:03:43 to 19:55:21
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     100
# Exec time      0    255s      2s      3s      3s      3s   363ms      2s
# Lock time      0    20ms   140us   274us   198us   247us    34us   185us
# Rows sent      0     100       1       1       1       1       0       1
# Rows examine   0 103.56M   1.03M   1.04M   1.04M   1.03M   7.34k   1.03M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 126.76k   1.27k   1.27k   1.27k   1.27k       0   1.27k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
        count(distinct
        clientFid) finishClientCount from erp_contract co
        inner join
        (select
        o.contractFid,max(startTime)
        startTime,sum(courseHours) courseHours
        from erp_contract_orders o
        ,(select contractId,max(startTime)
        startTime,sum(courseHours)
        courseHours from
        erp_lessons
        where
        lessonStatus in(1,3,4) group by contractId) l
        where o.contractId=l.contractId
        group by o.contractFid) oo
        on
        co.contractId=oo.contractFid and co.contractFlag='N'
        where
        date(startTime) between '2018-04-09' and
        '2018-04-15'
        and co.totalLessonCount=courseHours
        and studentFid not in(select userId
        from user_test where accType='STU')
        and co.clientFid not in(select clientId from erp_contract coo,erp_contract_orders
        o
        left join (select contractId,sum(courseHours) courseHours
        from erp_lessons
        where contractId>0 and lessonStatus in(1,3,4) and startTime < date_add('2018-04-15',interval
        1 day) group by contractId) l on o.contractId=l.contractId
        where
        o.contractFid=coo.contractId
        and coo.payTime < '2018-04-09'
        and ifnull(l.courseHours,0)!=realLessonCount)\G

# Query 18: 0.00 QPS, 0.00x concurrency, ID 0xD824344EA5B63403 at byte 8756
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.07
# Time range: 2018-04-17 04:10:05 to 2018-04-18 04:00:02
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1      99
# Exec time      0    253s      2s      5s      3s      3s   419ms      3s
# Lock time      0    45ms   306us   698us   452us   541us    78us   467us
# Rows sent      0      81       0      12    0.82    6.98    2.24       0
# Rows examine   0  43.73M  62.61k 901.77k 452.30k 871.90k 403.66k  62.55k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     4 306.38k   3.09k   3.09k   3.09k   3.09k       0   3.09k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_plan'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_plan`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'teach_lesson_plan'\G
#    SHOW CREATE TABLE `yimi`.`teach_lesson_plan`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo contractNo,o.contractId orderFid,0 lessonFid,
		o.subjectId subjectFid,s.subjectName,o.teacherId teacherFid,i.userRealName teacherName,o.gradeId gradeFid,g.gradeName,round(temp.completeCount/5,0) workFlag
		from erp_contract_orders o
		join erp_contract co on co.contractId = o.contractFid
		join erp_clients c on o.clientId = c.clientId
		join t_user_info t on o.studentId = t.id
		join mis_user_info i on o.teacherId = i.userId
		join erp_conf_student_grades g on o.gradeId = g.gradeId
		join erp_conf_course_subjects s on o.subjectId = s.subjectId
		join (
		SELECT o.contractFid,o.teacherId,o.subjectId,o.clientId,sum(tmp.lessonCount) lessonCount,sum(tmp.lessonNum) completeCount
		from erp_contract_orders o
		JOIN erp_contract ec on o.contractFid = ec.contractId
		JOIN (
		SELECT contractId,sum(courseHours) lessonCount,count(contractId) lessonNum FROM erp_lessons
		WHERE lessonStatus = 1
		AND contractId>0
		GROUP BY contractId
		) tmp on o.contractId = tmp.contractId
		GROUP BY o.teacherId,o.subjectId,o.clientId
		HAVING sum(tmp.lessonNum)%5 = 0
		AND sum(tmp.lessonNum)>0
		
		)temp on o.clientId = temp.clientId and o.teacherId = temp.teacherId and o.subjectId = temp.subjectId
		JOIN (
		select tm.clientId,tm.teacherId,tm.subjectId,sum(renainLessonCount) renainLessonCount
		from (
		select o.contractId,o.clientId,o.teacherId,o.subjectId,(o.realLessonCount - ifnull(sum(l.courseHours),0)) renainLessonCount
		from erp_contract_orders o left JOIN erp_lessons l on o.contractId = l.contractId
		where l.lessonStatus in (1,3,4)
		GROUP BY o.contractId
		) tm GROUP BY tm.clientId,tm.teacherId,tm.subjectId
		) tmp on o.subjectId = tmp.subjectId and o.teacherId = tmp.teacherId and o.clientId = tmp.clientId 
		left join (
		select teacherId,subjectId,clientId,sum(planCount) planCount from (
		select o.teacherId,o.subjectId,o.clientId,round(count(p.planId)/5,0) planCount
		from erp_lesson_plan p
		JOIN erp_contract_orders o on p.contractId = o.contractId
		where o.teacherId>0
		GROUP BY o.teacherId,o.subjectId,o.clientId
		UNION ALL
		SELECT teacherFid teacherId,subjectFid subjectId,clientFid clientId,count(id) planCount
		FROM teach_lesson_plan
		GROUP BY teacherFid,subjectFid,clientFid
		) tmp
		GROUP BY teacherId,subjectId,clientId
		) tm on o.subjectId = tm.subjectId and o.teacherId = tm.teacherId and o.clientId = tm.clientId 
		,mis_work_order_config w
		where
		w.configId = 9
		and not exists(select 1 from mis_work_order o1 where o1.configFid = w.configId
		AND o1.clientFid = o.clientId
		AND o1.subjectFid = o.subjectId
		AND o1.teacherFid = o.teacherId
		and workFlag = round(temp.completeCount/5,0))
		and o.contractFid != o.contractId
		and o.contractId>0
		and tmp.renainLessonCount >0 
		and round(temp.completeCount/5,0) > (ifnull(planCount,0)-1) 
		GROUP BY o.clientId,o.subjectId,o.teacherId\G

# Query 19: 0.00 QPS, 0.01x concurrency, ID 0xD9CFEA53507AC560 at byte 4955493
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.09
# Time range: 2018-04-17 09:29:34 to 22:25:00
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1      81
# Exec time      0    248s      2s      4s      3s      4s   523ms      3s
# Lock time      0    16ms    86us   291us   197us   273us    54us   204us
# Rows sent      0      81       1       1       1       1       0       1
# Rows examine   0 158.06M   1.95M   1.95M   1.95M   1.95M   1.94k   1.86M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 160.10k   1.98k   1.98k   1.98k   1.98k       0   1.98k
# String:
# Databases    yimi
# Hosts        10.31.53.111 (18/22%), 10.80.58.47 (16/19%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        COUNT(1)
        FROM mis_user_info u
        LEFT JOIN erp_clients ec ON u.userId = ec.chargeFid
        LEFT JOIN mis_user_info u1 ON u1.userId = ec.consultantId
        LEFT JOIN mis_user_info u2 ON u2.userId = ec.cooperateConsultantId
        INNER JOIN erp_lessons l ON ec.studentId = l.studentId
        INNER JOIN t_user_info tui on tui.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
         INNER JOIN www_config pre on pre.configId=1
         INNER JOIN www_config aft on aft.configId=2
        WHERE
        l.lessonStatus = 1 and
        ((u.userOrgFid IN
         (  
            3010100
         ) 
         
            and ec.chargeFid = 900001282
         
        )
        OR (CASE WHEN ec.consultantId!= ec.chargeFid THEN
        u1.userOrgFid IN
         (  
            3010100
         ) 
         
            and ec.consultantId = 900001282
         
        END)
        OR (u2.userOrgFid IN
         (  
            3010100
         ) 
         
            AND ec.cooperateConsultantId = 900001282
         
        ))
         
         
        	and l.subjectId in
	         (  
	            0
	         , 
	            1
	         , 
	            2
	         , 
	            3
	         , 
	            4
	         , 
	            5
	         , 
	            6
	         , 
	            7
	         , 
	            8
	         , 
	            9
	         , 
	            13
	         , 
	            16
	         ) 
         
         
        	and l.gradeId in
	         (  
	            130
	         , 
	            140
	         , 
	            150
	         , 
	            160
	         , 
	            170
	         , 
	            210
	         , 
	            220
	         , 
	            230
	         , 
	            240
	         , 
	            310
	         , 
	            320
	         , 
	            330
	         , 
	            410
	         )\G

# Query 20: 0.00 QPS, 0.00x concurrency, ID 0x4A078E636F95F53C at byte 1510523
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.08
# Time range: 2018-04-17 04:10:23 to 2018-04-18 04:00:21
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1      94
# Exec time      0    240s      2s      4s      3s      3s   448ms      2s
# Lock time      0    24ms   186us   394us   257us   332us    47us   236us
# Rows sent      0     106       0     101    1.13       0    9.99       0
# Rows examine   0  88.94M 816.76k 980.31k 968.93k 961.27k  41.66k 961.27k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 151.10k   1.61k   1.61k   1.61k   1.61k       0   1.61k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName,round((datediff(now(),l.startTime)-30)/7,0)+1 workFlag
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) < DATE_SUB(now(),INTERVAL 30 DAY)
		) t on l.startTime = t.startTime and l.clientId = t.clientId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 15
		and co.gradeFid in (160,230,330)
		and co.contractProp = 1
		and exists(select 1 from erp_contract ec where ec.clientFid = c.clientId and ec.contractStatus=3)
		and (datediff(now(),l.startTime)-30)%7=0
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid and workFlag = round((datediff(now(),l.startTime)-30)/7,0)+1)\G

# Query 21: 0.00 QPS, 0.00x concurrency, ID 0x08FE275627AABB49 at byte 6524284
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.02
# Time range: 2018-04-17 04:10:12 to 2018-04-18 04:00:09
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1      96
# Exec time      0    216s      2s      4s      2s      3s   218ms      2s
# Lock time      0    27ms   177us   363us   277us   316us    36us   273us
# Rows sent      0       3       0       3    0.03       0    0.29       0
# Rows examine   0  72.01M 767.55k 769.19k 768.12k 753.18k       0 753.18k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 154.88k   1.61k   1.61k   1.61k   1.61k       0   1.61k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_student_teach_special'\G
#    SHOW CREATE TABLE `yimi`.`erp_student_teach_special`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo contractNo,o.contractId orderFid,temp.lessonId lessonFid,
		o.subjectId subjectFid,s.subjectName,o.teacherId teacherFid,i.userRealName teacherName,o.gradeId gradeFid,g.gradeName
		from erp_contract_orders o
		join erp_contract co on co.contractId = o.contractFid
		join erp_clients c on o.clientId = c.clientId
		join t_user_info t on o.studentId = t.id
		join mis_user_info i on o.teacherId = i.userId
		join erp_conf_student_grades g on o.gradeId = g.gradeId
		join erp_conf_course_subjects s on o.subjectId = s.subjectId
		join (
		select
		contractId,l.lessonId
		from erp_lessons l,
		(
		select
		clientId,subjectId,teacherid,max(startTime) startTime
		from erp_lessons
		where lessonStatus=1
		AND startTime > date_sub(now(),INTERVAL 30 DAY)
		and lessonType=10
		GROUP BY subjectId,clientId,teacherId
		HAVING timestampdiff(day,max(startTime),now())= 14
		) ll
		where l.clientId=ll.clientId
		and l.subjectId=ll.subjectId
		and l.teacherId=ll.teacherId
		and l.startTime=ll.startTime
		) temp on o.contractId = temp.contractId
		,mis_work_order_config w
		where
		w.configId = 19
		and o.orderStatus = 2
		and not exists(select 1 from mis_work_order wo where wo.configFid = w.configId and wo.lessonFid = temp.lessonId)
		and not exists(select 1 from erp_student_teach_special s where c.clientId = s.clientFid)\G

# Query 22: 0.00 QPS, 0.00x concurrency, ID 0x2C9AB886E8ACE1D9 at byte 2531145
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.65
# Time range: 2018-04-17 07:15:15 to 2018-04-18 02:33:27
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      50
# Exec time      0    202s      2s      8s      4s      7s      2s      3s
# Lock time      0    15ms    51us   479us   295us   445us   138us   316us
# Rows sent      0   5.14k      49     154  105.24  151.03   29.92  102.22
# Rows examine   0       0       0       0       0       0       0       0
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 139.73k   2.79k   2.79k   2.79k   2.76k       0   2.76k
# String:
# Databases    yimi
# Hosts        10.80.58.47 (13/26%), 10.81.244.11 (13/26%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_application'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_application`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'server_trail_and_voice'\G
#    SHOW CREATE TABLE `yimi`.`server_trail_and_voice`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_teacher_schedule'\G
#    SHOW CREATE TABLE `yimi`.`erp_teacher_schedule`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
# EXPLAIN /*!50100 PARTITIONS*/
(SELECT
		tsche.lessonId,
		tsche.teacherId,
		TIMESTAMPDIFF(DAY,'2017-12-18',tsche.lessonDate) as dateId,
		(tsche.scheduleId -1) as scheduleId,
		if((tsche.isFree = 0 ),'V',tsche.relateType) as relateType,
		(CASE lessons.lessonType
		WHEN  1 THEN  "A"
		WHEN  0  THEN  "A"
		WHEN  10  THEN  "O"
		WHEN  11  THEN  "O"
		ELSE tsche.relateType
		END
		) as lessonType,
		lessons.startTime,
		lessons.endTime,
		lessons.lessonStatus,
		lessons.courseHours,
		lessons.clientId AS clientNo,
		"" AS lessonName,
		if((lessons.lessonType = 0 || lessons.lessonType = 1),(SELECT applicationId FROM erp_lesson_application WHERE lessonId = tsche.lessonId),lessons.contractId) AS contractNo,
		(SELECT gradeName FROM erp_conf_student_grades  WHERE gradeId = lessons.gradeId)     AS grade,
		(SELECT subjectName FROM erp_conf_course_subjects WHERE subjectId = lessons.subjectId) AS subject,
		clients.clientName   AS name,
		(SELECT userRealName FROM mis_user_info WHERE userId = clients.chargeFid) as chargeName,
		(SELECT userMobile  FROM mis_user_info WHERE userId = clients.chargeFid) as chargeMobile,
		clients.clientName   AS parentRealName,
		clients.phoneNo   AS parentContactInfo,
		(select IF(COUNT(1)>0,1,0) from server_trail_and_voice WHERE  lessonId = tsche.lessonId) as hasRecord,
		(select IF(COUNT(1)>0,1,0) from erp_lesson_docs WHERE docType = 1 and lessonId = tsche.lessonId) as hasCourseware
		FROM erp_teacher_schedule tsche
		LEFT JOIN  erp_lessons lessons
		ON lessons.lessonId = tsche.lessonId
		LEFT JOIN erp_clients clients ON lessons.clientId = clients.clientId
		WHERE
		(tsche.relateType = 'V'  OR tsche.relateType = 'O' OR tsche.relateType = 'A')
		AND
		tsche.teacherId = 900000691
		AND
		tsche.lessonDate  BETWEEN '2017-12-18' AND '2017-12-24'
		ORDER BY
		tsche.lessonDate
		)
		UNION ALL
		(
		SELECT
		tsche.lessonId,
		tsche.teacherId,
		TIMESTAMPDIFF(DAY,'2017-12-18',tsche.lessonDate) as dateId,
		(tsche.scheduleId -1) as scheduleId,
		tsche.relateType,
		'L' as lessonType,
		lessons.playBegin as startTime,
		lessons.playEnd  as endTime,
		lessons.lessonName,
		if(now()  <=  lessons.playBegin ,0,if(lessons.streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v WHERE  tsche.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as lessonStatus,
		0     AS courseHours,
		""    AS clientNo,
		""    AS contractNo,
		lessons.termIds    AS grade,
		lessons.subjectIds    AS subject,
		""    AS name,
		""    AS chargeName,
		""    AS chargeMobile,
		""    AS parentRealName,
		""    AS parentContactInfo,
		0     AS hasRecord,
		0     AS hasCourseware
		FROM lvb_lesson lessons
		LEFT JOIN  erp_teacher_schedule tsche ON lessons.lessonId = tsche.lessonId
		WHERE
		tsche.relateType = 'L'
		AND
		tsche.teacherId = 900000691
		AND
		tsche.lessonDate  BETWEEN '2017-12-18' AND '2017-12-24'
		ORDER BY tsche.lessonDate
		)\G

# Query 23: 0.00 QPS, 0.00x concurrency, ID 0x26476FF6C3C0CA5D at byte 1354592
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.07
# Time range: 2018-04-17 04:10:19 to 2018-04-18 03:00:22
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1      71
# Exec time      0    178s      2s      4s      3s      3s   418ms      2s
# Lock time      0    19ms   201us   377us   267us   332us    46us   247us
# Rows sent      0      15       0       5    0.21    0.99    0.85       0
# Rows examine   0  57.21M 752.25k 832.71k 825.08k 830.38k  31.45k 830.38k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 114.68k   1.62k   1.62k   1.62k   1.62k       0   1.62k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName,round((datediff(now(),l.startTime)-30)/14,0)+1 workFlag
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) <  DATE_SUB(now(),INTERVAL 30 DAY)
		) t on l.startTime = t.startTime and l.clientId = t.clientId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 13
		and co.gradeFid not in (160,230,330)
		and co.contractProp = 1
		and exists(select 1 from erp_contract ec where ec.clientFid = c.clientId and ec.contractStatus=3)
		and (datediff(now(),l.startTime)-30)%14=0
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid and workFlag = round((datediff(now(),l.startTime)-30)/14,0)+1)\G

# Query 24: 0.00 QPS, 0.00x concurrency, ID 0xAF7087AE5BCF7A6F at byte 3168550
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.09
# Time range: 2018-04-17 09:23:03 to 22:49:43
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      64
# Exec time      0    171s      2s      4s      3s      4s   492ms      2s
# Lock time      0     9ms    43us   301us   146us   260us    76us   159us
# Rows sent      0   1.55k       0      93   24.83   69.19   23.45   14.52
# Rows examine   0  61.61M 564.48k   1.01M 985.79k 1009.33k  75.58k 961.27k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1  91.15k   1.39k   2.24k   1.42k   1.39k  138.65   1.39k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        erpuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lesson_comment'\G
#    SHOW CREATE TABLE `yimi`.`lesson_comment`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_cr'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_cr`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
				l.*,
				
				IFNULL(c.clientName,t.nickName) studentName,
				mui.userRealName teacherName,
				g.gradeName gradeName,
				s.subjectName subjectName,
				o1.userRealName ccName,
				u1.userRealName chargeName,
				u1.userMobile chargePhone,
				stulc.param1 stuParam1,
				stulc.param2 stuParam2,
				stulc.param3 stuParam3,
				stulc.param4 stuParam4,
				tealc.param1 teaParam1,
				tealc.param2 teaParam2,
				tealc.param3 teaParam3,
				c.eduSystem
		FROM erp_lessons l
		LEFT JOIN erp_clients c ON l.clientId=c.clientId
		LEFT JOIN t_user_info t ON l.studentId=t.id
		LEFT JOIN mis_user_info mui ON mui.userId = l.teacherId
		LEFT JOIN erp_conf_student_grades g ON l.gradeId=g.gradeId
		LEFT JOIN erp_conf_course_subjects s ON l.subjectId=s.subjectId
		LEFT JOIN mis_user_info o1 ON o1.userId = c.consultantId
		LEFT JOIN mis_user_info u1 ON u1.userId=c.chargeFid
		LEFT JOIN lesson_comment stulc ON stulc.lessonFid=l.lessonId and stulc.commentBy='STU'
		LEFT JOIN lesson_comment tealc ON tealc.lessonFid=l.lessonId and tealc.commentBy='TEA'
		 WHERE  (c.clientName like '%张楮寒%' OR t.nickName like '%张楮寒%')
			
			
			
			
			
			
			
				and (c.consultantId in (				
				 900001480
	           )
				or EXISTS (select distinct 1 from erp_client_cr t1
				where t1.clientFid=l.clientId and t1.endTime is null
				and t1.crFid in (				
				 900001480
	           ))) 
		order by startTime desc limit 0,20\G

# Query 26: 0.00 QPS, 0.00x concurrency, ID 0x4E33A4D16C9051F7 at byte 1658052
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.04
# Time range: 2018-04-17 09:23:01 to 19:55:26
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      67
# Exec time      0    164s      2s      3s      2s      3s   298ms      2s
# Lock time      0    11ms   118us   260us   171us   214us    31us   167us
# Rows sent      0      67       1       1       1       1       0       1
# Rows examine   0  81.28M   1.18M   1.24M   1.21M   1.20M  24.91k   1.20M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1  72.43k   1.08k   1.08k   1.08k   1.08k       0   1.08k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_order_flow'\G
#    SHOW CREATE TABLE `yimi`.`erp_order_flow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
select count(distinct clientId) pauseStudentCount from
        erp_contract_orders o,(
        select
        ff.orderFid,orderStatusFid from
        erp_order_flow ff ,(select orderFid,
        max(createdOn) createdOn from
        erp_order_flow
        where createdOn < date_add('2018-04-09',interval
        1 day) and orderStatusFid>0 group by orderFid) fff where ff.createdOn=fff.createdOn and
        ff.orderFid=fff.orderFid) f
        where o.contractId=f.orderFid and
        f.orderStatusFid in(6)
        and studentId
        not
        in(select userId from user_test)
        and clientId not
        in(select clientId
        from
        erp_contract_orders o,(
        select
        ff.orderFid,orderStatusFid from
        erp_order_flow ff ,(select orderFid,
        max(createdOn) createdOn from
        erp_order_flow
        where createdOn < date_add('2018-04-09',interval
        1 day) and orderStatusFid>0 group by orderFid) fff where ff.createdOn=fff.createdOn and
        ff.orderFid=fff.orderFid) f
        where o.contractId=f.orderFid and
        f.orderStatusFid in(1,2))\G

# Query 32: 0.00 QPS, 0.00x concurrency, ID 0x8DF7748590F106FA at byte 7233
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.07
# Time range: 2018-04-17 04:10:04 to 2018-04-18 03:00:02
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      53
# Exec time      0    125s      2s      5s      2s      3s   393ms      2s
# Lock time      0   110ms   107us    50ms     2ms   273us     9ms   176us
# Rows sent      0       3       0       1    0.06       0    0.23       0
# Rows examine   0  49.69M 956.14k 963.81k 960.03k 961.27k   3.84k 915.49k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1  65.99k   1.25k   1.25k   1.25k   1.25k       0   1.25k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName
		FROM erp_lessons l
		join (
		select clientId,min(lessonId) lessonId from erp_lessons WHERE lessonType = 10 GROUP BY clientId
		) t on l.lessonId = t.lessonId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 7
		and l.createTime > DATE(now())
		and co.contractProp = 1
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid)\G

# Query 33: 0.00 QPS, 0.00x concurrency, ID 0x9A4B12447FDDD372 at byte 1659988
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.02
# Time range: 2018-04-17 09:03:49 to 19:55:29
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      53
# Exec time      0    123s      2s      3s      2s      3s   189ms      2s
# Lock time      0     7ms    87us   180us   133us   159us    20us   131us
# Rows sent      0      53       1       1       1       1       0       1
# Rows examine   0  55.47M   1.04M   1.05M   1.05M   1.03M       0   1.03M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  36.59k     707     707     707     707       0     707
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_order_flow'\G
#    SHOW CREATE TABLE `yimi`.`erp_order_flow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
select count(distinct subjectId,studentId) pendingSubjectOrderCount
        from
        erp_contract_orders o,(
        select
        ff.orderFid,ff.orderStatusFid,ff.createdOn from erp_order_flow
        ff,(select orderFid,max(createdOn) createdOn from erp_order_flow
        where
        createdOn < date_add('2018-04-09',interval
        1 day) and orderStatusFid>0 group by orderFid)
        fff where ff.orderFid=fff.orderFid and
        ff.createdOn=fff.createdOn and ff.orderFid=fff.orderFid) f
        where
        o.contractId=f.orderFid
        and
        orderStatusFid in(1,2,6)
        and studentId
        not
        in(select
        userId from
        user_test where accType='STU')\G

# Query 34: 1.15 QPS, 8.49x concurrency, ID 0x24A7383D45436873 at byte 6733109
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.34
# Time range: 2018-04-17 22:20:23 to 22:20:36
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      15
# Exec time      0    110s      3s      9s      7s      9s      2s      7s
# Lock time      0     3ms   157us   272us   218us   247us    32us   230us
# Rows sent      0      15       1       1       1       1       0       1
# Rows examine   0  10.13M 691.67k 691.67k 691.67k 691.67k       0 691.67k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  20.49k   1.37k   1.37k   1.37k   1.37k       0   1.37k
# String:
# Databases    yimi
# Hosts        10.31.53.111 (6/40%), 10.80.58.47 (4/26%)... 3 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        COUNT(1)
        FROM mis_user_info u
        LEFT JOIN erp_clients ec ON u.userId = ec.chargeFid
        LEFT JOIN mis_user_info u1 ON u1.userId = ec.consultantId
        LEFT JOIN mis_user_info u2 ON u2.userId = ec.cooperateConsultantId
        INNER JOIN erp_lessons l ON ec.studentId = l.studentId
        INNER JOIN t_user_info tui on tui.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
        INNER JOIN www_config pre on pre.configId=1
        INNER JOIN www_config aft on aft.configId=2
        WHERE
        ((u.userOrgFid IN
         (  
            3120100
         ) 
         
            and ec.chargeFid = 900001428
         
        )
        OR (CASE WHEN ec.consultantId!= ec.chargeFid THEN
        u1.userOrgFid IN
         (  
            3120100
         ) 
         
            and ec.consultantId = 900001428
         
        END)
        OR (u2.userOrgFid IN
         (  
            3120100
         ) 
         
            AND ec.cooperateConsultantId = 900001428
         
        ))
         
            and (l.clientId='章凯琪'
            or ec.clientName='章凯琪'
            or l.lessonId='章凯琪'
            or tui.realname='章凯琪'
            )
         
         
         
            AND l.startTime >= '2018-04-16'\G

# Query 35: 0.00 QPS, 0.01x concurrency, ID 0x6FF7C208961C02F5 at byte 3174860
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.13
# Time range: 2018-04-17 15:19:43 to 17:52:02
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      34
# Exec time      0    104s      2s      5s      3s      4s   630ms      3s
# Lock time      0     3ms    46us   116us    77us   103us    17us    76us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0  46.68M   1.37M   1.37M   1.37M   1.32M       0   1.32M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  17.89k     524     554  538.85  537.02   12.79  537.02
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
# EXPLAIN /*!50100 PARTITIONS*/
select el.lessonId,el.lessonStatus,el.lessonType,el.startTime,el.endTime,el.teacherId,
        mui.userRealName teacherName,el.studentId,ec.clientName studentName from erp_lessons el
        LEFT JOIN erp_clients ec on ec.clientId=el.clientId
        LEFT JOIN mis_user_info mui on mui.userId=el.teacherId
        where
        (mui.userRealName='201804160014' or ec.clientName='201804160014'
        or (el.clientId='201804160014' and 1=1) or mui.userMobile='201804160014' or ec.phoneNo='201804160014')
        ORDER BY el.startTime desc
        LIMIT 1\G

# Query 36: 0.00 QPS, 0.00x concurrency, ID 0x50E7215F3276D4D0 at byte 7193099
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.78
# Time range: 2018-04-17 06:58:49 to 2018-04-18 00:19:02
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      21
# Exec time      0     99s      2s     11s      5s      6s      2s      5s
# Lock time      0     1ms    22us   190us    64us   138us    42us    49us
# Rows sent      0   3.39k     104     247  165.19  212.52   48.48  136.99
# Rows examine   0 342.63M  10.25M  24.41M  16.32M  21.31M   4.77M  13.74M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  24.45k   1.16k   1.16k   1.16k   1.16k       0   1.16k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+  ###
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,lessonName,playBegin,playEnd,orginalPrice,currentPrice,entryLimit,img1,img2,
        if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
        WHERE l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
        (SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount
        FROM
        lvb_lesson l left join lvb_lesson_ext le on l.lessonId = le.lessonFid
        where
        (
          
             
              
                1=1
             
          
        )
        and
        (
          
              
                termIds like concat (concat('%','230'),'%')
             
             
          
        )
        and
        (
          
             
             
             
              
                1=1
             
          
        )
        and
        (
          
             
             
              
                1=1
             
          
        )
        and l.applyFids  like concat('%',concat(1,'%'))
        and now() >= l.validBegin
        and now()  <=  l.validEnd
        group by l.lessonId\G

# Query 40: 0.00 QPS, 0.00x concurrency, ID 0x21B83224C5BD6EDA at byte 2229157
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.15
# Time range: 2018-04-17 11:19:52 to 20:41:33
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      14
# Exec time      0     81s      5s      7s      6s      7s   938ms      6s
# Lock time      0     2ms    55us   167us   122us   159us    31us   125us
# Rows sent      0       9       0       1    0.64    0.99    0.48    0.99
# Rows examine   0  12.09M 883.86k 885.05k 884.27k 871.90k       0 871.90k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0   7.86k     575     575     575     575       0     575
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_family'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_family`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
# EXPLAIN /*!50100 PARTITIONS*/
select distinct ec.clientId, ec.clientName, ec.phoneNo, ec.studentId, ec.consultantId, ec.chargeFid, u1.userRealName ccName, u2.userRealName crName
		from erp_clients ec
		left join mis_user_info u1 on ec.consultantId = u1.userId
		left join mis_user_info u2 on ec.chargeFid = u2.userId
		left join erp_client_family f on ec.clientId = f.clientFid
		left join t_user_info t on ec.studentId = t.id and (t.accountType = 0 or t.accountType = 1)
		 WHERE (ec.phoneNo = '15190858550' or ec.clientName = '15190858550' or familyPhoneNo = '15190858550' or t.mobileNo = '15190858550')\G

# Query 41: 0.00 QPS, 0.00x concurrency, ID 0xF5446E0AC6AB1913 at byte 7660491
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.53
# Time range: 2018-04-17 06:15:53 to 2018-04-18 00:58:05
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      25
# Exec time      0     80s      2s      7s      3s      5s      1s      3s
# Lock time      0     2ms    57us    91us    69us    76us     7us    66us
# Rows sent      0   1.47k      25     157   60.20   92.72   26.12   59.77
# Rows examine   0 293.39M   4.91M  30.62M  11.74M  18.41M   5.25M  11.87M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  22.36k     916     916     916     916       0     916
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
				l.lessonId,le.lessonFid,l.lessonName,l.playBegin,l.playEnd,l.orginalPrice,l.currentPrice,l.entryLimit,le.img1,le.img2,o.paidOn,
				 (SELECT if(count(1) = (l.entryLimit-l.entryBase),1,0) FROM lvb_order_lesson ol  WHERE ol.lessonId = l.lessonId) as isFull,
			if(now() <= l.playBegin ,0,if(l.streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
			WHERE l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
				(SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase  as paycount
			FROM
			lvb_lesson l
			    LEFT JOIN lvb_lesson_ext le on l.lessonId = le.lessonFid
				INNER JOIN lvb_order_lesson s on s.lessonId=l.lessonId
				INNER JOIN lvb_order o on o.orderid = s.orderFid
			WHERE
				o.studentFid = 186638 and o.isPaid=1
				and l.applyFids  like concat('%,',concat(1,',%'))
				and now() >= l.validBegin
            group by l.lessonId\G

# Query 43: 0.00 QPS, 0.00x concurrency, ID 0x60E69C3EBFFC9431 at byte 1620755
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.02
# Time range: 2018-04-17 09:20:20 to 15:23:13
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      34
# Exec time      0     79s      2s      3s      2s      3s   215ms      2s
# Lock time      0    10ms    56us   375us   297us   348us    75us   316us
# Rows sent      0      71       1      10    2.09    9.83    2.84    0.99
# Rows examine   0  21.20M 421.67k 663.11k 638.53k 650.62k  64.43k 650.62k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1  69.96k   2.05k   2.07k   2.06k   2.06k       8   2.06k
# String:
# Databases    yimi
# Hosts        10.81.244.11 (10/29%), 10.81.244.3 (8/23%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'server_trail_and_voice'\G
#    SHOW CREATE TABLE `yimi`.`server_trail_and_voice`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_teacher_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_teacher_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,
        l.teacherId,
        l.lessonType,
        l.courseHours,
        DATE_FORMAT(l.startTime,'%Y-%m-%d %H:%i') AS startTime,
        DATE_FORMAT(l.endTime,'%Y-%m-%d %H:%i') AS endTime,
        (CASE ec.clientName WHEN '' THEN tui.realName ELSE ec.clientName END) studentName,
        s.subjectName,
        g.gradeName,
        l.lessonStatus,
        TIMESTAMPDIFF(SECOND,NOW(),l.startTime) remaining,
        TIMESTAMPDIFF(SECOND,l.startTime,l.endTime) lessonSecondCount,
        CAST(pre.configValue AS SIGNED)*60 beforeSecond,
        CAST(aft.configValue AS SIGNED)*60 afterSecond,
        IF(EXISTS(SELECT 1 FROM server_trail_and_voice WHERE STATUS=1 AND lessonID=l.lessonId),1,0) hasRecord,
        IF(EXISTS(SELECT 1 FROM erp_lesson_docs WHERE parentId=0 AND docType=1 AND lessonId=l.lessonId),1,0) hasDoc,
        "" AS title,
        "" AS keywords,
        CASE l.studentAppraiseType WHEN 0 THEN '未评价' WHEN 1 THEN '好评' WHEN 2 THEN '中评' WHEN 3 THEN '差评' END
        studentAppraiseType,
        studentAppraises

        FROM mis_teacher_info u
        INNER JOIN erp_lessons l ON u.subjectIds LIKE CONCAT('%,',l.subjectId,',%')
        INNER JOIN t_user_info tui ON tui.id = l.studentId
        LEFT JOIN erp_clients ec ON ec.studentId = l.studentId
        LEFT JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
        INNER JOIN www_config pre ON pre.configId=1
        INNER JOIN www_config aft ON aft.configId=2
        WHERE u.userFid = 800121389
         
            AND (l.clientId='684777'
            OR ec.clientName='684777'
            OR l.lessonId='684777'
            OR tui.realname='684777'
            )
         
         
         
         
         
            AND ((l.startTime > DATE(NOW()) AND l.lessonStatus=0) OR l.lessonStatus=1)
         
        ORDER BY l.lessonStatus,
        CASE WHEN l.lessonStatus IN(0) THEN
        l.startTime END,
        CASE WHEN l.lessonStatus IN(1) THEN
        l.startTime END DESC
        LIMIT 0, 10\G

# Query 46: 0.38 QPS, 0.81x concurrency, ID 0x2F1A313814D4967F at byte 7926804
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.00
# Time range: 2018-04-18 03:00:38 to 03:01:59
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      31
# Exec time      0     66s      2s      2s      2s      2s    98ms      2s
# Lock time      0     5ms   105us   189us   153us   176us    30us   159us
# Rows sent      0      31       1       1       1       1       0       1
# Rows examine   0  30.05M 992.56k 992.77k 992.62k 961.27k       0 961.27k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  24.19k     797     800  799.13  793.42       0  793.42
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_order_flow'\G
#    SHOW CREATE TABLE `yimi`.`erp_order_flow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
# EXPLAIN /*!50100 PARTITIONS*/
select count(0) from erp_contract_orders tmpeco
        join (
        select eof.orderFid,eof.orderStatusFid from erp_order_flow eof
        join (select max(flowId) flowId from erp_order_flow where orderStatusFid>0 and createdOn  <  '2018-04-17 23:57:54' GROUP BY orderFid) tmp on tmp.flowId=eof.flowId
        ) tmpeof on tmpeco.contractId=tmpeof.orderFid
        LEFT JOIN (select contractId,sum(courseHours) overHours from erp_lessons where lessonStatus in(1,3,4) and contractId>0 GROUP BY contractId) tmpel on tmpel.contractId=tmpeco.contractId
        where tmpeof.orderStatusFid in(1,2,6) and (orderStatusFid=1 or tmpel.overHours!=tmpeco.realLessonCount)
         and tmpeco.teacherId=108453 
         and tmpeco.subjectId=2 
        and tmpeco.contractId!=16296 and tmpeco.clientId=256466\G

# Query 47: 0.00 QPS, 0.00x concurrency, ID 0x53E68A2F4F0BCA83 at byte 6513303
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.03
# Time range: 2018-04-17 09:30:02 to 22:30:02
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      26
# Exec time      0     62s      2s      3s      2s      3s   253ms      2s
# Lock time      0   134ms    86us    50ms     5ms    30ms    14ms   138us
# Rows sent      0      26       1       1       1       1       0       1
# Rows examine   0   9.71M 382.14k 382.51k 382.34k 380.41k       0 380.41k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  18.18k     716     716     716     716       0     716
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_follow'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_follow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_follow_status'\G
#    SHOW CREATE TABLE `yimi`.`erp_follow_status`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
			   ifnull(sum(if(ec.flag in('A1','A2'),1,0)),0) AClientNum,
			   ifnull(sum(if(ec.flag='B',1,0)),0) BClientNum,
			   count(0) totalNum, date_format(now(),'%H:%i') now,
				ifnull( sum(if(ec.flag in('A1','A2') and ecf.clientFid is null,1,0)),0) AClientNoFollowNum,
				ifnull(sum(if(ec.flag = 'B' and ecf.clientFid is null,1,0)),0) BClientNoFollowNum,
			   ifnull(sum(if(ecf.clientFid is null,1,0)),0) clientNoFollowNum from erp_clients ec
			left join (
						  SELECT clientFid
							  FROM erp_client_follow ecf
								where ecf.clientFid not in(select statusId from erp_follow_status where type=',SYS,')
							  GROUP BY clientFid
					  ) ecf on ecf.clientFid=ec.clientId
		where ec.clientSea='T'\G

# Query 50: 0.00 QPS, 0.00x concurrency, ID 0xF5FEACC32429CC03 at byte 5340982
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.48
# Time range: 2018-04-17 09:29:34 to 19:54:02
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      22
# Exec time      0     55s      2s      6s      3s      2s      1s      2s
# Lock time      0     8ms   249us   444us   372us   403us    43us   366us
# Rows sent      0     208       4      10    9.45    9.83    1.71    9.83
# Rows examine   0  12.51M 367.25k   2.63M 582.47k 380.41k 664.98k 362.29k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1  71.67k   3.26k   3.26k   3.26k   3.26k       0   3.26k
# String:
# Databases    yimi
# Hosts        10.31.53.111 (7/31%), 10.81.244.3 (6/27%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'server_trail_and_voice'\G
#    SHOW CREATE TABLE `yimi`.`server_trail_and_voice`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,
        l.teacherId,
        l.lessonType,
        l.courseHours,
        date_format(l.startTime,'%Y-%m-%d %H:%i') AS startTime,
        date_format(l.endTime,'%Y-%m-%d %H:%i') AS endTime,
        (case ec.clientName when '' then tui.realName else ec.clientName end) studentName,
        s.subjectName,
        g.gradeName,
        l.lessonStatus,
         timestampdiff(second,now(),l.startTime) remaining,
         timestampdiff(second,l.startTime,l.endTime) lessonSecondCount,
         cast(pre.configValue as signed)*60 beforeSecond,
         cast(aft.configValue as signed)*60 afterSecond,
        if(exists(select 1 from server_trail_and_voice where status=1 and lessonID=l.lessonId),1,0) hasRecord,
        if(exists(select 1 from erp_lesson_docs where parentId=0 and docType=1 and lessonId=l.lessonId),1,0) hasDoc,
        "" AS title,
        "" AS keywords,
        case l.studentAppraiseType when 0 then '未评价' when 1 then '好评' when 2 then '中评' when 3 then '差评' end
        studentAppraiseType,
        studentAppraises
        FROM mis_user_info u
        LEFT JOIN erp_clients ec ON u.userId = ec.chargeFid
        LEFT JOIN mis_user_info u1 ON u1.userId = ec.consultantId
        LEFT JOIN mis_user_info u2 ON u2.userId = ec.cooperateConsultantId
        INNER JOIN erp_lessons l ON ec.studentId = l.studentId
        INNER JOIN t_user_info tui on tui.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
         INNER JOIN www_config pre on pre.configId=1
         INNER JOIN www_config aft on aft.configId=2
        WHERE
       	l.lessonStatus = 1 and
        ((u.userOrgFid IN
         (  
            3080100
         ) 
         
            and ec.chargeFid = 900001518
         
        )
        OR (CASE WHEN ec.consultantId!= ec.chargeFid THEN
        u1.userOrgFid IN
         (  
            3080100
         ) 
         
            and ec.consultantId = 900001518
         
        END)
        OR (u2.userOrgFid IN
         (  
            3080100
         ) 
         
            AND ec.cooperateConsultantId = 900001518
         
        ))
         
         
        	and l.subjectId in
	         (  
	            0
	         , 
	            1
	         , 
	            2
	         , 
	            3
	         , 
	            4
	         , 
	            5
	         , 
	            6
	         , 
	            7
	         , 
	            8
	         , 
	            9
	         , 
	            13
	         , 
	            16
	         ) 
         
         
        	and l.gradeId in
	         (  
	            130
	         , 
	            140
	         , 
	            150
	         , 
	            160
	         , 
	            170
	         , 
	            210
	         , 
	            220
	         , 
	            230
	         , 
	            240
	         , 
	            310
	         , 
	            320
	         , 
	            330
	         , 
	            410
	         ) 
         
         
         
         
		 
         
         
        ORDER BY l.lessonStatus,
        CASE WHEN l.lessonStatus in(0) THEN
        l.startTime END,
        CASE WHEN l.lessonStatus in(1) THEN
        l.startTime END desc
        limit 0, 10\G

# Query 51: 0.47 QPS, 0.97x concurrency, ID 0xC4EDC64AF48E3254 at byte 8033994
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.00
# Time range: 2018-04-18 03:05:29 to 03:06:24
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      26
# Exec time      0     53s      2s      2s      2s      2s    19ms      2s
# Lock time      0     4ms   105us   195us   170us   185us    19us   176us
# Rows sent      0      26       1       1       1       1       0       1
# Rows examine   0  25.21M 992.56k 993.72k 992.72k 961.27k       0 961.27k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  18.94k     746     746     746     746       0     746
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_order_flow'\G
#    SHOW CREATE TABLE `yimi`.`erp_order_flow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
# EXPLAIN /*!50100 PARTITIONS*/
select count(0) from erp_contract_orders tmpeco
        join (
        select eof.orderFid,eof.orderStatusFid from erp_order_flow eof
        join (select max(flowId) flowId from erp_order_flow where orderStatusFid>0 and createdOn  <  '2018-04-16 16:01:06' GROUP BY orderFid) tmp on tmp.flowId=eof.flowId
        ) tmpeof on tmpeco.contractId=tmpeof.orderFid
        LEFT JOIN (select contractId,sum(courseHours) overHours from erp_lessons where lessonStatus in(1,3,4) and contractId>0 GROUP BY contractId) tmpel on tmpel.contractId=tmpeco.contractId
        where tmpeof.orderStatusFid in(1,2,6) and (orderStatusFid=1 or tmpel.overHours!=tmpeco.realLessonCount)
         
         
        and tmpeco.contractId!=14929 and tmpeco.clientId=302272\G

# Query 55: 0.00 QPS, 0.00x concurrency, ID 0xA84D5981B9D05DD8 at byte 3314412
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.19
# Time range: 2018-04-17 13:35:06 to 17:51:48
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      13
# Exec time      0     50s      3s      5s      4s      5s   866ms      4s
# Lock time      0     1ms    52us   284us    79us    76us    57us    60us
# Rows sent      0      13       1       1       1       1       0       1
# Rows examine   0  73.96M   5.67M   5.73M   5.69M   5.71M  30.40k   5.44M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0   2.16k     167     179  169.77  174.84    3.51  166.51
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'free_lesson'\G
#    SHOW CREATE TABLE `yimi`.`free_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
				count(0)
			FROM
			free_lesson fl
			 WHERE  EXISTS(select 1 from erp_channel where ufrom>0 and (freeSource=ufrom or ufrom=id) and name like '%百校联盟%')\G

# Query 57: 0.00 QPS, 0.00x concurrency, ID 0x1937B21D3A757C2D at byte 1040309
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.11
# Time range: 2018-04-17 08:54:45 to 17:46:54
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      16
# Exec time      0     44s      2s      4s      3s      4s   542ms      3s
# Lock time      0     6ms   289us   480us   377us   445us    49us   366us
# Rows sent      0      16       1       1       1       1       0       1
# Rows examine   0  30.80M   1.92M   1.97M   1.92M   1.95M  26.91k   1.86M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  62.34k   3.90k   3.90k   3.90k   3.90k       0   3.90k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel_cate'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel_cate`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_channel`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_event'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_event`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
			 temp1.cate1,
			 temp1.cate2,
			 temp1.cate3,
			 temp1.cate4,
			 temp1.cate5,
			 temp1.cate1Fid,
			 temp1.cate2Fid,
			 temp1.cate3Fid,
			 temp1.cate4Fid,
			 temp1.cate5Fid,
			 temp1.levelId,
			  
			 		0 secondChannelId,
					null secondChannel,
					0 firstChannelId,
					null firstChannel,
			 	 
			 temp2.propBFid,
			 sum(temp2.leadsCount) leadsCount,
			 sum(temp2.deadNumberCount) deadNumberCount,
			 sum(temp2.reservationCount) reservationCount,
			 sum(temp2.attendCount) attendCount,
			 sum(temp2.signCount) signCount,
			 sum(temp2.signAmount) signAmount,
			 sum(temp2.leadsToReservation) leadsToReservationAvg,
			 sum(temp2.reservationToAttend) reservationToAttendAvg,
			 sum(temp2.attendToSign) attendToSignAvg,
			 sum(temp2.leadsToSign) leadsToSignAvg
			 from 
			(
				select
					 
						1 levelId,
				 		cate1Fid,
				 		cate1,
					 	0 cate2Fid,
					 	NULL cate2,
					 	0 cate3Fid,
					 	NULL cate3,
					 	0 cate4Fid,
					 	NULL cate4,
					 	0 cate5Fid,
					 	NULL cate5,
				 	 
					 
				 	 
				 	 
				 	 
				 	cateId
				from erp_channel_cate t
				where levelId = 5
				 
				 
				 
				 
				 
			)temp1
			left join (
				select  
					c.cateFid,
					c.id secondChannelId,
					c.name secondChannel,
					c.propBFid,
					c1.id firstChannelId,
					c1.name firstChannel,
					ifnull(leadsCount,0) leadsCount,
					ifnull(deadNumberCount,0) deadNumberCount,
					ifnull(reservationCount,0) reservationCount,
					ifnull(attendCount,0) attendCount,
					ifnull(signCount,0) signCount,
					ifnull(signAmount,0) signAmount,
					ifnull(leadsToReservation,0) leadsToReservation,
					ifnull(reservationToAttend,0) reservationToAttend,
					ifnull(attendToSign,0) attendToSign,
					ifnull(leadsToSign,0) leadsToSign
				from 
				erp_channel c
				join erp_channel c1 on c.pid = c1.id
				join erp_channel_cate ecc on ecc.cateId = c.cateFid
				join (
					select 
						ecc.secondChannelFid,
						ecc.secondChannel,
						ecc.firstChannelFid,
						ecc.firstChannel,
						count(ec.clientId) leadsCount,
						sum(ce.isDeadNumber) deadNumberCount,
						count(reservation.clientFid) reservationCount,
						count(attend.clientFid) attendCount,
						count(sign.clientFid) signCount,
						sum(ifnull(sign.firstContractAmount,0)) signAmount,
						sum(ifnull(dateDiff(reservation.applicationTime,reservation.createTime),0)) leadsToReservation,
						sum(ifnull(dateDiff(attend.attendTime ,attend.applicationTime),0)) reservationToAttend,
						sum(ifnull(dateDiff(sign.firstContractPayTime ,sign.attendTime),0)) attendToSign,
						sum(ifnull(dateDiff(sign.firstContractPayTime ,sign.createTime),0)) leadsToSign
					 from 
						 
						(
							SELECT 
								erp_client_channel.* 
							FROM 
								erp_client_channel 
							JOIN
								(SELECT 
									clientFid,MAX(id) id 
								FROM 
									erp_client_channel
								where 
									isSettle = 1
								group by clientFid) temp
							ON 
								temp.clientFid=erp_client_channel.clientFid AND erp_client_channel.id=temp.id						
						) ecc
						join erp_clients ec on ecc.clientFid = ec.clientId
						join erp_client_event ce on ce.clientFid = ec.clientId
						left join erp_client_event reservation 
							on ce.clientFid = reservation.clientFid 
							and reservation.applicationFid>0 
							 
						left join erp_client_event attend
							on ce.clientFid = attend.clientFid
							and attend.attendLessonFid>0 
							 
						left join erp_client_event sign
							on ce.clientFid = sign.clientFid
							and sign.firstContractFid>0
							 
					where date(ce.createTime) between '2018-04-02' and '2018-04-29' 
							
							and not exists (
								select 1 from user_test ut where ec.studentId = ut.userId and ut.accType = 'STU'
							)
							 
					group by ecc.secondChannelFid
				) temp on c.id = temp.secondChannelFid
				  
			)temp2 on temp1.cateId = temp2.cateFid
			 
			
			 group by temp1.cate1Fid  order by temp1.cate1Fid asc\G

# Query 59: 0.00 QPS, 0.00x concurrency, ID 0x4E36042C05849EC9 at byte 1772207
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.04
# Time range: 2018-04-17 09:12:10 to 23:32:47
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      17
# Exec time      0     39s      2s      3s      2s      3s   306ms      2s
# Lock time      0     1ms    65us    91us    76us    80us     6us    76us
# Rows sent      0     577      24      49   33.94   46.83    9.42   26.08
# Rows examine   0 111.99M   4.66M   9.51M   6.59M   9.30M   1.95M   5.18M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  14.59k     879     879     879     879       0     879
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_series'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_series`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_series_lesson_ref'\G
#    SHOW CREATE TABLE `yimi`.`lvb_series_lesson_ref`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
		l.lessonId,lessonName,playBegin,playEnd,l.orginalPrice,l.currentPrice,entryLimit,img1,img2,r.refNum,
		if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
		WHERE  l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
		(SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount,
		 
		(SELECT if(count(1) =(l.entryLimit-l.entryBase),1,0) FROM lvb_order_lesson ol  WHERE ol.lessonId = l.lessonId) as isFull
		FROM
		lvb_lesson_series ls
		INNER join lvb_series_lesson_ref r on ls.seriesId=r.seriesFid
		INNER join lvb_lesson l  on r.lessonFid=l.lessonId
		left join lvb_lesson_ext le on l.lessonId=le.lessonFid
		where
		ls.seriesId = '135'
		and l.applyFids  like concat('%,',concat(1,',%'))
		and now() >= l.validBegin
		and now()  <=  l.validEnd
		group by l.lessonId\G

# Query 60: 0.00 QPS, 0.00x concurrency, ID 0xF928383DFAECA667 at byte 6295401
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.31
# Time range: 2018-04-17 10:34:35 to 2018-04-18 00:55:44
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      14
# Exec time      0     38s      2s      5s      3s      4s   922ms      2s
# Lock time      0     1ms    85us   121us    99us   113us    12us    93us
# Rows sent      0     368      14      47   26.29   28.75    7.40   24.84
# Rows examine   0   1.98M 122.85k 181.94k 144.73k 150.54k  13.45k 136.54k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  17.16k   1.23k   1.23k   1.23k   1.23k       0   1.23k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_series'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_series`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_series_lesson_ref'\G
#    SHOW CREATE TABLE `yimi`.`lvb_series_lesson_ref`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
		l.lessonId,lessonName,playBegin,playEnd,l.orginalPrice,l.currentPrice,entryLimit,img1,img2,r.refNum,
		if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
		WHERE  l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
		(SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount,
		 
			(SELECT IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=149669 AND o.orderType='L' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,
			IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=149669 AND o.orderType='S' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,0))) isPaid,
		 
		(SELECT if(count(1) =(l.entryLimit-l.entryBase),1,0) FROM lvb_order_lesson ol  WHERE ol.lessonId = l.lessonId) as isFull
		FROM
		lvb_lesson_series ls
		INNER join lvb_series_lesson_ref r on ls.seriesId=r.seriesFid
		INNER join lvb_lesson l  on r.lessonFid=l.lessonId
		left join lvb_lesson_ext le on l.lessonId=le.lessonFid
		where
		ls.seriesId = '136'
		and l.applyFids  like concat('%,',concat(1,',%'))
		and now() >= l.validBegin
		group by l.lessonId\G

# Query 61: 0.00 QPS, 0.00x concurrency, ID 0xB66AF273D4CC2576 at byte 3576654
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.01
# Time range: 2018-04-17 10:06:22 to 17:34:50
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      17
# Exec time      0     38s      2s      2s      2s      2s   153ms      2s
# Lock time      0     2ms    83us   172us   123us   159us    26us   122us
# Rows sent      0      63       0      10    3.71    9.83    4.07    0.99
# Rows examine   0  14.38M 865.35k 868.38k 866.14k 830.38k       0 830.38k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0   9.57k     574     583  576.29  563.87       0  563.87
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
# EXPLAIN /*!50100 PARTITIONS*/
select l.lessonId,if(contractId>0,'订单课','试听课')
		lessonType,concat(DATE_FORMAT(l.startTime, '%Y-%m-%d %k:%i'),'-',DATE_FORMAT(l.endTime, '%k:%i')) lessonTime
		,tu.userRealName teacherName,c.clientName studentName, l.lessonStatus
		from erp_lessons l
		join mis_user_info tu on tu.userId=l.teacherId
		join erp_clients c on c.clientId=l.clientId
		where
		tu.userId=l.teacherId
		and c.clientId=l.clientId
		and date(l.startTime) <= date(now())
		and (l.lessonId='谷曼' or c.clientName='谷曼' or tu.userRealName='谷曼')
		order by l.startTime desc limit 10\G

# Query 63: 1.67 QPS, 6.01x concurrency, ID 0x5B97519418BA5B13 at byte 6722400
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.19
# Time range: 2018-04-17 22:20:23 to 22:20:29
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      10
# Exec time      0     36s      2s      4s      4s      4s   836ms      4s
# Lock time      0     4ms   317us   435us   387us   403us    27us   384us
# Rows sent      0      10       1       1       1       1       0       1
# Rows examine   0   4.34M 444.52k 444.52k 444.52k 444.52k       0 444.52k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  26.09k   2.61k   2.61k   2.61k   2.61k       0   2.61k
# String:
# Databases    yimi
# Hosts        10.31.53.111 (4/40%), 10.28.143.117 (2/20%)... 2 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'server_trail_and_voice'\G
#    SHOW CREATE TABLE `yimi`.`server_trail_and_voice`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,
        l.teacherId,
        l.lessonType,
        l.courseHours,
        date_format(l.startTime,'%Y-%m-%d %H:%i') AS startTime,
        date_format(l.endTime,'%Y-%m-%d %H:%i') AS endTime,
        (case ec.clientName when '' then tui.realName else ec.clientName end) studentName,
        s.subjectName,
        g.gradeName,
        l.lessonStatus,
        timestampdiff(second,now(),l.startTime) remaining,
        timestampdiff(second,l.startTime,l.endTime) lessonSecondCount,
        cast(pre.configValue as signed)*60 beforeSecond,
        cast(aft.configValue as signed)*60 afterSecond,
        if(exists(select 1 from server_trail_and_voice where status=1 and lessonID=l.lessonId),1,0) hasRecord,
        if(exists(select 1 from erp_lesson_docs where parentId=0 and docType=1 and lessonId=l.lessonId),1,0) hasDoc,
        "" AS title,
        "" AS keywords,
        case l.studentAppraiseType when 0 then '未评价' when 1 then '好评' when 2 then '中评' when 3 then '差评' end
        studentAppraiseType,
        studentAppraises
        FROM mis_user_info u
        LEFT JOIN erp_clients ec ON u.userId = ec.chargeFid
        LEFT JOIN mis_user_info u1 ON u1.userId = ec.consultantId
        LEFT JOIN mis_user_info u2 ON u2.userId = ec.cooperateConsultantId
        INNER JOIN erp_lessons l ON ec.studentId = l.studentId
        INNER JOIN t_user_info tui on tui.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
        INNER JOIN www_config pre on pre.configId=1
        INNER JOIN www_config aft on aft.configId=2
        WHERE
        ((u.userOrgFid IN
         (  
            3120100
         ) 
         
            and ec.chargeFid = 900001428
         
        )
        OR (CASE WHEN ec.consultantId!= ec.chargeFid THEN
        u1.userOrgFid IN
         (  
            3120100
         ) 
         
            and ec.consultantId = 900001428
         
        END)
        OR (u2.userOrgFid IN
         (  
            3120100
         ) 
         
            AND ec.cooperateConsultantId = 900001428
         
        ))
         
            and (l.clientId='章凯琪'
            or ec.clientName='章凯琪'
            or l.lessonId='章凯琪'
            or tui.realname='章凯琪'
            )
         
         
         
            AND l.startTime >= '2018-04-16'
         
         
         
        ORDER BY l.lessonStatus,
        CASE WHEN l.lessonStatus in(0) THEN
        l.startTime END,
        CASE WHEN l.lessonStatus in(1) THEN
        l.startTime END desc
        limit 0, 10\G

# Query 68: 0.00 QPS, 0.00x concurrency, ID 0x7A6044C4585A6A8C at byte 2454070
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.05
# Time range: 2018-04-17 12:32:09 to 21:53:13
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      11
# Exec time      0     28s      2s      3s      3s      3s   363ms      2s
# Lock time      0     1ms    88us   120us    98us   113us    10us    93us
# Rows sent      0     332      16      38   30.18   34.95    6.03   31.70
# Rows examine   0   1.73M 126.56k 197.96k 161.30k 192.13k  19.66k 158.07k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  14.73k   1.34k   1.34k   1.34k   1.33k       0   1.33k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_series_lesson_ref'\G
#    SHOW CREATE TABLE `yimi`.`lvb_series_lesson_ref`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_series'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_series`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
	    ls.seriesId,seriesName,l.lessonId,lessonName,playBegin,playEnd,l.orginalPrice,l.currentPrice,entryLimit,img1,img2,
	    if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
	    WHERE  l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
		(SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount,
		 
			(SELECT IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=190542 AND o.orderType='L' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,
			IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=190542 AND o.orderType='S' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,0))) isPaid,
		 
		(SELECT if(count(1) = (l.entryLimit-l.entryBase),1,0) FROM lvb_order_lesson ol  WHERE ol.lessonId = l.lessonId) as isFull
	FROM
	lvb_series_lesson_ref r
	INNER JOIN lvb_lesson_series ls on r.seriesFid=ls.seriesId
	INNER join lvb_lesson l  on r.lessonFid=l.lessonId
		left join lvb_lesson_ext le on l.lessonId=le.lessonFid
	where
	    r.seriesFid IN (SELECT seriesFid FROM  lvb_series_lesson_ref where lessonFid = '3301')
		and l.applyFids  like concat('%,',concat(1,',%'))
		and now() >= l.validBegin
		and now()  <=  l.validEnd
		GROUP BY l.lessonId\G

# Query 72: 0.00 QPS, 0.00x concurrency, ID 0x7096D48A29F00CFF at byte 3148990
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.00
# Time range: 2018-04-17 10:15:34 to 18:35:58
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      12
# Exec time      0     25s      2s      2s      2s      2s    65ms      2s
# Lock time      0     2ms    46us   237us   184us   214us    45us   185us
# Rows sent      0      12       1       1       1       1       0       1
# Rows examine   0   7.47M 636.75k 644.72k 637.82k 619.64k       0 619.64k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  10.02k     848     864  855.33  833.10       0  833.10
# String:
# Databases    yimi
# Hosts        10.80.237.213 (3/25%), 10.81.244.3 (3/25%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_teacher_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_teacher_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        COUNT(1)
        FROM mis_teacher_info u
        INNER JOIN erp_lessons l ON u.subjectIds LIKE CONCAT('%,',l.subjectId,',%')
        INNER JOIN t_user_info tui ON tui.id = l.studentId
        LEFT JOIN erp_clients ec ON ec.studentId = l.studentId
        LEFT JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
        INNER JOIN www_config pre ON pre.configId=1
        INNER JOIN www_config aft ON aft.configId=2
        WHERE u.userFid = 800121389
         
            AND (l.clientId='胡美玲'
            OR ec.clientName='胡美玲'
            OR l.lessonId='胡美玲'
            OR tui.realname='胡美玲'
            )
         
         
         
         
         
            AND ((l.startTime > DATE(NOW()) AND l.lessonStatus=0) OR l.lessonStatus=1)\G

# Query 75: 0.00 QPS, 0.00x concurrency, ID 0x38D31DE66BF3A521 at byte 4823655
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.01
# Time range: 2018-04-17 11:51:43 to 19:15:56
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      10
# Exec time      0     22s      2s      3s      2s      2s   171ms      2s
# Lock time      0     1ms    45us   228us   144us   214us    66us   176us
# Rows sent      0     133       6      19   13.30   18.53    4.31   14.52
# Rows examine   0   8.62M 881.29k 888.97k 883.02k 871.90k       0 871.90k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  14.44k   1.44k   1.45k   1.44k   1.39k       0   1.39k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        erpuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lesson_comment'\G
#    SHOW CREATE TABLE `yimi`.`lesson_comment`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_cr'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_cr`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
				l.*,
				
				IFNULL(c.clientName,t.nickName) studentName,
				mui.userRealName teacherName,
				g.gradeName gradeName,
				s.subjectName subjectName,
				o1.userRealName ccName,
				u1.userRealName chargeName,
				u1.userMobile chargePhone,
				stulc.param1 stuParam1,
				stulc.param2 stuParam2,
				stulc.param3 stuParam3,
				stulc.param4 stuParam4,
				tealc.param1 teaParam1,
				tealc.param2 teaParam2,
				tealc.param3 teaParam3,
				c.eduSystem
		FROM erp_lessons l
		LEFT JOIN erp_clients c ON l.clientId=c.clientId
		LEFT JOIN t_user_info t ON l.studentId=t.id
		LEFT JOIN mis_user_info mui ON mui.userId = l.teacherId
		LEFT JOIN erp_conf_student_grades g ON l.gradeId=g.gradeId
		LEFT JOIN erp_conf_course_subjects s ON l.subjectId=s.subjectId
		LEFT JOIN mis_user_info o1 ON o1.userId = c.consultantId
		LEFT JOIN mis_user_info u1 ON u1.userId=c.chargeFid
		LEFT JOIN lesson_comment stulc ON stulc.lessonFid=l.lessonId and stulc.commentBy='STU'
		LEFT JOIN lesson_comment tealc ON tealc.lessonFid=l.lessonId and tealc.commentBy='TEA'
		 WHERE  l.lessonStatus = 1
			
			
			
			
				
				and (c.clientName like '%丁仁浩%' OR t.nickName like '%丁仁浩%')
			
			
			
			
			
			
			
				and (c.consultantId in (				
				 900001010
	           )
				or EXISTS (select distinct 1 from erp_client_cr t1
				where t1.clientFid=l.clientId and t1.endTime is null
				and t1.crFid in (				
				 900001010
	           ))) 
		order by startTime desc limit 0,20\G
