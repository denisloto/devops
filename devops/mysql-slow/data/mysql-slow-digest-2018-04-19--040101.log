
# A software update is available:
#   * The current version for Percona::Toolkit is 3.0.5


# 3s user time, 30ms system time, 33.11M rss, 242.41M vsz
# Current date: Thu Apr 19 04:01:08 2018
# Hostname: aliyun-hz-hd1-E-bgp-4
# Files: /data/script/mysql-slow-digest/mysql-slow--2018-04-19--040101.log
# Overall: 8.51k total, 183 unique, 0.10 QPS, 0.58x concurrency __________
# Time range: 2018-04-18 04:01:50 to 2018-04-19 04:00:38
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time         50164s      2s    125s      6s     25s     10s      3s
# Lock time            68s     9us     22s     8ms   316us   403ms    98us
# Rows sent        150.34M       0  24.47M  18.09k  918.49 488.31k    1.96
# Rows examine      66.93G       0 242.53M   8.06M  92.12M  23.03M   1.95M
# Rows affecte       1.30M       0  96.63k  159.95       0   3.48k       0
# Query size         7.22M      24  46.94k  889.66   2.76k   1.18k  463.90

# Profile
# Rank Query ID           Response time   Calls R/Call  V/M   Item
# ==== ================== =============== ===== ======= ===== ============
#    1 0x0F3305545EA49428 8135.7448 16.2%  2143  3.7964  4.54 SELECT erp_lesson_book_files mis_user_info erp_lesson_docs
#    2 0x7CB8293C8D8EFAA6 8113.4872 16.2%   268 30.2742  1.45 SELECT lvb_lesson_video lvb_order_lesson lvb_lesson lvb_lesson_ext
#    3 0x597AE1A5E18B09B5 7980.3486 15.9%  2243  3.5579  0.13 SELECT erp_lesson_book_files mis_user_info erp_lesson_docs
#    4 0x4EC8A0DB8530E4CC 5935.2587 11.8%   191 31.0747  1.64 SELECT lvb_lesson_video lvb_order_lesson lvb_lesson lvb_lesson_ext
#    5 0xC8F5044C7E2EADE7 3725.0839  7.4%   109 34.1751 50.01 SELECT erp_lessons erp_conf_course_subjects wx_service_msg
#    6 0x802478FD2EC71668 2186.2969  4.4%   148 14.7723  1.03 INSERT SELECT client_sea erp_clients erp_client_follow erp_follow_status callcenter_outer_log
#    7 0x874AC800CFB0B05C 1847.5686  3.7%   720  2.5661  0.09 SELECT app_notification
#    8 0x5FDDE1EC4813C54F 1172.0131  2.3%    72 16.2780  5.74 SELECT erp_lesson_application erp_lessons erp_conf_course_subjects erp_conf_student_grades wx_service_msg
#    9 0x5188E74C090BF609  926.6297  1.8%   276  3.3574  0.44 SELECT lvb_lesson_video lvb_order_lesson lvb_order lvb_order_lesson lvb_order lvb_order_lesson lvb_lesson_series lvb_series_lesson_ref lvb_lesson lvb_lesson_ext
#   10 0x36D3CB05408B0789  863.8032  1.7%    14 61.7002 25.55 SELECT UNION erp_contract_orders user_test erp_order_flow erp_contract_orders user_test erp_order_flow erp_lessons mis_calendar_month
#   11 0x0924E63A71759FDC  837.0290  1.7%   102  8.2062  0.33 INSERT SELECT client_sea erp_clients erp_client_follow erp_follow_status callcenter_outer_log
#   12 0x9802F83F3C5469D4  687.5044  1.4%   242  2.8409  0.16 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects mis_work_order
#   13 0xAF7087AE5BCF7A6F  502.6618  1.0%   175  2.8724  0.08 SELECT erp_lessons erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects mis_user_info lesson_comment erp_client_cr
#   14 0xC275A476B01092D4  458.6305  0.9%    16 28.6644  1.12 SELECT lvb_lesson_video lvb_order_lesson lvb_lesson lvb_lesson_ext
#   15 0x95FC0D96C9D7A5B1  377.0951  0.8%    11 34.2814 14.75 SELECT UNION erp_contract_pre_orders erp_contract user_test erp_contract_orders user_test erp_order_flow erp_lessons mis_calendar_month
#   16 0x807CEFFF6917F85F  290.8837  0.6%   113  2.5742  0.06 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects mis_work_order
#   17 0xED7DE5AA05230157  275.5670  0.5%   104  2.6497  0.10 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_contract mis_work_order
#   18 0xD824344EA5B63403  272.1624  0.5%   100  2.7216  0.12 SELECT UNION erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_contract_orders erp_contract erp_lessons erp_contract_orders erp_lessons erp_lesson_plan erp_contract_orders teach_lesson_plan mis_work_order
#   19 0x08FE275627AABB49  271.2223  0.5%   115  2.3585  0.07 SELECT erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_lessons mis_work_order erp_student_teach_special
#   20 0xF83D3854B6294F5F  260.9440  0.5%    94  2.7760  0.14 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_contract mis_work_order
#   21 0x2C9AB886E8ACE1D9  225.6000  0.4%    59  3.8237  0.57 SELECT UNION erp_lesson_application erp_conf_student_grades erp_conf_course_subjects mis_user_info server_trail_and_voice erp_lesson_docs erp_teacher_schedule erp_lessons erp_clients lvb_lesson_video lvb_lesson erp_teacher_schedule
#   22 0x984170966838BF4D  217.5785  0.4%    43  5.0600  0.75 SELECT mis_user_info erp_clients mis_user_info erp_lessons t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   23 0x4A078E636F95F53C  217.0319  0.4%    76  2.8557  0.45 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_contract mis_work_order
#   24 0x4B83C48FBD8F9C61  200.6028  0.4%    78  2.5718  0.03 SELECT erp_contract erp_contract_orders erp_lessons user_test erp_contract erp_contract_orders erp_lessons
#   25 0x26476FF6C3C0CA5D  186.1091  0.4%    71  2.6213  0.07 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects erp_contract mis_work_order
#   26 0x4E33A4D16C9051F7  179.2367  0.4%    71  2.5245  0.03 SELECT erp_contract_orders erp_order_flow user_test erp_contract_orders erp_order_flow
#   27 0x9A4B12447FDDD372  152.2110  0.3%    65  2.3417  0.02 SELECT erp_contract_orders erp_order_flow user_test
#   29 0x4E36042C05849EC9  144.6721  0.3%    53  2.7297  0.19 SELECT lvb_lesson_video lvb_order_lesson lvb_lesson_series lvb_series_lesson_ref lvb_lesson lvb_lesson_ext
#   31 0x8DF7748590F106FA  134.2214  0.3%    51  2.6318  0.21 SELECT erp_lessons erp_contract_orders erp_contract erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects mis_work_order
#   33 0x6FF7C208961C02F5  120.1733  0.2%    34  3.5345  0.23 SELECT erp_lessons erp_clients mis_user_info
#   35 0x21B83224C5BD6EDA  106.2265  0.2%    18  5.9015  0.13 SELECT erp_clients mis_user_info erp_client_family t_user_info
#   36 0xD9CFEA53507AC560  101.7833  0.2%    30  3.3928  0.15 SELECT mis_user_info erp_clients mis_user_info erp_lessons t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   38 0xEC2DF1FE33870420   90.9746  0.2%    24  3.7906  0.14 SELECT UNION erp_teacher_schedule mis_teacher_info erp_conf_lesson_schedule_? mis_calendar_week mis_teacher_info erp_timetable erp_conf_timetable mis_teacher_info erp_conf_lesson_schedule_? mis_calendar_week mis_teacher_info erp_timetable erp_conf_timetable
#   39 0x53E68A2F4F0BCA83   83.5025  0.2%    25  3.3401  0.77 SELECT erp_clients erp_client_follow erp_follow_status
#   40 0x7A6044C4585A6A8C   73.4047  0.1%    22  3.3366  0.42 SELECT lvb_lesson_video lvb_order_lesson lvb_order lvb_order_lesson lvb_order lvb_order_lesson lvb_series_lesson_ref lvb_lesson_series lvb_lesson lvb_lesson_ext lvb_series_lesson_ref
#   41 0xC4EDC64AF48E3254   70.2458  0.1%    35  2.0070  0.00 SELECT erp_contract_orders erp_order_flow erp_lessons
#   44 0xD8D08DA009DE195E   54.8682  0.1%    20  2.7434  0.25 SELECT mis_work_order erp_contract_orders erp_contract erp_clients mis_user_info erp_order_status erp_lessons erp_learn_report user_test
#   45 0x8FC934C0FB674018   54.5331  0.1%    12  4.5444  0.41 SELECT erp_channel_cate erp_channel erp_channel_cate erp_client_channel erp_clients erp_client_event user_test
#   46 0xA84D5981B9D05DD8   54.2409  0.1%    13  4.1724  0.14 SELECT free_lesson erp_channel
#   47 0x7146E02EEE59AD24   52.6063  0.1%    19  2.7688  0.20 SELECT erp_contract_orders erp_contract erp_clients mis_user_info erp_lessons erp_learn_report user_test
#   48 0xF5FEACC32429CC03   51.1238  0.1%    15  3.4083  0.46 SELECT server_trail_and_voice erp_lesson_docs mis_user_info erp_clients mis_user_info erp_lessons t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   50 0x7DCA8A8076898D63   48.2577  0.1%    18  2.6810  0.13 SELECT mis_work_order erp_contract_orders erp_contract erp_clients mis_user_info erp_order_status erp_lessons erp_learn_report user_test
#   51 0xB66AF273D4CC2576   48.1948  0.1%    21  2.2950  0.10 SELECT erp_lessons mis_user_info erp_clients
#   53 0xBC6AD8511E5DCBAA   47.2230  0.1%    16  2.9514  0.08 SELECT server_trail_and_voice erp_lesson_docs mis_user_info erp_clients mis_user_info erp_lessons t_user_info erp_conf_course_subjects erp_conf_student_grades www_config
#   56 0x2E7AC79FAFA8B5C7   42.4305  0.1%    16  2.6519  0.10 SELECT erp_contract_orders erp_contract erp_clients mis_user_info erp_lessons erp_learn_report user_test
#   58 0x9F41075C48CFAA92   39.3343  0.1%    17  2.3138  0.01 SELECT erp_lessons erp_clients t_user_info mis_user_info erp_conf_student_grades erp_conf_course_subjects mis_user_info lesson_comment erp_client_cr
#   61 0x6BC7D5D7388C71CF   34.4584  0.1%    12  2.8715  0.62 UPDATE SELECT client_data_pool erp_channel
#   66 0x398D07B3BB5A793E   31.1534  0.1%    13  2.3964  0.03 DELETE SELECT erp_teacher_schedule erp_lessons
#   67 0x1937B21D3A757C2D   30.5367  0.1%    11  2.7761  0.14 SELECT erp_channel_cate erp_channel erp_channel_cate erp_client_channel erp_clients erp_client_event user_test
#   69 0xF928383DFAECA667   27.4314  0.1%    10  2.7431  0.22 SELECT lvb_lesson_video lvb_order_lesson lvb_order lvb_order_lesson lvb_order lvb_order_lesson lvb_lesson_series lvb_series_lesson_ref lvb_lesson lvb_lesson_ext
# MISC 0xMISC             2123.6142  4.2%   284  7.4775   0.0 <133 ITEMS>

# Query 1: 0.03 QPS, 0.13x concurrency, ID 0x0F3305545EA49428 at byte 356916
# This item is included in the report because it matches --limit.
# Scores: V/M = 4.54
# Time range: 2018-04-18 08:03:01 to 2018-04-19 01:50:14
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         25    2143
# Exec time     16   8136s      3s    101s      4s      5s      4s      3s
# Lock time      0   243ms    17us    50ms   113us   144us     1ms    93us
# Rows sent      0   2.09k       0       1    1.00    0.99    0.02    0.99
# Rows examine   6   4.21G   3.22k   2.01M   2.01M   1.95M  43.09k   1.95M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     9 686.64k     324     338  328.10  329.68       7  329.68
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        erpuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+  #
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_book_files'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_book_files`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT count(*) FROM erp_lesson_book_files b LEFT JOIN mis_user_info mui ON mui.userId = b.operator LEFT JOIN (SELECT t.fileId, COUNT(DISTINCT t.lessonId) importCnt FROM erp_lesson_docs t WHERE t.parentId = 0 AND t.fileId != 0 GROUP BY t.fileId) t1 ON t1.fileId = b.fileId WHERE catalogCode LIKE '%qwcjba/qfioct/%' AND parentId = 0\G

# Query 2: 0.00 QPS, 0.12x concurrency, ID 0x7CB8293C8D8EFAA6 at byte 6882257
# This item is included in the report because it matches --limit.
# Scores: V/M = 1.45
# Time range: 2018-04-18 06:09:26 to 2018-04-19 00:32:37
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          3     268
# Exec time     16   8113s     21s     45s     30s     40s      7s     29s
# Lock time      0    15ms    26us   228us    54us    66us    24us    49us
# Rows sent      0 248.04k     944     949  947.74  918.49       0  918.49
# Rows examine  36  24.63G  93.56M  94.31M  94.12M  92.12M       0  92.12M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     4 301.50k   1.12k   1.12k   1.12k   1.12k       0   1.12k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,lessonName,playBegin,playEnd,orginalPrice,currentPrice,entryLimit,img1,img2,
        if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
        WHERE l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
        (SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount
        FROM
        lvb_lesson l left join lvb_lesson_ext le on l.lessonId = le.lessonFid
        where
        (
          
             
              
                1=1
             
          
        )
        and
        (
          
             
              
                1=1
             
          
        )
        and
        (
          
             
             
             
              
                1=1
             
          
        )
        and
        (
          
             
             
              
                1=1
             
          
        )
        and l.applyFids  like concat('%',concat(1,'%'))
        and now() >= l.validBegin
        and now()  <=  l.validEnd
        group by l.lessonId\G

# Query 3: 0.04 QPS, 0.12x concurrency, ID 0x597AE1A5E18B09B5 at byte 3137465
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.13
# Time range: 2018-04-18 08:03:48 to 2018-04-19 01:50:16
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         26    2243
# Exec time     15   7980s      3s     11s      4s      5s   677ms      3s
# Lock time      0   224ms    18us    14ms    99us   152us   385us    89us
# Rows sent      0  24.96k       0      50   11.39   19.46    7.36    9.83
# Rows examine   6   4.41G   2.01M   2.01M   2.01M   1.95M       0   1.95M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size    14   1.03M     476     491  480.17  487.09    5.67  463.90
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        erpuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+  #
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_book_files'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_book_files`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT b.*,mui.userRealName operatorName,
			
			t1.importCnt
			FROM
						erp_lesson_book_files b
			LEFT JOIN mis_user_info mui on mui.userId = b.operator	
			LEFT JOIN (
				SELECT t.fileId,COUNT(DISTINCT t.lessonId) importCnt
						FROM erp_lesson_docs t
						WHERE t.parentId = 0 AND t.fileId != 0
						GROUP BY t.fileId 
			) t1 ON t1.fileId=b.fileId
		 WHERE catalogCode like '%yxjrlx/%' and parentId = 0 
		order by fileStatus desc,
		 
		createTime desc limit 0,20\G

# Query 4: 0.00 QPS, 0.08x concurrency, ID 0x4EC8A0DB8530E4CC at byte 5363246
# This item is included in the report because it matches --limit.
# Scores: V/M = 1.64
# Time range: 2018-04-18 05:37:33 to 2018-04-19 02:48:18
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2     191
# Exec time     11   5935s     21s     45s     31s     42s      7s     29s
# Lock time      0    52ms    32us    10ms   274us   366us   723us   247us
# Rows sent      0 176.67k     944     949  947.18  918.49       0  918.49
# Rows examine  26  17.54G  93.56M  94.32M  94.04M  92.12M       0  92.12M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     9 704.13k   3.69k   3.69k   3.69k   3.69k       0   3.69k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,lessonName,playBegin,playEnd,orginalPrice,currentPrice,entryLimit,img1,img2,
        if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
        WHERE l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
        (SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount
        FROM
        lvb_lesson l left join lvb_lesson_ext le on l.lessonId = le.lessonFid
        where
        (
          
              
                subjectIds like concat (concat('%','1'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','2'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','3'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','4'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','5'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','6'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','7'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','8'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','9'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','13'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','16'),'%')
             
             
          
        )
        and
        (
          
              
                termIds like concat (concat('%','130'),'%')
             
             
         
             or 
                termIds like concat (concat('%','140'),'%')
             
             
         
             or 
                termIds like concat (concat('%','150'),'%')
             
             
         
             or 
                termIds like concat (concat('%','160'),'%')
             
             
         
             or 
                termIds like concat (concat('%','170'),'%')
             
             
         
             or 
                termIds like concat (concat('%','210'),'%')
             
             
         
             or 
                termIds like concat (concat('%','220'),'%')
             
             
         
             or 
                termIds like concat (concat('%','230'),'%')
             
             
         
             or 
                termIds like concat (concat('%','240'),'%')
             
             
         
             or 
                termIds like concat (concat('%','310'),'%')
             
             
         
             or 
                termIds like concat (concat('%','320'),'%')
             
             
         
             or 
                termIds like concat (concat('%','330'),'%')
             
             
         
             or 
                termIds like concat (concat('%','410'),'%')
             
             
          
        )
        and
        (
          
             
             
             
              
                1=1
             
          
        )
        and
        (
          
             
             
              
                1=1
             
          
        )
        and l.applyFids  like concat('%',concat(1,'%'))
        and now() >= l.validBegin
        and now()  <=  l.validEnd
        group by l.lessonId\G

# Query 5: 0.00 QPS, 0.05x concurrency, ID 0xC8F5044C7E2EADE7 at byte 9500286
# This item is included in the report because it matches --limit.
# Scores: V/M = 50.01
# Time range: 2018-04-18 05:02:01 to 2018-04-19 03:02:06
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     109
# Exec time      7   3725s      2s    125s     34s    118s     41s     12s
# Lock time      0     5ms    19us   140us    49us    76us    19us    44us
# Rows sent      0  11.51k       5     740  108.14  400.73  146.25   34.95
# Rows examine   8   5.94G   2.44M 242.53M  55.79M 221.69M  70.88M  18.41M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1  75.24k     703     707  706.85  685.39    0.00  685.39
# String:
# Databases    yimi
# Hosts        10.80.58.47 (27/24%), 10.81.244.3 (22/20%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ###########################################
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'wx_service_msg'\G
#    SHOW CREATE TABLE `yimi`.`wx_service_msg`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
			lesson_temp.startTime,
			lesson_temp.endTime,
			lesson_temp.lessonId,
			lesson_temp.teacherId,
			lesson_temp.studentId,
			eccs.subjectName
		from
			(select els.startTime,
					els.endTime,
					els.subjectId,
					els.teacherId,
					els.studentId,
					els.lessonId
			from erp_lessons els
			where els.lessonType=10 and els.lessonStatus=0 and els.startTime   >=   NOW()
			and els.startTime   <=   '2018-04-20 03:00:01.786000') as lesson_temp
		left join erp_conf_course_subjects eccs on eccs.subjectId=lesson_temp.subjectId
		left join wx_service_msg wsm on wsm.bizFid=lesson_temp.lessonId and wsm.bizType='LESSON'
		and wsm.bizTimeType='1D' and wsm.userType='STU'
		where wsm.tId is null\G

# Query 6: 0.00 QPS, 0.03x concurrency, ID 0x802478FD2EC71668 at byte 426487
# This item is included in the report because it matches --limit.
# Scores: V/M = 1.03
# Time range: 2018-04-18 04:10:15 to 2018-04-19 04:00:11
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     148
# Exec time      4   2186s      9s     34s     15s     20s      4s     15s
# Lock time      0    32ms   151us     1ms   219us   273us    71us   204us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   1   1.26G   3.94M  10.69M   8.71M  10.25M   2.71M   9.76M
# Rows affecte  10 144.53k    1000    1000    1000    1000       0    1000
# Query size     2 216.51k   1.46k   1.46k   1.46k   1.46k       0   1.46k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ###########
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'client_sea'\G
#    SHOW CREATE TABLE `yimi`.`client_sea`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_follow'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_follow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_follow_status'\G
#    SHOW CREATE TABLE `yimi`.`erp_follow_status`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'callcenter_outer_log'\G
#    SHOW CREATE TABLE `yimi`.`callcenter_outer_log`\G
insert IGNORE client_sea(clientFid, clientSea, flag, clientType, viewTime, latestFollowTime)
        SELECT ec.clientId,ec.clientSea,ec.flag,ec.clientType ,ec.viewTime,ifnull(ecf.createdOn,now()) from erp_clients ec
        left join(
             
                    select max(id) id,clientFid,count(0) followNum,max(createdOn) createdOn from erp_client_follow
                        where followStatusFid in(select statusId from erp_follow_status where type like '%,CC,%') GROUP BY clientFid
             
        ) ecf
        on ecf.clientFid=ec.clientId
         WHERE ec.clientSea='P' and ec.clientType = 'C' and ec.viewTime<=now() and ec.flag is not null
            and not exists(select 1 from callcenter_outer_log where ec.clientId=callcenter_outer_log.clientFid and createdOn>date_add(now(),INTERVAL -120 MINUTE))
            and ec.phoneNo REGEXP '^[0]?[1][3456789][0-9]{9}$'
            and not exists(select 1 from callcenter_outer_log where ec.clientId=callcenter_outer_log.clientFid and createdOn>date_add(now(),INTERVAL -120 MINUTE))
            
             and date(ec.createdOnTime) >='2016-01-01'
             and date(ec.createdOnTime) <='2018-03-20'
            
            
            and ec.secondChannelFid not in(27001,21006,27006,21001,21002,39003,27008,27005,27004,21005,39001,39004,39002,21004,39010,39009,21003,39012,39005,39006/*... omitted 10 items ...*/) 
        ORDER BY ec.topTimes>0 desc,ec.viewTime asc
        LIMIT 1000\G

# Query 7: 0.01 QPS, 0.02x concurrency, ID 0x874AC800CFB0B05C at byte 7580990
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.09
# Time range: 2018-04-18 04:02:04 to 2018-04-19 04:00:04
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          8     720
# Exec time      3   1848s      2s      4s      3s      3s   468ms      2s
# Lock time      0    35ms     9us    11ms    49us    80us   394us    23us
# Rows sent      0  75.90k       1     810  107.94  537.02  181.36   17.65
# Rows examine   1   1.19G   1.69M   1.69M   1.69M   1.69M       0   1.69M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 201.80k     287     287     287     287       0     287
# String:
# Databases    yimi
# Hosts        10.28.143.117 (142/19%), 10.80.58.47 (140/19%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'app_notification'\G
#    SHOW CREATE TABLE `yimi`.`app_notification`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT nId, bizType,userFid,relateId,displayType,title,msg,sound,goActivity,appSysInfo,appVersion,appDeviceInfo,isSend,sendTimes,thirdMsgId,isRead,status,createdOn,lastUpdatedOn,umengAppKey,appSource,userName
		FROM  app_notification
		WHERE isSend=0	AND sendTimes < 5 and NOW()<deadline\G

# Query 8: 0.00 QPS, 0.01x concurrency, ID 0x5FDDE1EC4813C54F at byte 7605371
# This item is included in the report because it matches --limit.
# Scores: V/M = 5.74
# Time range: 2018-04-18 05:00:21 to 2018-04-19 04:00:22
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      72
# Exec time      2   1172s      2s     35s     16s     30s     10s     18s
# Lock time      0     4ms    26us   132us    61us    80us    16us    60us
# Rows sent      0   4.83k       9     116   68.76  112.70   38.62   92.72
# Rows examine   2   1.68G   2.75M  38.91M  23.93M  36.45M  13.75M  34.72M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  57.23k     811     814  813.96  793.42       0  793.42
# String:
# Databases    yimi
# Hosts        10.28.143.117 (15/20%), 10.31.53.111 (13/18%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ######################################
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_application'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_application`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'wx_service_msg'\G
#    SHOW CREATE TABLE `yimi`.`wx_service_msg`\G
# EXPLAIN /*!50100 PARTITIONS*/
select msg_temp.startTime,
		msg_temp.teacherId,
		msg_temp.studentId,
		msg_temp.endTime,
		msg_temp.applicationId,
		eccs.subjectName,
		ecsg.gradeName
		from 
			(select ela.applicationId,
			ela.subjectFid,
			els.startTime,
			els.endTime,
			els.teacherId,
			els.studentId,
			els.gradeId 
			from erp_lesson_application ela
			join erp_lessons els on ela.lessonId=els.lessonId
			where els.startTime   >=   NOW() and els.startTime   <=   '2018-04-19 21:00:01.430000') as msg_temp
		left join erp_conf_course_subjects eccs on eccs.subjectId=msg_temp.subjectFid
		left join erp_conf_student_grades ecsg on ecsg.gradeId=msg_temp.gradeId
		left join wx_service_msg wsm on wsm.bizFid=msg_temp.applicationId and wsm.bizType='APPLICATION' 
		and wsm.bizTimeType='1D' and wsm.userType='TEA'
		where wsm.tId is null\G

# Query 9: 0.00 QPS, 0.01x concurrency, ID 0x5188E74C090BF609 at byte 6327651
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.44
# Time range: 2018-04-18 05:36:32 to 2018-04-19 00:36:19
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          3     276
# Exec time      1    927s      2s      8s      3s      6s      1s      3s
# Lock time      0    28ms    69us   402us   101us   125us    39us    93us
# Rows sent      0   8.31k      14      50   30.82   49.17    9.57   26.08
# Rows examine   0 111.21M 123.40k  12.49M 412.61k 182.98k   1.46M 143.37k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     4 345.81k   1.25k   1.25k   1.25k   1.25k       0   1.25k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_series'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_series`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_series_lesson_ref'\G
#    SHOW CREATE TABLE `yimi`.`lvb_series_lesson_ref`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
		l.lessonId,lessonName,playBegin,playEnd,l.orginalPrice,l.currentPrice,entryLimit,img1,img2,r.refNum,
		if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
		WHERE  l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
		(SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount,
		 
			(SELECT IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=192306 AND o.orderType='L' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,
			IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=192306 AND o.orderType='S' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,0))) isPaid,
		 
		(SELECT if(count(1) =(l.entryLimit-l.entryBase),1,0) FROM lvb_order_lesson ol  WHERE ol.lessonId = l.lessonId) as isFull
		FROM
		lvb_lesson_series ls
		INNER join lvb_series_lesson_ref r on ls.seriesId=r.seriesFid
		INNER join lvb_lesson l  on r.lessonFid=l.lessonId
		left join lvb_lesson_ext le on l.lessonId=le.lessonFid
		where
		ls.seriesId = '134'
		and l.applyFids  like concat('%,',concat(1,',%'))
		and now() >= l.validBegin
		and now()  <=  l.validEnd
		group by l.lessonId\G

# Query 10: 0.00 QPS, 0.04x concurrency, ID 0x36D3CB05408B0789 at byte 2077337
# This item is included in the report because it matches --limit.
# Scores: V/M = 25.55
# Time range: 2018-04-18 09:05:37 to 15:54:22
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      14
# Exec time      1    864s     15s    105s     62s    102s     40s     97s
# Lock time      0     3ms   159us   278us   214us   273us    39us   204us
# Rows sent      0     233       0      56   16.64   54.21   22.61    6.98
# Rows examine   0  63.43M      21   9.59M   4.53M   9.30M   4.44M   8.43M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  19.58k   1.40k   1.40k   1.40k   1.40k       0   1.40k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_order_flow'\G
#    SHOW CREATE TABLE `yimi`.`erp_order_flow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_calendar_month'\G
#    SHOW CREATE TABLE `yimi`.`mis_calendar_month`\G
# EXPLAIN /*!50100 PARTITIONS*/
select  
          ck, 
        sum(expSubjectCount) expSubjectCount from (
         
         
            select 
            teacherId ck,count(0) expSubjectCount from erp_contract_orders
            where date(createTime) between '2018-04-02' and
            '2018-04-15'
            and studentId not in(select userId
            from user_test where accType='STU')
            and teachProp=2
            and exists(select 1
            from erp_order_flow where memo = '新建订单' and
            orderFid=contractId)
             
            group by ck
         
        union all
        select o.subjectId ck,count(distinct subjectId,studentId) expSubjectCount
        from erp_contract_orders o
        where date(createTime) between '2018-04-02' and
        '2018-04-15'
        and studentId not in(select userId
        from user_test where accType='STU')
         
        and originLessonCount>=30
        and
        teachProp=2
        and exists(select 1 from erp_order_flow where memo like
        '由订单%' and
        orderFid=contractId)
        and exists(select 1 from erp_lessons
        where lessonStatus in(1,3,4)
        and startTime  < 
        date_add((select monthEnd from `mis_calendar_month` where date(createTime)
        between monthStart and monthEnd),interval 1
        day)
        and contractId=o.contractId)
          and subjectId=2 
        group by ck) a 
        group by ck\G

# Query 11: 0.00 QPS, 0.01x concurrency, ID 0x0924E63A71759FDC at byte 3744716
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.33
# Time range: 2018-04-18 04:10:22 to 23:50:22
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     102
# Exec time      1    837s      6s     15s      8s     11s      2s      7s
# Lock time      0    19ms   111us     2ms   181us   204us   209us   152us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0 371.89M   3.64M   3.66M   3.65M   3.50M       0   3.50M
# Rows affecte   0   1.00k       1      91   10.06   20.43   16.22    4.96
# Query size     1  91.54k     919     919     919     919       0     919
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+  #############
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'client_sea'\G
#    SHOW CREATE TABLE `yimi`.`client_sea`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_follow'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_follow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_follow_status'\G
#    SHOW CREATE TABLE `yimi`.`erp_follow_status`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'callcenter_outer_log'\G
#    SHOW CREATE TABLE `yimi`.`callcenter_outer_log`\G
insert IGNORE client_sea(clientFid, clientSea, flag, clientType, viewTime, latestFollowTime)
        SELECT ec.clientId,ec.clientSea,ec.flag,ec.clientType ,ec.viewTime,ifnull(ecf.createdOn,now()) from erp_clients ec
        left join(select max(createdOn) createdOn,clientFid,count(0) followNum from erp_client_follow
            where followStatusFid in(select statusId from erp_follow_status where  type like '%,CC,%') GROUP BY clientFid
        )
         ecf
        on ecf.clientFid=ec.clientId
        where
            ec.clientSea='P' and ec.clientType in ('R','N') and ec.viewTime <= now() and ec.flag is not null
            and ec.phoneNo REGEXP '^[0]?[1][3456789][0-9]{9}$'
            and not exists(select 1 from callcenter_outer_log where ec.clientId=callcenter_outer_log.clientFid and createdOn>date_add(now(),INTERVAL -120 MINUTE))
        ORDER BY ec.topTimes>0 desc,ec.viewTime asc
        LIMIT 1000\G

# Query 12: 0.00 QPS, 0.01x concurrency, ID 0x9802F83F3C5469D4 at byte 2301219
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.16
# Time range: 2018-04-18 04:10:07 to 2018-04-19 04:00:07
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2     242
# Exec time      1    688s      2s      7s      3s      4s   680ms      3s
# Lock time      0    52ms   141us   308us   216us   260us    36us   214us
# Rows sent      0      25       0       3    0.10    0.99    0.41       0
# Rows examine   0 513.18M   2.12M   2.13M   2.12M   2.05M       0   2.05M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     4 314.79k   1.30k   1.30k   1.30k   1.30k       0   1.30k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) > DATE(now())
		) t on l.clientId = t.clientId and l.startTime = t.startTime
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 22
		and co.contractProp = 1
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid)\G

# Query 13: 0.00 QPS, 0.01x concurrency, ID 0xAF7087AE5BCF7A6F at byte 2922789
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.08
# Time range: 2018-04-18 09:08:34 to 23:09:05
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2     175
# Exec time      1    503s      2s      4s      3s      4s   481ms      3s
# Lock time      0    29ms    39us     2ms   165us   236us   147us   167us
# Rows sent      0   3.11k       0     100   18.22   80.10   23.07   10.84
# Rows examine   0 168.64M 550.25k 1012.71k 986.81k 1009.33k  68.92k 961.27k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     3 245.09k   1.39k   1.46k   1.40k   1.39k   18.27   1.39k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        erpuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lesson_comment'\G
#    SHOW CREATE TABLE `yimi`.`lesson_comment`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_cr'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_cr`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
				l.*,
				
				IFNULL(c.clientName,t.nickName) studentName,
				mui.userRealName teacherName,
				g.gradeName gradeName,
				s.subjectName subjectName,
				o1.userRealName ccName,
				u1.userRealName chargeName,
				u1.userMobile chargePhone,
				stulc.param1 stuParam1,
				stulc.param2 stuParam2,
				stulc.param3 stuParam3,
				stulc.param4 stuParam4,
				tealc.param1 teaParam1,
				tealc.param2 teaParam2,
				tealc.param3 teaParam3,
				c.eduSystem
		FROM erp_lessons l
		LEFT JOIN erp_clients c ON l.clientId=c.clientId
		LEFT JOIN t_user_info t ON l.studentId=t.id
		LEFT JOIN mis_user_info mui ON mui.userId = l.teacherId
		LEFT JOIN erp_conf_student_grades g ON l.gradeId=g.gradeId
		LEFT JOIN erp_conf_course_subjects s ON l.subjectId=s.subjectId
		LEFT JOIN mis_user_info o1 ON o1.userId = c.consultantId
		LEFT JOIN mis_user_info u1 ON u1.userId=c.chargeFid
		LEFT JOIN lesson_comment stulc ON stulc.lessonFid=l.lessonId and stulc.commentBy='STU'
		LEFT JOIN lesson_comment tealc ON tealc.lessonFid=l.lessonId and tealc.commentBy='TEA'
		 WHERE  (c.clientName like '%马郭文%' OR t.nickName like '%马郭文%')
			
			
			
			
			
			
			
				and (c.consultantId in (				
				 900000982
	           )
				or EXISTS (select distinct 1 from erp_client_cr t1
				where t1.clientFid=l.clientId and t1.endTime is null
				and t1.crFid in (				
				 900000982
	           ))) 
		order by startTime desc limit 20,20\G

# Query 14: 0.00 QPS, 0.01x concurrency, ID 0xC275A476B01092D4 at byte 8933866
# This item is included in the report because it matches --limit.
# Scores: V/M = 1.12
# Time range: 2018-04-18 07:42:54 to 23:24:15
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      16
# Exec time      0    459s     21s     41s     29s     39s      6s     27s
# Lock time      0     2ms    35us   328us   113us   236us    87us    54us
# Rows sent      0  14.80k     944     948  947.50  918.49       0  918.49
# Rows examine   2   1.47G  93.56M  94.30M  94.14M  92.12M       0  92.12M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  48.08k   3.00k   3.00k   3.00k   3.00k       0   3.00k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,lessonName,playBegin,playEnd,orginalPrice,currentPrice,entryLimit,img1,img2,
        if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
        WHERE l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
        (SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount
        FROM
        lvb_lesson l left join lvb_lesson_ext le on l.lessonId = le.lessonFid
        where
        (
          
              
                subjectIds like concat (concat('%','1'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','2'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','3'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','7'),'%')
             
             
         
             or 
                subjectIds like concat (concat('%','8'),'%')
             
             
          
        )
        and
        (
          
              
                termIds like concat (concat('%','130'),'%')
             
             
         
             or 
                termIds like concat (concat('%','140'),'%')
             
             
         
             or 
                termIds like concat (concat('%','150'),'%')
             
             
         
             or 
                termIds like concat (concat('%','160'),'%')
             
             
         
             or 
                termIds like concat (concat('%','170'),'%')
             
             
         
             or 
                termIds like concat (concat('%','210'),'%')
             
             
         
             or 
                termIds like concat (concat('%','220'),'%')
             
             
         
             or 
                termIds like concat (concat('%','230'),'%')
             
             
         
             or 
                termIds like concat (concat('%','240'),'%')
             
             
         
             or 
                termIds like concat (concat('%','310'),'%')
             
             
         
             or 
                termIds like concat (concat('%','320'),'%')
             
             
         
             or 
                termIds like concat (concat('%','330'),'%')
             
             
         
             or 
                termIds like concat (concat('%','410'),'%')
             
             
          
        )
        and
        (
          
             
             
             
              
                1=1
             
          
        )
        and
        (
          
             
             
              
                1=1
             
          
        )
        and l.applyFids  like concat('%',concat(1,'%'))
        and now() >= l.validBegin
        and now()  <=  l.validEnd
        group by l.lessonId\G

# Query 15: 0.00 QPS, 0.01x concurrency, ID 0x95FC0D96C9D7A5B1 at byte 2067521
# This item is included in the report because it matches --limit.
# Scores: V/M = 14.75
# Time range: 2018-04-18 10:24:01 to 22:41:31
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      11
# Exec time      0    377s     15s     70s     34s     66s     22s     20s
# Lock time      0     2ms   161us   261us   199us   236us    32us   194us
# Rows sent      0      49       0       9    4.45    8.91    4.25    6.40
# Rows examine   0     158       0      29   14.36   28.75   13.72   20.65
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  14.27k   1.30k   1.30k   1.30k   1.30k       0   1.30k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_pre_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_pre_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_order_flow'\G
#    SHOW CREATE TABLE `yimi`.`erp_order_flow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_calendar_month'\G
#    SHOW CREATE TABLE `yimi`.`mis_calendar_month`\G
# EXPLAIN /*!50100 PARTITIONS*/
select   ck, 
         
        sum(expSubjectCount) expSubjectCount from (
         select subjectFid ck,count(0) expSubjectCount from
            erp_contract_pre_orders right join erp_contract on contractFid=contractId
            where
            date(payTime) between '2018-04-02' and '2018-04-15'
            and studentFid not in(select userId from user_test where
            accType='STU')
            and contractProp=2
             
            group by ck
         
         
        union all
        select o.subjectId ck,count(distinct subjectId,studentId) expSubjectCount
        from erp_contract_orders o
        where date(createTime) between '2018-04-02' and
        '2018-04-15'
        and studentId not in(select userId
        from user_test where accType='STU')
         
        and originLessonCount>=30
        and
        teachProp=2
        and exists(select 1 from erp_order_flow where memo like
        '由订单%' and
        orderFid=contractId)
        and exists(select 1 from erp_lessons
        where lessonStatus in(1,3,4)
        and startTime  < 
        date_add((select monthEnd from `mis_calendar_month` where date(createTime)
        between monthStart and monthEnd),interval 1
        day)
        and contractId=o.contractId)
         
        group by ck) a 
        group by ck\G

# Query 16: 0.00 QPS, 0.00x concurrency, ID 0x807CEFFF6917F85F at byte 1880798
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.06
# Time range: 2018-04-18 06:40:10 to 2018-04-19 04:00:12
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     113
# Exec time      0    291s      2s      5s      3s      3s   393ms      2s
# Lock time      0    28ms   170us   337us   250us   301us    44us   247us
# Rows sent      0      46       0      11    0.41    3.89    1.51       0
# Rows examine   0  82.15M 710.07k 778.04k 744.44k 753.18k  33.98k 753.18k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 173.95k   1.54k   1.54k   1.54k   1.53k       0   1.53k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,
		t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,
		i.userRealName teacherName,l.gradeId gradeFid,g.gradeName,round(timestampdiff(DAY,t.startTime,now())/7,0) workFlag
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) >  DATE_SUB(now(),INTERVAL 30 DAY)
		) t on l.startTime = t.startTime and l.clientId = t.clientId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		JOIN erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 11
		and timestampdiff(DAY,t.startTime,now())%7 = 0
		and timestampdiff(DAY,t.startTime,now()) > 0
		and co.contractProp = 1
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid and workFlag = round(timestampdiff(DAY,t.startTime,now())/7,0))\G

# Query 17: 0.00 QPS, 0.00x concurrency, ID 0xED7DE5AA05230157 at byte 1359084
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.10
# Time range: 2018-04-18 04:10:16 to 2018-04-19 04:00:14
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     104
# Exec time      0    276s      2s      4s      3s      3s   520ms      3s
# Lock time      0    25ms   166us   337us   243us   301us    40us   224us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0 230.35M   2.21M   2.22M   2.21M   2.15M       0   2.15M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 154.38k   1.48k   1.48k   1.48k   1.48k       0   1.48k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName,1 workFlag
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) =  DATE_SUB(now(),INTERVAL 30 DAY)
		) t on l.startTime = t.startTime and l.clientId = t.clientId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 12
		and co.gradeFid not in (160,230,330)
		and co.contractProp = 1
		and exists(select 1 from erp_contract ec where ec.clientFid = c.clientId and ec.contractStatus=3)
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid and workFlag = 1)\G

# Query 18: 0.00 QPS, 0.00x concurrency, ID 0xD824344EA5B63403 at byte 3132247
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.12
# Time range: 2018-04-18 04:10:05 to 2018-04-19 04:00:03
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     100
# Exec time      0    272s      2s      6s      3s      4s   560ms      3s
# Lock time      0   206ms   297us    51ms     2ms   541us     8ms   467us
# Rows sent      0      99       0      19    0.99    4.96    2.81       0
# Rows examine   0  32.37M  62.69k 903.90k 331.52k 871.90k 377.54k  62.55k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     4 309.47k   3.09k   3.09k   3.09k   3.09k       0   3.09k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_plan'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_plan`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'teach_lesson_plan'\G
#    SHOW CREATE TABLE `yimi`.`teach_lesson_plan`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo contractNo,o.contractId orderFid,0 lessonFid,
		o.subjectId subjectFid,s.subjectName,o.teacherId teacherFid,i.userRealName teacherName,o.gradeId gradeFid,g.gradeName,round(temp.completeCount/5,0) workFlag
		from erp_contract_orders o
		join erp_contract co on co.contractId = o.contractFid
		join erp_clients c on o.clientId = c.clientId
		join t_user_info t on o.studentId = t.id
		join mis_user_info i on o.teacherId = i.userId
		join erp_conf_student_grades g on o.gradeId = g.gradeId
		join erp_conf_course_subjects s on o.subjectId = s.subjectId
		join (
		SELECT o.contractFid,o.teacherId,o.subjectId,o.clientId,sum(tmp.lessonCount) lessonCount,sum(tmp.lessonNum) completeCount
		from erp_contract_orders o
		JOIN erp_contract ec on o.contractFid = ec.contractId
		JOIN (
		SELECT contractId,sum(courseHours) lessonCount,count(contractId) lessonNum FROM erp_lessons
		WHERE lessonStatus = 1
		AND contractId>0
		GROUP BY contractId
		) tmp on o.contractId = tmp.contractId
		GROUP BY o.teacherId,o.subjectId,o.clientId
		HAVING sum(tmp.lessonNum)%5 = 0
		AND sum(tmp.lessonNum)>0
		
		)temp on o.clientId = temp.clientId and o.teacherId = temp.teacherId and o.subjectId = temp.subjectId
		JOIN (
		select tm.clientId,tm.teacherId,tm.subjectId,sum(renainLessonCount) renainLessonCount
		from (
		select o.contractId,o.clientId,o.teacherId,o.subjectId,(o.realLessonCount - ifnull(sum(l.courseHours),0)) renainLessonCount
		from erp_contract_orders o left JOIN erp_lessons l on o.contractId = l.contractId
		where l.lessonStatus in (1,3,4)
		GROUP BY o.contractId
		) tm GROUP BY tm.clientId,tm.teacherId,tm.subjectId
		) tmp on o.subjectId = tmp.subjectId and o.teacherId = tmp.teacherId and o.clientId = tmp.clientId 
		left join (
		select teacherId,subjectId,clientId,sum(planCount) planCount from (
		select o.teacherId,o.subjectId,o.clientId,round(count(p.planId)/5,0) planCount
		from erp_lesson_plan p
		JOIN erp_contract_orders o on p.contractId = o.contractId
		where o.teacherId>0
		GROUP BY o.teacherId,o.subjectId,o.clientId
		UNION ALL
		SELECT teacherFid teacherId,subjectFid subjectId,clientFid clientId,count(id) planCount
		FROM teach_lesson_plan
		GROUP BY teacherFid,subjectFid,clientFid
		) tmp
		GROUP BY teacherId,subjectId,clientId
		) tm on o.subjectId = tm.subjectId and o.teacherId = tm.teacherId and o.clientId = tm.clientId 
		,mis_work_order_config w
		where
		w.configId = 9
		and not exists(select 1 from mis_work_order o1 where o1.configFid = w.configId
		AND o1.clientFid = o.clientId
		AND o1.subjectFid = o.subjectId
		AND o1.teacherFid = o.teacherId
		and workFlag = round(temp.completeCount/5,0))
		and o.contractFid != o.contractId
		and o.contractId>0
		and tmp.renainLessonCount >0 
		and round(temp.completeCount/5,0) > (ifnull(planCount,0)-1) 
		GROUP BY o.clientId,o.subjectId,o.teacherId\G

# Query 19: 0.00 QPS, 0.00x concurrency, ID 0x08FE275627AABB49 at byte 2293513
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.07
# Time range: 2018-04-18 06:40:06 to 2018-04-19 03:10:07
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1     115
# Exec time      0    271s      2s      4s      2s      3s   394ms      2s
# Lock time      0    31ms   175us   359us   269us   316us    40us   273us
# Rows sent      0       7       0       4    0.06       0    0.45       0
# Rows examine   0  86.49M 769.19k 771.76k 770.11k 753.18k       0 753.18k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 185.53k   1.61k   1.61k   1.61k   1.61k       0   1.61k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_student_teach_special'\G
#    SHOW CREATE TABLE `yimi`.`erp_student_teach_special`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo contractNo,o.contractId orderFid,temp.lessonId lessonFid,
		o.subjectId subjectFid,s.subjectName,o.teacherId teacherFid,i.userRealName teacherName,o.gradeId gradeFid,g.gradeName
		from erp_contract_orders o
		join erp_contract co on co.contractId = o.contractFid
		join erp_clients c on o.clientId = c.clientId
		join t_user_info t on o.studentId = t.id
		join mis_user_info i on o.teacherId = i.userId
		join erp_conf_student_grades g on o.gradeId = g.gradeId
		join erp_conf_course_subjects s on o.subjectId = s.subjectId
		join (
		select
		contractId,l.lessonId
		from erp_lessons l,
		(
		select
		clientId,subjectId,teacherid,max(startTime) startTime
		from erp_lessons
		where lessonStatus=1
		AND startTime > date_sub(now(),INTERVAL 30 DAY)
		and lessonType=10
		GROUP BY subjectId,clientId,teacherId
		HAVING timestampdiff(day,max(startTime),now())= 28
		) ll
		where l.clientId=ll.clientId
		and l.subjectId=ll.subjectId
		and l.teacherId=ll.teacherId
		and l.startTime=ll.startTime
		) temp on o.contractId = temp.contractId
		,mis_work_order_config w
		where
		w.configId = 20
		and o.orderStatus = 2
		and not exists(select 1 from mis_work_order wo where wo.configFid = w.configId and wo.lessonFid = temp.lessonId)
		and not exists(select 1 from erp_student_teach_special s where c.clientId = s.clientFid)\G

# Query 20: 0.00 QPS, 0.00x concurrency, ID 0xF83D3854B6294F5F at byte 8281612
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.14
# Time range: 2018-04-18 04:10:21 to 2018-04-19 04:00:18
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1      94
# Exec time      0    261s      2s      5s      3s      4s   619ms      3s
# Lock time      0    22ms   164us   567us   236us   287us    52us   224us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0 208.52M   2.22M   2.22M   2.22M   2.15M       0   2.15M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 139.16k   1.48k   1.48k   1.48k   1.48k       0   1.48k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName,1 workFlag
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) =  DATE_SUB(now(),INTERVAL 30 DAY)
		) t on l.startTime = t.startTime and l.clientId = t.clientId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 14
		and co.gradeFid in (160,230,330)
		and co.contractProp = 1
		and exists(select 1 from erp_contract ec where ec.clientFid = c.clientId and ec.contractStatus=3)
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid and workFlag = 1)\G

# Query 21: 0.00 QPS, 0.00x concurrency, ID 0x2C9AB886E8ACE1D9 at byte 6669402
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.57
# Time range: 2018-04-18 07:50:35 to 23:26:15
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      59
# Exec time      0    226s      2s      9s      4s      7s      1s      3s
# Lock time      0    19ms    52us   493us   315us   445us   139us   332us
# Rows sent      0   5.76k      36     154  100.05  151.03   26.72   88.31
# Rows examine   0       0       0       0       0       0       0       0
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     2 164.84k   2.79k   2.79k   2.79k   2.76k    0.00   2.76k
# String:
# Databases    yimi
# Hosts        10.28.143.117 (15/25%), 10.80.58.47 (15/25%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_application'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_application`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'server_trail_and_voice'\G
#    SHOW CREATE TABLE `yimi`.`server_trail_and_voice`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_teacher_schedule'\G
#    SHOW CREATE TABLE `yimi`.`erp_teacher_schedule`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
# EXPLAIN /*!50100 PARTITIONS*/
(SELECT
		tsche.lessonId,
		tsche.teacherId,
		TIMESTAMPDIFF(DAY,'2018-04-02',tsche.lessonDate) as dateId,
		(tsche.scheduleId -1) as scheduleId,
		if((tsche.isFree = 0 ),'V',tsche.relateType) as relateType,
		(CASE lessons.lessonType
		WHEN  1 THEN  "A"
		WHEN  0  THEN  "A"
		WHEN  10  THEN  "O"
		WHEN  11  THEN  "O"
		ELSE tsche.relateType
		END
		) as lessonType,
		lessons.startTime,
		lessons.endTime,
		lessons.lessonStatus,
		lessons.courseHours,
		lessons.clientId AS clientNo,
		"" AS lessonName,
		if((lessons.lessonType = 0 || lessons.lessonType = 1),(SELECT applicationId FROM erp_lesson_application WHERE lessonId = tsche.lessonId),lessons.contractId) AS contractNo,
		(SELECT gradeName FROM erp_conf_student_grades  WHERE gradeId = lessons.gradeId)     AS grade,
		(SELECT subjectName FROM erp_conf_course_subjects WHERE subjectId = lessons.subjectId) AS subject,
		clients.clientName   AS name,
		(SELECT userRealName FROM mis_user_info WHERE userId = clients.chargeFid) as chargeName,
		(SELECT userMobile  FROM mis_user_info WHERE userId = clients.chargeFid) as chargeMobile,
		clients.clientName   AS parentRealName,
		clients.phoneNo   AS parentContactInfo,
		(select IF(COUNT(1)>0,1,0) from server_trail_and_voice WHERE  lessonId = tsche.lessonId) as hasRecord,
		(select IF(COUNT(1)>0,1,0) from erp_lesson_docs WHERE docType = 1 and lessonId = tsche.lessonId) as hasCourseware
		FROM erp_teacher_schedule tsche
		LEFT JOIN  erp_lessons lessons
		ON lessons.lessonId = tsche.lessonId
		LEFT JOIN erp_clients clients ON lessons.clientId = clients.clientId
		WHERE
		(tsche.relateType = 'V'  OR tsche.relateType = 'O' OR tsche.relateType = 'A')
		AND
		tsche.teacherId = 900000569
		AND
		tsche.lessonDate  BETWEEN '2018-04-02' AND '2018-04-08'
		ORDER BY
		tsche.lessonDate
		)
		UNION ALL
		(
		SELECT
		tsche.lessonId,
		tsche.teacherId,
		TIMESTAMPDIFF(DAY,'2018-04-02',tsche.lessonDate) as dateId,
		(tsche.scheduleId -1) as scheduleId,
		tsche.relateType,
		'L' as lessonType,
		lessons.playBegin as startTime,
		lessons.playEnd  as endTime,
		lessons.lessonName,
		if(now()  <=  lessons.playBegin ,0,if(lessons.streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v WHERE  tsche.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as lessonStatus,
		0     AS courseHours,
		""    AS clientNo,
		""    AS contractNo,
		lessons.termIds    AS grade,
		lessons.subjectIds    AS subject,
		""    AS name,
		""    AS chargeName,
		""    AS chargeMobile,
		""    AS parentRealName,
		""    AS parentContactInfo,
		0     AS hasRecord,
		0     AS hasCourseware
		FROM lvb_lesson lessons
		LEFT JOIN  erp_teacher_schedule tsche ON lessons.lessonId = tsche.lessonId
		WHERE
		tsche.relateType = 'L'
		AND
		tsche.teacherId = 900000569
		AND
		tsche.lessonDate  BETWEEN '2018-04-02' AND '2018-04-08'
		ORDER BY tsche.lessonDate
		)\G

# Query 22: 0.00 QPS, 0.01x concurrency, ID 0x984170966838BF4D at byte 6224310
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.75
# Time range: 2018-04-18 13:20:06 to 20:21:08
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      43
# Exec time      0    218s      2s      8s      5s      7s      2s      6s
# Lock time      0     5ms    51us   237us   118us   194us    40us   103us
# Rows sent      0      43       1       1       1       1       0       1
# Rows examine   0  35.77M 833.89k 887.76k 851.82k 871.90k  19.07k 830.38k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  51.06k   1.19k   1.19k   1.19k   1.19k       0   1.19k
# String:
# Databases    yimi
# Hosts        10.81.244.3 (11/25%), 10.80.58.47 (10/23%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        COUNT(1)
        FROM mis_user_info u
        LEFT JOIN erp_clients ec ON u.userId = ec.chargeFid
        LEFT JOIN mis_user_info u1 ON u1.userId = ec.consultantId
        LEFT JOIN mis_user_info u2 ON u2.userId = ec.cooperateConsultantId
        INNER JOIN erp_lessons l ON ec.studentId = l.studentId
        INNER JOIN t_user_info tui on tui.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
        INNER JOIN www_config pre on pre.configId=1
        INNER JOIN www_config aft on aft.configId=2
        WHERE
        ((u.userOrgFid IN
         (  
            6040100
         ) 
         
            and ec.chargeFid = 900001484
         
        )
        OR (CASE WHEN ec.consultantId!= ec.chargeFid THEN
        u1.userOrgFid IN
         (  
            6040100
         ) 
         
            and ec.consultantId = 900001484
         
        END)
        OR (u2.userOrgFid IN
         (  
            6040100
         ) 
         
            AND ec.cooperateConsultantId = 900001484
         
        ))
         
         
         
            AND l.startTime >= '2018-04-11'\G

# Query 23: 0.00 QPS, 0.00x concurrency, ID 0x4A078E636F95F53C at byte 5460554
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.45
# Time range: 2018-04-18 04:10:23 to 2018-04-19 04:00:20
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      76
# Exec time      0    217s      2s     10s      3s      4s      1s      3s
# Lock time      0    21ms   188us   436us   273us   348us    48us   273us
# Rows sent      0     102       0     100    1.34       0   11.09       0
# Rows examine   0  60.75M 816.77k 826.32k 818.46k 790.84k       0 790.84k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 122.16k   1.61k   1.61k   1.61k   1.61k       0   1.61k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName,round((datediff(now(),l.startTime)-30)/7,0)+1 workFlag
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) < DATE_SUB(now(),INTERVAL 30 DAY)
		) t on l.startTime = t.startTime and l.clientId = t.clientId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 15
		and co.gradeFid in (160,230,330)
		and co.contractProp = 1
		and exists(select 1 from erp_contract ec where ec.clientFid = c.clientId and ec.contractStatus=3)
		and (datediff(now(),l.startTime)-30)%7=0
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid and workFlag = round((datediff(now(),l.startTime)-30)/7,0)+1)\G

# Query 24: 0.00 QPS, 0.00x concurrency, ID 0x4B83C48FBD8F9C61 at byte 893117
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.03
# Time range: 2018-04-18 09:24:32 to 21:18:53
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      78
# Exec time      0    201s      2s      3s      3s      3s   273ms      3s
# Lock time      0    16ms   131us   298us   210us   260us    36us   204us
# Rows sent      0      78       1       1       1       1       0       1
# Rows examine   0  80.92M   1.03M   1.05M   1.04M   1.03M   8.21k   1.03M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1  98.87k   1.27k   1.27k   1.27k   1.27k       0   1.27k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
        count(distinct
        clientFid) finishClientCount from erp_contract co
        inner join
        (select
        o.contractFid,max(startTime)
        startTime,sum(courseHours) courseHours
        from erp_contract_orders o
        ,(select contractId,max(startTime)
        startTime,sum(courseHours)
        courseHours from
        erp_lessons
        where
        lessonStatus in(1,3,4) group by contractId) l
        where o.contractId=l.contractId
        group by o.contractFid) oo
        on
        co.contractId=oo.contractFid and co.contractFlag='N'
        where
        date(startTime) between '2018-03-23' and
        '2018-03-23'
        and co.totalLessonCount=courseHours
        and studentFid not in(select userId
        from user_test where accType='STU')
        and co.clientFid not in(select clientId from erp_contract coo,erp_contract_orders
        o
        left join (select contractId,sum(courseHours) courseHours
        from erp_lessons
        where contractId>0 and lessonStatus in(1,3,4) and startTime < date_add('2018-03-23',interval
        1 day) group by contractId) l on o.contractId=l.contractId
        where
        o.contractFid=coo.contractId
        and coo.payTime < '2018-03-23'
        and ifnull(l.courseHours,0)!=realLessonCount)\G

# Query 25: 0.00 QPS, 0.00x concurrency, ID 0x26476FF6C3C0CA5D at byte 6427328
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.07
# Time range: 2018-04-18 04:10:18 to 2018-04-19 03:30:15
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      71
# Exec time      0    186s      2s      5s      3s      3s   440ms      3s
# Lock time      0    20ms   194us   368us   280us   348us    45us   287us
# Rows sent      0     166       0     163    2.34       0   18.68       0
# Rows examine   0  52.24M 752.25k 757.64k 753.43k 753.18k   2.70k 717.31k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 114.68k   1.62k   1.62k   1.62k   1.62k       0   1.62k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName,round((datediff(now(),l.startTime)-30)/14,0)+1 workFlag
		FROM erp_lessons l
		JOIN (
		select clientId,min(startTime) startTime from erp_lessons WHERE lessonStatus = 1 and lessonType = 10 GROUP BY clientId HAVING min(startTime) <  DATE_SUB(now(),INTERVAL 30 DAY)
		) t on l.startTime = t.startTime and l.clientId = t.clientId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 13
		and co.gradeFid not in (160,230,330)
		and co.contractProp = 1
		and exists(select 1 from erp_contract ec where ec.clientFid = c.clientId and ec.contractStatus=3)
		and (datediff(now(),l.startTime)-30)%14=0
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid and workFlag = round((datediff(now(),l.startTime)-30)/14,0)+1)\G

# Query 26: 0.00 QPS, 0.00x concurrency, ID 0x4E33A4D16C9051F7 at byte 984218
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.03
# Time range: 2018-04-18 09:24:55 to 21:13:32
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      71
# Exec time      0    179s      2s      3s      3s      3s   284ms      3s
# Lock time      0    13ms   128us   590us   182us   224us    54us   167us
# Rows sent      0      71       1       1       1       1       0       1
# Rows examine   0  86.45M   1.19M   1.25M   1.22M   1.20M  19.44k   1.20M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1  76.75k   1.08k   1.08k   1.08k   1.08k       0   1.08k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_order_flow'\G
#    SHOW CREATE TABLE `yimi`.`erp_order_flow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
select count(distinct clientId) pauseStudentCount from
        erp_contract_orders o,(
        select
        ff.orderFid,orderStatusFid from
        erp_order_flow ff ,(select orderFid,
        max(createdOn) createdOn from
        erp_order_flow
        where createdOn < date_add('2018-04-13',interval
        1 day) and orderStatusFid>0 group by orderFid) fff where ff.createdOn=fff.createdOn and
        ff.orderFid=fff.orderFid) f
        where o.contractId=f.orderFid and
        f.orderStatusFid in(6)
        and studentId
        not
        in(select userId from user_test)
        and clientId not
        in(select clientId
        from
        erp_contract_orders o,(
        select
        ff.orderFid,orderStatusFid from
        erp_order_flow ff ,(select orderFid,
        max(createdOn) createdOn from
        erp_order_flow
        where createdOn < date_add('2018-04-13',interval
        1 day) and orderStatusFid>0 group by orderFid) fff where ff.createdOn=fff.createdOn and
        ff.orderFid=fff.orderFid) f
        where o.contractId=f.orderFid and
        f.orderStatusFid in(1,2))\G

# Query 27: 0.00 QPS, 0.00x concurrency, ID 0x9A4B12447FDDD372 at byte 987022
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.02
# Time range: 2018-04-18 09:25:06 to 21:18:59
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      65
# Exec time      0    152s      2s      3s      2s      3s   203ms      2s
# Lock time      0    13ms    90us     4ms   201us   176us   500us   131us
# Rows sent      0      65       1       1       1       1       0       1
# Rows examine   0  68.24M   1.05M   1.05M   1.05M   1.03M       0   1.03M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  44.88k     707     707     707     707       0     707
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_order_flow'\G
#    SHOW CREATE TABLE `yimi`.`erp_order_flow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
select count(distinct subjectId,studentId) pendingSubjectOrderCount
        from
        erp_contract_orders o,(
        select
        ff.orderFid,ff.orderStatusFid,ff.createdOn from erp_order_flow
        ff,(select orderFid,max(createdOn) createdOn from erp_order_flow
        where
        createdOn < date_add('2018-04-13',interval
        1 day) and orderStatusFid>0 group by orderFid)
        fff where ff.orderFid=fff.orderFid and
        ff.createdOn=fff.createdOn and ff.orderFid=fff.orderFid) f
        where
        o.contractId=f.orderFid
        and
        orderStatusFid in(1,2,6)
        and studentId
        not
        in(select
        userId from
        user_test where accType='STU')\G

# Query 29: 0.00 QPS, 0.00x concurrency, ID 0x4E36042C05849EC9 at byte 5743580
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.19
# Time range: 2018-04-18 07:41:30 to 2018-04-19 02:40:17
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      53
# Exec time      0    145s      2s      5s      3s      4s   711ms      2s
# Lock time      0     4ms    53us   224us    84us    98us    24us    80us
# Rows sent      0   1.94k      24      50   37.53   49.17   10.33   42.48
# Rows examine   0 388.30M   4.68M   9.78M   7.33M   9.30M   2.04M   8.03M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  45.50k     879     879     879     879       0     879
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_series'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_series`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_series_lesson_ref'\G
#    SHOW CREATE TABLE `yimi`.`lvb_series_lesson_ref`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
		l.lessonId,lessonName,playBegin,playEnd,l.orginalPrice,l.currentPrice,entryLimit,img1,img2,r.refNum,
		if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
		WHERE  l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
		(SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount,
		 
		(SELECT if(count(1) =(l.entryLimit-l.entryBase),1,0) FROM lvb_order_lesson ol  WHERE ol.lessonId = l.lessonId) as isFull
		FROM
		lvb_lesson_series ls
		INNER join lvb_series_lesson_ref r on ls.seriesId=r.seriesFid
		INNER join lvb_lesson l  on r.lessonFid=l.lessonId
		left join lvb_lesson_ext le on l.lessonId=le.lessonFid
		where
		ls.seriesId = '134'
		and l.applyFids  like concat('%,',concat(1,',%'))
		and now() >= l.validBegin
		and now()  <=  l.validEnd
		group by l.lessonId\G

# Query 31: 0.00 QPS, 0.00x concurrency, ID 0x8DF7748590F106FA at byte 3128289
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.21
# Time range: 2018-04-18 04:10:04 to 23:50:02
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      51
# Exec time      0    134s      2s      6s      3s      4s   735ms      2s
# Lock time      0   111ms   110us    51ms     2ms   273us    10ms   185us
# Rows sent      0      12       0       2    0.24    0.99    0.54       0
# Rows examine   0  47.96M 957.75k 967.84k 963.02k 961.27k   5.04k 961.27k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  63.50k   1.25k   1.25k   1.25k   1.25k       0   1.25k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
		w.configId configFid,w.configType,w.configChildType,w.configPriority,
		w.configDeadline,w.configName,w.configContent configContent,w.configObject,w.configRemind,
		0 sendByFid,'系统' sendBy,1 status,
		c.clientId clientFid,c.clientName,c.studentId studentFid,t.realName studentName,co.contractId contractFid,co.contractNo,o.contractId orderFid,l.lessonId lessonFid,
		l.subjectId subjectFid,s.subjectName,l.teacherId teacherFid,i.userRealName teacherName,l.gradeId gradeFid,g.gradeName
		FROM erp_lessons l
		join (
		select clientId,min(lessonId) lessonId from erp_lessons WHERE lessonType = 10 GROUP BY clientId
		) t on l.lessonId = t.lessonId
		JOIN erp_contract_orders o on o.contractId = l.contractId
		JOIN erp_contract co on co.contractId = o.contractFid
		join erp_clients c on l.clientId = c.clientId
		left join t_user_info t on c.studentId = t.id
		left join mis_user_info i on l.teacherId = i.userId
		left join erp_conf_student_grades g on l.gradeId = g.gradeId
		left join erp_conf_course_subjects s on l.subjectId = s.subjectId
		,mis_work_order_config w
		where
		w.configId = 7
		and l.createTime > DATE(now())
		and co.contractProp = 1
		and not exists(select 1 from mis_work_order o where o.configFid = w.configId and l.lessonId = o.lessonFid)\G

# Query 33: 0.01 QPS, 0.02x concurrency, ID 0x6FF7C208961C02F5 at byte 3016368
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.23
# Time range: 2018-04-18 13:56:21 to 15:16:33
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      34
# Exec time      0    120s      2s      6s      4s      5s   908ms      3s
# Lock time      0     3ms    50us   131us    80us   119us    22us    73us
# Rows sent      0       5       0       1    0.15    0.99    0.35       0
# Rows examine   0  43.94M 836.05k   1.37M   1.29M   1.32M 184.95k   1.32M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  17.67k     524     549  532.09  537.02   11.96  511.45
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
# EXPLAIN /*!50100 PARTITIONS*/
select el.lessonId,el.lessonStatus,el.lessonType,el.startTime,el.endTime,el.teacherId,
        mui.userRealName teacherName,el.studentId,ec.clientName studentName from erp_lessons el
        LEFT JOIN erp_clients ec on ec.clientId=el.clientId
        LEFT JOIN mis_user_info mui on mui.userId=el.teacherId
        where
        (mui.userRealName='999851' or ec.clientName='999851'
        or (el.clientId='999851' and 1=1) or mui.userMobile='999851' or ec.phoneNo='999851')
        ORDER BY el.startTime desc
        LIMIT 1\G

# Query 35: 0.00 QPS, 0.01x concurrency, ID 0x21B83224C5BD6EDA at byte 1311773
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.13
# Time range: 2018-04-18 10:00:49 to 14:05:03
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      18
# Exec time      0    106s      5s      7s      6s      7s   886ms      5s
# Lock time      0     2ms    72us   134us   105us   131us    18us   108us
# Rows sent      0       8       0       2    0.44    0.99    0.59       0
# Rows examine   0  15.58M 885.75k 886.55k 886.07k 871.90k       0 871.90k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  10.11k     575     575     575     575       0     575
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_family'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_family`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
# EXPLAIN /*!50100 PARTITIONS*/
select distinct ec.clientId, ec.clientName, ec.phoneNo, ec.studentId, ec.consultantId, ec.chargeFid, u1.userRealName ccName, u2.userRealName crName
		from erp_clients ec
		left join mis_user_info u1 on ec.consultantId = u1.userId
		left join mis_user_info u2 on ec.chargeFid = u2.userId
		left join erp_client_family f on ec.clientId = f.clientFid
		left join t_user_info t on ec.studentId = t.id and (t.accountType = 0 or t.accountType = 1)
		 WHERE (ec.phoneNo = '13854603678' or ec.clientName = '13854603678' or familyPhoneNo = '13854603678' or t.mobileNo = '13854603678')\G

# Query 36: 0.00 QPS, 0.00x concurrency, ID 0xD9CFEA53507AC560 at byte 7138110
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.15
# Time range: 2018-04-18 10:25:54 to 22:14:08
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      30
# Exec time      0    102s      2s      6s      3s      5s   719ms      3s
# Lock time      0     6ms    58us   300us   186us   260us    67us   214us
# Rows sent      0      30       1       1       1       1       0       1
# Rows examine   0  58.70M   1.96M   1.96M   1.96M   1.95M       0   1.95M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  59.30k   1.98k   1.98k   1.98k   1.98k       0   1.98k
# String:
# Databases    yimi
# Hosts        10.81.244.3 (9/30%), 10.80.58.47 (7/23%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        COUNT(1)
        FROM mis_user_info u
        LEFT JOIN erp_clients ec ON u.userId = ec.chargeFid
        LEFT JOIN mis_user_info u1 ON u1.userId = ec.consultantId
        LEFT JOIN mis_user_info u2 ON u2.userId = ec.cooperateConsultantId
        INNER JOIN erp_lessons l ON ec.studentId = l.studentId
        INNER JOIN t_user_info tui on tui.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
         INNER JOIN www_config pre on pre.configId=1
         INNER JOIN www_config aft on aft.configId=2
        WHERE
        l.lessonStatus = 1 and
        ((u.userOrgFid IN
         (  
            3070100
         ) 
         
            and ec.chargeFid = 900001363
         
        )
        OR (CASE WHEN ec.consultantId!= ec.chargeFid THEN
        u1.userOrgFid IN
         (  
            3070100
         ) 
         
            and ec.consultantId = 900001363
         
        END)
        OR (u2.userOrgFid IN
         (  
            3070100
         ) 
         
            AND ec.cooperateConsultantId = 900001363
         
        ))
         
         
        	and l.subjectId in
	         (  
	            0
	         , 
	            1
	         , 
	            2
	         , 
	            3
	         , 
	            4
	         , 
	            5
	         , 
	            6
	         , 
	            7
	         , 
	            8
	         , 
	            9
	         , 
	            13
	         , 
	            16
	         ) 
         
         
        	and l.gradeId in
	         (  
	            130
	         , 
	            140
	         , 
	            150
	         , 
	            160
	         , 
	            170
	         , 
	            210
	         , 
	            220
	         , 
	            230
	         , 
	            240
	         , 
	            310
	         , 
	            320
	         , 
	            330
	         , 
	            410
	         )\G

# Query 38: 0.00 QPS, 0.00x concurrency, ID 0xEC2DF1FE33870420 at byte 5884037
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.14
# Time range: 2018-04-18 10:55:13 to 22:23:07
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      24
# Exec time      0     91s      3s      5s      4s      5s   716ms      4s
# Lock time      0    12ms   361us   704us   503us   657us   104us   541us
# Rows sent      0   3.61k     154     154     154     154       0     154
# Rows examine   0  98.52M   4.09M   4.12M   4.11M   4.06M       0   4.06M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     1 103.59k   4.32k   4.32k   4.32k   4.32k       0   4.32k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_teacher_schedule'\G
#    SHOW CREATE TABLE `yimi`.`erp_teacher_schedule`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_teacher_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_teacher_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_lesson_schedule_201609'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_lesson_schedule_201609`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_calendar_week'\G
#    SHOW CREATE TABLE `yimi`.`mis_calendar_week`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_timetable'\G
#    SHOW CREATE TABLE `yimi`.`erp_timetable`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_timetable'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_timetable`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT temp.lessonDate,temp.scheduleId,GROUP_CONCAT(teacherIds) teacherIds FROM
		(

			SELECT lessonDate,scheduleId,CONCAT(',',(GROUP_CONCAT(DISTINCT teacherId)),',') teacherIds FROM erp_teacher_schedule
			WHERE lessonId > 0
			 
				AND lessonDate BETWEEN '2018-04-18' and DATE_ADD('2018-04-18',INTERVAL 6 DAY)
			 
			 
			GROUP BY lessonDate,scheduleId
			 
				UNION
				SELECT lessonDate,scheduleId,(SELECT CONCAT(',',GROUP_CONCAT(mti1.userFid),',') FROM mis_teacher_info mti1 WHERE mti1.teacherType=1 and mti1.isTeach = 1 AND NOT
				FIND_IN_SET(mti1.userFid,IFNULL(teacherIds,''))) teacherIds
					from(
					select  b.scheduleId,b.date lessonDate,temp.teacherIds from (
				    select a.scheduleId,t.date from erp_conf_lesson_schedule_201609 a,(
				      select w.date from mis_calendar_week w where w.date between (select subdate('2018-04-18',if(date_format('2018-04-18','%w')=0,7,date_format('2018-04-18','%w'))-1)) and date_add((select subdate('2018-04-18',if(date_format('2018-04-18','%w')=0,7,date_format('2018-04-18','%w'))-1)),INTERVAL 6 DAY)
				    ) t
				  ) b
				  left join (
				  select et.scheduleId scheduleId,date_format(date_add((select subdate('2018-04-18',if(date_format('2018-04-18','%w')=0,7,date_format('2018-04-18','%w'))-1)),INTERVAL (IF(et.dayOfWeek=1,6,et.dayOfWeek-2)) DAY),'%Y-%m-%d') lessonDate ,
				         CONCAT(',',GROUP_CONCAT(mti.userFid),',') teacherIds
				  from
				    mis_teacher_info mti,erp_timetable et
				  where
				    (
				      exists(select 1 from erp_conf_timetable tmpect
				      where tmpect.relatedFid=mti.timetableFid and  et.timetableFid=tmpect.timetableId
				            and (select subdate('2018-04-18',if(date_format('2018-04-18','%w')=0,7,date_format('2018-04-18','%w'))-1)) between tmpect.beginDate and tmpect.endDate)
				      or (
				        not exists(select 1 from erp_conf_timetable tmpect where tmpect.relatedFid=mti.timetableFid and (select subdate('2018-04-18',if(date_format('2018-04-18','%w')=0,7,date_format('2018-04-18','%w'))-1)) between tmpect.beginDate and tmpect.endDate)
				        and et.timetableFid=mti.timetableFid
				      )
				    )
				    AND mti.teacherType=1 and mti.isTeach = 1
					 
				  GROUP BY lessonDate,scheduleId
				)temp on b.scheduleId = temp.scheduleId and b.date = temp.lessonDate
					
					) t
			 
			 
				UNION
				SELECT lessonDate,scheduleId,(SELECT CONCAT(',',GROUP_CONCAT(mti1.userFid),',') FROM mis_teacher_info mti1 WHERE mti1.teacherType=1 and mti1.isTeach = 1 AND NOT
				FIND_IN_SET(mti1.userFid,IFNULL(teacherIds,''))) teacherIds
					from(
					select  b.scheduleId,b.date lessonDate,temp.teacherIds from (
				    select a.scheduleId,t.date from erp_conf_lesson_schedule_201609 a,(
				      select w.date from mis_calendar_week w where w.date between (select subdate('2018-04-23',if(date_format('2018-04-23','%w')=0,7,date_format('2018-04-23','%w'))-1)) and date_add((select subdate('2018-04-23',if(date_format('2018-04-23','%w')=0,7,date_format('2018-04-23','%w'))-1)),INTERVAL 6 DAY)
				    ) t
				  ) b
				  left join (
				  select et.scheduleId scheduleId,date_format(date_add((select subdate('2018-04-23',if(date_format('2018-04-23','%w')=0,7,date_format('2018-04-23','%w'))-1)),INTERVAL (IF(et.dayOfWeek=1,6,et.dayOfWeek-2)) DAY),'%Y-%m-%d') lessonDate ,
				         CONCAT(',',GROUP_CONCAT(mti.userFid),',') teacherIds
				  from
				    mis_teacher_info mti,erp_timetable et
				  where
				    (
				      exists(select 1 from erp_conf_timetable tmpect
				      where tmpect.relatedFid=mti.timetableFid and  et.timetableFid=tmpect.timetableId
				            and (select subdate('2018-04-23',if(date_format('2018-04-23','%w')=0,7,date_format('2018-04-23','%w'))-1)) between tmpect.beginDate and tmpect.endDate)
				      or (
				        not exists(select 1 from erp_conf_timetable tmpect where tmpect.relatedFid=mti.timetableFid and (select subdate('2018-04-23',if(date_format('2018-04-23','%w')=0,7,date_format('2018-04-23','%w'))-1)) between tmpect.beginDate and tmpect.endDate)
				        and et.timetableFid=mti.timetableFid
				      )
				    )
				    AND mti.teacherType=1 and mti.isTeach = 1
					 
				  GROUP BY lessonDate,scheduleId
				)temp on b.scheduleId = temp.scheduleId and b.date = temp.lessonDate

					) t
			 
		) temp
		where lessonDate BETWEEN '2018-04-18' and DATE_ADD('2018-04-18',INTERVAL 6 DAY)
		GROUP BY lessonDate,scheduleId\G

# Query 39: 0.00 QPS, 0.00x concurrency, ID 0x53E68A2F4F0BCA83 at byte 3138742
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.77
# Time range: 2018-04-18 09:30:02 to 23:00:02
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      25
# Exec time      0     84s      2s     10s      3s      5s      2s      3s
# Lock time      0    55ms   100us    50ms     2ms   194us     9ms   144us
# Rows sent      0      25       1       1       1       1       0       1
# Rows examine   0   9.34M 382.10k 383.38k 382.53k 380.41k       0 380.41k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  17.48k     716     716     716     716       0     716
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+  ##
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_follow'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_follow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_follow_status'\G
#    SHOW CREATE TABLE `yimi`.`erp_follow_status`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
			   ifnull(sum(if(ec.flag in('A1','A2'),1,0)),0) AClientNum,
			   ifnull(sum(if(ec.flag='B',1,0)),0) BClientNum,
			   count(0) totalNum, date_format(now(),'%H:%i') now,
				ifnull( sum(if(ec.flag in('A1','A2') and ecf.clientFid is null,1,0)),0) AClientNoFollowNum,
				ifnull(sum(if(ec.flag = 'B' and ecf.clientFid is null,1,0)),0) BClientNoFollowNum,
			   ifnull(sum(if(ecf.clientFid is null,1,0)),0) clientNoFollowNum from erp_clients ec
			left join (
						  SELECT clientFid
							  FROM erp_client_follow ecf
								where ecf.clientFid not in(select statusId from erp_follow_status where type=',SYS,')
							  GROUP BY clientFid
					  ) ecf on ecf.clientFid=ec.clientId
		where ec.clientSea='T'\G

# Query 40: 0.00 QPS, 0.00x concurrency, ID 0x7A6044C4585A6A8C at byte 3794335
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.42
# Time range: 2018-04-18 08:21:27 to 23:31:56
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      22
# Exec time      0     73s      2s      7s      3s      5s      1s      3s
# Lock time      0     2ms    78us   131us   106us   119us    13us   103us
# Rows sent      0     662      16      50   30.09   42.48    8.53   26.08
# Rows examine   0   3.45M 127.00k 203.99k 160.71k 192.13k  24.18k 158.25k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  29.46k   1.34k   1.34k   1.34k   1.33k       0   1.33k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_series_lesson_ref'\G
#    SHOW CREATE TABLE `yimi`.`lvb_series_lesson_ref`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_series'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_series`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
	    ls.seriesId,seriesName,l.lessonId,lessonName,playBegin,playEnd,l.orginalPrice,l.currentPrice,entryLimit,img1,img2,
	    if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
	    WHERE  l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
		(SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount,
		 
			(SELECT IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=165004 AND o.orderType='L' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,
			IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=165004 AND o.orderType='S' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,0))) isPaid,
		 
		(SELECT if(count(1) = (l.entryLimit-l.entryBase),1,0) FROM lvb_order_lesson ol  WHERE ol.lessonId = l.lessonId) as isFull
	FROM
	lvb_series_lesson_ref r
	INNER JOIN lvb_lesson_series ls on r.seriesFid=ls.seriesId
	INNER join lvb_lesson l  on r.lessonFid=l.lessonId
		left join lvb_lesson_ext le on l.lessonId=le.lessonFid
	where
	    r.seriesFid IN (SELECT seriesFid FROM  lvb_series_lesson_ref where lessonFid = '51')
		and l.applyFids  like concat('%,',concat(1,',%'))
		and now() >= l.validBegin
		and now()  <=  l.validEnd
		GROUP BY l.lessonId\G

# Query 41: 0.26 QPS, 0.52x concurrency, ID 0xC4EDC64AF48E3254 at byte 9557882
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.00
# Time range: 2018-04-19 03:05:48 to 03:08:03
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      35
# Exec time      0     70s      2s      2s      2s      2s       0      2s
# Lock time      0     6ms   104us   206us   166us   185us    22us   167us
# Rows sent      0      35       1       1       1       1       0       1
# Rows examine   0  34.04M 995.64k 996.77k 995.81k 961.27k       0 961.27k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  25.50k     746     746     746     746       0     746
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_order_flow'\G
#    SHOW CREATE TABLE `yimi`.`erp_order_flow`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
# EXPLAIN /*!50100 PARTITIONS*/
select count(0) from erp_contract_orders tmpeco
        join (
        select eof.orderFid,eof.orderStatusFid from erp_order_flow eof
        join (select max(flowId) flowId from erp_order_flow where orderStatusFid>0 and createdOn  <  '2018-04-17 18:45:00' GROUP BY orderFid) tmp on tmp.flowId=eof.flowId
        ) tmpeof on tmpeco.contractId=tmpeof.orderFid
        LEFT JOIN (select contractId,sum(courseHours) overHours from erp_lessons where lessonStatus in(1,3,4) and contractId>0 GROUP BY contractId) tmpel on tmpel.contractId=tmpeco.contractId
        where tmpeof.orderStatusFid in(1,2,6) and (orderStatusFid=1 or tmpel.overHours!=tmpeco.realLessonCount)
         
         
        and tmpeco.contractId!=12726 and tmpeco.clientId=249365\G

# Query 44: 0.00 QPS, 0.00x concurrency, ID 0xD8D08DA009DE195E at byte 2056292
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.25
# Time range: 2018-04-18 12:00:12 to 18:46:54
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      20
# Exec time      0     55s      2s      5s      3s      5s   834ms      3s
# Lock time      0     7ms   197us   433us   337us   403us    56us   348us
# Rows sent      0     188       6      10    9.40    9.83    1.46    9.83
# Rows examine   0   9.26M 473.16k 482.18k 474.23k 462.39k       0 462.39k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  53.84k   2.64k   3.11k   2.69k   3.04k  127.05   2.62k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_order_status'\G
#    SHOW CREATE TABLE `yimi`.`erp_order_status`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_learn_report'\G
#    SHOW CREATE TABLE `yimi`.`erp_learn_report`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
         
            CASE WHEN (SELECT COUNT(*) FROM mis_work_order orders
                       WHERE orders.orderFid=o.contractId
                       AND orders.configType='WARN'
                       AND orders.status=1)>0
            THEN 1
            ELSE 0
            END  isOrderWarn,
         
         
		ec.consultantId,
		ec.cooperateConsultantId,
		ec.createdByFid,
		o.`contractId`,
		o.`clientId`,
		c.contractType,
		o.`orderProp`,
		o.`teachProp`,
		o.`orderStatus`,
		o.`realLessonCount`,
		o.`teacherId`,
		o.`teacherName`,
		o.`subjectId`,
		o.`gradeId`,
		o.`createTime`,
		c.`contractNo`,
		u.`userRealName` as chargeName,
		ec.`clientName` realName,
		ec.`clientName` parentRealName,
		ec.`chargeFid`,
		ec.`phoneNo` AS
		parentTel,
		ec.`phoneNo` AS studentTel,
		s.`statusDesc`,
		u.`userOrgFid`,
		u.`userId`,
		tu2.`userOrgFid` as ccUserOrgFid,
		tu2.`userId` as ccUserId,
		CASE
		WHEN
		o.`orderProp` = 1
		THEN '新'
		WHEN o.`orderProp` = 2
		THEN '续'
		WHEN o.`orderProp` = 3
		THEN '扩'
		WHEN o.`orderProp` = 4
		THEN '赠'
		ELSE ''
		END AS orderPropDesc,
		CASE
		WHEN
		o.`teachProp` = 1
		THEN '新签'
		WHEN o.`teachProp` = 2
		THEN '续科'
		WHEN o.`teachProp` = 3
		THEN '赠送'
		ELSE ''
		END AS
		teachPropDesc,
		maxel.startTime AS lessonStartTime,
        (o.`realLessonCount` - ifNUll(maxel.courseHours,0)) AS remainHours,
        IF(elr.orderFid is not null, 1, 0)              hasReport,
		ec.studentId
		FROM erp_contract_orders o
		JOIN erp_contract c ON
		o.`contractFid` = c.`contractId`
		LEFT JOIN erp_clients ec ON
		ec.`clientId` = o.`clientId`
		LEFT JOIN mis_user_info u ON u.`userId` =
		ec.`chargeFid`
		LEFT JOIN mis_user_info tu2 ON tu2.userId =
		ec.consultantId
		LEFT JOIN erp_order_status s ON s.`statusId` =
		o.`orderStatus`
		left join (
                  SELECT DATE_FORMAT(max(l.startTime), '%Y-%m-%d %H:%i') startTime,IFNULL(sum(courseHours),0) courseHours,
                    l.contractId
                 FROM erp_lessons l
                 WHERE l.lessonStatus in (1,3,4) AND l.contractId>0
                 GROUP BY l.contractId
              ) maxel on maxel.contractId=o.contractId
        LEFT JOIN (
            SELECT DISTINCT r.orderFid
                 FROM erp_learn_report r
         )elr on elr.orderFid=o.contractId
		 WHERE o.orderStatus>0
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			and 2=2
				
				
					and ec.chargeFid in (
						
							900001431
						
					)
				
			
			
			
			
			
			
				and not exists (select 1 from user_test ut where ut.userId = ec.studentId and ut.accType = 'STU') 
			 
					ORDER BY o.contractId DESC
				 
		LIMIT 0, 10\G

# Query 45: 0.00 QPS, 0.00x concurrency, ID 0x8FC934C0FB674018 at byte 4069912
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.41
# Time range: 2018-04-18 10:24:06 to 17:25:10
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      12
# Exec time      0     55s      3s      7s      5s      6s      1s      5s
# Lock time      0     4ms   278us   471us   363us   424us    67us   384us
# Rows sent      0      28       1       6    2.33    4.96    1.75    1.96
# Rows examine   0  30.33M   1.87M   2.94M   2.53M   2.88M 490.09k   2.88M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  47.40k   3.95k   3.95k   3.95k   3.95k       0   3.95k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel_cate'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel_cate`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_channel`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_event'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_event`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
			 temp1.cate1,
			 temp1.cate2,
			 temp1.cate3,
			 temp1.cate4,
			 temp1.cate5,
			 temp1.cate1Fid,
			 temp1.cate2Fid,
			 temp1.cate3Fid,
			 temp1.cate4Fid,
			 temp1.cate5Fid,
			 temp1.levelId,
			  
			 		temp2.secondChannelId,
					temp2.secondChannel,
					temp2.firstChannelId,
					temp2.firstChannel,
			 	 
			 temp2.propBFid,
			 sum(temp2.leadsCount) leadsCount,
			 sum(temp2.deadNumberCount) deadNumberCount,
			 sum(temp2.reservationCount) reservationCount,
			 sum(temp2.attendCount) attendCount,
			 sum(temp2.signCount) signCount,
			 sum(temp2.signAmount) signAmount,
			 sum(temp2.leadsToReservation) leadsToReservationAvg,
			 sum(temp2.reservationToAttend) reservationToAttendAvg,
			 sum(temp2.attendToSign) attendToSignAvg,
			 sum(temp2.leadsToSign) leadsToSignAvg
			 from 
			(
				select
					 
					 
				 	 
				 	 
				 	 
				 		5 levelId,
				 		cate1Fid,
				 		cate1,
					 	cate2Fid,
					 	cate2,
					 	cate3Fid,
					 	cate3,
					 	cate4Fid,
					 	cate4,
					 	cateId cate5Fid,
					 	cateName cate5,
				 	 
				 	cateId
				from erp_channel_cate t
				where levelId = 5
				 
				 
				 
				 
				 and cateId = 581 
			)temp1
			left join (
				select  
					c.cateFid,
					c.id secondChannelId,
					c.name secondChannel,
					c.propBFid,
					c1.id firstChannelId,
					c1.name firstChannel,
					ifnull(leadsCount,0) leadsCount,
					ifnull(deadNumberCount,0) deadNumberCount,
					ifnull(reservationCount,0) reservationCount,
					ifnull(attendCount,0) attendCount,
					ifnull(signCount,0) signCount,
					ifnull(signAmount,0) signAmount,
					ifnull(leadsToReservation,0) leadsToReservation,
					ifnull(reservationToAttend,0) reservationToAttend,
					ifnull(attendToSign,0) attendToSign,
					ifnull(leadsToSign,0) leadsToSign
				from 
				erp_channel c
				join erp_channel c1 on c.pid = c1.id
				join erp_channel_cate ecc on ecc.cateId = c.cateFid
				join (
					select 
						ecc.secondChannelFid,
						ecc.secondChannel,
						ecc.firstChannelFid,
						ecc.firstChannel,
						count(ec.clientId) leadsCount,
						sum(ce.isDeadNumber) deadNumberCount,
						count(reservation.clientFid) reservationCount,
						count(attend.clientFid) attendCount,
						count(sign.clientFid) signCount,
						sum(ifnull(sign.firstContractAmount,0)) signAmount,
						sum(ifnull(dateDiff(reservation.applicationTime,reservation.createTime),0)) leadsToReservation,
						sum(ifnull(dateDiff(attend.attendTime ,attend.applicationTime),0)) reservationToAttend,
						sum(ifnull(dateDiff(sign.firstContractPayTime ,sign.attendTime),0)) attendToSign,
						sum(ifnull(dateDiff(sign.firstContractPayTime ,sign.createTime),0)) leadsToSign
					 from 
						 
						(
							SELECT 
								erp_client_channel.* 
							FROM 
								erp_client_channel 
							JOIN
								(SELECT 
									clientFid,MAX(id) id 
								FROM 
									erp_client_channel
								where 
									isSettle = 1
								group by clientFid) temp
							ON 
								temp.clientFid=erp_client_channel.clientFid AND erp_client_channel.id=temp.id						
						) ecc
						join erp_clients ec on ecc.clientFid = ec.clientId
						join erp_client_event ce on ce.clientFid = ec.clientId
						left join erp_client_event reservation 
							on ce.clientFid = reservation.clientFid 
							and reservation.applicationFid>0 
							 
						left join erp_client_event attend
							on ce.clientFid = attend.clientFid
							and attend.attendLessonFid>0 
							 
						left join erp_client_event sign
							on ce.clientFid = sign.clientFid
							and sign.firstContractFid>0
							 
					where date(ce.createTime) between '2016-01-01' and '2018-04-18' 
							
							and not exists (
								select 1 from user_test ut where ec.studentId = ut.userId and ut.accType = 'STU'
							)
							 
					group by ecc.secondChannelFid
				) temp on c.id = temp.secondChannelFid
				  
			)temp2 on temp1.cateId = temp2.cateFid
			 
			
			 
			 
			 
			 
			 
			 group by temp2.secondChannelId  order by temp2.secondChannelId asc\G

# Query 46: 0.00 QPS, 0.00x concurrency, ID 0xA84D5981B9D05DD8 at byte 1412451
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.14
# Time range: 2018-04-18 09:55:57 to 16:07:08
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      13
# Exec time      0     54s      3s      5s      4s      5s   751ms      4s
# Lock time      0   920us    47us    95us    70us    89us    15us    73us
# Rows sent      0      13       1       1       1       1       0       1
# Rows examine   0  74.87M   5.73M   5.78M   5.76M   5.71M       0   5.71M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0   2.24k     170     186  176.15  183.58       8  166.51
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'free_lesson'\G
#    SHOW CREATE TABLE `yimi`.`free_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
				count(0)
			FROM
			free_lesson fl
			 WHERE  EXISTS(select 1 from erp_channel where ufrom>0 and (freeSource=ufrom or ufrom=id) and name like '%都市快报%')\G

# Query 47: 0.00 QPS, 0.00x concurrency, ID 0x7146E02EEE59AD24 at byte 2059250
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.20
# Time range: 2018-04-18 10:30:07 to 19:50:09
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      19
# Exec time      0     53s      2s      5s      3s      5s   742ms      2s
# Lock time      0     4ms   130us   240us   184us   236us    32us   176us
# Rows sent      0      19       1       1       1       1       0       1
# Rows examine   0   8.79M 473.02k 475.23k 473.61k 462.39k       0 462.39k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  21.34k   1.10k   1.56k   1.12k   1.09k  101.49   1.09k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_learn_report'\G
#    SHOW CREATE TABLE `yimi`.`erp_learn_report`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
			count(1)
		FROM erp_contract_orders o
		JOIN erp_contract c ON
		o.`contractFid` = c.`contractId`
		LEFT JOIN erp_clients ec ON
		ec.`clientId` = o.`clientId`
		LEFT JOIN mis_user_info u ON u.`userId` =
		ec.`chargeFid`
		LEFT JOIN mis_user_info tu2 ON tu2.userId =
		ec.consultantId
		left join (
                  SELECT DATE_FORMAT(max(l.startTime), '%Y-%m-%d %H:%i') startTime,IFNULL(sum(courseHours),0) courseHours,
                    l.contractId
                 FROM erp_lessons l
                 WHERE l.lessonStatus in (1,3,4) AND l.contractId>0
                 GROUP BY l.contractId
              ) maxel on maxel.contractId=o.contractId
        LEFT JOIN (
            SELECT DISTINCT r.orderFid
            FROM erp_learn_report r
         )elr on elr.orderFid=o.contractId
		 WHERE o.orderStatus>0
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			and 2=2
				
				
					and ec.chargeFid in (
						
							900001431
						
					)
				
			
			
			
			
			
			
				and not exists (select 1 from user_test ut where ut.userId = ec.studentId and ut.accType = 'STU')\G

# Query 48: 0.00 QPS, 0.00x concurrency, ID 0xF5FEACC32429CC03 at byte 2318049
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.46
# Time range: 2018-04-18 10:25:51 to 21:45:28
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      15
# Exec time      0     51s      2s      5s      3s      5s      1s      3s
# Lock time      0     5ms    50us   406us   301us   384us   123us   357us
# Rows sent      0     131       2      10    8.73    9.83    2.35    9.83
# Rows examine   0  15.75M 353.43k   2.64M   1.05M   2.62M 991.84k 409.41k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  48.87k   3.26k   3.26k   3.26k   3.19k       0   3.19k
# String:
# Databases    yimi
# Hosts        10.28.143.117 (4/26%), 10.81.244.3 (4/26%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'server_trail_and_voice'\G
#    SHOW CREATE TABLE `yimi`.`server_trail_and_voice`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,
        l.teacherId,
        l.lessonType,
        l.courseHours,
        date_format(l.startTime,'%Y-%m-%d %H:%i') AS startTime,
        date_format(l.endTime,'%Y-%m-%d %H:%i') AS endTime,
        (case ec.clientName when '' then tui.realName else ec.clientName end) studentName,
        s.subjectName,
        g.gradeName,
        l.lessonStatus,
         timestampdiff(second,now(),l.startTime) remaining,
         timestampdiff(second,l.startTime,l.endTime) lessonSecondCount,
         cast(pre.configValue as signed)*60 beforeSecond,
         cast(aft.configValue as signed)*60 afterSecond,
        if(exists(select 1 from server_trail_and_voice where status=1 and lessonID=l.lessonId),1,0) hasRecord,
        if(exists(select 1 from erp_lesson_docs where parentId=0 and docType=1 and lessonId=l.lessonId),1,0) hasDoc,
        "" AS title,
        "" AS keywords,
        case l.studentAppraiseType when 0 then '未评价' when 1 then '好评' when 2 then '中评' when 3 then '差评' end
        studentAppraiseType,
        studentAppraises
        FROM mis_user_info u
        LEFT JOIN erp_clients ec ON u.userId = ec.chargeFid
        LEFT JOIN mis_user_info u1 ON u1.userId = ec.consultantId
        LEFT JOIN mis_user_info u2 ON u2.userId = ec.cooperateConsultantId
        INNER JOIN erp_lessons l ON ec.studentId = l.studentId
        INNER JOIN t_user_info tui on tui.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
         INNER JOIN www_config pre on pre.configId=1
         INNER JOIN www_config aft on aft.configId=2
        WHERE
       	l.lessonStatus = 1 and
        ((u.userOrgFid IN
         (  
            3080100
         ) 
         
            and ec.chargeFid = 900001518
         
        )
        OR (CASE WHEN ec.consultantId!= ec.chargeFid THEN
        u1.userOrgFid IN
         (  
            3080100
         ) 
         
            and ec.consultantId = 900001518
         
        END)
        OR (u2.userOrgFid IN
         (  
            3080100
         ) 
         
            AND ec.cooperateConsultantId = 900001518
         
        ))
         
         
        	and l.subjectId in
	         (  
	            0
	         , 
	            1
	         , 
	            2
	         , 
	            3
	         , 
	            4
	         , 
	            5
	         , 
	            6
	         , 
	            7
	         , 
	            8
	         , 
	            9
	         , 
	            13
	         , 
	            16
	         ) 
         
         
        	and l.gradeId in
	         (  
	            130
	         , 
	            140
	         , 
	            150
	         , 
	            160
	         , 
	            170
	         , 
	            210
	         , 
	            220
	         , 
	            230
	         , 
	            240
	         , 
	            310
	         , 
	            320
	         , 
	            330
	         , 
	            410
	         ) 
         
         
         
         
		 
         
         
        ORDER BY l.lessonStatus,
        CASE WHEN l.lessonStatus in(0) THEN
        l.startTime END,
        CASE WHEN l.lessonStatus in(1) THEN
        l.startTime END desc
        limit 0, 10\G

# Query 50: 0.00 QPS, 0.00x concurrency, ID 0x7DCA8A8076898D63 at byte 3730810
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.13
# Time range: 2018-04-18 10:50:14 to 21:00:03
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      18
# Exec time      0     48s      2s      4s      3s      4s   582ms      3s
# Lock time      0     7ms   313us   397us   363us   384us    24us   348us
# Rows sent      0      58       1      10    3.22    9.83    2.70    1.96
# Rows examine   0   8.33M 473.20k 474.01k 473.62k 462.39k       0 462.39k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  48.67k   2.70k   2.71k   2.70k   2.62k       0   2.62k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_work_order'\G
#    SHOW CREATE TABLE `yimi`.`mis_work_order`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_order_status'\G
#    SHOW CREATE TABLE `yimi`.`erp_order_status`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_learn_report'\G
#    SHOW CREATE TABLE `yimi`.`erp_learn_report`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
         
            CASE WHEN (SELECT COUNT(*) FROM mis_work_order orders
                       WHERE orders.orderFid=o.contractId
                       AND orders.configType='WARN'
                       AND orders.status=1)>0
            THEN 1
            ELSE 0
            END  isOrderWarn,
         
         
		ec.consultantId,
		ec.cooperateConsultantId,
		ec.createdByFid,
		o.`contractId`,
		o.`clientId`,
		c.contractType,
		o.`orderProp`,
		o.`teachProp`,
		o.`orderStatus`,
		o.`realLessonCount`,
		o.`teacherId`,
		o.`teacherName`,
		o.`subjectId`,
		o.`gradeId`,
		o.`createTime`,
		c.`contractNo`,
		u.`userRealName` as chargeName,
		ec.`clientName` realName,
		ec.`clientName` parentRealName,
		ec.`chargeFid`,
		ec.`phoneNo` AS
		parentTel,
		ec.`phoneNo` AS studentTel,
		s.`statusDesc`,
		u.`userOrgFid`,
		u.`userId`,
		tu2.`userOrgFid` as ccUserOrgFid,
		tu2.`userId` as ccUserId,
		CASE
		WHEN
		o.`orderProp` = 1
		THEN '新'
		WHEN o.`orderProp` = 2
		THEN '续'
		WHEN o.`orderProp` = 3
		THEN '扩'
		WHEN o.`orderProp` = 4
		THEN '赠'
		ELSE ''
		END AS orderPropDesc,
		CASE
		WHEN
		o.`teachProp` = 1
		THEN '新签'
		WHEN o.`teachProp` = 2
		THEN '续科'
		WHEN o.`teachProp` = 3
		THEN '赠送'
		ELSE ''
		END AS
		teachPropDesc,
		maxel.startTime AS lessonStartTime,
        (o.`realLessonCount` - ifNUll(maxel.courseHours,0)) AS remainHours,
        IF(elr.orderFid is not null, 1, 0)              hasReport,
		ec.studentId
		FROM erp_contract_orders o
		JOIN erp_contract c ON
		o.`contractFid` = c.`contractId`
		LEFT JOIN erp_clients ec ON
		ec.`clientId` = o.`clientId`
		LEFT JOIN mis_user_info u ON u.`userId` =
		ec.`chargeFid`
		LEFT JOIN mis_user_info tu2 ON tu2.userId =
		ec.consultantId
		LEFT JOIN erp_order_status s ON s.`statusId` =
		o.`orderStatus`
		left join (
                  SELECT DATE_FORMAT(max(l.startTime), '%Y-%m-%d %H:%i') startTime,IFNULL(sum(courseHours),0) courseHours,
                    l.contractId
                 FROM erp_lessons l
                 WHERE l.lessonStatus in (1,3,4) AND l.contractId>0
                 GROUP BY l.contractId
              ) maxel on maxel.contractId=o.contractId
        LEFT JOIN (
            SELECT DISTINCT r.orderFid
                 FROM erp_learn_report r
         )elr on elr.orderFid=o.contractId
		 WHERE o.orderStatus>0
			
			
			
			
			
			
			
			
			
			
				AND ec.clientName like
				CONCAT('%','叶','%')
			
			
			
			
			
			
			
			
			
			
			
			
			and 2=2
				
				
					and ec.chargeFid in (
						
							900001440
						
					)
				
			
			
			
			
			
			
				and not exists (select 1 from user_test ut where ut.userId = ec.studentId and ut.accType = 'STU') 
			 
					ORDER BY o.contractId DESC
				 
		LIMIT 0, 10\G

# Query 51: 0.00 QPS, 0.00x concurrency, ID 0xB66AF273D4CC2576 at byte 3849953
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.10
# Time range: 2018-04-18 09:12:07 to 21:04:49
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      21
# Exec time      0     48s      2s      4s      2s      2s   469ms      2s
# Lock time      0     3ms    95us   176us   126us   144us    18us   119us
# Rows sent      0      47       0      10    2.24    9.83    3.12    0.99
# Rows examine   0  17.78M 866.80k 867.97k 867.17k 830.38k       0 830.38k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  11.82k     574     586  576.14  563.87       0  563.87
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
# EXPLAIN /*!50100 PARTITIONS*/
select l.lessonId,if(contractId>0,'订单课','试听课')
		lessonType,concat(DATE_FORMAT(l.startTime, '%Y-%m-%d %k:%i'),'-',DATE_FORMAT(l.endTime, '%k:%i')) lessonTime
		,tu.userRealName teacherName,c.clientName studentName, l.lessonStatus
		from erp_lessons l
		join mis_user_info tu on tu.userId=l.teacherId
		join erp_clients c on c.clientId=l.clientId
		where
		tu.userId=l.teacherId
		and c.clientId=l.clientId
		and date(l.startTime) <= date(now())
		and (l.lessonId='郑宇轩' or c.clientName='郑宇轩' or tu.userRealName='郑宇轩')
		order by l.startTime desc limit 10\G

# Query 53: 0.00 QPS, 0.00x concurrency, ID 0xBC6AD8511E5DCBAA at byte 6209085
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.08
# Time range: 2018-04-18 16:16:00 to 19:30:33
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      16
# Exec time      0     47s      2s      4s      3s      4s   500ms      3s
# Lock time      0     6ms    62us   399us   346us   384us    74us   348us
# Rows sent      0     160      10      10      10      10       0      10
# Rows examine   0   1.93M  83.91k 130.94k 123.68k 130.04k  11.26k 117.95k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  38.89k   2.43k   2.43k   2.43k   2.43k       0   2.43k
# String:
# Databases    yimi
# Hosts        10.28.143.117 (5/31%), 10.81.244.3 (4/25%)... 4 more
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'server_trail_and_voice'\G
#    SHOW CREATE TABLE `yimi`.`server_trail_and_voice`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lesson_docs'\G
#    SHOW CREATE TABLE `yimi`.`erp_lesson_docs`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'www_config'\G
#    SHOW CREATE TABLE `yimi`.`www_config`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
        l.lessonId,
        l.teacherId,
        l.lessonType,
        l.courseHours,
        date_format(l.startTime,'%Y-%m-%d %H:%i') AS startTime,
        date_format(l.endTime,'%Y-%m-%d %H:%i') AS endTime,
        (case ec.clientName when '' then tui.realName else ec.clientName end) studentName,
        s.subjectName,
        g.gradeName,
        l.lessonStatus,
        timestampdiff(second,now(),l.startTime) remaining,
        timestampdiff(second,l.startTime,l.endTime) lessonSecondCount,
        cast(pre.configValue as signed)*60 beforeSecond,
        cast(aft.configValue as signed)*60 afterSecond,
        if(exists(select 1 from server_trail_and_voice where status=1 and lessonID=l.lessonId),1,0) hasRecord,
        if(exists(select 1 from erp_lesson_docs where parentId=0 and docType=1 and lessonId=l.lessonId),1,0) hasDoc,
        "" AS title,
        "" AS keywords,
        case l.studentAppraiseType when 0 then '未评价' when 1 then '好评' when 2 then '中评' when 3 then '差评' end
        studentAppraiseType,
        studentAppraises
        FROM mis_user_info u
        LEFT JOIN erp_clients ec ON u.userId = ec.chargeFid
        LEFT JOIN mis_user_info u1 ON u1.userId = ec.consultantId
        LEFT JOIN mis_user_info u2 ON u2.userId = ec.cooperateConsultantId
        INNER JOIN erp_lessons l ON ec.studentId = l.studentId
        INNER JOIN t_user_info tui on tui.id = l.studentId
        INNER JOIN erp_conf_course_subjects s ON l.subjectId = s.subjectId
        LEFT JOIN erp_conf_student_grades g ON l.gradeId = g.gradeId
        INNER JOIN www_config pre on pre.configId=1
        INNER JOIN www_config aft on aft.configId=2
        WHERE
        ((u.userOrgFid IN
         (  
            6040100
         ) 
         
            and ec.chargeFid = 900001484
         
        )
        OR (CASE WHEN ec.consultantId!= ec.chargeFid THEN
        u1.userOrgFid IN
         (  
            6040100
         ) 
         
            and ec.consultantId = 900001484
         
        END)
        OR (u2.userOrgFid IN
         (  
            6040100
         ) 
         
            AND ec.cooperateConsultantId = 900001484
         
        ))
         
         
         
            AND l.startTime >= '2018-04-11'
         
         
         
        ORDER BY l.lessonStatus,
        CASE WHEN l.lessonStatus in(0) THEN
        l.startTime END,
        CASE WHEN l.lessonStatus in(1) THEN
        l.startTime END desc
        limit 0, 10\G

# Query 56: 0.00 QPS, 0.00x concurrency, ID 0x2E7AC79FAFA8B5C7 at byte 5453294
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.10
# Time range: 2018-04-18 12:00:13 to 21:00:05
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      16
# Exec time      0     42s      2s      4s      3s      4s   528ms      2s
# Lock time      0    14ms   186us    11ms   906us   260us     3ms   204us
# Rows sent      0      16       1       1       1       1       0       1
# Rows examine   0   7.40M 473.17k 473.99k 473.61k 462.39k       0 462.39k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  18.52k   1.15k   1.16k   1.16k   1.14k       0   1.14k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract_orders'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract_orders`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_contract'\G
#    SHOW CREATE TABLE `yimi`.`erp_contract`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_learn_report'\G
#    SHOW CREATE TABLE `yimi`.`erp_learn_report`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
			count(1)
		FROM erp_contract_orders o
		JOIN erp_contract c ON
		o.`contractFid` = c.`contractId`
		LEFT JOIN erp_clients ec ON
		ec.`clientId` = o.`clientId`
		LEFT JOIN mis_user_info u ON u.`userId` =
		ec.`chargeFid`
		LEFT JOIN mis_user_info tu2 ON tu2.userId =
		ec.consultantId
		left join (
                  SELECT DATE_FORMAT(max(l.startTime), '%Y-%m-%d %H:%i') startTime,IFNULL(sum(courseHours),0) courseHours,
                    l.contractId
                 FROM erp_lessons l
                 WHERE l.lessonStatus in (1,3,4) AND l.contractId>0
                 GROUP BY l.contractId
              ) maxel on maxel.contractId=o.contractId
        LEFT JOIN (
            SELECT DISTINCT r.orderFid
            FROM erp_learn_report r
         )elr on elr.orderFid=o.contractId
		 WHERE o.orderStatus>0
			
			
			
			
			
			
			
			
			
			
				AND ec.clientName like
				CONCAT('%','李盈杰','%')
			
			
			
			
			
			
			
			
			
			
			
			
			and 2=2
				
				
					and ec.chargeFid in (
						
							900001079
						
					)
				
			
			
			
			
			
			
				and not exists (select 1 from user_test ut where ut.userId = ec.studentId and ut.accType = 'STU')\G

# Query 58: 0.00 QPS, 0.00x concurrency, ID 0x9F41075C48CFAA92 at byte 2157220
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.01
# Time range: 2018-04-18 10:55:09 to 19:29:22
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      17
# Exec time      0     39s      2s      3s      2s      3s   178ms      2s
# Lock time      0     2ms    46us   258us   143us   236us    79us   163us
# Rows sent      0     294       0      61   17.29   34.95   12.99   13.83
# Rows examine   0  10.70M 321.97k 705.63k 644.70k 683.15k  95.31k 683.15k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  25.73k   1.44k   2.47k   1.51k   1.46k  237.69   1.39k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        erpuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 't_user_info'\G
#    SHOW CREATE TABLE `yimi`.`t_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'mis_user_info'\G
#    SHOW CREATE TABLE `yimi`.`mis_user_info`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_student_grades'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_student_grades`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_conf_course_subjects'\G
#    SHOW CREATE TABLE `yimi`.`erp_conf_course_subjects`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lesson_comment'\G
#    SHOW CREATE TABLE `yimi`.`lesson_comment`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_cr'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_cr`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
				l.*,
				
				IFNULL(c.clientName,t.nickName) studentName,
				mui.userRealName teacherName,
				g.gradeName gradeName,
				s.subjectName subjectName,
				o1.userRealName ccName,
				u1.userRealName chargeName,
				u1.userMobile chargePhone,
				stulc.param1 stuParam1,
				stulc.param2 stuParam2,
				stulc.param3 stuParam3,
				stulc.param4 stuParam4,
				tealc.param1 teaParam1,
				tealc.param2 teaParam2,
				tealc.param3 teaParam3,
				c.eduSystem
		FROM erp_lessons l
		LEFT JOIN erp_clients c ON l.clientId=c.clientId
		LEFT JOIN t_user_info t ON l.studentId=t.id
		LEFT JOIN mis_user_info mui ON mui.userId = l.teacherId
		LEFT JOIN erp_conf_student_grades g ON l.gradeId=g.gradeId
		LEFT JOIN erp_conf_course_subjects s ON l.subjectId=s.subjectId
		LEFT JOIN mis_user_info o1 ON o1.userId = c.consultantId
		LEFT JOIN mis_user_info u1 ON u1.userId=c.chargeFid
		LEFT JOIN lesson_comment stulc ON stulc.lessonFid=l.lessonId and stulc.commentBy='STU'
		LEFT JOIN lesson_comment tealc ON tealc.lessonFid=l.lessonId and tealc.commentBy='TEA'
		 WHERE  l.subjectId = 2
			
			
			
			
			
			
			
				
				and (c.clientName like '%贝贝%' OR t.nickName like '%贝贝%')
			
			
			
			
			
			
			
				and (c.consultantId in (				
				 900001075
	           )
				or EXISTS (select distinct 1 from erp_client_cr t1
				where t1.clientFid=l.clientId and t1.endTime is null
				and t1.crFid in (				
				 900001075
	           ))) 
		order by startTime desc limit 0,100\G

# Query 61: 0.00 QPS, 0.00x concurrency, ID 0x6BC7D5D7388C71CF at byte 3130888
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.62
# Time range: 2018-04-18 13:30:02 to 2018-04-19 03:00:01
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      12
# Exec time      0     34s      2s      7s      3s      4s      1s      3s
# Lock time      0   829us    46us   110us    69us    84us    17us    66us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0   7.10M 605.28k 607.98k 606.27k 590.13k       0 590.13k
# Rows affecte  87   1.13M  96.38k  96.63k  96.48k  92.42k       0  92.42k
# Query size     0   2.05k     175     175     175     175       0     175
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'client_data_pool'\G
#    SHOW CREATE TABLE `yimi`.`client_data_pool`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel`\G
update client_data_pool set flag='A1'
        where type='N' and exists(select 1 from erp_channel where erp_channel.id=client_data_pool.secondChannel and erp_channel.flag='A')\G
# Converted for EXPLAIN
# EXPLAIN /*!50100 PARTITIONS*/
select  flag='A1' from client_data_pool where  type='N' and exists(select 1 from erp_channel where erp_channel.id=client_data_pool.secondChannel and erp_channel.flag='A')\G

# Query 66: 0.00 QPS, 0.00x concurrency, ID 0x398D07B3BB5A793E at byte 6754426
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.03
# Time range: 2018-04-18 10:43:49 to 19:55:25
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      13
# Exec time      0     31s      2s      3s      2s      3s   247ms      2s
# Lock time      0   698us    42us    68us    53us    60us     7us    52us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0  10.76M 847.00k 848.33k 847.78k 830.38k    0.02 830.38k
# Rows affecte   0     203       0      62   15.62   36.69   18.82       0
# Query size     0   1.97k     155     155     155     155       0     155
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_teacher_schedule'\G
#    SHOW CREATE TABLE `yimi`.`erp_teacher_schedule`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_lessons'\G
#    SHOW CREATE TABLE `yimi`.`erp_lessons`\G
delete from erp_teacher_schedule WHERE isFree = 1 AND lessonId IN (SELECT l.lessonId FROM erp_lessons l WHERE l.contractId = 22328 AND l.lessonStatus = 0 )\G
# Converted for EXPLAIN
# EXPLAIN /*!50100 PARTITIONS*/
select * from  erp_teacher_schedule WHERE isFree = 1 AND lessonId IN (SELECT l.lessonId FROM erp_lessons l WHERE l.contractId = 22328 AND l.lessonStatus = 0 )\G

# Query 67: 0.00 QPS, 0.01x concurrency, ID 0x1937B21D3A757C2D at byte 506031
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.14
# Time range: 2018-04-18 08:43:02 to 10:23:38
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      11
# Exec time      0     31s      2s      4s      3s      4s   633ms      3s
# Lock time      0     4ms   284us   478us   353us   424us    59us   340us
# Rows sent      0      11       1       1       1       1       0       1
# Rows examine   0  21.19M   1.89M   1.97M   1.93M   1.86M  27.36k   1.86M
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  42.86k   3.90k   3.90k   3.90k   3.90k       0   3.90k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        misuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel_cate'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel_cate`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_channel`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_channel'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_channel`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_clients'\G
#    SHOW CREATE TABLE `yimi`.`erp_clients`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'erp_client_event'\G
#    SHOW CREATE TABLE `yimi`.`erp_client_event`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'user_test'\G
#    SHOW CREATE TABLE `yimi`.`user_test`\G
# EXPLAIN /*!50100 PARTITIONS*/
select
			 temp1.cate1,
			 temp1.cate2,
			 temp1.cate3,
			 temp1.cate4,
			 temp1.cate5,
			 temp1.cate1Fid,
			 temp1.cate2Fid,
			 temp1.cate3Fid,
			 temp1.cate4Fid,
			 temp1.cate5Fid,
			 temp1.levelId,
			  
			 		0 secondChannelId,
					null secondChannel,
					0 firstChannelId,
					null firstChannel,
			 	 
			 temp2.propBFid,
			 sum(temp2.leadsCount) leadsCount,
			 sum(temp2.deadNumberCount) deadNumberCount,
			 sum(temp2.reservationCount) reservationCount,
			 sum(temp2.attendCount) attendCount,
			 sum(temp2.signCount) signCount,
			 sum(temp2.signAmount) signAmount,
			 sum(temp2.leadsToReservation) leadsToReservationAvg,
			 sum(temp2.reservationToAttend) reservationToAttendAvg,
			 sum(temp2.attendToSign) attendToSignAvg,
			 sum(temp2.leadsToSign) leadsToSignAvg
			 from 
			(
				select
					 
						1 levelId,
				 		cate1Fid,
				 		cate1,
					 	0 cate2Fid,
					 	NULL cate2,
					 	0 cate3Fid,
					 	NULL cate3,
					 	0 cate4Fid,
					 	NULL cate4,
					 	0 cate5Fid,
					 	NULL cate5,
				 	 
					 
				 	 
				 	 
				 	 
				 	cateId
				from erp_channel_cate t
				where levelId = 5
				 
				 
				 
				 
				 
			)temp1
			left join (
				select  
					c.cateFid,
					c.id secondChannelId,
					c.name secondChannel,
					c.propBFid,
					c1.id firstChannelId,
					c1.name firstChannel,
					ifnull(leadsCount,0) leadsCount,
					ifnull(deadNumberCount,0) deadNumberCount,
					ifnull(reservationCount,0) reservationCount,
					ifnull(attendCount,0) attendCount,
					ifnull(signCount,0) signCount,
					ifnull(signAmount,0) signAmount,
					ifnull(leadsToReservation,0) leadsToReservation,
					ifnull(reservationToAttend,0) reservationToAttend,
					ifnull(attendToSign,0) attendToSign,
					ifnull(leadsToSign,0) leadsToSign
				from 
				erp_channel c
				join erp_channel c1 on c.pid = c1.id
				join erp_channel_cate ecc on ecc.cateId = c.cateFid
				join (
					select 
						ecc.secondChannelFid,
						ecc.secondChannel,
						ecc.firstChannelFid,
						ecc.firstChannel,
						count(ec.clientId) leadsCount,
						sum(ce.isDeadNumber) deadNumberCount,
						count(reservation.clientFid) reservationCount,
						count(attend.clientFid) attendCount,
						count(sign.clientFid) signCount,
						sum(ifnull(sign.firstContractAmount,0)) signAmount,
						sum(ifnull(dateDiff(reservation.applicationTime,reservation.createTime),0)) leadsToReservation,
						sum(ifnull(dateDiff(attend.attendTime ,attend.applicationTime),0)) reservationToAttend,
						sum(ifnull(dateDiff(sign.firstContractPayTime ,sign.attendTime),0)) attendToSign,
						sum(ifnull(dateDiff(sign.firstContractPayTime ,sign.createTime),0)) leadsToSign
					 from 
						 
						(
							SELECT 
								erp_client_channel.* 
							FROM 
								erp_client_channel 
							JOIN
								(SELECT 
									clientFid,MAX(id) id 
								FROM 
									erp_client_channel
								where 
									isSettle = 1
								group by clientFid) temp
							ON 
								temp.clientFid=erp_client_channel.clientFid AND erp_client_channel.id=temp.id						
						) ecc
						join erp_clients ec on ecc.clientFid = ec.clientId
						join erp_client_event ce on ce.clientFid = ec.clientId
						left join erp_client_event reservation 
							on ce.clientFid = reservation.clientFid 
							and reservation.applicationFid>0 
							 
						left join erp_client_event attend
							on ce.clientFid = attend.clientFid
							and attend.attendLessonFid>0 
							 
						left join erp_client_event sign
							on ce.clientFid = sign.clientFid
							and sign.firstContractFid>0
							 
					where date(ce.createTime) between '2018-04-02' and '2018-04-29' 
							
							and not exists (
								select 1 from user_test ut where ec.studentId = ut.userId and ut.accType = 'STU'
							)
							 
					group by ecc.secondChannelFid
				) temp on c.id = temp.secondChannelFid
				  
			)temp2 on temp1.cateId = temp2.cateFid
			 
			
			 group by temp1.cate1Fid  order by temp1.cate1Fid asc\G

# Query 69: 0.00 QPS, 0.00x concurrency, ID 0xF928383DFAECA667 at byte 7828870
# This item is included in the report because it matches --outliers.
# Scores: V/M = 0.22
# Time range: 2018-04-18 08:27:50 to 23:17:34
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      10
# Exec time      0     27s      2s      4s      3s      4s   775ms      2s
# Lock time      0     1ms    88us   295us   137us   236us    65us   113us
# Rows sent      0     235      14      30   23.50   24.84    4.48   24.84
# Rows examine   0  14.19M 126.69k   8.92M   1.42M   4.06M   2.75M 136.54k
# Rows affecte   0       0       0       0       0       0       0       0
# Query size     0  12.26k   1.23k   1.23k   1.23k   1.23k       0   1.23k
# String:
# Databases    yimi
# Hosts        10.117.41.91
# Users        wwwuser
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_video'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_video`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_order'\G
#    SHOW CREATE TABLE `yimi`.`lvb_order`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_series'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_series`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_series_lesson_ref'\G
#    SHOW CREATE TABLE `yimi`.`lvb_series_lesson_ref`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson`\G
#    SHOW TABLE STATUS FROM `yimi` LIKE 'lvb_lesson_ext'\G
#    SHOW CREATE TABLE `yimi`.`lvb_lesson_ext`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT
		l.lessonId,lessonName,playBegin,playEnd,l.orginalPrice,l.currentPrice,entryLimit,img1,img2,r.refNum,
		if(now()  <=  playBegin ,0,if(streamIsClosed=0,1,if((SELECT COUNT(1) FROM lvb_lesson_video v
		WHERE  l.lessonId = v.lessonFid AND v.videoUrl IS NOT NULL)>0,3,2))) as status,
		(SELECT count(1) FROM lvb_order_lesson ol WHERE ol.lessonId = l.lessonId) +l.entryBase as paycount,
		 
			(SELECT IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=167994 AND o.orderType='L' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,
			IF((SELECT COUNT(1) FROM lvb_order o INNER JOIN lvb_order_lesson ol ON o.orderId=ol.orderFid WHERE o.studentFid=167994 AND o.orderType='S' AND ol.lessonId=l.lessonId AND o.isPaid=1)>0,1,0))) isPaid,
		 
		(SELECT if(count(1) =(l.entryLimit-l.entryBase),1,0) FROM lvb_order_lesson ol  WHERE ol.lessonId = l.lessonId) as isFull
		FROM
		lvb_lesson_series ls
		INNER join lvb_series_lesson_ref r on ls.seriesId=r.seriesFid
		INNER join lvb_lesson l  on r.lessonFid=l.lessonId
		left join lvb_lesson_ext le on l.lessonId=le.lessonFid
		where
		ls.seriesId = '121'
		and l.applyFids  like concat('%,',concat(1,',%'))
		and now() >= l.validBegin
		group by l.lessonId\G
